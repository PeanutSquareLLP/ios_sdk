NSString * const __jsext_base64_autogen = @"dmFyIGRlZmF1bHRIYW5kbGVyID0gewogICAgZ2V0OiBmdW5jdGlvbihvYmosIHByb3BOYW1lKSB7IHJldHVybiBvYmpbcHJvcE5hbWVdOyB9LAogICAgc2V0OiBmdW5jdGlvbihvYmosIHByb3BOYW1lLCB2YWwpIHsgb2JqW3Byb3BOYW1lXSA9IHZhbDsgfQp9OwoKdmFyIFByb3h5ID0gZnVuY3Rpb24odGFyZ2V0LCBoYW5kbGVyKSB7CiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDsKICAgIHRoaXMuaGFuZGxlciA9IGhhbmRsZXI7CiAgICB0aGlzLmhhbmRsZXIuZ2V0ID0gdGhpcy5oYW5kbGVyLmdldCB8fCBkZWZhdWx0SGFuZGxlci5nZXQ7CiAgICB0aGlzLmhhbmRsZXIuc2V0ID0gdGhpcy5oYW5kbGVyLnNldCB8fCBkZWZhdWx0SGFuZGxlci5zZXQ7Cn07CgpQcm94eS5wcm90b3R5cGUuZ2V0VHJhcCA9IGZ1bmN0aW9uKHByb3BlcnR5TmFtZSkgewogICAgcmV0dXJuIHRoaXMuaGFuZGxlci5nZXQodGhpcy50YXJnZXQsIHByb3BlcnR5TmFtZSk7Cn07CgpQcm94eS5wcm90b3R5cGUuc2V0VHJhcCA9IGZ1bmN0aW9uKHByb3BlcnR5TmFtZSwgdmFsdWUpIHsKICAgIHRoaXMuaGFuZGxlci5zZXQodGhpcy50YXJnZXQsIHByb3BlcnR5TmFtZSwgdmFsdWUpOwp9OwoKZnVuY3Rpb24gZ2xvYmFsR2V0SW50ZXJjZXB0b3Iob2JqZWN0LCBwcm9wZXJ0eU5hbWUpIHsKICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBQcm94eSkgewogICAgICAgIHJldHVybiBvYmplY3QuZ2V0VHJhcChwcm9wZXJ0eU5hbWUpOwogICAgfQogICAgdmFyIHZhbHVlID0gZGVmYXVsdEhhbmRsZXIuZ2V0KG9iamVjdCwgcHJvcGVydHlOYW1lKTsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICByZXR1cm4gdmFsdWUuYmluZChvYmplY3QpCiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB2YWx1ZQogICAgfQp9CgpmdW5jdGlvbiBnbG9iYWxTZXRJbnRlcmNlcHRvcihvYmplY3QsIHByb3BlcnR5TmFtZSwgdmFsdWUpIHsKICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBQcm94eSkgewogICAgICAgIHJldHVybiBvYmplY3Quc2V0VHJhcChwcm9wZXJ0eU5hbWUsIHZhbHVlKTsKICAgIH0KICAgIGRlZmF1bHRIYW5kbGVyLnNldChwcm9wZXJ0eU5hbWUsIHZhbHVlKTsKfQoKLy8gVGhpcyBmaWxlIHdhcyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZDsgRE8gTk9UIEVESVQuCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKQ29weXJpZ2h0IChjKSAyMDExIFRoZSBNb3ppbGxhIEZvdW5kYXRpb24uCkFsbCByaWdodHMgcmVzZXJ2ZWQuCgpSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZQptZXQ6CgogICAgUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KCiAgICBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodAogICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZQogICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KClRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTCklTIiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRApUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEKUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUCkhPTERFUiBPUiBDT05UUklCVVRPUlMgQkUgTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwKU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEClRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IKUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORwpORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMKU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAqIHNyYy9sb29zZS5qcwogICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAvL0BsaW5lIDEgInNyYy9sb29zZS5qcyIKICAgIC8vIFRoaXMgZmlsZSBob2xkcyBhbnkgZG9tLmpzIGNvZGUgdGhhdCB3b24ndCB3b3JrIGluIHN0cmljdCBtb2RlCgogICAgLy8KICAgIC8vIFRoaXMgaXMgYSBzaW1wbGUgY2xhc3MgdXNlZCBpbiBzcmMvaW1wbC9IVE1MRXZlbnQuanMgYW5kIGVsc2V3aGVyZSBmb3IKICAgIC8vIGNvbnZlcnRpbmcgYW4gSFRNTCBldmVudCBoYW5kbGVyIGNvbnRlbnQgYXR0cmlidXRlIGludG8gYSBmdW5jdGlvbiB3aXRoCiAgICAvLyBhIHNwZWNpYWwgc2NvcGUgY2hhaW4uICBJdCB1c2VzIHdpdGgsIHNvIGl0IGNhbid0IGJlIGluIHN0cmljdCBtb2RlLgogICAgLy8KICAgIC8vIFRoaXMgaXMgYSBjbGFzcyB3aXRoIGEgYnVpbGQoKSBtZXRob2QgaW5zdGVhZCBvZiBhIHNpbXBsZSBmdW5jdGlvbiBiZWNhdXNlCiAgICAvLyBpbnNpZGUgb2Ygd2l0aCBzdGF0ZW1lbnRzIGl0IGlzIGhhcmQgdG8gcmVmZXIgdG8gdGhlIGZ1bmN0aW9uIGFyZ3VtZW50cy4KICAgIC8vIEJ5IHVzaW5nIHRoaXMgY2xhc3MtYmFzZWQgZGVzaWduLCBJIGNhbiByZWZlciB0byB0aGVtIGFzIHByb3BlcnRpZXMgb2YgdGhpcy4KICAgIC8vCiAgICAvLyBUaGUgYm9keSBhcmd1bWVudCBpcyBhIHN0cmluZyBvZiBqcyBjb2RlIHRoYXQgYmVjb21lcyB0aGUgYm9keSBvZiB0aGUKICAgIC8vIGV2ZW50IGhhbmRsZXIgZnVuY3Rpb24uCiAgICAvLwogICAgLy8gVGhlIGRvY3VtZW50LCBmb3JtLCBhbmQgZWxlbWVudCBhcmd1bWVudHMgdG8gdGhlIGNvbnN0cnVjdG9yIG11c3QgYmUKICAgIC8vIHdyYXBwZXIgb2JqZWN0cywgbm90IGltcGwgb2JqZWN0cy4gIE5vdGUgdGhhdCB3ZSBjYW4ndCBjYWxsIHdyYXAgZnJvbQogICAgLy8gdGhpcyBmaWxlLCBzbyB0aGV5IG11c3QgYmUgcGFzc2VkIGluIHdyYXBwZWQuCiAgICAvLwoKICAgIGZ1bmN0aW9uIEV2ZW50SGFuZGxlckJ1aWxkZXIoYm9keSwgZG9jdW1lbnQsIGZvcm0sIGVsZW1lbnQpIHsKICAgICAgICB0aGlzLmJvZHkgPSBib2R5OwogICAgICAgIHRoaXMuZG9jdW1lbnQgPSBkb2N1bWVudDsKICAgICAgICB0aGlzLmZvcm0gPSBmb3JtOwogICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7CiAgICB9CgogICAgRXZlbnRIYW5kbGVyQnVpbGRlci5wcm90b3R5cGUuYnVpbGQgPSBmdW5jdGlvbiBidWlsZCgpIHsKICAgICAgICB2YXIgZnVuYyA9IG5ldyBGdW5jdGlvbignZXZlbnQnLCB0aGlzLmJvZHkpOwogICAgICAgIHJldHVybiBmdW5jLmJpbmQodGhpcy5kb2N1bWVudC5mb3JtLmVsZW1lbnQpOwogICAgICAgIC8qd2l0aCh0aGlzLmRvY3VtZW50KQogICAgICAgICAgICB3aXRoKHRoaXMuZm9ybSkKICAgICAgICAgICAgICAgIHdpdGgodGhpcy5lbGVtZW50KQogICAgICAgICAgICAgICAgICAgIHJldHVybiBldmFsKCIoZnVuY3Rpb24oZXZlbnQpeyIgKyB0aGlzLmJvZHkgKyAifSkiKTsqLwogICAgfTsKCiAgICAvLyBEZWZpbmUgdGhpcyBoZXJlIHNvIGl0IGlzIG5vdCBpbiBzdHJpY3QgbW9kZQogICAgLy8gQmVjYXVzZSBzdHJpY3QgbW9kZSBldmFsIGNhbid0IGRlZmluZSB2YXJpYWJsZXMuCiAgICBmdW5jdGlvbiBldmFsU2NyaXB0KHMpIHsKICAgICAgICB2YXIgZ2V2YWwgPSBldmFsOyAvLyBEbyBhbiBpbmRpcmVjdCBldmFsIHRvIGdldCBnbG9iYWwgY29udGV4dAogICAgICAgIHMgPSAndHJ5eycgKyBzICsgJ31jYXRjaChlKXt2YXIgbXNnPSJleGNlcHRpb24gd2hpbGUgZXZhbGluZyBzY3JpcHQ6XFxuXFx0IiArIGUubWVzc2FnZSArICJcXG4iICsgZS5zdGFjazsgY29uc29sZS5sb2cobXNnKTsgdGhyb3cgRXJyb3IobXNnKTt9JzsKCiAgICAgICAgZ2V2YWwocyk7CiAgICB9KGZ1bmN0aW9uIChnbG9iYWwpIHsKICAgICAgICAidXNlIHN0cmljdCI7CgogICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgKiAgc3JjL3NuYXBzaG90LmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvc25hcHNob3QuanMiCiAgICAgICAgLyoKICAgICAgICAgKiBXZSB3YW50IHRvIGJlIHN1cmUgdGhhdCB3ZSBvbmx5IHVzZSB0aGUgYnVpbHQtaW4gdmVyc2lvbnMgb2Ygc3RhbmRhcmQKICAgICAgICAgKiBmdW5jdGlvbnMgYW5kIG1ldGhvZHMgbGlrZSBPYmplY3QuY3JlYXRlIGFuZCBBcnJheS5wcm90b3R5cGUucG9wLgogICAgICAgICAqIFNvIGhlcmUgd2UgbWFrZSBzbmFwc2hvdHMgb2YgYWxsIHRoZSBzeXN0ZW0gb2JqZWN0cywgYW5kIHRoZW4gZGVmaW5lCiAgICAgICAgICogdXRpbGl0eSBmdW5jdGlvbnMgdGhhdCB1c2UgdGhlbS4KICAgICAgICAgKgogICAgICAgICAqIEl0IGlzIGFuIGVycm9yIGlmIGFueSBvZiB0aGUgYnVpbHQtaW4gbWV0aG9kcyBhcmUgdXNlZCBhbnl3aGVyZSBlbHNlCiAgICAgICAgICogaW4gZG9tLmpzIGFmdGVyIHRoaXMgaW5pdGlhbCBzbmFwc2hvdC4KICAgICAgICAgKgogICAgICAgICAqIFRoZSB1dGlsaXRpZXMgZGVmaW5lZCBoZXJlIHVzZSBhIGZ1bmN0aW9uYWwgc3ludGF4IHJhdGhlciB0aGFuIHRoZQogICAgICAgICAqIE9PIHN5bnRheCBvZiB0aGUgSlMgYnVpbHRpbnMuICBJbnN0ZWFkIG9mIGEubWFwKGYpLCB3ZSBjYWxsIG1hcChhLCBmKQogICAgICAgICAqIGZvciBleGFtcGxlLgogICAgICAgICAqCiAgICAgICAgICogU2VlIC4uL3Rlc3QvbW9ua2V5LmpzIGZvciBjb2RlIHRoYXQgcGF0Y2hlcyBhbGwgdGhlIGJ1aWx0LWluCiAgICAgICAgICogZnVuY3Rpb25zIGFuZCBtZXRob2RzIHRvIHRlc3Qgd2hldGhlciB3ZSBhdm9pZCB1c2luZyB0aGVtLgogICAgICAgICAqLwoKICAgICAgICBmdW5jdGlvbiBzaGFsbG93X2Zyb3plbl9jb3B5KG8pIHsKICAgICAgICAgICAgdmFyIHIgPSB7fTsKICAgICAgICAgICAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMobykuZm9yRWFjaChmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHIsIG4sIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobywgbikpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5mcmVlemUocik7CiAgICAgICAgfQoKICAgICAgICB2YXIgdW5kZWZpbmVkID0gdm9pZCAwLAoKCiAgICAgICAgLy8gQ29weSB0aGUgb3JpZ2luYWwgc3RhdGUgb2YgY29uc3RydWN0b3IgZnVuY3Rpb25zCiAgICAgICAgLy8gVGhpcyBpcyBub3QgYSBjb21wbGV0ZSBsaXN0LiBJJ3ZlIGxlZnQgb3V0IGVycm9yIHR5cGVzIEknbSB1bmxpa2VseQogICAgICAgIC8vIHRvIGV2ZXIgdGhyb3cuCgogICAgICAgIEFycmF5ID0gZ2xvYmFsLkFycmF5LAogICAgICAgICAgICBCb29sZWFuID0gZ2xvYmFsLkJvb2xlYW4sCiAgICAgICAgICAgIERhdGUgPSBnbG9iYWwuRGF0ZSwKICAgICAgICAgICAgRXJyb3IgPSBnbG9iYWwuRXJyb3IsCiAgICAgICAgICAgIEZ1bmN0aW9uID0gZ2xvYmFsLkZ1bmN0aW9uLAogICAgICAgICAgICBOdW1iZXIgPSBnbG9iYWwuTnVtYmVyLAogICAgICAgICAgICBPYmplY3QgPSBnbG9iYWwuT2JqZWN0LAogICAgICAgICAgICBSYW5nZUVycm9yID0gZ2xvYmFsLlJhbmdlRXJyb3IsCiAgICAgICAgICAgIFJlZ0V4cCA9IGdsb2JhbC5SZWdFeHAsCiAgICAgICAgICAgIFN0cmluZyA9IGdsb2JhbC5TdHJpbmcsCiAgICAgICAgICAgIFR5cGVFcnJvciA9IGdsb2JhbC5UeXBlRXJyb3IsCiAgICAgICAgICAgIFdlYWtNYXAgPSBnbG9iYWwuV2Vha01hcCwKICAgICAgICAgICAgUHJveHkgPSBnbG9iYWwuUHJveHk7CgogICAgICAgIC8vIGNhbGxiaW5kIHBhcmFtZXRlcml6ZXMgdGhlIGJpbmRpbmcgb2YgYHRoaXNgCiAgICAgICAgLy8gW10ubWFwKGNhbGxiYWNrKSAtPiBtYXAoW10sIGNhbGxiYWNrKQogICAgICAgIHZhciBjYWxsYmluZCA9IEZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsLmJpbmQuYmluZChGdW5jdGlvbi5wcm90b3R5cGUuY2FsbCk7CgogICAgICAgIC8vIFN0cmluZyBhbmQgYXJyYXkgZ2VuZXJpY3MgYXJlIG5vdCBkZWZpbmVkIGluIE5vZGUsIHNvIGRlZmluZSB0aGVtIG5vdwogICAgICAgIC8vIGlmIG5lZWRlZAogICAgICAgIGlmICghU3RyaW5nLmluZGV4T2YpIHsKICAgICAgICAgICAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoU3RyaW5nLnByb3RvdHlwZSkuZm9yRWFjaChmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBTdHJpbmcucHJvdG90eXBlW21dICE9PSAiZnVuY3Rpb24iKSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAobSA9PT0gImxlbmd0aCIgfHwgbSA9PT0gImNvbnN0cnVjdG9yIikgcmV0dXJuOwogICAgICAgICAgICAgICAgU3RyaW5nW21dID0gY2FsbGJpbmQoU3RyaW5nLnByb3RvdHlwZVttXSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFBcnJheS5mb3JFYWNoKSB7CiAgICAgICAgICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKEFycmF5LnByb3RvdHlwZSkuZm9yRWFjaChmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBBcnJheS5wcm90b3R5cGVbbV0gIT09ICJmdW5jdGlvbiIpIHJldHVybjsKICAgICAgICAgICAgICAgIGlmIChtID09PSAibGVuZ3RoIiB8fCBtID09PSAiY29uc3RydWN0b3IiKSByZXR1cm47CiAgICAgICAgICAgICAgICBBcnJheVttXSA9IGNhbGxiaW5kKEFycmF5LnByb3RvdHlwZVttXSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyCiAgICAgICAgLy8gU29tZSBnbG9iYWwgZnVuY3Rpb25zLgogICAgICAgIC8vIE5vdGUgdGhhdCBpbiBzdHJpY3QgbW9kZSB3ZSdyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IGlkZW50aWZpZXJzCiAgICAgICAgLy8gbmFtZWQgZXZhbC4gIEJ1dCBpZiB3ZSBnaXZlIGV2YWwgYW55IG90aGVyIG5hbWUgdGhlbiBpdCBkb2VzIGEKICAgICAgICAvLyBnbG9iYWwgZXZhbCBpbnN0ZWFkIG9mIGEgbG9jYWwgZXZhbC4gSSBzaG91bGRuJ3QgZXZlciBuZWVkIHRvIHVzZSBpdCwKICAgICAgICAvLyBzbyBqdXN0IG9taXQgaXQgaGVyZS4KICAgICAgICBwYXJzZUludCA9IGdsb2JhbC5wYXJzZUludCwKICAgICAgICAgICAgcGFyc2VGbG9hdCA9IGdsb2JhbC5wYXJzZUZsb2F0LAogICAgICAgICAgICBpc05hTiA9IGdsb2JhbC5pc05hTiwKICAgICAgICAgICAgaXNGaW5pdGUgPSBnbG9iYWwuaXNGaW5pdGUsCgoKICAgICAgICAvLyBTbmFwc2hvdCBvYmplY3RzIHRoYXQgaG9sZCBhIGxvdCBvZiBzdGF0aWMgbWV0aG9kcwogICAgICAgIC8vIFdlIGFsc28gd2FudCB0byBtYWtlIGEgc25hcHNob3Qgb2YgdGhlIHN0YXRpYyBtZXRob2RzIG9mIE9iamVjdCwgQXJyYXksCiAgICAgICAgLy8gYW5kIFN0cmluZy4gKEZpcmVmb3ggZGVmaW5lcyB1c2VmdWwgIkFycmF5IGdlbmVyaWNzIiBhbmQgIlN0cmluZwogICAgICAgIC8vIGdlbmVyaWNzIiB0aGF0IGFyZSBxdWl0ZSBoZWxwZnVsIHRvIHVzKS4gIFNpbmNlIHdlJ3ZlIGFscmVhZHkgYm91bmQKICAgICAgICAvLyB0aGUgbmFtZXMgT2JqZWN0LCBBcnJheSwgYW5kIFN0cmluZywgd2UgdXNlIE8sIEEsIGFuZCBTIGFzIHNob3J0aGFuZAogICAgICAgIC8vIG5vdGF0aW9uIGZvciB0aGVzZSBmcmVxdWVudGx5LWFjY2Vzc2VkIHNldHMgb2YgbWV0aG9kcy4KICAgICAgICBKU09OID0gc2hhbGxvd19mcm96ZW5fY29weShnbG9iYWwuSlNPTiksCiAgICAgICAgICAgIE1hdGggPSBzaGFsbG93X2Zyb3plbl9jb3B5KGdsb2JhbC5NYXRoKSwKICAgICAgICAgICAgLy9Qcm94eSA9IHNoYWxsb3dfZnJvemVuX2NvcHkoZ2xvYmFsLlByb3h5KSwKICAgICAgICAgICAgTyA9IHNoYWxsb3dfZnJvemVuX2NvcHkoT2JqZWN0KSwKICAgICAgICAgICAgQSA9IHNoYWxsb3dfZnJvemVuX2NvcHkoQXJyYXkpLAogICAgICAgICAgICBTID0gc2hhbGxvd19mcm96ZW5fY29weShTdHJpbmcpLAoKCiAgICAgICAgLy8gQ29weSBzb21lIGluZGl2aWR1YWwgc3RhdGljIG1ldGhvZHMgZnJvbSB0eXBlcyB0aGF0IGRvbid0CiAgICAgICAgLy8gZGVmaW5lIHZlcnkgbWFueS4KICAgICAgICBub3cgPSBEYXRlLm5vdywKCgogICAgICAgIC8vIE5vdGUgdGhhdCBpdCBpcyBuZXZlciBzYWZlIHRvIGludm9rZSBhIG1ldGhvZCBvZiBhIGJ1aWx0LWluCiAgICAgICAgLy8gb2JqZWN0IGV4Y2VwdCBpbiBjb2RlIHRoYXQgaXMgZ29pbmcgdG8gcnVuIHJpZ2h0IG5vdy4gVGhlCiAgICAgICAgLy8gZnVuY3Rpb25zIGRlZmluZWQgYmVsb3cgcHJvdmlkZSBhIHNhZmUgYWx0ZXJuYXRpdmUsIGJ1dCBtYW5kYXRlCiAgICAgICAgLy8gYSBmdW5jdGlvbmFsIHN0eWxlIG9mIHByb2dyYW1taW5nIHJhdGhlciB0aGFuIGFuIE9PIHN0eWxlLgoKICAgICAgICAvLyBGdW5jdGlvbnMKICAgICAgICAvLyBjYWxsKGYsIG8sIGFyZ3MuLi4pCiAgICAgICAgY2FsbCA9IGNhbGxiaW5kKEZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsKSwKCiAgICAgICAgLy8gYXBwbHkoZiwgbywgW2FyZ3NdKQogICAgICAgIGFwcGx5ID0gY2FsbGJpbmQoRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5KSwKCiAgICAgICAgLy8gYmluZChmLCBvKQogICAgICAgIGJpbmQgPSBjYWxsYmluZChGdW5jdGlvbi5wcm90b3R5cGUuYmluZCksCgoKICAgICAgICAvLyBXZWFrTWFwIGZ1bmN0aW9ucwogICAgICAgIHdtZ2V0ID0gY2FsbGJpbmQoV2Vha01hcC5wcm90b3R5cGUuZ2V0KSwKICAgICAgICAgICAgd21zZXQgPSBjYWxsYmluZChXZWFrTWFwLnByb3RvdHlwZS5zZXQpLAoKCiAgICAgICAgLy8gT2JqZWN0IGZ1bmN0aW9ucwogICAgICAgIGhhc093blByb3BlcnR5ID0gY2FsbGJpbmQoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSksCgoKICAgICAgICAvLyBBcnJheSBmdW5jdGlvbnMgYXJlIGFsbCBkZWZpbmVkIGFzIGdlbmVyaWNzIGxpa2UgQS5wb3AsIGJ1dCBpdHMKICAgICAgICAvLyBjb252ZW5pZW50IHRvIGdpdmUgdGhlIG1vc3QgY29tbW9ubHktdXNlZCBvbmVzIHVucXVhbGlmaWVkCiAgICAgICAgLy8gbmFtZXMuICBUaGUgbGVzcy1jb21tb25seSB1c2VkIGZ1bmN0aW9ucyAoYW5kIHRob3NlIHRoYXQgaGF2ZQogICAgICAgIC8vIG5hbWUgY29sbGlzaW9ucyBsaWtlIGluZGV4T2YsIGxhc3RJbmRleE9mIGFuZCBzbGljZSkgY2FuIGJlCiAgICAgICAgLy8gYWNjZXNzZWQgb24gdGhlIEEgb3IgUyBvYmplY3RzLgogICAgICAgIGNvbmNhdCA9IEEuY29uY2F0IHx8IGNhbGxiaW5kKEFycmF5LnByb3RvdHlwZS5jb25jYXQpLAogICAgICAgICAgICBldmVyeSA9IEEuZXZlcnkgfHwgY2FsbGJpbmQoQXJyYXkucHJvdG90eXBlLmV2ZXJ5KSwKCiAgICAgICAgLy8gTm90ZSBsb3dlcmNhc2UgZQogICAgICAgIGZvcmVhY2ggPSBBLmZvckVhY2ggfHwgY2FsbGJpbmQoQXJyYXkucHJvdG90eXBlLmZvckVhY2gpLAogICAgICAgICAgICBpc0FycmF5ID0gQS5pc0FycmF5IHx8IGNhbGxiaW5kKEFycmF5LnByb3RvdHlwZS5pc0FycmF5KSwKICAgICAgICAgICAgam9pbiA9IEEuam9pbiB8fCBjYWxsYmluZChBcnJheS5wcm90b3R5cGUuam9pbiksCiAgICAgICAgICAgIG1hcCA9IEEubWFwIHx8IGNhbGxiaW5kKEFycmF5LnByb3RvdHlwZS5tYXApLAogICAgICAgICAgICBwdXNoID0gQS5wdXNoIHx8IGNhbGxiaW5kKEFycmF5LnByb3RvdHlwZS5wdXNoKSwKICAgICAgICAgICAgcG9wID0gQS5wb3AgfHwgY2FsbGJpbmQoQXJyYXkucHJvdG90eXBlLnBvcCksCiAgICAgICAgICAgIHVuc2hpZnQgPSBBLnVuc2hpZnQgfHwgY2FsbGJpbmQoQXJyYXkucHJvdG90eXBlLnVuc2hpZnQpLAogICAgICAgICAgICByZWR1Y2UgPSBBLnJlZHVjZSB8fCBjYWxsYmluZChBcnJheS5wcm90b3R5cGUucmVkdWNlKSwKICAgICAgICAgICAgc29ydCA9IEEuc29ydCB8fCBjYWxsYmluZChBcnJheS5wcm90b3R5cGUuc29ydCksCiAgICAgICAgICAgIGZpbHRlciA9IEEuZmlsdGVyIHx8IGNhbGxiaW5kKEFycmF5LnByb3RvdHlwZS5maWx0ZXIpLAogICAgICAgICAgICBzcGxpY2UgPSBBLnNwbGljZSB8fCBjYWxsYmluZChBcnJheS5wcm90b3R5cGUuc3BsaWNlKSwKCgogICAgICAgIC8vIERpdHRvIGZvciB0aGUgU3RyaW5nIGdlbmVyaWMgZnVuY3Rpb25zCiAgICAgICAgZnJvbUNoYXJDb2RlID0gUy5mcm9tQ2hhckNvZGUgfHwgY2FsbGJpbmQoU3RyaW5nLnByb3RvdHlwZS5mcm9tQ2hhckNvZGUpLAogICAgICAgICAgICBtYXRjaCA9IFMubWF0Y2ggfHwgY2FsbGJpbmQoU3RyaW5nLnByb3RvdHlwZS5tYXRjaCksCiAgICAgICAgICAgIHJlcGxhY2UgPSBTLnJlcGxhY2UgfHwgY2FsbGJpbmQoU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlKSwKICAgICAgICAgICAgc2VhcmNoID0gUy5zZWFyY2ggfHwgY2FsbGJpbmQoU3RyaW5nLnByb3RvdHlwZS5zZWFyY2gpLAogICAgICAgICAgICBzcGxpdCA9IFMuc3BsaXQgfHwgY2FsbGJpbmQoU3RyaW5nLnByb3RvdHlwZS5zcGxpdCksCiAgICAgICAgICAgIHN1YnN0cmluZyA9IFMuc3Vic3RyaW5nIHx8IGNhbGxiaW5kKFN0cmluZy5wcm90b3R5cGUuc3Vic3RyaW5nKSwKICAgICAgICAgICAgdG9Mb3dlckNhc2UgPSBTLnRvTG93ZXJDYXNlIHx8IGNhbGxiaW5kKFN0cmluZy5wcm90b3R5cGUudG9Mb3dlckNhc2UpLAogICAgICAgICAgICB0b1VwcGVyQ2FzZSA9IFMudG9VcHBlckNhc2UgfHwgY2FsbGJpbmQoU3RyaW5nLnByb3RvdHlwZS50b1VwcGVyQ2FzZSksCiAgICAgICAgICAgIHRyaW0gPSBTLnRyaW0gfHwgY2FsbGJpbmQoU3RyaW5nLnByb3RvdHlwZS50cmltKSwKCgogICAgICAgIC8vIE9uZSBtb3JlIGFycmF5LXJlbGF0ZWQgZnVuY3Rpb24KICAgICAgICBwdXNoQWxsID0gRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5LmJpbmQoQXJyYXkucHJvdG90eXBlLnB1c2gpLAoKCiAgICAgICAgLy8gUmVnRXhwIGZ1bmN0aW9ucywgdG9vCiAgICAgICAgZXhlYyA9IGNhbGxiaW5kKFJlZ0V4cC5wcm90b3R5cGUuZXhlYyksCiAgICAgICAgICAgIHRlc3QgPSBjYWxsYmluZChSZWdFeHAucHJvdG90eXBlLnRlc3QpOwoKICAgICAgICAvLyBUaGVzZSBhcmUgYWxsIHVuaXF1ZSBhbmQgaGF2ZSB0aGVpciB1c2VzLCBwYXJ0aWN1bGFybHkgZm9yIGZvcm1hdHRpbmcuCiAgICAgICAgLy8gQWxzbywgb25seSB3aGVuIGFjY2Vzc2luZyBkaXJlY3RseSBmcm9tIHByaW1pdGl2ZSB3cmFwcGVyIChzdHJpbmcvbnVtYmVyKSBpcwogICAgICAgIC8vIHRoZSBuYXRpdmUgdmVyc2lvbiBhc3N1cmVkIHRvIGJlIHVzZWQuCiAgICAgICAgdmFyIHRvU3RyaW5nID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgICAgIC8vIGBbXS5qb2luKCcsJylgCiAgICAgICAgICAgIEFycmF5OiBjYWxsYmluZChBcnJheS5wcm90b3R5cGUudG9TdHJpbmcpLAogICAgICAgICAgICAvLyAndHJ1ZScgb3IgJ2ZhbHNlJwogICAgICAgICAgICBCb29sZWFuOiBjYWxsYmluZChCb29sZWFuLnByb3RvdHlwZS50b1N0cmluZyksCiAgICAgICAgICAgIC8vICJTYXQgRGVjIDEwIDIwMTEgMjM6NDA6NTYgR01ULTA1MDAgKFVTIEVhc3Rlcm4gU3RhbmRhcmQgVGltZSkiCiAgICAgICAgICAgIERhdGU6IGNhbGxiaW5kKERhdGUucHJvdG90eXBlLnRvU3RyaW5nKSwKICAgICAgICAgICAgLy8gV29ya3MgZ2VuZXJpY2FsbHksIGBlLm5hbWUgKyAnICcgKyBlLm1lc3NhZ2VgCiAgICAgICAgICAgIEVycm9yOiBjYWxsYmluZChFcnJvci5wcm90b3R5cGUudG9TdHJpbmcpLAogICAgICAgICAgICAvLyB1bm1vZGlmaWVkIHNvdXJjZSBpbiBWOCwgbm9ybWFsaXplZCBpbiBzcGlkZXJtb25rZXkKICAgICAgICAgICAgRnVuY3Rpb246IGNhbGxiaW5kKEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyksCiAgICAgICAgICAgIC8vIFdvcmtzIGdlbmVyaWNhbGx5LCAnW29iamVjdCBJbnRlcm5hbENsYXNzXScKICAgICAgICAgICAgT2JqZWN0OiBjYWxsYmluZChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nKSwKICAgICAgICAgICAgLy8gaW5wdXQgbXVzdCBiZSBudW1iZXIsIGhhcyBvcHRpb25hbCByYWRpeCBwYXJhbWV0ZXIKICAgICAgICAgICAgTnVtYmVyOiBjYWxsYmluZChOdW1iZXIucHJvdG90eXBlLnRvU3RyaW5nKSwKICAgICAgICAgICAgLy8gUmVnRXhwKCdeXHMrJywgJ2cnKS50b1N0cmluZygpIC0+ICcvXHMrL2cnCiAgICAgICAgICAgIFJlZ0V4cDogY2FsbGJpbmQoUmVnRXhwLnByb3RvdHlwZS50b1N0cmluZyksCiAgICAgICAgICAgIC8vIGlucHV0IG11c3QgYmUgc3RyaW5nCiAgICAgICAgICAgIFN0cmluZzogY2FsbGJpbmQoU3RyaW5nLnByb3RvdHlwZS50b1N0cmluZykKICAgICAgICB9KTsKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICAqICBzcmMvZ2xvYmFscy5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL2dsb2JhbHMuanMiCiAgICAgICAgLy8gVGhlc2UgY29uc3RhbnRzIGFuZCB2YXJpYWJsZXMgYXJlbid0IHJlYWxseSBnbG9iYWxzLiAgVGhleSdyZSBhbGwgd2l0aGluCiAgICAgICAgLy8gdGhlIGNsb3N1cmUgYWRkZWQgYnkgdGhlIE1ha2VmaWxlLCBzbyB0aGV5IGRvbid0IGFmZmVjdCB0aGUgZ2xvYmFsCiAgICAgICAgLy8gZW52aXJvbm1lbnQuICBCdXQgdGhleSBhcmUgdmlzaWJsZSBldmVyeXdoZXJlIHdpdGhpbiBkb20uanMKCiAgICAgICAgLy8gTmFtZXNwYWNlcwogICAgICAgIHZhciBIVE1MX05BTUVTUEFDRSA9ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIjsKICAgICAgICB2YXIgWE1MX05BTUVTUEFDRSA9ICJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiOwogICAgICAgIHZhciBYTUxOU19OQU1FU1BBQ0UgPSAiaHR0cDovL3d3dy53My5vcmcvMjAwMC94bWxucy8iOwogICAgICAgIHZhciBNQVRITUxfTkFNRVNQQUNFID0gImh0dHA6Ly93d3cudzMub3JnLzE5OTgvTWF0aC9NYXRoTUwiOwogICAgICAgIHZhciBTVkdfTkFNRVNQQUNFID0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIjsKICAgICAgICB2YXIgWExJTktfTkFNRVNQQUNFID0gImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiOwoKICAgICAgICAvLyBBbnl0aGluZyBJIHdhbnQgdG8gZGVmaW5lIGxhemlseSB1c2luZyBkZWZpbmVMYXp5UHJvcGVydHkgYWJvdmUgaGFzCiAgICAgICAgLy8gdG8gYmUgYSBwcm9wZXJ0eSBvZiBzb21ldGhpbmc7IGl0IGNhbid0IGp1c3QgYmUgYSBsb2NhbCB2YXJpYWJsZS4KICAgICAgICAvLyBTbyB0aGVzZSBvYmplY3RzIGFyZSBob2xkZXJzIGZvciBsYXp5IHByb3BlcnRpZXMuCiAgICAgICAgdmFyIGltcGwgPSB7fTsgLy8gaW1wbGVtZW50YXRpb24gY29uc3RydXRvcnMgZGVmaW5lZCBoZXJlCiAgICAgICAgdmFyIGlkbCA9IHt9OyAvLyBpbnRlcmZhY2UgY29uc3RydWN0b3JzIGRlZmluZWQgaGVyZQoKCiAgICAgICAgLy8gU29tZXRpbWVzIHdlIG5lZWQgdG8ga25vdyB0aGUgZG9jdW1lbnQgb2YgdGhlIGN1cnJlbnQgc2NyaXB0LgogICAgICAgIC8vIFNvIHRoaXMgZ2xvYmFsIGlzIHRoZSA8c2NyaXB0PiBlbGVtZW50IHRoYXQncyBydW5uaW5nIGlmIHRoZXJlIGlzIG9uZS4KICAgICAgICB2YXIgY3VycmVudGx5RXhlY3V0aW5nU2NyaXB0ID0gbnVsbDsKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICAqICBzcmMvdXRpbHMuanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy91dGlscy5qcyIKICAgICAgICAvLyBVdGlsaXR5IGZ1bmN0aW9ucyBhbmQgb3RoZXIgZ2xvYmFscyB1c2VkIHRocm91Z2hvdXQgZG9tLmpzCgogICAgICAgIGZ1bmN0aW9uIGFzc2VydChleHByLCBtc2cpIHsKICAgICAgICAgICAgaWYgKCFleHByKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFzc2VydGlvbiBmYWlsZWQ6ICIgKyAobXNnIHx8ICIiKSArICJcbiIgKyBuZXcgRXJyb3IoKS5zdGFjayk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEZvciBzdHVmZiB0aGF0IEkgaGF2ZW4ndCBpbXBsZW1lbnRlZCB5ZXQKICAgICAgICBmdW5jdGlvbiBueWkoKSB7CiAgICAgICAgICAgIHZhciBlID0gbmV3IEVycm9yKCk7CiAgICAgICAgICAgIHZhciB3aGVyZSA9IHNwbGl0KGUuc3RhY2ssICJcbiIpWzFdOwogICAgICAgICAgICBlLm5hbWUgPSAiTm90WWV0SW1wbGVtZW50ZWQiOwogICAgICAgICAgICBlLm1lc3NhZ2UgPSB3aGVyZTsKICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CgogICAgICAgIC8vIENhbGxlZCBieSBkZXByZWNhdGVkIGZ1bmN0aW9ucywgZXRjLgogICAgICAgIGZ1bmN0aW9uIHdhcm4obXNnKSB7CiAgICAgICAgICAgIGlmIChnbG9iYWwuY29uc29sZSkgY29uc29sZS53YXJuKG1zZyk7ZWxzZSBpZiAoZ2xvYmFsLnByaW50KSB7CiAgICAgICAgICAgICAgICBwcmludCgiV0FSTklORzogIiArIG1zZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEN1cnJlbnRseSB0aGlzIGlzIG9ubHkgdXNlZCB0byByZXBvcnQgZXJyb3JzIHdoZW4gcnVubmluZyBzY3JpcHRzCiAgICAgICAgZnVuY3Rpb24gZXJyb3IobXNnKSB7CiAgICAgICAgICAgIGlmIChnbG9iYWwuY29uc29sZSAmJiBnbG9iYWwuY29uc29sZS5lcnJvcikgY29uc29sZS5lcnJvcihtc2cpO2Vsc2UgaWYgKGdsb2JhbC5wcmludCkgewogICAgICAgICAgICAgICAgcHJpbnQoIkVSUk9SOiAiICsgbXNnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gVXRpbGl0eSBmdW5jdGlvbnMgdGhhdCByZXR1cm4gcHJvcGVydHkgZGVzY3JpcHRvcnMKICAgICAgICBmdW5jdGlvbiBjb25zdGFudCh2KSB7CiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiB2IH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGF0dHJpYnV0ZShnZXQsIHNldCkgewogICAgICAgICAgICBpZiAoc2V0KSByZXR1cm4geyBnZXQ6IGdldCwgc2V0OiBzZXQgfTtlbHNlIHJldHVybiB7IGdldDogZ2V0IH07CiAgICAgICAgfQoKICAgICAgICAvLyBzb21lIGZ1bmN0aW9ucyB0aGF0IGRvIHZlcnkgc2ltcGxlIHN0dWZmCiAgICAgICAgLy8gTm90ZSB0aGF0IHRoZWlyIG5hbWVzIGJlZ2luIHdpdGggZi4KICAgICAgICAvLyBUaGlzIGlzIGdvb2QgZm9yIHRoaW5ncyBsaWtlIGF0dHJpYnV0ZShmbnVsbCxmbm9vcCkKICAgICAgICBmdW5jdGlvbiBmbnVsbCgpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGZ0cnVlKCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZmZhbHNlKCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGZub29wKCkgey8qIGRvIG5vdGhpbmcgKi99CgogICAgICAgIHZhciByZWFkb25seVByb3BEZXNjID0geyB3cml0YWJsZTogZmFsc2UsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9OwogICAgICAgIHZhciBoaWRkZW5Qcm9wRGVzYyA9IHsgd3JpdGFibGU6IHRydWUsIGVudW1lcmFibGU6IGZhbHNlLCBjb25maWd1cmFibGU6IHRydWUgfTsKICAgICAgICB2YXIgY29uc3RhbnRQcm9wRGVzYyA9IHsgd3JpdGFibGU6IGZhbHNlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IGZhbHNlIH07CiAgICAgICAgdmFyIGhpZGRlbkNvbnN0YW50UHJvcERlc2MgPSB7CiAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogZmFsc2UsIGNvbmZpZ3VyYWJsZTogZmFsc2UKICAgICAgICB9OwoKICAgICAgICAvLyBTZXQgby5wIHRvIHYsIGJ1dCBtYWtlIHRoZSBwcm9wZXJ0eSByZWFkLW9ubHkKICAgICAgICBmdW5jdGlvbiBkZWZpbmVSZWFkb25seVByb3AobywgcCwgdikgewogICAgICAgICAgICByZWFkb25seVByb3BEZXNjLnZhbHVlID0gdjsKICAgICAgICAgICAgTy5kZWZpbmVQcm9wZXJ0eShvLCBwLCByZWFkb25seVByb3BEZXNjKTsKICAgICAgICB9CgogICAgICAgIC8vIFNldCBvLnAgdG8gdiwgYnV0IG1ha2UgdGhlIHByb3BlcnR5IG5vbi1lbnVtZXJhYmxlCiAgICAgICAgZnVuY3Rpb24gZGVmaW5lSGlkZGVuUHJvcChvLCBwLCB2KSB7CiAgICAgICAgICAgIGhpZGRlblByb3BEZXNjLnZhbHVlID0gdjsKICAgICAgICAgICAgTy5kZWZpbmVQcm9wZXJ0eShvLCBwLCBoaWRkZW5Qcm9wRGVzYyk7CiAgICAgICAgfQoKICAgICAgICAvLyBTZXQgby5wIHRvIHYsIGFuZCBtYWtlIGl0IGNvbnN0YW50CiAgICAgICAgZnVuY3Rpb24gZGVmaW5lQ29uc3RhbnRQcm9wKG8sIHAsIHYpIHsKICAgICAgICAgICAgY29uc3RhbnRQcm9wRGVzYy52YWx1ZSA9IHY7CiAgICAgICAgICAgIE8uZGVmaW5lUHJvcGVydHkobywgcCwgY29uc3RhbnRQcm9wRGVzYyk7CiAgICAgICAgfQoKICAgICAgICAvLyBTZXQgby5wIHRvIHYsIGFuZCBtYWtlIGl0IGNvbnN0YW50IGFuZCBub24tZW51bWVyYWJsZQogICAgICAgIGZ1bmN0aW9uIGRlZmluZUhpZGRlbkNvbnN0YW50UHJvcChvLCBwLCB2KSB7CiAgICAgICAgICAgIGhpZGRlbkNvbnN0YW50UHJvcERlc2MudmFsdWUgPSB2OwogICAgICAgICAgICBPLmRlZmluZVByb3BlcnR5KG8sIHAsIGhpZGRlbkNvbnN0YW50UHJvcERlc2MpOwogICAgICAgIH0KCiAgICAgICAgLy8KICAgICAgICAvLyBEZWZpbmUgYSBwcm9wZXJ0eSBwIG9mIHRoZSBvYmplY3QgbyB3aG9zZSB2YWx1ZSBpcyB0aGUgcmV0dXJuIHZhbHVlIG9mIGYoKS4KICAgICAgICAvLyBCdXQgZG9uJ3QgaW52b2tlIGYoKSB1bnRpbCB0aGUgcHJvcGVydHkgaXMgYWN0dWFsbHkgdXNlZCBmb3IgdGhlIGZpcnN0IHRpbWUuCiAgICAgICAgLy8gVGhlIHByb3BlcnR5IHdpbGwgYmUgd3JpdGVhYmxlLCBlbnVtZXJhYmxlIGFuZCBjb25maWd1cmFibGUuCiAgICAgICAgLy8gSWYgdGhlIHByb3BlcnR5IGlzIG1hZGUgcmVhZC1vbmx5IGJlZm9yZSBpdCBpcyB1c2VkLCB0aGVuIGl0IHdpbGwgdGhyb3cKICAgICAgICAvLyBhbiBleGNlcHRpb24gd2hlbiB1c2VkLgogICAgICAgIC8vIEJhc2VkIG9uIEFuZHJlYXMncyBBZGRSZXNvbHZlSG9vayBmdW5jdGlvbi4KICAgICAgICAvLwogICAgICAgIGZ1bmN0aW9uIGRlZmluZUxhenlQcm9wZXJ0eShvLCBwLCBmLCBoaWRkZW4sIHJlYWRvbmx5KSB7CiAgICAgICAgICAgIE8uZGVmaW5lUHJvcGVydHkobywgcCwgewogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gV2hlbiB0aGUgcHJvcGVydHkgaXMgZmlyc3QgcmV0cmlldmVkCiAgICAgICAgICAgICAgICAgICAgdmFyIHJlYWx2YWwgPSBmKCk7IC8vIGNvbXB1dGUgaXRzIGFjdHVhbCB2YWx1ZQogICAgICAgICAgICAgICAgICAgIE8uZGVmaW5lUHJvcGVydHkobywgcCwgeyAvLyBTdG9yZSB0aGF0IHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiByZWFsdmFsLAogICAgICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogIXJlYWRvbmx5LAogICAgICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhaGlkZGVuLAogICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVhbHZhbDsgLy8gQW5kIHJldHVybiB0aGUgY29tcHV0ZWQgdmFsdWUKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzZXQ6IHJlYWRvbmx5ID8gdW5kZWZpbmVkIDogZnVuY3Rpb24gKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBwcm9wZXJ0eSBpcyB3cml0YWJsZSBhbmQgaXMgc2V0IGJlZm9yZSBiZWluZyByZWFkLAogICAgICAgICAgICAgICAgICAgIC8vIGp1c3QgcmVwbGFjZSB0aGUgdmFsdWUgYW5kIGYoKSB3aWxsIG5ldmVyIGJlIGludm9rZWQKCiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBsaW5lIGJlbG93IHdoZW4gdGhpcyBidWcgaXMgZml4ZWQ6CiAgICAgICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NzAzMTU3CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9bcF07CgogICAgICAgICAgICAgICAgICAgIE8uZGVmaW5lUHJvcGVydHkobywgcCwgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbmV3dmFsLAogICAgICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogIXJlYWRvbmx5LAogICAgICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhaGlkZGVuLAogICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhaGlkZGVuLAogICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gQ29tcGFyZSB0d28gbm9kZXMgYmFzZWQgb24gdGhlaXIgZG9jdW1lbnQgb3JkZXIuIFRoaXMgZnVuY3Rpb24gaXMgaW50ZW5kZWQKICAgICAgICAvLyB0byBiZSBwYXNzZWQgdG8gc29ydCgpLiBBc3N1bWVzIHRoYXQgdGhlIGFycmF5IGJlaW5nIHNvcnRlZCBkb2VzIG5vdAogICAgICAgIC8vIGNvbnRhaW4gZHVwbGljYXRlcy4gIEFuZCB0aGF0IGFsbCBub2RlcyBhcmUgY29ubmVjdGVkIGFuZCBjb21wYXJhYmxlLgogICAgICAgIC8vIENsZXZlciBjb2RlIGJ5IHBwayB2aWEgamVyZXNpZy4KICAgICAgICBmdW5jdGlvbiBkb2N1bWVudE9yZGVyKG4sIG0pIHsKICAgICAgICAgICAgcmV0dXJuIDMgLSAobi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihtKSAmIDYpOwogICAgICAgIH0KCiAgICAgICAgLy8gTGlrZSBTdHJpbmcudHJpbSgpLCBidXQgdXNlcyBIVE1MJ3MgZGVmaW5pdGlvbiBvZiB3aGl0ZXNwYWNlCiAgICAgICAgLy8gaW5zdGVhZCBvZiB1c2luZyBVbmljb2RlJ3MgZGVmaW5pdGlvbiBvZiB3aGl0ZXNwYWNlLgogICAgICAgIGZ1bmN0aW9uIGh0bWxUcmltKHMpIHsKICAgICAgICAgICAgcmV0dXJuIHMucmVwbGFjZSgvXlsgXHRcblxyXGZdK3xbIFx0XG5cclxmXSskL2csICIiKTsKICAgICAgICB9CgogICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgKiAgc3JjL3dyYXBtYXAuanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy93cmFwbWFwLmpzIgogICAgICAgIC8vIGRvbS5qcyB1c2VzIHR3byBraW5kcyBvZiB0cmVlIG5vZGUgb2JqZWN0cy4gIG5vZGVzICh3aXRoIGEKICAgICAgICAvLyBsb3dlcmNhc2UgbikgYXJlIHRoZSBpbnRlcm5hbCBkYXRhIHN0cnVjdHVyZXMgdGhhdCBob2xkIHRoZSBhY3R1YWwKICAgICAgICAvLyBkb2N1bWVudCBkYXRhLiBUaGV5IGFyZSBpbXBsZW1lbnRlZCBieSB0aGUgZmlsZXMgaW4gaW1wbC8qIE5vZGVzCiAgICAgICAgLy8gKHdpdGggYSBjYXBpdGFsIE4pIGFyZSB0aGUgcHVibGljIG9iamVjdHMgdGhhdCBpbXBsZW1lbnQgRE9NCiAgICAgICAgLy8gaW50ZXJmYWNlcyBhbmQgZG8gbm90IGhhdmUgYW55IHByb3BlcnRpZXMgb3RoZXIgdGhhbiB0aGUgYWNjZXNzb3IKICAgICAgICAvLyBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIGRlZmluZWQgYnkgdGhlIERPTS4gIFRoZXkgYXJlIGltcGxlbWVudGVkIGJ5CiAgICAgICAgLy8gdGhlIGZpbGVzIGluIGlkbC8qCiAgICAgICAgLy8KICAgICAgICAvLyBFdmVyeSBOb2RlIG11c3QgaGF2ZSBhIG5vZGUgdG8gaG9sZCBpdHMgYWN0dWFsIGRhdGEuCiAgICAgICAgLy8gQnV0IG5vZGVzIGNhbiBleGlzdCB3aXRob3V0IGFueSBjb3JyZXNwb25kaW5nIE5vZGU6IE5vZGVzIGFyZSBjcmVhdGVkCiAgICAgICAgLy8gYXMgbmVlZGVkLCB3aGVuIHNjcmlwdHMgdXNlIHRoZSBET00gQVBJIHRvIGluc3BlY3QgdGhlIGRvY3VtZW50IHRyZWUuCiAgICAgICAgLy8KICAgICAgICAvLyBTaW5jZSBOb2RlIG9iamVjdHMgY2FuJ3QgaGF2ZSBwcm9wZXJ0aWVzLCB0aGUgbWFwcGluZyBmcm9tIE5vZGUgdG8gbm9kZQogICAgICAgIC8vIGlzIGRvbmUgd2l0aCBhIFdlYWtNYXAuICBUaGUgbWFwcGluZyBmcm9tIG5vZGUgdG8gTm9kZSBpcyBzaW1wbGVyOgogICAgICAgIC8vIGlmIGEgTm9kZSBleGlzdHMgZm9yIHRoZSBub2RlLCBpdCBpcyBzaW1wbHkgc2V0IG9uIGEgcHJvcGVydHkgb2YgdGhlIG5vZGUuCiAgICAgICAgLy8KICAgICAgICAvLyBUaGUgbWV0aG9kcyBpbiB0aGlzIGZpbGUgbWFuYWdlIHRoZSBtYXBwaW5nIGJldHdlZW4gbm9kZXMgYW5kIE5vZGVzCiAgICAgICAgLy8KCiAgICAgICAgdmFyIGlkbFRvSW1wbE1hcCA9IG5ldyBXZWFrTWFwKCksCiAgICAgICAgICAgIGxhc3RrZXkgPSB7fSwKICAgICAgICAgICAgbGFzdHZhbHVlID0gdW5kZWZpbmVkOwoKICAgICAgICAvLyBSZXR1cm4gdGhlIGltcGxlbWVudGF0aW9uIG9iamVjdCBmb3IgdGhlIERPTSBOb2RlIG4KICAgICAgICAvLyBUaGlzIG1ldGhvZCB3aWxsIHRocm93IGEgVHlwZUVycm9yIGlmIG4gaXMKICAgICAgICAvLyBudWxsLCB1bmRlZmluZWQsIGEgcHJpbWl0aXZlLCBvciBhbiBvYmplY3Qgd2l0aCBubyBtYXBwaW5nLgogICAgICAgIC8vIFRoaXMgcHJvdmlkZXMgYmFzaWMgZXJyb3IgY2hlY2tpbmcgZm9yIG1ldGhvZHMgbGlrZSBOb2RlLmFwcGVuZENoaWxkKCkuCiAgICAgICAgLy8gWFhYOiBXZSB1c2VkIHRvIHRocm93IE5PVF9GT1VORF9FUlIgaGVyZSwgYnV0IG1zMmdlcidzIHRlc3RzCiAgICAgICAgLy8gZXhwZWN0IFR5cGVFcnJvcgogICAgICAgIGZ1bmN0aW9uIHVud3JhcChuKSB7CiAgICAgICAgICAgIC8vIFNpbXBsZSBvcHRpbWl6YXRpb24KICAgICAgICAgICAgLy8gSWYgSSBldmVyIHJlbW92ZSBvciBhbHRlciBtYXBwaW5ncywgdGhlbiB0aGlzIHdvbid0IGJlIHZhbGlkIGFueW1vcmUuCiAgICAgICAgICAgIGlmIChuID09PSBsYXN0a2V5KSByZXR1cm4gbGFzdHZhbHVlOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBpbXBsID0gd21nZXQoaWRsVG9JbXBsTWFwLCBuKTsKCiAgICAgICAgICAgICAgICAvLyBUaGlzIGhhcHBlbnMgaWYgc29tZW9uZSBwYXNzZXMgYSBib2d1cyBvYmplY3QgdG8KICAgICAgICAgICAgICAgIC8vIGFwcGVuZENoaWxkLCBmb3IgZXhhbXBsZS4KICAgICAgICAgICAgICAgIGlmICghaW1wbCkgTm90Rm91bmRFcnJvcigpOwoKICAgICAgICAgICAgICAgIGxhc3RrZXkgPSBuOwogICAgICAgICAgICAgICAgbGFzdHZhbHVlID0gaW1wbDsKICAgICAgICAgICAgICAgIHJldHVybiBpbXBsOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAvLyBJZiBuIHdhcyBudWxsIG9yIG5vdCBhbiBvYmplY3QgdGhlIFdlYWtNYXAgd2lsbCByYWlzZSBhIFR5cGVFcnJvcgogICAgICAgICAgICAgICAgLy8gVHlwZUVycm9yIG1pZ2h0IGJlIHRoZSBiZXN0IHRoaW5nIHRvIHByb3BhZ2F0ZSwgYnV0IHRoZXJlIGlzIGFsc28KICAgICAgICAgICAgICAgIC8vIHNvbWUgcHJlY2VuZGVudCBmb3IgcmFpc2luZyBhIERPTUV4Y2VwdGlvbiB3aXRoIGNvZGUKICAgICAgICAgICAgICAgIC8vIE5PVF9GT1VORF9FUlI7CiAgICAgICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdW53cmFwT3JOdWxsKG4pIHsKICAgICAgICAgICAgcmV0dXJuIG4gPyB1bndyYXAobikgOiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gUmV0dXJuIHRoZSBpbnRlcmZhY2Ugb2JqZWN0IChhIERPTSBub2RlKSBmb3IgdGhlIGltcGxlbWVudGF0aW9uIG9iamVjdCBuLAogICAgICAgIC8vIGNyZWF0aW5nIGl0IGlmIG5lY2Vzc2FyeS4gSW1wbGVtZW50YXRpb24gb2JqZWN0cyBkZWZpbmUgdGhlIHR5cGUKICAgICAgICAvLyBvZiB3cmFwcGVyIHRoZXkgcmVxdWlyZSBieSBkZWZpbmluZyBhbiBfaWRsTmFtZSBwcm9wZXJ0eS4gTW9zdCBjbGFzc2VzCiAgICAgICAgLy8gZG8gdGhpcyBvbiB0aGVpciBwcm90b3R5cGUuICBGb3IgY2hpbGROb2RlcyBhbmQgYXR0cmlidXRlcyBhcnJheXMsCiAgICAgICAgLy8gd2UgaGF2ZSB0byBkZWZpbmUgX2lkbE5hbWUgZGlyZWN0bHkgb24gdGhlIGFycmF5IG9iamVjdHMsIGhvd2V2ZXIuCiAgICAgICAgZnVuY3Rpb24gd3JhcChuKSB7CiAgICAgICAgICAgIGlmIChuID09PSBudWxsKSByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGlmIChuID09PSB1bmRlZmluZWQpIHRocm93IG5ldyBFcnJvcigiQ2FuJ3Qgd3JhcCB1bmRlZmluZWQgcHJvcGVydHkiKTsKCiAgICAgICAgICAgIC8vIElmIG4gZG9lc24ndCBoYXZlIGEgd3JhcHBlciBhbHJlYWR5LCBjcmVhdGUgb25lLgogICAgICAgICAgICBpZiAoIW4uX2lkbCkgewogICAgICAgICAgICAgICAgdmFyIHR5cGVuYW1lID0gbi5faWRsTmFtZTsKICAgICAgICAgICAgICAgIGlmICghdHlwZW5hbWUpIHRocm93IEVycm9yKCJJbXBsZW1lbnRhdGlvbiBvYmplY3QgZG9lcyBub3QgZGVmaW5lIF9pZGxOYW1lIik7CiAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IGlkbFt0eXBlbmFtZV07CiAgICAgICAgICAgICAgICBpZiAoIXR5cGUpIHRocm93IEVycm9yKCJVbmtub3duIGlkbCB0eXBlICIgKyB0eXBlbmFtZSk7CgogICAgICAgICAgICAgICAgbi5faWRsID0gdHlwZS5mYWN0b3J5KG4pOyAvLyBDcmVhdGUgdGhlIHdyYXBwZXIKICAgICAgICAgICAgICAgIHdtc2V0KGlkbFRvSW1wbE1hcCwgbi5faWRsLCBuKTsgLy8gUmVtZW1iZXIgaXQgZm9yIHVud3JhcCgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBuLl9pZGw7CiAgICAgICAgfQoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy94bWxuYW1lcy5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL3htbG5hbWVzLmpzIgogICAgICAgIC8vIFRoaXMgZ3JhbW1hciBpcyBmcm9tIHRoZSBYTUwgYW5kIFhNTCBOYW1lc3BhY2Ugc3BlY3MuIEl0IHNwZWNpZmllcyB3aGV0aGVyCiAgICAgICAgLy8gYSBzdHJpbmcgKHN1Y2ggYXMgYW4gZWxlbWVudCBvciBhdHRyaWJ1dGUgbmFtZSkgaXMgYSB2YWxpZCBOYW1lIG9yIFFOYW1lLgogICAgICAgIC8vCiAgICAgICAgLy8gTmFtZSAgICAgICAgICAgIDo6PSAgICAgICAgICBOYW1lU3RhcnRDaGFyIChOYW1lQ2hhcikqCiAgICAgICAgLy8gTmFtZVN0YXJ0Q2hhciAgIDo6PSAgICAgICAgICAiOiIgfCBbQS1aXSB8ICJfIiB8IFthLXpdIHwKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsjeEMwLSN4RDZdIHwgWyN4RDgtI3hGNl0gfCBbI3hGOC0jeDJGRl0gfAogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWyN4MzcwLSN4MzdEXSB8IFsjeDM3Ri0jeDFGRkZdIHwKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsjeDIwMEMtI3gyMDBEXSB8IFsjeDIwNzAtI3gyMThGXSB8CiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbI3gyQzAwLSN4MkZFRl0gfCBbI3gzMDAxLSN4RDdGRl0gfAogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWyN4RjkwMC0jeEZEQ0ZdIHwgWyN4RkRGMC0jeEZGRkRdIHwKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsjeDEwMDAwLSN4RUZGRkZdCiAgICAgICAgLy8KICAgICAgICAvLyBOYW1lQ2hhciAgICAgICAgOjo9ICAgICAgICAgIE5hbWVTdGFydENoYXIgfCAiLSIgfCAiLiIgfCBbMC05XSB8CiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjeEI3IHwgWyN4MDMwMC0jeDAzNkZdIHwgWyN4MjAzRi0jeDIwNDBdCiAgICAgICAgLy8KICAgICAgICAvLyBRTmFtZSAgICAgICAgICAgOjo9ICAgICAgICAgIFByZWZpeGVkTmFtZXwgVW5wcmVmaXhlZE5hbWUKICAgICAgICAvLyBQcmVmaXhlZE5hbWUgICAgOjo9ICAgICAgICAgIFByZWZpeCAnOicgTG9jYWxQYXJ0CiAgICAgICAgLy8gVW5wcmVmaXhlZE5hbWUgIDo6PSAgICAgICAgICBMb2NhbFBhcnQKICAgICAgICAvLyBQcmVmaXggICAgICAgICAgOjo9ICAgICAgICAgIE5DTmFtZQogICAgICAgIC8vIExvY2FsUGFydCAgICAgICA6Oj0gICAgICAgICAgTkNOYW1lCiAgICAgICAgLy8gTkNOYW1lICAgICAgICAgIDo6PSAgICAgICAgICBOYW1lIC0gKENoYXIqICc6JyBDaGFyKikKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgQW4gWE1MIE5hbWUsIG1pbnVzIHRoZSAiOiIKICAgICAgICAvLwogICAgICAgIHZhciB4bWwgPSBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICAvLyBNb3N0IG5hbWVzIHdpbGwgYmUgQVNDSUkgb25seS4gVHJ5IG1hdGNoaW5nIGFnYWluc3Qgc2ltcGxlIHJlZ2V4cHMgZmlyc3QKICAgICAgICAgICAgdmFyIHNpbXBsZW5hbWUgPSAvXltfOkEtWmEtel1bLS46XHddKyQvOwogICAgICAgICAgICB2YXIgc2ltcGxlcW5hbWUgPSAvXihbX0EtWmEtel1bLS5cd10rfFtfQS1aYS16XVstLlx3XSs6W19BLVphLXpdWy0uXHddKykkLzsKCiAgICAgICAgICAgIC8vIElmIHRoZSByZWd1bGFyIGV4cHJlc3Npb25zIGFib3ZlIGZhaWwsIHRyeSBtb3JlIGNvbXBsZXggb25lcyB0aGF0IHdvcmsKICAgICAgICAgICAgLy8gZm9yIGFueSBpZGVudGlmaWVycyB1c2luZyBjb2RlcG9pbnRzIGZyb20gdGhlIFVuaWNvZGUgQk1QCiAgICAgICAgICAgIHZhciBuY25hbWVzdGFydGNoYXJzID0gIl9BLVphLXpcdTAwQzAtXHUwMEQ2XHUwMEQ4LVx1MDBGNlx1MDBGOC1cdTAyZmZcdTAzNzAtXHUwMzdEXHUwMzdGLVx1MUZGRlx1MjAwQy1cdTIwMERcdTIwNzAtXHUyMThGXHUyQzAwLVx1MkZFRlx1MzAwMS1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZGRCI7CiAgICAgICAgICAgIHZhciBuY25hbWVjaGFycyA9ICItLl9BLVphLXowLTlcdTAwQjdcdTAwQzAtXHUwMEQ2XHUwMEQ4LVx1MDBGNlx1MDBGOC1cdTAyZmZcdTAzMDAtXHUwMzdEXHUwMzdGLVx1MUZGRlx1MjAwQ1x1MjAwRFx1MjAzZlx1MjA0MFx1MjA3MC1cdTIxOEZcdTJDMDAtXHUyRkVGXHUzMDAxLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkZEIjsKCiAgICAgICAgICAgIHZhciBuY25hbWUgPSAiWyIgKyBuY25hbWVzdGFydGNoYXJzICsgIl1bIiArIG5jbmFtZWNoYXJzICsgIl0qIjsKICAgICAgICAgICAgdmFyIG5hbWVzdGFydGNoYXJzID0gbmNuYW1lc3RhcnRjaGFycyArICI6IjsKICAgICAgICAgICAgdmFyIG5hbWVjaGFycyA9IG5jbmFtZWNoYXJzICsgIjoiOwogICAgICAgICAgICB2YXIgbmFtZSA9IG5ldyBSZWdFeHAoIl5bIiArIG5hbWVzdGFydGNoYXJzICsgIl0iICsgIlsiICsgbmFtZWNoYXJzICsgIl0qJCIpOwogICAgICAgICAgICB2YXIgcW5hbWUgPSBuZXcgUmVnRXhwKCJeKCIgKyBuY25hbWUgKyAifCIgKyBuY25hbWUgKyAiOiIgKyBuY25hbWUgKyAiKSQiKTsKCiAgICAgICAgICAgIC8vIFhNTCBzYXlzIHRoYXQgdGhlc2UgY2hhcmFjdGVycyBhcmUgYWxzbyBsZWdhbDoKICAgICAgICAgICAgLy8gWyN4MTAwMDAtI3hFRkZGRl0uICBTbyBpZiB0aGUgcGF0dGVybnMgYWJvdmUgZmFpbCwgYW5kIHRoZQogICAgICAgICAgICAvLyB0YXJnZXQgc3RyaW5nIGluY2x1ZGVzIHN1cnJvZ2F0ZXMsIHRoZW4gdHJ5IHRoZSBmb2xsb3dpbmcKICAgICAgICAgICAgLy8gcGF0dGVybnMgdGhhdCBhbGxvdyBzdXJyb2dhdGVzIGFuZCB0aGVuIHJ1biBhbiBleHRyYSB2YWxpZGF0aW9uCiAgICAgICAgICAgIC8vIHN0ZXAgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIHN1cnJvZ2F0ZXMgYXJlIGluIHZhbGlkIHBhaXJzIGFuZCBpbgogICAgICAgICAgICAvLyB0aGUgcmlnaHQgcmFuZ2UuICBOb3RlIHRoYXQgc2luY2UgdGhlIGNoYXJhY3RlcnMgXHVmMDAwMCB0byBcdTFmMDAwMAogICAgICAgICAgICAvLyBhcmUgbm90IGFsbG93ZWQsIGl0IG1lYW5zIHRoYXQgdGhlIGhpZ2ggc3Vycm9nYXRlIGNhbiBvbmx5IGdvIHVwIHRvCiAgICAgICAgICAgIC8vIFx1REI3ZiBpbnN0ZWFkIG9mIFx1REJGRi4KICAgICAgICAgICAgdmFyIGhhc3N1cnJvZ2F0ZXMgPSAvW1x1RDgwMC1cdURCN0ZcdURDMDAtXHVERkZGXS87CiAgICAgICAgICAgIHZhciBzdXJyb2dhdGVjaGFycyA9IC9bXHVEODAwLVx1REI3Rlx1REMwMC1cdURGRkZdL2c7CiAgICAgICAgICAgIHZhciBzdXJyb2dhdGVwYWlycyA9IC9bXHVEODAwLVx1REI3Rl1bXHVEQzAwLVx1REZGRl0vZzsKCiAgICAgICAgICAgIC8vIE1vZGlmeSB0aGUgdmFyaWFibGVzIGFib3ZlIHRvIGFsbG93IHN1cnJvZ2F0ZXMKICAgICAgICAgICAgbmNuYW1lc3RhcnRjaGFycyArPSAiXHVEODAwLVx1REI3Rlx1REMwMC1cdURGRkYiOwogICAgICAgICAgICBuY25hbWVjaGFycyArPSAiXHVEODAwLVx1REI3Rlx1REMwMC1cdURGRkYiOwogICAgICAgICAgICBuY25hbWUgPSAiWyIgKyBuY25hbWVzdGFydGNoYXJzICsgIl1bIiArIG5jbmFtZWNoYXJzICsgIl0qIjsKICAgICAgICAgICAgbmFtZXN0YXJ0Y2hhcnMgPSBuY25hbWVzdGFydGNoYXJzICsgIjoiOwogICAgICAgICAgICBuYW1lY2hhcnMgPSBuY25hbWVjaGFycyArICI6IjsKCiAgICAgICAgICAgIC8vIEJ1aWxkIGFub3RoZXIgc2V0IG9mIHJlZ2V4cHMgdGhhdCBpbmNsdWRlIHN1cnJvZ2F0ZXMKICAgICAgICAgICAgdmFyIHN1cnJvZ2F0ZW5hbWUgPSBuZXcgUmVnRXhwKCJeWyIgKyBuYW1lc3RhcnRjaGFycyArICJdIiArICJbIiArIG5hbWVjaGFycyArICJdKiQiKTsKICAgICAgICAgICAgdmFyIHN1cnJvZ2F0ZXFuYW1lID0gbmV3IFJlZ0V4cCgiXigiICsgbmNuYW1lICsgInwiICsgbmNuYW1lICsgIjoiICsgbmNuYW1lICsgIikkIik7CgogICAgICAgICAgICBmdW5jdGlvbiBpc1ZhbGlkTmFtZShzKSB7CiAgICAgICAgICAgICAgICBpZiAodGVzdChzaW1wbGVuYW1lLCBzKSkgcmV0dXJuIHRydWU7IC8vIFBsYWluIEFTQ0lJCiAgICAgICAgICAgICAgICBpZiAodGVzdChuYW1lLCBzKSkgcmV0dXJuIHRydWU7IC8vIFVuaWNvZGUgQk1QCgogICAgICAgICAgICAgICAgLy8gTWF5YmUgdGhlIHRlc3RzIGFib3ZlIGZhaWxlZCBiZWNhdXNlIHMgaW5jbHVkZXMgc3Vycm9nYXRlIHBhaXJzCiAgICAgICAgICAgICAgICAvLyBNb3N0IGxpa2VseSwgdGhvdWdoLCB0aGV5IGZhaWxlZCBmb3Igc29tZSBtb3JlIGJhc2ljIHN5bnRheCBwcm9ibGVtCiAgICAgICAgICAgICAgICBpZiAoIXRlc3QoaGFzc3Vycm9nYXRlcywgcykpIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICAvLyBJcyB0aGUgc3RyaW5nIGEgdmFsaWQgbmFtZSBpZiB3ZSBhbGxvdyBzdXJyb2dhdGVzPwogICAgICAgICAgICAgICAgaWYgKCF0ZXN0KHN1cnJvZ2F0ZW5hbWUsIHMpKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAgICAgLy8gRmluYWxseSwgYXJlIHRoZSBzdXJyb2dhdGVzIGFsbCBjb3JyZWN0bHkgcGFpcmVkIHVwPwogICAgICAgICAgICAgICAgdmFyIGNoYXJzID0gbWF0Y2gocywgc3Vycm9nYXRlY2hhcnMpLAogICAgICAgICAgICAgICAgICAgIHBhaXJzID0gbWF0Y2gocywgc3Vycm9nYXRlcGFpcnMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHBhaXJzICE9IG51bGwgJiYgMiAqIHBhaXJzLmxlbmd0aCA9PT0gY2hhcnMubGVuZ3RoOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpc1ZhbGlkUU5hbWUocykgewogICAgICAgICAgICAgICAgaWYgKHRlc3Qoc2ltcGxlcW5hbWUsIHMpKSByZXR1cm4gdHJ1ZTsgLy8gUGxhaW4gQVNDSUkKICAgICAgICAgICAgICAgIGlmICh0ZXN0KHFuYW1lLCBzKSkgcmV0dXJuIHRydWU7IC8vIFVuaWNvZGUgQk1QCgogICAgICAgICAgICAgICAgaWYgKCF0ZXN0KGhhc3N1cnJvZ2F0ZXMsIHMpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoIXRlc3Qoc3Vycm9nYXRlcW5hbWUsIHMpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB2YXIgY2hhcnMgPSBtYXRjaChzLCBzdXJyb2dhdGVjaGFycyksCiAgICAgICAgICAgICAgICAgICAgcGFpcnMgPSBtYXRjaChzLCBzdXJyb2dhdGVwYWlycyk7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFpcnMgIT0gbnVsbCAmJiAyICogcGFpcnMubGVuZ3RoID09PSBjaGFycy5sZW5ndGg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB7IGlzVmFsaWROYW1lOiBpc1ZhbGlkTmFtZSwgaXNWYWxpZFFOYW1lOiBpc1ZhbGlkUU5hbWUgfTsKICAgICAgICB9KCk7CgogICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgKiAgc3JjL2lkbC5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL2lkbC5qcyIKICAgICAgICAvLyBUaGlzIGZpbGUgZGVmaW5lcyBmdW5jdGlvbnMgZm9yIHNhdGlzZnlpbmcgdGhlIHJlcXVpcmVtZW50cyBvZiBXZWJJREwKICAgICAgICAvLyBTZWUgYWxzbyAuLi90b29scy9pZGwyZG9tanMKCiAgICAgICAgLy8gV2ViSURMIHJlcXVpcmVzIHZhbHVlIGNvbnZlcnNpb25zIGluIHZhcmlvdXMgcGxhY2VzLgoKICAgICAgICAvLyBDb252ZXJ0IHggdG8gYW4gdW5zaWduZWQgbG9uZyBhbmQgcmV0dXJuIGl0CiAgICAgICAgLy8gV2ViSURMIGN1cnJlbnRseSBzYXlzIHRvIHVzZSBFUyBUb1VpbnQzMigpIHVubGVzcyB0aGVyZSBpcyBhIFtDbGFtcF0KICAgICAgICAvLyBhdHRyaWJ1dGUgb24gdGhlIG9wZXJhdGlvbi4gIFdlIGNhbiBpbnZva2UgdGhlIFRvVWludDMyIG9wZXJhdGlvbgogICAgICAgIC8vIHdpdGggdGhlID4+PiBvcGVyYXRvci4KICAgICAgICAvLwogICAgICAgIGZ1bmN0aW9uIHRvVUxvbmcoeCkgewogICAgICAgICAgICByZXR1cm4geCA+Pj4gMDsgLy8gVGhlID4+PiBvcGVyYXRvciBkb2VzIFRvVWludDMyCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0b0xvbmcoeCkgewogICAgICAgICAgICByZXR1cm4geCAmIDB4RkZGRkZGRkY7IC8vIFRoaXMgc2hvdWxkIGRvIFRvSW50MzIKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRvVVNob3J0KHgpIHsKICAgICAgICAgICAgcmV0dXJuIHggPj4+IDAgJiAweEZGRkY7IC8vIENvbnZlcnQgdG8gdWludDMyLCBhbmQgdGhlbiB0cnVuY2F0ZS4KICAgICAgICB9CgogICAgICAgIC8vIENvbnZlcnQgdGhlIHZhbHVlIHggdG8gYSBudW1iZXIsIGFuZCByYWlzZSBhbiBleGNlcHRpb24gaWYKICAgICAgICAvLyBpdCBpcyBOYU4gb3IgaW5maW5pdGUuIFRoaXMgaXMgbm90IGFjdHVhbGx5IHBhcnQgb2YgV2ViSURMOgogICAgICAgIC8vIEhUTUwgbWFuZGF0ZXMgdGhpcyBjaGVjayAiZXhjZXB0IHdoZXJlIG90aGVyd2lzZSBzcGVjaWZpZWQiLgogICAgICAgIC8vIEknbGwgcHJvYmFibHkgd2FudCB0byBjaGFuZ2UgdGhlIGlkbCB0eXBlIG9mIGF0dHJpYnV0ZXMgb3IKICAgICAgICAvLyBhcmd1bWVudHMgZm9yIHdoaWNoIE5hTiBhbmQgaW5maW5pdGUgdmFsdWVzIGFyZSBhbGxvd2VkLCBpZgogICAgICAgIC8vIHRoZXJlIGFyZSBhbnkKICAgICAgICBmdW5jdGlvbiB0b0RvdWJsZSh4KSB7CiAgICAgICAgICAgIHZhciB2ID0gTnVtYmVyKHgpOwogICAgICAgICAgICBpZiAoIWlzRmluaXRlKHYpKSBOb3RTdXBwb3J0ZWRFcnJvcih4ICsgIiBpcyBub3QgYSBmaW5pdGUgZmxvYXQuIik7CiAgICAgICAgICAgIHJldHVybiB2OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdW5kZWYybnVsbCh4KSB7CiAgICAgICAgICAgIHJldHVybiB4ID09PSB1bmRlZmluZWQgPyBudWxsIDogeDsKICAgICAgICB9CgogICAgICAgIC8vIENvbnZlcnQgeCB0byBhIHN0cmluZyBhcyB3aXRoIHRoZSBTdHJpbmcoKSBjb252ZXJzaW9uIGZ1bmN0aW9uLgogICAgICAgIC8vIEJ1dCBpZiB4IGlzIG51bGwsIHJldHVybiB0aGUgZW1wdHkgc3RyaW5nIGluc2VhZCBvZiAibnVsbCIuCiAgICAgICAgLy8gSWYgYSBXZWJJREwgbWV0aG9kIGFyZ3VtZW50IGlzIGp1c3QgRE9NU3RyaW5nLCBjb252ZXJ0IHdpdGggU3RyaW5nKCkKICAgICAgICAvLyBCdXQgaWYgaXQgaXMgW1RyZWF0TnVsbEFzPUVtcHR5U3RyaW5nXSBET01TdHJpbmcgdGhlbiB1c2UgdGhpcyBmdW5jdGlvbi4KICAgICAgICBmdW5jdGlvbiBTdHJpbmdPckVtcHR5KHgpIHsKICAgICAgICAgICAgcmV0dXJuIHggPT09IG51bGwgPyAiIiA6IFN0cmluZyh4KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFN0cmluZ09yTnVsbCh4KSB7CiAgICAgICAgICAgIHJldHVybiB4ID09PSBudWxsID8gbnVsbCA6IFN0cmluZyh4KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIE9wdGlvbmFsU3RyaW5nT3JOdWxsKHgpIHsKICAgICAgICAgICAgcmV0dXJuIHggPT09IG51bGwgfHwgeCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IFN0cmluZyh4KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIE9wdGlvbmFsdG9Mb25nKHgpIHsKICAgICAgICAgICAgcmV0dXJuIHggPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IHRvTG9uZyh4KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIE9wdGlvbmFsQm9vbGVhbih4KSB7CiAgICAgICAgICAgIHJldHVybiB4ID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiBCb29sZWFuKHgpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gT3B0aW9uYWxPYmplY3QoeCkgewogICAgICAgICAgICByZXR1cm4geCA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogT2JqZWN0KHgpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdG9DYWxsYmFjayh4KSB7CiAgICAgICAgICAgIHZhciB0ID0gdHlwZW9mIHg7CiAgICAgICAgICAgIGlmICh0ID09PSAiZnVuY3Rpb24iIHx8IHQgPT09ICJvYmplY3QiKSByZXR1cm4geDtlbHNlIHRocm93IFR5cGVFcnJvcigiRXhwZWN0ZWQgY2FsbGJhY2s7IGdvdDogIiArIHgpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdG9DYWxsYmFja09yTnVsbCh4KSB7CiAgICAgICAgICAgIHJldHVybiB4ID09PSBudWxsIHx8IHggPT09IHVuZGVmaW5lZCA/IG51bGwgOiB0b0NhbGxiYWNrKHgpOwogICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyBjb25zdHJ1Y3RvciB0YWtlcyBhIHNpbmdsZSBvYmplY3QgYXMgaXRzIGFyZ3VtZW50IGFuZCBsb29rcyBmb3IKICAgICAgICAvLyB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXMgb2YgdGhhdCBvYmplY3Q6CiAgICAgICAgLy8KICAgICAgICAvLyAgICBuYW1lICAgICAgICAgLy8gVGhlIG5hbWUgb2YgdGhlIGludGVyZmFjZQogICAgICAgIC8vICAgIHN1cGVyY2xhc3MgICAvLyBUaGUgc3VwZXJjbGFzcyBjb25zdHJ1Y3RvcgogICAgICAgIC8vICAgIHByb3h5SGFuZGxlciAvLyBUaGUgcHJveHkgaGFuZGxlciBjb25zdHJ1Y3RvciwgaWYgb25lIGlzIG5lZWRlZAogICAgICAgIC8vICAgIGNvbnN0YW50cyAgICAvLyBjb25zdGFudHMgZGVmaW5lZCBieSB0aGUgaW50ZXJmYWNlCiAgICAgICAgLy8gICAgbWVtYmVycyAgICAgIC8vIGludGVyZmFjZSBhdHRyaWJ1dGVzIGFuZCBtZXRob2RzCiAgICAgICAgLy8gICAgY29uc3RydWN0b3IgIC8vIG9wdGlvbmFsIHB1YmxpYyBjb25zdHJ1Y3Rvci4KICAgICAgICAvLwogICAgICAgIC8vIEl0IHJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogICAgICAgIC8vICAgcHVibGljSW50ZXJmYWNlIC8vIFRoZSBwdWJsaWMgaW50ZXJmYWNlIHRvIGJlIHBsYWNlZCBpbiB0aGUgZ2xvYmFsIHNjb3BlCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgLy8gVGhlIGlucHV0IGNvbnN0cnVjdG9yIG9yIGEgc3ludGhldGljIG5vLW9wIG9uZS4KICAgICAgICAvLyAgIHByb3RvdHlwZSAgICAgICAvLyBUaGUgcHJvdG90eXBlIG9iamVjdCBmb3IgdGhlIGludGVyZmFjZQogICAgICAgIC8vICAgICAgICAgICAgICAgICAgIC8vIEFsc28gYXZhaWxhYmxlIGFzIHB1YmxpY0ludGVyZmFjZS5wcm90b3R5cGUKICAgICAgICAvLyAgIGZhY3RvcnkgICAgICAgICAvLyBBIGZhY3RvcnkgZnVuY3Rpb24gZm9yIGNyZWF0aW5nIGFuIGluc3RhbmNlCiAgICAgICAgLy8KICAgICAgICBmdW5jdGlvbiBJRExJbnRlcmZhY2UobykgewogICAgICAgICAgICB2YXIgbmFtZSA9IG8ubmFtZSB8fCAiIjsKICAgICAgICAgICAgdmFyIHN1cGVyY2xhc3MgPSBvLnN1cGVyY2xhc3M7CiAgICAgICAgICAgIHZhciBwcm94eUZhY3RvcnkgPSBvLnByb3h5RmFjdG9yeTsKICAgICAgICAgICAgdmFyIGNvbnN0YW50cyA9IG8uY29uc3RhbnRzIHx8IHt9OwogICAgICAgICAgICB2YXIgbWVtYmVycyA9IG8ubWVtYmVycyB8fCB7fTsKICAgICAgICAgICAgdmFyIHByb3RvdHlwZSwgaW50ZXJmYWNlT2JqZWN0OwoKICAgICAgICAgICAgLy8gU2V0IHVwIHRoZSBwcm90b3R5cGUgb2JqZWN0CiAgICAgICAgICAgIHByb3RvdHlwZSA9IHN1cGVyY2xhc3MgPyBPLmNyZWF0ZShzdXBlcmNsYXNzLnByb3RvdHlwZSkgOiB7fTsKCiAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eShvLCAiY29uc3RydWN0b3IiKSkgewogICAgICAgICAgICAgICAgaW50ZXJmYWNlT2JqZWN0ID0gby5jb25zdHJ1Y3RvcjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFRoZSBpbnRlcmZhY2Ugb2JqZWN0IGlzIHN1cHBvc2VkIHRvIHdvcmsgd2l0aCBpbnN0YW5jZW9mLCBidXQgaXMKICAgICAgICAgICAgICAgIC8vIG5vdCBzdXBwb3NlZCB0byBiZSBjYWxsYWJsZS4gIFdlIGNhbid0IGNvbmZvcm0gdG8gYm90aCByZXF1aXJlbWVudHMKICAgICAgICAgICAgICAgIC8vIHNvIHdlIG1ha2UgdGhlIGludGVyZmFjZSBvYmplY3QgYSBmdW5jdGlvbiB0aGF0IHRocm93cyB3aGVuIGNhbGxlZC4KICAgICAgICAgICAgICAgIGludGVyZmFjZU9iamVjdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKG5hbWUgKyAiIGlzIG5vdCAoc3VwcG9zZWQgdG8gYmUpIGEgZnVuY3Rpb24iKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFdlYklETCBzYXlzIHRoYXQgdGhlIGludGVyZmFjZSBvYmplY3QgaGFzIHRoaXMgcHJvdG90eXBlIHByb3BlcnR5CiAgICAgICAgICAgIGludGVyZmFjZU9iamVjdC5wcm90b3R5cGUgPSBwcm90b3R5cGU7CiAgICAgICAgICAgIC8vIE1ha2UgaXQgcmVhZC1vbmx5CiAgICAgICAgICAgIE8uZGVmaW5lUHJvcGVydHkoaW50ZXJmYWNlT2JqZWN0LCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7CiAgICAgICAgICAgIC8vIFhYWDogdGhlIGxpbmUgYmVsb3cgd29ya3MgaW4gc3BpZGVybW9ua2V5LCBidXQgbm90IGluIG5vZGUuCiAgICAgICAgICAgIC8vIHByb2JhYmx5IHJlbGF0ZWQgdGhlIGZhY3QgdGhhdCBwcm90b3R5cGUgYWxyZWFkeSBleGlzdHMgYW5kCiAgICAgICAgICAgIC8vIGlzIHdyaXRhYmxlIGJ1dCBub24tY29uZmlndXJhYmxlPwogICAgICAgICAgICAvLyAgZGVmaW5lSGlkZGVuQ29uc3RhbnRQcm9wKGludGVyZmFjZU9iamVjdCwgInByb3RvdHlwZSIsIHByb3RvdHlwZSk7CgogICAgICAgICAgICAvLyBXZWJJREwgYWxzbyBzYXlzIHRoYXQgdGhlIHByb3RvdHlwZSBwb2ludHMgYmFjayB0byB0aGUgaW50ZXJmYWNlIG9iamVjdAogICAgICAgICAgICAvLyBpbnN0ZWFkIG9mIHRoZSByZWFsIGNvbnN0cnVjdG9yLgogICAgICAgICAgICBkZWZpbmVIaWRkZW5Qcm9wKHByb3RvdHlwZSwgImNvbnN0cnVjdG9yIiwgaW50ZXJmYWNlT2JqZWN0KTsKCiAgICAgICAgICAgIC8vIENvbnN0YW50cyBtdXN0IGJlIGRlZmluZWQgb24gYm90aCB0aGUgcHJvdG90eXBlIGFuZCBpbnRlcmZhY2Ugb2JqZWN0cwogICAgICAgICAgICAvLyBBbmQgdGhleSBtdXN0IHJlYWQtb25seSBhbmQgbm9uLWNvbmZpZ3VyYWJsZQogICAgICAgICAgICBmb3IgKHZhciBjIGluIGNvbnN0YW50cykgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gY29uc3RhbnRzW2NdOwogICAgICAgICAgICAgICAgZGVmaW5lQ29uc3RhbnRQcm9wKHByb3RvdHlwZSwgYywgdmFsdWUpOwogICAgICAgICAgICAgICAgZGVmaW5lQ29uc3RhbnRQcm9wKGludGVyZmFjZU9iamVjdCwgYywgdmFsdWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBOb3cgY29weSBhdHRyaWJ1dGVzIGFuZCBtZXRob2RzIG9udG8gdGhlIHByb3RvdHlwZSBvYmplY3QuCiAgICAgICAgICAgIC8vIE1lbWJlcnMgc2hvdWxkIGp1c3QgYmUgYW4gb3JkaW5hcnkgb2JqZWN0LiAgQXR0cmlidXRlcyBzaG91bGQgYmUKICAgICAgICAgICAgLy8gZGVmaW5lZCB3aXRoIGdldHRlcnMgYW5kIHNldHRlcnMuIE1ldGhvZHMgc2hvdWxkIGJlIHJlZ3VsYXIgcHJvcGVydGllcy4KICAgICAgICAgICAgLy8gVGhpcyB3aWxsIG1lYW4gdGhhdCB0aGUgbWVtYmVycyB3aWxsIGFsbCBiZSBlbnVtZXJhYmxlLCBjb25maWd1cmFibGUKICAgICAgICAgICAgLy8gYW5kIHdyaXRhYmxlICh1bmxlc3MgdGhlcmUgaXMgbm8gc2V0dGVyKSBhcyB0aGV5IGFyZSBzdXBwb3NlZCB0byBiZS4KICAgICAgICAgICAgZm9yICh2YXIgbSBpbiBtZW1iZXJzKSB7CiAgICAgICAgICAgICAgICAvLyBHZXQgdGhlIHByb3BlcnR5IGRlc2NyaXB0b3Igb2YgdGhlIG1lbWJlcgogICAgICAgICAgICAgICAgdmFyIGRlc2MgPSBPLmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtZW1iZXJzLCBtKTsKCiAgICAgICAgICAgICAgICAvLyBOb3cgY29weSB0aGUgcHJvcGVydHkgdG8gdGhlIHByb3RvdHlwZSBvYmplY3QKICAgICAgICAgICAgICAgIE8uZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCBtLCBkZXNjKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgdGhlIGludGVyZmFjZSBkb2VzIG5vdCBhbHJlYWR5IGRlZmluZSBhIHRvU3RyaW5nIG1ldGhvZCwgYWRkIG9uZS4KICAgICAgICAgICAgLy8gVGhpcyB3aWxsIGhlbHAgdG8gbWFrZSBkZWJ1Z2dpbmcgZWFzaWVyLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBYWFg6IEknbSBub3Qgc3VyZSBpZiB0aGlzIGlzIGxlZ2FsIGFjY29yZGluZyB0byBXZWJJREwgYW5kIERPTSBDb3JlLgogICAgICAgICAgICAvLyBYWFggTWF5YmUgSSBjb3VsZCBtb3ZlIGl0IGRvd24gdG8gYW4gb2JqZWN0IG9uIHRoZSBwcm90b3R5cGUgY2hhaW4KICAgICAgICAgICAgLy8gYWJvdmUgT2JqZWN0LnByb3RvdHlwZS4gIEJ1dCB0aGVuIEknZCBuZWVkIHNvbWUgd2F5IHRvIGRldGVybWluZQogICAgICAgICAgICAvLyB0aGUgdHlwZSBuYW1lLiAgTWF5YmUgdGhlIG5hbWUgb2YgdGhlIHB1YmxpYyAiY29uc3RydWN0b3IiIGZ1bmN0aW9uPwogICAgICAgICAgICAvLyBCdXQgdGhlbiBJJ2QgaGF2ZSB0byBjcmVhdGUgdGhhdCBmdW5jdGlvbiB3aXRoIGV2YWwsIEkgdGhpbmsuCiAgICAgICAgICAgIGlmICghaGFzT3duUHJvcGVydHkobWVtYmVycywgInRvU3RyaW5nIikpIHsKICAgICAgICAgICAgICAgIHByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIltvYmplY3QgIiArIG5hbWUgKyAiXSI7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBOb3cgc2V0IHVwIHRoZSBmaWVsZHMgb2YgdGhpcyBvYmplY3QKICAgICAgICAgICAgdGhpcy5wcm90b3R5cGUgPSBwcm90b3R5cGU7CiAgICAgICAgICAgIHRoaXMucHVibGljSW50ZXJmYWNlID0gaW50ZXJmYWNlT2JqZWN0OwogICAgICAgICAgICB0aGlzLmZhY3RvcnkgPSBwcm94eUZhY3RvcnkgPyBwcm94eUZhY3RvcnkgOiBPLmNyZWF0ZS5iaW5kKE9iamVjdCwgcHJvdG90eXBlLCB7fSk7CiAgICAgICAgfQoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9kb21jb3JlLmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvZG9tY29yZS5qcyIKICAgICAgICAvLwogICAgICAgIC8vIERPIE5PVCBFRElULgogICAgICAgIC8vIFRoaXMgZmlsZSB3YXMgZ2VuZXJhdGVkIGJ5IGlkbDJkb21qcyBmcm9tIHNyYy9pZGwvZG9tY29yZS5pZGwKICAgICAgICAvLwoKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgRXZlbnQKICAgICAgICAvLwoKICAgICAgICAvLyBDb25zdGFudHMgZGVmaW5lZCBieSBFdmVudAogICAgICAgIHZhciBDQVBUVVJJTkdfUEhBU0UgPSAxOwogICAgICAgIHZhciBBVF9UQVJHRVQgPSAyOwogICAgICAgIHZhciBCVUJCTElOR19QSEFTRSA9IDM7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJFdmVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5FdmVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJFdmVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkV2ZW50IiwKICAgICAgICAgICAgICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiBFdmVudCh0eXBlLCBldmVudEluaXREaWN0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAobmV3IGltcGwuRXZlbnQoU3RyaW5nKHR5cGUpLCBPcHRpb25hbEV2ZW50SW5pdChldmVudEluaXREaWN0KSkpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbnN0YW50czogewogICAgICAgICAgICAgICAgICAgIENBUFRVUklOR19QSEFTRTogQ0FQVFVSSU5HX1BIQVNFLAogICAgICAgICAgICAgICAgICAgIEFUX1RBUkdFVDogQVRfVEFSR0VULAogICAgICAgICAgICAgICAgICAgIEJVQkJMSU5HX1BIQVNFOiBCVUJCTElOR19QSEFTRQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgdHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50eXBlOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0YXJnZXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS50YXJnZXQpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjdXJyZW50VGFyZ2V0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuY3VycmVudFRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGV2ZW50UGhhc2UoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZXZlbnRQaGFzZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBzdG9wUHJvcGFnYXRpb246IGZ1bmN0aW9uIHN0b3BQcm9wYWdhdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjogZnVuY3Rpb24gc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJ1YmJsZXMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYnViYmxlczsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY2FuY2VsYWJsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jYW5jZWxhYmxlOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0OiBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGRlZmF1bHRQcmV2ZW50ZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGVmYXVsdFByZXZlbnRlZDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaXNUcnVzdGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmlzVHJ1c3RlZDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdGltZVN0YW1wKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnRpbWVTdGFtcDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBpbml0RXZlbnQ6IGZ1bmN0aW9uIGluaXRFdmVudCh0eXBlLCBidWJibGVzLCBjYW5jZWxhYmxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5pbml0RXZlbnQoU3RyaW5nKHR5cGUpLCBCb29sZWFuKGJ1YmJsZXMpLCBCb29sZWFuKGNhbmNlbGFibGUpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBEaWN0aW9uYXJ5IEV2ZW50SW5pdAogICAgICAgIC8vCgogICAgICAgIGZ1bmN0aW9uIEV2ZW50SW5pdChvKSB7CiAgICAgICAgICAgIHZhciBydiA9IE8uY3JlYXRlKEV2ZW50SW5pdC5wcm90b3R5cGUpOwogICAgICAgICAgICBpZiAoJ2J1YmJsZXMnIGluIG8pIHJ2WydidWJibGVzJ10gPSBCb29sZWFuKG9bJ2J1YmJsZXMnXSk7CiAgICAgICAgICAgIGlmICgnY2FuY2VsYWJsZScgaW4gbykgcnZbJ2NhbmNlbGFibGUnXSA9IEJvb2xlYW4ob1snY2FuY2VsYWJsZSddKTsKICAgICAgICAgICAgcmV0dXJuIHJ2OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBPcHRpb25hbEV2ZW50SW5pdChvKSB7CiAgICAgICAgICAgIHJldHVybiBvID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiBFdmVudEluaXQobyk7CiAgICAgICAgfQogICAgICAgIEV2ZW50SW5pdC5wcm90b3R5cGUgPSB7fTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgQ3VzdG9tRXZlbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiQ3VzdG9tRXZlbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuQ3VzdG9tRXZlbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiQ3VzdG9tRXZlbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJDdXN0b21FdmVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuRXZlbnQsCiAgICAgICAgICAgICAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24gQ3VzdG9tRXZlbnQodHlwZSwgZXZlbnRJbml0RGljdCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKG5ldyBpbXBsLkN1c3RvbUV2ZW50KFN0cmluZyh0eXBlKSwgT3B0aW9uYWxDdXN0b21FdmVudEluaXQoZXZlbnRJbml0RGljdCkpKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IGRldGFpbCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5kZXRhaWw7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gRGljdGlvbmFyeSBDdXN0b21FdmVudEluaXQKICAgICAgICAvLwoKICAgICAgICBmdW5jdGlvbiBDdXN0b21FdmVudEluaXQobykgewogICAgICAgICAgICB2YXIgcnYgPSBPLmNyZWF0ZShDdXN0b21FdmVudEluaXQucHJvdG90eXBlKTsKICAgICAgICAgICAgaWYgKCdidWJibGVzJyBpbiBvKSBydlsnYnViYmxlcyddID0gQm9vbGVhbihvWydidWJibGVzJ10pOwogICAgICAgICAgICBpZiAoJ2NhbmNlbGFibGUnIGluIG8pIHJ2WydjYW5jZWxhYmxlJ10gPSBCb29sZWFuKG9bJ2NhbmNlbGFibGUnXSk7CiAgICAgICAgICAgIGlmICgnZGV0YWlsJyBpbiBvKSBydlsnZGV0YWlsJ10gPSBvWydkZXRhaWwnXTsKICAgICAgICAgICAgcmV0dXJuIHJ2OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBPcHRpb25hbEN1c3RvbUV2ZW50SW5pdChvKSB7CiAgICAgICAgICAgIHJldHVybiBvID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiBDdXN0b21FdmVudEluaXQobyk7CiAgICAgICAgfQogICAgICAgIEN1c3RvbUV2ZW50SW5pdC5wcm90b3R5cGUgPSBPLmNyZWF0ZShFdmVudEluaXQucHJvdG90eXBlKTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgRXZlbnRUYXJnZXQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiRXZlbnRUYXJnZXQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuRXZlbnRUYXJnZXQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiRXZlbnRUYXJnZXQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJFdmVudFRhcmdldCIsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lciwgY2FwdHVyZSkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYWRkRXZlbnRMaXN0ZW5lcihTdHJpbmcodHlwZSksIHRvQ2FsbGJhY2tPck51bGwobGlzdGVuZXIpLCBPcHRpb25hbEJvb2xlYW4oY2FwdHVyZSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHBvc3RNZXNzYWdlOiBmdW5jdGlvbiBwb3N0TWVzc2FnZShkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5wb3N0TWVzc2FnZShkYXRhKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyLCBjYXB0dXJlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5yZW1vdmVFdmVudExpc3RlbmVyKFN0cmluZyh0eXBlKSwgdG9DYWxsYmFja09yTnVsbChsaXN0ZW5lciksIE9wdGlvbmFsQm9vbGVhbihjYXB0dXJlKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hFdmVudDogZnVuY3Rpb24gZGlzcGF0Y2hFdmVudChldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmRpc3BhdGNoRXZlbnQodW53cmFwKGV2ZW50KSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIE5vZGUKICAgICAgICAvLwoKICAgICAgICAvLyBDb25zdGFudHMgZGVmaW5lZCBieSBOb2RlCiAgICAgICAgdmFyIEVMRU1FTlRfTk9ERSA9IDE7CiAgICAgICAgdmFyIEFUVFJJQlVURV9OT0RFID0gMjsKICAgICAgICB2YXIgVEVYVF9OT0RFID0gMzsKICAgICAgICB2YXIgQ0RBVEFfU0VDVElPTl9OT0RFID0gNDsKICAgICAgICB2YXIgRU5USVRZX1JFRkVSRU5DRV9OT0RFID0gNTsKICAgICAgICB2YXIgRU5USVRZX05PREUgPSA2OwogICAgICAgIHZhciBQUk9DRVNTSU5HX0lOU1RSVUNUSU9OX05PREUgPSA3OwogICAgICAgIHZhciBDT01NRU5UX05PREUgPSA4OwogICAgICAgIHZhciBET0NVTUVOVF9OT0RFID0gOTsKICAgICAgICB2YXIgRE9DVU1FTlRfVFlQRV9OT0RFID0gMTA7CiAgICAgICAgdmFyIERPQ1VNRU5UX0ZSQUdNRU5UX05PREUgPSAxMTsKICAgICAgICB2YXIgTk9UQVRJT05fTk9ERSA9IDEyOwogICAgICAgIHZhciBET0NVTUVOVF9QT1NJVElPTl9ESVNDT05ORUNURUQgPSAweDAxOwogICAgICAgIHZhciBET0NVTUVOVF9QT1NJVElPTl9QUkVDRURJTkcgPSAweDAyOwogICAgICAgIHZhciBET0NVTUVOVF9QT1NJVElPTl9GT0xMT1dJTkcgPSAweDA0OwogICAgICAgIHZhciBET0NVTUVOVF9QT1NJVElPTl9DT05UQUlOUyA9IDB4MDg7CiAgICAgICAgdmFyIERPQ1VNRU5UX1BPU0lUSU9OX0NPTlRBSU5FRF9CWSA9IDB4MTA7CiAgICAgICAgdmFyIERPQ1VNRU5UX1BPU0lUSU9OX0lNUExFTUVOVEFUSU9OX1NQRUNJRklDID0gMHgyMDsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIk5vZGUiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuTm9kZS5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJOb2RlIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiTm9kZSIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuRXZlbnRUYXJnZXQsCiAgICAgICAgICAgICAgICBjb25zdGFudHM6IHsKICAgICAgICAgICAgICAgICAgICBFTEVNRU5UX05PREU6IEVMRU1FTlRfTk9ERSwKICAgICAgICAgICAgICAgICAgICBBVFRSSUJVVEVfTk9ERTogQVRUUklCVVRFX05PREUsCiAgICAgICAgICAgICAgICAgICAgVEVYVF9OT0RFOiBURVhUX05PREUsCiAgICAgICAgICAgICAgICAgICAgQ0RBVEFfU0VDVElPTl9OT0RFOiBDREFUQV9TRUNUSU9OX05PREUsCiAgICAgICAgICAgICAgICAgICAgRU5USVRZX1JFRkVSRU5DRV9OT0RFOiBFTlRJVFlfUkVGRVJFTkNFX05PREUsCiAgICAgICAgICAgICAgICAgICAgRU5USVRZX05PREU6IEVOVElUWV9OT0RFLAogICAgICAgICAgICAgICAgICAgIFBST0NFU1NJTkdfSU5TVFJVQ1RJT05fTk9ERTogUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFLAogICAgICAgICAgICAgICAgICAgIENPTU1FTlRfTk9ERTogQ09NTUVOVF9OT0RFLAogICAgICAgICAgICAgICAgICAgIERPQ1VNRU5UX05PREU6IERPQ1VNRU5UX05PREUsCiAgICAgICAgICAgICAgICAgICAgRE9DVU1FTlRfVFlQRV9OT0RFOiBET0NVTUVOVF9UWVBFX05PREUsCiAgICAgICAgICAgICAgICAgICAgRE9DVU1FTlRfRlJBR01FTlRfTk9ERTogRE9DVU1FTlRfRlJBR01FTlRfTk9ERSwKICAgICAgICAgICAgICAgICAgICBOT1RBVElPTl9OT0RFOiBOT1RBVElPTl9OT0RFLAogICAgICAgICAgICAgICAgICAgIERPQ1VNRU5UX1BPU0lUSU9OX0RJU0NPTk5FQ1RFRDogRE9DVU1FTlRfUE9TSVRJT05fRElTQ09OTkVDVEVELAogICAgICAgICAgICAgICAgICAgIERPQ1VNRU5UX1BPU0lUSU9OX1BSRUNFRElORzogRE9DVU1FTlRfUE9TSVRJT05fUFJFQ0VESU5HLAogICAgICAgICAgICAgICAgICAgIERPQ1VNRU5UX1BPU0lUSU9OX0ZPTExPV0lORzogRE9DVU1FTlRfUE9TSVRJT05fRk9MTE9XSU5HLAogICAgICAgICAgICAgICAgICAgIERPQ1VNRU5UX1BPU0lUSU9OX0NPTlRBSU5TOiBET0NVTUVOVF9QT1NJVElPTl9DT05UQUlOUywKICAgICAgICAgICAgICAgICAgICBET0NVTUVOVF9QT1NJVElPTl9DT05UQUlORURfQlk6IERPQ1VNRU5UX1BPU0lUSU9OX0NPTlRBSU5FRF9CWSwKICAgICAgICAgICAgICAgICAgICBET0NVTUVOVF9QT1NJVElPTl9JTVBMRU1FTlRBVElPTl9TUEVDSUZJQzogRE9DVU1FTlRfUE9TSVRJT05fSU1QTEVNRU5UQVRJT05fU1BFQ0lGSUMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IG5vZGVUeXBlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm5vZGVUeXBlOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBub2RlTmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ub2RlTmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYmFzZVVSSSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5iYXNlVVJJOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvd25lckRvY3VtZW50KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykub3duZXJEb2N1bWVudCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHBhcmVudE5vZGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5wYXJlbnROb2RlKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcGFyZW50RWxlbWVudCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnBhcmVudEVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGhhc0NoaWxkTm9kZXM6IGZ1bmN0aW9uIGhhc0NoaWxkTm9kZXMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaGFzQ2hpbGROb2RlcygpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjaGlsZE5vZGVzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuY2hpbGROb2Rlcyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZpcnN0Q2hpbGQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5maXJzdENoaWxkKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbGFzdENoaWxkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykubGFzdENoaWxkKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcHJldmlvdXNTaWJsaW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykucHJldmlvdXNTaWJsaW5nKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbmV4dFNpYmxpbmcoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5uZXh0U2libGluZyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgY29tcGFyZURvY3VtZW50UG9zaXRpb246IGZ1bmN0aW9uIGNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKG90aGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY29tcGFyZURvY3VtZW50UG9zaXRpb24odW53cmFwKG90aGVyKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG5vZGVWYWx1ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ub2RlVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbm9kZVZhbHVlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubm9kZVZhbHVlID0gU3RyaW5nT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHRleHRDb250ZW50KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnRleHRDb250ZW50OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHRleHRDb250ZW50KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudGV4dENvbnRlbnQgPSBTdHJpbmdPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBpbnNlcnRCZWZvcmU6IGZ1bmN0aW9uIGluc2VydEJlZm9yZShuZXdDaGlsZCwgcmVmQ2hpbGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmluc2VydEJlZm9yZSh1bndyYXAobmV3Q2hpbGQpLCB1bndyYXBPck51bGwocmVmQ2hpbGQpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgcmVwbGFjZUNoaWxkOiBmdW5jdGlvbiByZXBsYWNlQ2hpbGQobmV3Q2hpbGQsIG9sZENoaWxkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5yZXBsYWNlQ2hpbGQodW53cmFwKG5ld0NoaWxkKSwgdW53cmFwKG9sZENoaWxkKSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHJlbW92ZUNoaWxkOiBmdW5jdGlvbiByZW1vdmVDaGlsZChvbGRDaGlsZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykucmVtb3ZlQ2hpbGQodW53cmFwKG9sZENoaWxkKSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGFwcGVuZENoaWxkOiBmdW5jdGlvbiBhcHBlbmRDaGlsZChuZXdDaGlsZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuYXBwZW5kQ2hpbGQodW53cmFwKG5ld0NoaWxkKSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGNsb25lTm9kZTogZnVuY3Rpb24gY2xvbmVOb2RlKGRlZXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmNsb25lTm9kZShCb29sZWFuKGRlZXApKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgaXNTYW1lTm9kZTogZnVuY3Rpb24gaXNTYW1lTm9kZShub2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaXNTYW1lTm9kZSh1bndyYXBPck51bGwobm9kZSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGlzRXF1YWxOb2RlOiBmdW5jdGlvbiBpc0VxdWFsTm9kZShub2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaXNFcXVhbE5vZGUodW53cmFwT3JOdWxsKG5vZGUpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBsb29rdXBQcmVmaXg6IGZ1bmN0aW9uIGxvb2t1cFByZWZpeChuYW1lc3BhY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5sb29rdXBQcmVmaXgoU3RyaW5nT3JFbXB0eShuYW1lc3BhY2UpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBsb29rdXBOYW1lc3BhY2VVUkk6IGZ1bmN0aW9uIGxvb2t1cE5hbWVzcGFjZVVSSShwcmVmaXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5sb29rdXBOYW1lc3BhY2VVUkkoU3RyaW5nT3JOdWxsKHByZWZpeCkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGlzRGVmYXVsdE5hbWVzcGFjZTogZnVuY3Rpb24gaXNEZWZhdWx0TmFtZXNwYWNlKG5hbWVzcGFjZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmlzRGVmYXVsdE5hbWVzcGFjZShTdHJpbmdPckVtcHR5KG5hbWVzcGFjZSkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBEb2N1bWVudEZyYWdtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkRvY3VtZW50RnJhZ21lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuRG9jdW1lbnRGcmFnbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJEb2N1bWVudEZyYWdtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiRG9jdW1lbnRGcmFnbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuTm9kZSwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHt9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBEb2N1bWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJEb2N1bWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5Eb2N1bWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJEb2N1bWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkRvY3VtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5Ob2RlLAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIF9zZXRNdXRhdGlvbkhhbmRsZXI6IGZ1bmN0aW9uIF9zZXRNdXRhdGlvbkhhbmRsZXIoaGFuZGxlcikgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuX3NldE11dGF0aW9uSGFuZGxlcih0b0NhbGxiYWNrKGhhbmRsZXIpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBfZGlzcGF0Y2hSZW5kZXJlckV2ZW50OiBmdW5jdGlvbiBfZGlzcGF0Y2hSZW5kZXJlckV2ZW50KHRhcmdldCwgdHlwZSwgZGV0YWlscykgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuX2Rpc3BhdGNoUmVuZGVyZXJFdmVudCh0b1VMb25nKHRhcmdldCksIFN0cmluZyh0eXBlKSwgRXZlbnRJbml0KGRldGFpbHMpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaW1wbGVtZW50YXRpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5pbXBsZW1lbnRhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGRvY3VtZW50VVJJKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmRvY3VtZW50VVJJOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRvY3VtZW50VVJJKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZG9jdW1lbnRVUkkgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY29tcGF0TW9kZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jb21wYXRNb2RlOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBkb2N0eXBlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuZG9jdHlwZSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGRvY3VtZW50RWxlbWVudCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmRvY3VtZW50RWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0RWxlbWVudHNCeVRhZ05hbWU6IGZ1bmN0aW9uIGdldEVsZW1lbnRzQnlUYWdOYW1lKHF1YWxpZmllZE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmdldEVsZW1lbnRzQnlUYWdOYW1lKFN0cmluZyhxdWFsaWZpZWROYW1lKSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldEVsZW1lbnRzQnlUYWdOYW1lTlM6IGZ1bmN0aW9uIGdldEVsZW1lbnRzQnlUYWdOYW1lTlMobmFtZXNwYWNlLCBsb2NhbE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmdldEVsZW1lbnRzQnlUYWdOYW1lTlMoU3RyaW5nKG5hbWVzcGFjZSksIFN0cmluZyhsb2NhbE5hbWUpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0RWxlbWVudHNCeUNsYXNzTmFtZTogZnVuY3Rpb24gZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGFzc05hbWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFN0cmluZyhjbGFzc05hbWVzKSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldEVsZW1lbnRCeUlkOiBmdW5jdGlvbiBnZXRFbGVtZW50QnlJZChlbGVtZW50SWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmdldEVsZW1lbnRCeUlkKFN0cmluZyhlbGVtZW50SWQpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgcXVlcnlTZWxlY3RvcjogZnVuY3Rpb24gcXVlcnlTZWxlY3RvcihzZWxlY3RvcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykucXVlcnlTZWxlY3RvcihTdHJpbmcoc2VsZWN0b3IpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgcXVlcnlTZWxlY3RvckFsbDogZnVuY3Rpb24gcXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykucXVlcnlTZWxlY3RvckFsbChTdHJpbmcoc2VsZWN0b3IpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlRWxlbWVudDogZnVuY3Rpb24gY3JlYXRlRWxlbWVudChsb2NhbE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmNyZWF0ZUVsZW1lbnQoU3RyaW5nT3JFbXB0eShsb2NhbE5hbWUpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlRWxlbWVudE5TOiBmdW5jdGlvbiBjcmVhdGVFbGVtZW50TlMobmFtZXNwYWNlLCBxdWFsaWZpZWROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5jcmVhdGVFbGVtZW50TlMoU3RyaW5nKG5hbWVzcGFjZSksIFN0cmluZyhxdWFsaWZpZWROYW1lKSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGNyZWF0ZURvY3VtZW50RnJhZ21lbnQ6IGZ1bmN0aW9uIGNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGNyZWF0ZVRleHROb2RlOiBmdW5jdGlvbiBjcmVhdGVUZXh0Tm9kZShkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5jcmVhdGVUZXh0Tm9kZShTdHJpbmcoZGF0YSkpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBjcmVhdGVDb21tZW50OiBmdW5jdGlvbiBjcmVhdGVDb21tZW50KGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmNyZWF0ZUNvbW1lbnQoU3RyaW5nKGRhdGEpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlUHJvY2Vzc2luZ0luc3RydWN0aW9uOiBmdW5jdGlvbiBjcmVhdGVQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24odGFyZ2V0LCBkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5jcmVhdGVQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24oU3RyaW5nKHRhcmdldCksIFN0cmluZyhkYXRhKSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGltcG9ydE5vZGU6IGZ1bmN0aW9uIGltcG9ydE5vZGUobm9kZSwgZGVlcCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuaW1wb3J0Tm9kZSh1bndyYXAobm9kZSksIEJvb2xlYW4oZGVlcCkpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBhZG9wdE5vZGU6IGZ1bmN0aW9uIGFkb3B0Tm9kZShub2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5hZG9wdE5vZGUodW53cmFwKG5vZGUpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlRXZlbnQ6IGZ1bmN0aW9uIGNyZWF0ZUV2ZW50KGV2ZW50SW50ZXJmYWNlTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuY3JlYXRlRXZlbnQoU3RyaW5nKGV2ZW50SW50ZXJmYWNlTmFtZSkpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgVVJMKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLlVSTDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZG9tYWluKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmRvbWFpbjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkb21haW4obmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kb21haW4gPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcmVmZXJyZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucmVmZXJyZXI7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvb2tpZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jb29raWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgY29va2llKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuY29va2llID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxhc3RNb2RpZmllZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5sYXN0TW9kaWZpZWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHJlYWR5U3RhdGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucmVhZHlTdGF0ZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdGl0bGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudGl0bGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdGl0bGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50aXRsZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBkaXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGlyOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRpcihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRpciA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBib2R5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuYm9keSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYm9keShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmJvZHkgPSB1bndyYXBPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaGVhZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmhlYWQpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBpbWFnZXMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5pbWFnZXMpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBlbWJlZHMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5lbWJlZHMpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwbHVnaW5zKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykucGx1Z2lucyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxpbmtzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykubGlua3MpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBmb3JtcygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmZvcm1zKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2NyaXB0cygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnNjcmlwdHMpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldEVsZW1lbnRzQnlOYW1lOiBmdW5jdGlvbiBnZXRFbGVtZW50c0J5TmFtZShlbGVtZW50TmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuZ2V0RWxlbWVudHNCeU5hbWUoU3RyaW5nKGVsZW1lbnROYW1lKSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBpbm5lckhUTUwoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaW5uZXJIVE1MOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGlubmVySFRNTChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmlubmVySFRNTCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHdyaXRlOiBmdW5jdGlvbiB3cml0ZSh0ZXh0IC8qLi4uKi8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB1bndyYXAodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKGFyZ3MsIFN0cmluZyhhcmd1bWVudHNbaV0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBhcHBseShjb250ZXh0LndyaXRlLCBjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICB3cml0ZWxuOiBmdW5jdGlvbiB3cml0ZWxuKHRleHQgLyouLi4qLykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGV4dCA9IHVud3JhcCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2goYXJncywgU3RyaW5nKGFyZ3VtZW50c1tpXSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGx5KGNvbnRleHQud3JpdGVsbiwgY29udGV4dCwgYXJncyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGRlZmF1bHRWaWV3KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuZGVmYXVsdFZpZXcpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmFib3J0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uYWJvcnQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25hYm9ydChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uYWJvcnQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uYmx1cigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmJsdXI7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25ibHVyKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25ibHVyID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmNhbnBsYXkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25jYW5wbGF5OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uY2FucGxheShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uY2FucGxheSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25jYW5wbGF5dGhyb3VnaCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmNhbnBsYXl0aHJvdWdoOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uY2FucGxheXRocm91Z2gobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmNhbnBsYXl0aHJvdWdoID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmNoYW5nZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmNoYW5nZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmNoYW5nZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uY2hhbmdlID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmNsaWNrKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uY2xpY2s7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25jbGljayhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uY2xpY2sgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uY29udGV4dG1lbnUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25jb250ZXh0bWVudTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmNvbnRleHRtZW51KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25jb250ZXh0bWVudSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25jdWVjaGFuZ2UoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25jdWVjaGFuZ2U7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25jdWVjaGFuZ2UobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmN1ZWNoYW5nZSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25kYmxjbGljaygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmRibGNsaWNrOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uZGJsY2xpY2sobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmRibGNsaWNrID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmRyYWcoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25kcmFnOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uZHJhZyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uZHJhZyA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25kcmFnZW5kKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZHJhZ2VuZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmRyYWdlbmQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmRyYWdlbmQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uZHJhZ2VudGVyKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZHJhZ2VudGVyOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uZHJhZ2VudGVyKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25kcmFnZW50ZXIgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uZHJhZ2xlYXZlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZHJhZ2xlYXZlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uZHJhZ2xlYXZlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25kcmFnbGVhdmUgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uZHJhZ292ZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25kcmFnb3ZlcjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmRyYWdvdmVyKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25kcmFnb3ZlciA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25kcmFnc3RhcnQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25kcmFnc3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25kcmFnc3RhcnQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmRyYWdzdGFydCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25kcm9wKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZHJvcDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmRyb3AobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmRyb3AgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uZHVyYXRpb25jaGFuZ2UoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25kdXJhdGlvbmNoYW5nZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmR1cmF0aW9uY2hhbmdlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25kdXJhdGlvbmNoYW5nZSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25lbXB0aWVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZW1wdGllZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmVtcHRpZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmVtcHRpZWQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uZW5kZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25lbmRlZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmVuZGVkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25lbmRlZCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25lcnJvcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmVycm9yOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uZXJyb3IobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmVycm9yID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmZvY3VzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZm9jdXM7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25mb2N1cyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uZm9jdXMgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uaW5wdXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25pbnB1dDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmlucHV0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25pbnB1dCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25pbnZhbGlkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uaW52YWxpZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmludmFsaWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmludmFsaWQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ua2V5ZG93bigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmtleWRvd247CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25rZXlkb3duKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25rZXlkb3duID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmtleXByZXNzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ua2V5cHJlc3M7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25rZXlwcmVzcyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ua2V5cHJlc3MgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ua2V5dXAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25rZXl1cDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmtleXVwKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25rZXl1cCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25sb2FkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ubG9hZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmxvYWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmxvYWQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ubG9hZGVkZGF0YSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmxvYWRlZGRhdGE7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25sb2FkZWRkYXRhKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25sb2FkZWRkYXRhID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmxvYWRlZG1ldGFkYXRhKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ubG9hZGVkbWV0YWRhdGE7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25sb2FkZWRtZXRhZGF0YShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ubG9hZGVkbWV0YWRhdGEgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ubG9hZHN0YXJ0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ubG9hZHN0YXJ0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ubG9hZHN0YXJ0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25sb2Fkc3RhcnQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ubW91c2Vkb3duKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ubW91c2Vkb3duOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ubW91c2Vkb3duKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25tb3VzZWRvd24gPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ubW91c2Vtb3ZlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ubW91c2Vtb3ZlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ubW91c2Vtb3ZlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25tb3VzZW1vdmUgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ubW91c2VvdXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25tb3VzZW91dDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbm1vdXNlb3V0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25tb3VzZW91dCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25tb3VzZW92ZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25tb3VzZW92ZXI7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25tb3VzZW92ZXIobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbm1vdXNlb3ZlciA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25tb3VzZXVwKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ubW91c2V1cDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbm1vdXNldXAobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbm1vdXNldXAgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ubW91c2V3aGVlbCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbm1vdXNld2hlZWw7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25tb3VzZXdoZWVsKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25tb3VzZXdoZWVsID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnBhdXNlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ucGF1c2U7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25wYXVzZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ucGF1c2UgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ucGxheSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnBsYXk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25wbGF5KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25wbGF5ID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnBsYXlpbmcoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25wbGF5aW5nOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ucGxheWluZyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ucGxheWluZyA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25wcm9ncmVzcygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ucHJvZ3Jlc3MobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnByb2dyZXNzID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnJhdGVjaGFuZ2UoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25yYXRlY2hhbmdlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ucmF0ZWNoYW5nZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ucmF0ZWNoYW5nZSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25yZWFkeXN0YXRlY2hhbmdlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ucmVhZHlzdGF0ZWNoYW5nZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnJlYWR5c3RhdGVjaGFuZ2UobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ucmVzZXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25yZXNldDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnJlc2V0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25yZXNldCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25zY3JvbGwoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25zY3JvbGw7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25zY3JvbGwobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnNjcm9sbCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25zZWVrZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25zZWVrZWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25zZWVrZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnNlZWtlZCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25zZWVraW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uc2Vla2luZzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnNlZWtpbmcobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnNlZWtpbmcgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uc2VsZWN0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uc2VsZWN0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uc2VsZWN0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25zZWxlY3QgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uc2hvdygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnNob3c7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25zaG93KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25zaG93ID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnN0YWxsZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25zdGFsbGVkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uc3RhbGxlZChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uc3RhbGxlZCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25zdWJtaXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25zdWJtaXQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25zdWJtaXQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnN1Ym1pdCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25zdXNwZW5kKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uc3VzcGVuZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnN1c3BlbmQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnN1c3BlbmQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9udGltZXVwZGF0ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnRpbWV1cGRhdGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb250aW1ldXBkYXRlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub250aW1ldXBkYXRlID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnZvbHVtZWNoYW5nZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnZvbHVtZWNoYW5nZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnZvbHVtZWNoYW5nZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9udm9sdW1lY2hhbmdlID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbndhaXRpbmcoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub253YWl0aW5nOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ud2FpdGluZyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ud2FpdGluZyA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgRE9NSW1wbGVtZW50YXRpb24KICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiRE9NSW1wbGVtZW50YXRpb24iLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuRE9NSW1wbGVtZW50YXRpb24ucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiRE9NSW1wbGVtZW50YXRpb24iLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJET01JbXBsZW1lbnRhdGlvbiIsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgaGFzRmVhdHVyZTogZnVuY3Rpb24gaGFzRmVhdHVyZShmZWF0dXJlLCB2ZXJzaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaGFzRmVhdHVyZShTdHJpbmcoZmVhdHVyZSksIFN0cmluZ09yRW1wdHkodmVyc2lvbikpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGNyZWF0ZURvY3VtZW50VHlwZTogZnVuY3Rpb24gY3JlYXRlRG9jdW1lbnRUeXBlKHF1YWxpZmllZE5hbWUsIHB1YmxpY0lkLCBzeXN0ZW1JZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuY3JlYXRlRG9jdW1lbnRUeXBlKFN0cmluZ09yRW1wdHkocXVhbGlmaWVkTmFtZSksIFN0cmluZyhwdWJsaWNJZCksIFN0cmluZyhzeXN0ZW1JZCkpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBjcmVhdGVEb2N1bWVudDogZnVuY3Rpb24gY3JlYXRlRG9jdW1lbnQobmFtZXNwYWNlLCBxdWFsaWZpZWROYW1lLCBkb2N0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5jcmVhdGVEb2N1bWVudChTdHJpbmdPckVtcHR5KG5hbWVzcGFjZSksIFN0cmluZ09yRW1wdHkocXVhbGlmaWVkTmFtZSksIHVud3JhcE9yTnVsbChkb2N0eXBlKSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGNyZWF0ZUhUTUxEb2N1bWVudDogZnVuY3Rpb24gY3JlYXRlSFRNTERvY3VtZW50KHRpdGxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5jcmVhdGVIVE1MRG9jdW1lbnQoU3RyaW5nKHRpdGxlKSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIG1velNldE91dHB1dE11dGF0aW9uSGFuZGxlcjogZnVuY3Rpb24gbW96U2V0T3V0cHV0TXV0YXRpb25IYW5kbGVyKGRvYywgaGFuZGxlcikgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubW96U2V0T3V0cHV0TXV0YXRpb25IYW5kbGVyKHVud3JhcChkb2MpLCB0b0NhbGxiYWNrKGhhbmRsZXIpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBtb3pHZXRJbnB1dE11dGF0aW9uSGFuZGxlcjogZnVuY3Rpb24gbW96R2V0SW5wdXRNdXRhdGlvbkhhbmRsZXIoZG9jKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubW96R2V0SW5wdXRNdXRhdGlvbkhhbmRsZXIodW53cmFwKGRvYykpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBtb3pIVE1MUGFyc2VyKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1vekhUTUxQYXJzZXI7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5FbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5Ob2RlLAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBuYW1lc3BhY2VVUkkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubmFtZXNwYWNlVVJJOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwcmVmaXgoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucHJlZml4OwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsb2NhbE5hbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubG9jYWxOYW1lOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0YWdOYW1lKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnRhZ05hbWU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGF0dHJpYnV0ZXMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5hdHRyaWJ1dGVzKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uIGdldEF0dHJpYnV0ZShxdWFsaWZpZWROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZ2V0QXR0cmlidXRlKFN0cmluZyhxdWFsaWZpZWROYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0QXR0cmlidXRlTlM6IGZ1bmN0aW9uIGdldEF0dHJpYnV0ZU5TKG5hbWVzcGFjZSwgbG9jYWxOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZ2V0QXR0cmlidXRlTlMoU3RyaW5nKG5hbWVzcGFjZSksIFN0cmluZyhsb2NhbE5hbWUpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBzZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uIHNldEF0dHJpYnV0ZShxdWFsaWZpZWROYW1lLCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2V0QXR0cmlidXRlKFN0cmluZyhxdWFsaWZpZWROYW1lKSwgU3RyaW5nKHZhbHVlKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgc2V0QXR0cmlidXRlTlM6IGZ1bmN0aW9uIHNldEF0dHJpYnV0ZU5TKG5hbWVzcGFjZSwgcXVhbGlmaWVkTmFtZSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNldEF0dHJpYnV0ZU5TKFN0cmluZyhuYW1lc3BhY2UpLCBTdHJpbmcocXVhbGlmaWVkTmFtZSksIFN0cmluZyh2YWx1ZSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHJlbW92ZUF0dHJpYnV0ZTogZnVuY3Rpb24gcmVtb3ZlQXR0cmlidXRlKHF1YWxpZmllZE5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnJlbW92ZUF0dHJpYnV0ZShTdHJpbmcocXVhbGlmaWVkTmFtZSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHJlbW92ZUF0dHJpYnV0ZU5TOiBmdW5jdGlvbiByZW1vdmVBdHRyaWJ1dGVOUyhuYW1lc3BhY2UsIGxvY2FsTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucmVtb3ZlQXR0cmlidXRlTlMoU3RyaW5nKG5hbWVzcGFjZSksIFN0cmluZyhsb2NhbE5hbWUpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBoYXNBdHRyaWJ1dGU6IGZ1bmN0aW9uIGhhc0F0dHJpYnV0ZShxdWFsaWZpZWROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaGFzQXR0cmlidXRlKFN0cmluZyhxdWFsaWZpZWROYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgaGFzQXR0cmlidXRlTlM6IGZ1bmN0aW9uIGhhc0F0dHJpYnV0ZU5TKG5hbWVzcGFjZSwgbG9jYWxOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaGFzQXR0cmlidXRlTlMoU3RyaW5nKG5hbWVzcGFjZSksIFN0cmluZyhsb2NhbE5hbWUpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXRFbGVtZW50c0J5VGFnTmFtZTogZnVuY3Rpb24gZ2V0RWxlbWVudHNCeVRhZ05hbWUocXVhbGlmaWVkTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuZ2V0RWxlbWVudHNCeVRhZ05hbWUoU3RyaW5nKHF1YWxpZmllZE5hbWUpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0RWxlbWVudHNCeVRhZ05hbWVOUzogZnVuY3Rpb24gZ2V0RWxlbWVudHNCeVRhZ05hbWVOUyhuYW1lc3BhY2UsIGxvY2FsTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuZ2V0RWxlbWVudHNCeVRhZ05hbWVOUyhTdHJpbmcobmFtZXNwYWNlKSwgU3RyaW5nKGxvY2FsTmFtZSkpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXRFbGVtZW50c0J5Q2xhc3NOYW1lOiBmdW5jdGlvbiBnZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoU3RyaW5nKGNsYXNzTmFtZXMpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNoaWxkcmVuKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuY2hpbGRyZW4pOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBmaXJzdEVsZW1lbnRDaGlsZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmZpcnN0RWxlbWVudENoaWxkKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbGFzdEVsZW1lbnRDaGlsZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmxhc3RFbGVtZW50Q2hpbGQpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwcmV2aW91c0VsZW1lbnRTaWJsaW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykucHJldmlvdXNFbGVtZW50U2libGluZyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG5leHRFbGVtZW50U2libGluZygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLm5leHRFbGVtZW50U2libGluZyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNoaWxkRWxlbWVudENvdW50KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNoaWxkRWxlbWVudENvdW50OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBBdHRyCiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkF0dHIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuQXR0ci5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJBdHRyIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiQXR0ciIsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IG5hbWVzcGFjZVVSSSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5uYW1lc3BhY2VVUkk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHByZWZpeCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5wcmVmaXg7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxvY2FsTmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5sb2NhbE5hbWU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG5hbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdmFsdWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdmFsdWUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS52YWx1ZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBEb2N1bWVudFR5cGUKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiRG9jdW1lbnRUeXBlIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkRvY3VtZW50VHlwZS5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJEb2N1bWVudFR5cGUiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJEb2N1bWVudFR5cGUiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLk5vZGUsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IG5hbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcHVibGljSWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucHVibGljSWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHN5c3RlbUlkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnN5c3RlbUlkOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24KICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiUHJvY2Vzc2luZ0luc3RydWN0aW9uIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLlByb2Nlc3NpbmdJbnN0cnVjdGlvbi5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24iLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24iLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLk5vZGUsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IHRhcmdldCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50YXJnZXQ7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGRhdGEoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGF0YTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkYXRhKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZGF0YSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBDaGFyYWN0ZXJEYXRhCiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkNoYXJhY3RlckRhdGEiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuQ2hhcmFjdGVyRGF0YS5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJDaGFyYWN0ZXJEYXRhIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiQ2hhcmFjdGVyRGF0YSIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuTm9kZSwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgZGF0YSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5kYXRhOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRhdGEobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kYXRhID0gU3RyaW5nT3JFbXB0eShuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsZW5ndGgoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHN1YnN0cmluZ0RhdGE6IGZ1bmN0aW9uIHN1YnN0cmluZ0RhdGEob2Zmc2V0LCBjb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnN1YnN0cmluZ0RhdGEodG9VTG9uZyhvZmZzZXQpLCB0b1VMb25nKGNvdW50KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kRGF0YTogZnVuY3Rpb24gYXBwZW5kRGF0YShkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5hcHBlbmREYXRhKFN0cmluZyhkYXRhKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0RGF0YTogZnVuY3Rpb24gaW5zZXJ0RGF0YShvZmZzZXQsIGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmluc2VydERhdGEodG9VTG9uZyhvZmZzZXQpLCBTdHJpbmcoZGF0YSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZURhdGE6IGZ1bmN0aW9uIGRlbGV0ZURhdGEob2Zmc2V0LCBjb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZGVsZXRlRGF0YSh0b1VMb25nKG9mZnNldCksIHRvVUxvbmcoY291bnQpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICByZXBsYWNlRGF0YTogZnVuY3Rpb24gcmVwbGFjZURhdGEob2Zmc2V0LCBjb3VudCwgZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucmVwbGFjZURhdGEodG9VTG9uZyhvZmZzZXQpLCB0b1VMb25nKGNvdW50KSwgU3RyaW5nKGRhdGEpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgVGV4dAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJUZXh0IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLlRleHQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiVGV4dCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIlRleHQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkNoYXJhY3RlckRhdGEsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgc3BsaXRUZXh0OiBmdW5jdGlvbiBzcGxpdFRleHQob2Zmc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5zcGxpdFRleHQodG9VTG9uZyhvZmZzZXQpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHdob2xlVGV4dCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS53aG9sZVRleHQ7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgcmVwbGFjZVdob2xlVGV4dDogZnVuY3Rpb24gcmVwbGFjZVdob2xlVGV4dChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5yZXBsYWNlV2hvbGVUZXh0KFN0cmluZyhkYXRhKSkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBDb21tZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkNvbW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuQ29tbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJDb21tZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiQ29tbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuQ2hhcmFjdGVyRGF0YSwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHt9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBOb2RlTGlzdAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJOb2RlTGlzdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5Ob2RlTGlzdC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJOb2RlTGlzdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIk5vZGVMaXN0IiwKICAgICAgICAgICAgICAgIHByb3h5RmFjdG9yeTogTm9kZUxpc3RQcm94eSwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBpdGVtOiBmdW5jdGlvbiBpdGVtKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5pdGVtKHRvVUxvbmcoaW5kZXgpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxlbmd0aCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxDb2xsZWN0aW9uCiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxDb2xsZWN0aW9uIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxDb2xsZWN0aW9uLnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxDb2xsZWN0aW9uIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTENvbGxlY3Rpb24iLAogICAgICAgICAgICAgICAgcHJveHlGYWN0b3J5OiBIVE1MQ29sbGVjdGlvblByb3h5LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBsZW5ndGgoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGl0ZW06IGZ1bmN0aW9uIGl0ZW0oaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLml0ZW0odG9VTG9uZyhpbmRleCkpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBuYW1lZEl0ZW06IGZ1bmN0aW9uIG5hbWVkSXRlbShuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5uYW1lZEl0ZW0oU3RyaW5nKG5hbWUpKSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIERPTVN0cmluZ0xpc3QKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiRE9NU3RyaW5nTGlzdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5ET01TdHJpbmdMaXN0LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkRPTVN0cmluZ0xpc3QiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJET01TdHJpbmdMaXN0IiwKICAgICAgICAgICAgICAgIHByb3h5RmFjdG9yeTogRE9NU3RyaW5nTGlzdFByb3h5LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBsZW5ndGgoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGl0ZW06IGZ1bmN0aW9uIGl0ZW0oaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5pdGVtKHRvVUxvbmcoaW5kZXgpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBjb250YWluczogZnVuY3Rpb24gY29udGFpbnMoc3RyaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY29udGFpbnMoU3RyaW5nKHN0cmluZykpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBET01Ub2tlbkxpc3QKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiRE9NVG9rZW5MaXN0IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkRPTVRva2VuTGlzdC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJET01Ub2tlbkxpc3QiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJET01Ub2tlbkxpc3QiLAogICAgICAgICAgICAgICAgcHJveHlGYWN0b3J5OiBET01Ub2tlbkxpc3RQcm94eSwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgbGVuZ3RoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBpdGVtOiBmdW5jdGlvbiBpdGVtKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaXRlbSh0b1VMb25nKGluZGV4KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IGZ1bmN0aW9uIGNvbnRhaW5zKHRva2VuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY29udGFpbnMoU3RyaW5nKHRva2VuKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgYWRkOiBmdW5jdGlvbiBhZGQodG9rZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmFkZChTdHJpbmcodG9rZW4pKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICByZW1vdmU6IGZ1bmN0aW9uIHJlbW92ZSh0b2tlbikgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucmVtb3ZlKFN0cmluZyh0b2tlbikpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHRvZ2dsZTogZnVuY3Rpb24gdG9nZ2xlKHRva2VuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudG9nZ2xlKFN0cmluZyh0b2tlbikpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiB0b1N0cmluZygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBET01TZXR0YWJsZVRva2VuTGlzdAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJET01TZXR0YWJsZVRva2VuTGlzdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5ET01TZXR0YWJsZVRva2VuTGlzdC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJET01TZXR0YWJsZVRva2VuTGlzdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkRPTVNldHRhYmxlVG9rZW5MaXN0IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5ET01Ub2tlbkxpc3QsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbHVlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHZhbHVlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudmFsdWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkF0dHJBcnJheSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkF0dHJBcnJheSIsCiAgICAgICAgICAgICAgICBwcm94eUZhY3Rvcnk6IEF0dHJBcnJheVByb3h5CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9ldmVudHMuanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy9ldmVudHMuanMiCiAgICAgICAgLy8KICAgICAgICAvLyBETyBOT1QgRURJVC4KICAgICAgICAvLyBUaGlzIGZpbGUgd2FzIGdlbmVyYXRlZCBieSBpZGwyZG9tanMgZnJvbSBzcmMvaWRsL2V2ZW50cy5pZGwKICAgICAgICAvLwoKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgVUlFdmVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJVSUV2ZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLlVJRXZlbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiVUlFdmVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIlVJRXZlbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkV2ZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCB2aWV3KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykudmlldyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGRldGFpbCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5kZXRhaWw7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgaW5pdFVJRXZlbnQ6IGZ1bmN0aW9uIGluaXRVSUV2ZW50KHR5cGVBcmcsIGNhbkJ1YmJsZUFyZywgY2FuY2VsYWJsZUFyZywgdmlld0FyZywgZGV0YWlsQXJnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5pbml0VUlFdmVudChTdHJpbmcodHlwZUFyZyksIEJvb2xlYW4oY2FuQnViYmxlQXJnKSwgQm9vbGVhbihjYW5jZWxhYmxlQXJnKSwgdW53cmFwKHZpZXdBcmcpLCB0b0xvbmcoZGV0YWlsQXJnKSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIE1vdXNlRXZlbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiTW91c2VFdmVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5Nb3VzZUV2ZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIk1vdXNlRXZlbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJNb3VzZUV2ZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5VSUV2ZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBzY3JlZW5YKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNjcmVlblg7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNjcmVlblkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc2NyZWVuWTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY2xpZW50WCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jbGllbnRYOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjbGllbnRZKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNsaWVudFk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGN0cmxLZXkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY3RybEtleTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2hpZnRLZXkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc2hpZnRLZXk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGFsdEtleSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5hbHRLZXk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG1ldGFLZXkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubWV0YUtleTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYnV0dG9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmJ1dHRvbjsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYnV0dG9ucygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5idXR0b25zOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCByZWxhdGVkVGFyZ2V0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykucmVsYXRlZFRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgaW5pdE1vdXNlRXZlbnQ6IGZ1bmN0aW9uIGluaXRNb3VzZUV2ZW50KHR5cGVBcmcsIGNhbkJ1YmJsZUFyZywgY2FuY2VsYWJsZUFyZywgdmlld0FyZywgZGV0YWlsQXJnLCBzY3JlZW5YQXJnLCBzY3JlZW5ZQXJnLCBjbGllbnRYQXJnLCBjbGllbnRZQXJnLCBjdHJsS2V5QXJnLCBhbHRLZXlBcmcsIHNoaWZ0S2V5QXJnLCBtZXRhS2V5QXJnLCBidXR0b25BcmcsIHJlbGF0ZWRUYXJnZXRBcmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmluaXRNb3VzZUV2ZW50KFN0cmluZyh0eXBlQXJnKSwgQm9vbGVhbihjYW5CdWJibGVBcmcpLCBCb29sZWFuKGNhbmNlbGFibGVBcmcpLCB1bndyYXAodmlld0FyZyksIHRvTG9uZyhkZXRhaWxBcmcpLCB0b0xvbmcoc2NyZWVuWEFyZyksIHRvTG9uZyhzY3JlZW5ZQXJnKSwgdG9Mb25nKGNsaWVudFhBcmcpLCB0b0xvbmcoY2xpZW50WUFyZyksIEJvb2xlYW4oY3RybEtleUFyZyksIEJvb2xlYW4oYWx0S2V5QXJnKSwgQm9vbGVhbihzaGlmdEtleUFyZyksIEJvb2xlYW4obWV0YUtleUFyZyksIHRvVVNob3J0KGJ1dHRvbkFyZyksIHVud3JhcChyZWxhdGVkVGFyZ2V0QXJnKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0TW9kaWZpZXJTdGF0ZTogZnVuY3Rpb24gZ2V0TW9kaWZpZXJTdGF0ZShrZXlBcmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5nZXRNb2RpZmllclN0YXRlKFN0cmluZyhrZXlBcmcpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICAqICBzcmMvaHRtbGVsdHMuanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy9odG1sZWx0cy5qcyIKICAgICAgICAvLwogICAgICAgIC8vIERPIE5PVCBFRElULgogICAgICAgIC8vIFRoaXMgZmlsZSB3YXMgZ2VuZXJhdGVkIGJ5IGlkbDJkb21qcyBmcm9tIHNyYy9pZGwvaHRtbGVsdHMuaWRsCiAgICAgICAgLy8KCgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxGb3JtQ29udHJvbHNDb2xsZWN0aW9uCiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxGb3JtQ29udHJvbHNDb2xsZWN0aW9uIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxGb3JtQ29udHJvbHNDb2xsZWN0aW9uLnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxGb3JtQ29udHJvbHNDb2xsZWN0aW9uIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTEZvcm1Db250cm9sc0NvbGxlY3Rpb24iLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxDb2xsZWN0aW9uLAogICAgICAgICAgICAgICAgcHJveHlGYWN0b3J5OiBIVE1MRm9ybUNvbnRyb2xzQ29sbGVjdGlvblByb3h5LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIG5hbWVkSXRlbTogZnVuY3Rpb24gbmFtZWRJdGVtKG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5uYW1lZEl0ZW0oU3RyaW5nKG5hbWUpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgUmFkaW9Ob2RlTGlzdAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJSYWRpb05vZGVMaXN0IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLlJhZGlvTm9kZUxpc3QucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiUmFkaW9Ob2RlTGlzdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIlJhZGlvTm9kZUxpc3QiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLk5vZGVMaXN0LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCB2YWx1ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB2YWx1ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnZhbHVlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxPcHRpb25zQ29sbGVjdGlvbgogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MT3B0aW9uc0NvbGxlY3Rpb24iLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTE9wdGlvbnNDb2xsZWN0aW9uLnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxPcHRpb25zQ29sbGVjdGlvbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxPcHRpb25zQ29sbGVjdGlvbiIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTENvbGxlY3Rpb24sCiAgICAgICAgICAgICAgICBwcm94eUZhY3Rvcnk6IEhUTUxPcHRpb25zQ29sbGVjdGlvblByb3h5LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBsZW5ndGgoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGxlbmd0aChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmxlbmd0aCA9IHRvVUxvbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBuYW1lZEl0ZW06IGZ1bmN0aW9uIG5hbWVkSXRlbShuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubmFtZWRJdGVtKFN0cmluZyhuYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnJlbW92ZSh0b0xvbmcoaW5kZXgpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2VsZWN0ZWRJbmRleCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zZWxlY3RlZEluZGV4OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNlbGVjdGVkSW5kZXgobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zZWxlY3RlZEluZGV4ID0gdG9Mb25nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxQcm9wZXJ0aWVzQ29sbGVjdGlvbgogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MUHJvcGVydGllc0NvbGxlY3Rpb24iLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTFByb3BlcnRpZXNDb2xsZWN0aW9uLnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxQcm9wZXJ0aWVzQ29sbGVjdGlvbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxQcm9wZXJ0aWVzQ29sbGVjdGlvbiIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTENvbGxlY3Rpb24sCiAgICAgICAgICAgICAgICBwcm94eUZhY3Rvcnk6IEhUTUxQcm9wZXJ0aWVzQ29sbGVjdGlvblByb3h5LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIG5hbWVkSXRlbTogZnVuY3Rpb24gbmFtZWRJdGVtKG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLm5hbWVkSXRlbShTdHJpbmcobmFtZSkpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbmFtZXMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5uYW1lcyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIFByb3BlcnR5Tm9kZUxpc3QKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiUHJvcGVydHlOb2RlTGlzdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5Qcm9wZXJ0eU5vZGVMaXN0LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIlByb3BlcnR5Tm9kZUxpc3QiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJQcm9wZXJ0eU5vZGVMaXN0IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5Ob2RlTGlzdCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXRWYWx1ZXM6IGZ1bmN0aW9uIGdldFZhbHVlcygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmdldFZhbHVlcygpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgRE9NU3RyaW5nTWFwCiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkRPTVN0cmluZ01hcCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5ET01TdHJpbmdNYXAucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiRE9NU3RyaW5nTWFwIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiRE9NU3RyaW5nTWFwIiwKICAgICAgICAgICAgICAgIHByb3h5RmFjdG9yeTogRE9NU3RyaW5nTWFwUHJveHksCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7fQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgRE9NRWxlbWVudE1hcAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJET01FbGVtZW50TWFwIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkRPTUVsZW1lbnRNYXAucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiRE9NRWxlbWVudE1hcCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkRPTUVsZW1lbnRNYXAiLAogICAgICAgICAgICAgICAgcHJveHlGYWN0b3J5OiBET01FbGVtZW50TWFwUHJveHksCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7fQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgQ1NTU3R5bGVEZWNsYXJhdGlvbgogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJDU1NTdHlsZURlY2xhcmF0aW9uIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkNTU1N0eWxlRGVjbGFyYXRpb24ucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiQ1NTU3R5bGVEZWNsYXJhdGlvbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkNTU1N0eWxlRGVjbGFyYXRpb24iLAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBjc3NUZXh0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNzc1RleHQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgY3NzVGV4dChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmNzc1RleHQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbGVuZ3RoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBpdGVtOiBmdW5jdGlvbiBpdGVtKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaXRlbSh0b1VMb25nKGluZGV4KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0UHJvcGVydHlWYWx1ZTogZnVuY3Rpb24gZ2V0UHJvcGVydHlWYWx1ZShwcm9wZXJ0eSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmdldFByb3BlcnR5VmFsdWUoU3RyaW5nKHByb3BlcnR5KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0UHJvcGVydHlQcmlvcml0eTogZnVuY3Rpb24gZ2V0UHJvcGVydHlQcmlvcml0eShwcm9wZXJ0eSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmdldFByb3BlcnR5UHJpb3JpdHkoU3RyaW5nKHByb3BlcnR5KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgc2V0UHJvcGVydHk6IGZ1bmN0aW9uIHNldFByb3BlcnR5KHByb3BlcnR5LCB2YWx1ZSwgcHJpb3JpdHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNldFByb3BlcnR5KFN0cmluZyhwcm9wZXJ0eSksIFN0cmluZyh2YWx1ZSksIE9wdGlvbmFsU3RyaW5nKHByaW9yaXR5KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlUHJvcGVydHk6IGZ1bmN0aW9uIHJlbW92ZVByb3BlcnR5KHByb3BlcnR5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucmVtb3ZlUHJvcGVydHkoU3RyaW5nKHByb3BlcnR5KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJhY2tncm91bmQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYmFja2dyb3VuZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBiYWNrZ3JvdW5kKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYmFja2dyb3VuZCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBiYWNrZ3JvdW5kQXR0YWNobWVudCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5iYWNrZ3JvdW5kQXR0YWNobWVudDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBiYWNrZ3JvdW5kQXR0YWNobWVudChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmJhY2tncm91bmRBdHRhY2htZW50ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJhY2tncm91bmRDb2xvcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5iYWNrZ3JvdW5kQ29sb3I7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYmFja2dyb3VuZENvbG9yKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYmFja2dyb3VuZENvbG9yID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJhY2tncm91bmRJbWFnZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5iYWNrZ3JvdW5kSW1hZ2U7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYmFja2dyb3VuZEltYWdlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYmFja2dyb3VuZEltYWdlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJhY2tncm91bmRQb3NpdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5iYWNrZ3JvdW5kUG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYmFja2dyb3VuZFBvc2l0aW9uKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYmFja2dyb3VuZFBvc2l0aW9uID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJhY2tncm91bmRSZXBlYXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYmFja2dyb3VuZFJlcGVhdDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBiYWNrZ3JvdW5kUmVwZWF0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYmFja2dyb3VuZFJlcGVhdCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBib3JkZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYm9yZGVyOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGJvcmRlcihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmJvcmRlciA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBib3JkZXJDb2xsYXBzZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ib3JkZXJDb2xsYXBzZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBib3JkZXJDb2xsYXBzZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmJvcmRlckNvbGxhcHNlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJvcmRlckNvbG9yKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmJvcmRlckNvbG9yOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGJvcmRlckNvbG9yKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYm9yZGVyQ29sb3IgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYm9yZGVyU3BhY2luZygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ib3JkZXJTcGFjaW5nOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGJvcmRlclNwYWNpbmcobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5ib3JkZXJTcGFjaW5nID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJvcmRlclN0eWxlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmJvcmRlclN0eWxlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGJvcmRlclN0eWxlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYm9yZGVyU3R5bGUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYm9yZGVyVG9wKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmJvcmRlclRvcDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBib3JkZXJUb3AobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5ib3JkZXJUb3AgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYm9yZGVyUmlnaHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYm9yZGVyUmlnaHQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYm9yZGVyUmlnaHQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5ib3JkZXJSaWdodCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBib3JkZXJCb3R0b20oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYm9yZGVyQm90dG9tOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGJvcmRlckJvdHRvbShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmJvcmRlckJvdHRvbSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBib3JkZXJMZWZ0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmJvcmRlckxlZnQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYm9yZGVyTGVmdChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmJvcmRlckxlZnQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYm9yZGVyVG9wQ29sb3IoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYm9yZGVyVG9wQ29sb3I7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYm9yZGVyVG9wQ29sb3IobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5ib3JkZXJUb3BDb2xvciA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBib3JkZXJSaWdodENvbG9yKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmJvcmRlclJpZ2h0Q29sb3I7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYm9yZGVyUmlnaHRDb2xvcihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmJvcmRlclJpZ2h0Q29sb3IgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYm9yZGVyQm90dG9tQ29sb3IoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYm9yZGVyQm90dG9tQ29sb3I7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYm9yZGVyQm90dG9tQ29sb3IobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5ib3JkZXJCb3R0b21Db2xvciA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBib3JkZXJMZWZ0Q29sb3IoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYm9yZGVyTGVmdENvbG9yOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGJvcmRlckxlZnRDb2xvcihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmJvcmRlckxlZnRDb2xvciA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBib3JkZXJUb3BTdHlsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ib3JkZXJUb3BTdHlsZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBib3JkZXJUb3BTdHlsZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmJvcmRlclRvcFN0eWxlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJvcmRlclJpZ2h0U3R5bGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYm9yZGVyUmlnaHRTdHlsZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBib3JkZXJSaWdodFN0eWxlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYm9yZGVyUmlnaHRTdHlsZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBib3JkZXJCb3R0b21TdHlsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ib3JkZXJCb3R0b21TdHlsZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBib3JkZXJCb3R0b21TdHlsZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmJvcmRlckJvdHRvbVN0eWxlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJvcmRlckxlZnRTdHlsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ib3JkZXJMZWZ0U3R5bGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYm9yZGVyTGVmdFN0eWxlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYm9yZGVyTGVmdFN0eWxlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJvcmRlclRvcFdpZHRoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmJvcmRlclRvcFdpZHRoOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGJvcmRlclRvcFdpZHRoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYm9yZGVyVG9wV2lkdGggPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYm9yZGVyUmlnaHRXaWR0aCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ib3JkZXJSaWdodFdpZHRoOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGJvcmRlclJpZ2h0V2lkdGgobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5ib3JkZXJSaWdodFdpZHRoID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJvcmRlckJvdHRvbVdpZHRoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmJvcmRlckJvdHRvbVdpZHRoOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGJvcmRlckJvdHRvbVdpZHRoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYm9yZGVyQm90dG9tV2lkdGggPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYm9yZGVyTGVmdFdpZHRoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmJvcmRlckxlZnRXaWR0aDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBib3JkZXJMZWZ0V2lkdGgobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5ib3JkZXJMZWZ0V2lkdGggPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYm9yZGVyV2lkdGgoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYm9yZGVyV2lkdGg7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYm9yZGVyV2lkdGgobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5ib3JkZXJXaWR0aCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBib3R0b20oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYm90dG9tOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGJvdHRvbShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmJvdHRvbSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjYXB0aW9uU2lkZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jYXB0aW9uU2lkZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBjYXB0aW9uU2lkZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmNhcHRpb25TaWRlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNsZWFyKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNsZWFyOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNsZWFyKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuY2xlYXIgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY2xpcCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jbGlwOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNsaXAobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5jbGlwID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvbG9yKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNvbG9yOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNvbG9yKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuY29sb3IgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY29udGVudCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jb250ZW50OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNvbnRlbnQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5jb250ZW50ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvdW50ZXJJbmNyZW1lbnQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY291bnRlckluY3JlbWVudDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBjb3VudGVySW5jcmVtZW50KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuY291bnRlckluY3JlbWVudCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjb3VudGVyUmVzZXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY291bnRlclJlc2V0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNvdW50ZXJSZXNldChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmNvdW50ZXJSZXNldCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjdXJzb3IoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY3Vyc29yOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGN1cnNvcihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmN1cnNvciA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBkaXJlY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGlyZWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRpcmVjdGlvbihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRpcmVjdGlvbiA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBkaXNwbGF5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmRpc3BsYXk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgZGlzcGxheShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRpc3BsYXkgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZW1wdHlDZWxscygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5lbXB0eUNlbGxzOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGVtcHR5Q2VsbHMobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5lbXB0eUNlbGxzID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNzc0Zsb2F0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNzc0Zsb2F0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNzc0Zsb2F0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuY3NzRmxvYXQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZm9udCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5mb250OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGZvbnQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5mb250ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvbnRGYW1pbHkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZm9udEZhbWlseTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBmb250RmFtaWx5KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZm9udEZhbWlseSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBmb250U2l6ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5mb250U2l6ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBmb250U2l6ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmZvbnRTaXplID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvbnRTaXplQWRqdXN0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmZvbnRTaXplQWRqdXN0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGZvbnRTaXplQWRqdXN0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZm9udFNpemVBZGp1c3QgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZm9udFN0cmV0Y2goKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZm9udFN0cmV0Y2g7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgZm9udFN0cmV0Y2gobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5mb250U3RyZXRjaCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBmb250U3R5bGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZm9udFN0eWxlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGZvbnRTdHlsZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmZvbnRTdHlsZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBmb250VmFyaWFudCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5mb250VmFyaWFudDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBmb250VmFyaWFudChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmZvbnRWYXJpYW50ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvbnRXZWlnaHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZm9udFdlaWdodDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBmb250V2VpZ2h0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZm9udFdlaWdodCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBoZWlnaHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGhlaWdodChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmhlaWdodCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsZWZ0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmxlZnQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbGVmdChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmxlZnQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbGV0dGVyU3BhY2luZygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5sZXR0ZXJTcGFjaW5nOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGxldHRlclNwYWNpbmcobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5sZXR0ZXJTcGFjaW5nID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxpbmVIZWlnaHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubGluZUhlaWdodDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBsaW5lSGVpZ2h0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubGluZUhlaWdodCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsaXN0U3R5bGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubGlzdFN0eWxlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGxpc3RTdHlsZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmxpc3RTdHlsZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsaXN0U3R5bGVJbWFnZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5saXN0U3R5bGVJbWFnZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBsaXN0U3R5bGVJbWFnZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmxpc3RTdHlsZUltYWdlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxpc3RTdHlsZVBvc2l0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmxpc3RTdHlsZVBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGxpc3RTdHlsZVBvc2l0aW9uKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubGlzdFN0eWxlUG9zaXRpb24gPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbGlzdFN0eWxlVHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5saXN0U3R5bGVUeXBlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGxpc3RTdHlsZVR5cGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5saXN0U3R5bGVUeXBlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG1hcmdpbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5tYXJnaW47CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbWFyZ2luKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubWFyZ2luID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG1hcmdpblRvcCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5tYXJnaW5Ub3A7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbWFyZ2luVG9wKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubWFyZ2luVG9wID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG1hcmdpblJpZ2h0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1hcmdpblJpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG1hcmdpblJpZ2h0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubWFyZ2luUmlnaHQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbWFyZ2luQm90dG9tKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1hcmdpbkJvdHRvbTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtYXJnaW5Cb3R0b20obmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5tYXJnaW5Cb3R0b20gPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbWFyZ2luTGVmdCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5tYXJnaW5MZWZ0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG1hcmdpbkxlZnQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5tYXJnaW5MZWZ0ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG1hcmtlck9mZnNldCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5tYXJrZXJPZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbWFya2VyT2Zmc2V0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubWFya2VyT2Zmc2V0ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG1hcmtzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1hcmtzOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG1hcmtzKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubWFya3MgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbWF4SGVpZ2h0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1heEhlaWdodDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtYXhIZWlnaHQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5tYXhIZWlnaHQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbWF4V2lkdGgoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubWF4V2lkdGg7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbWF4V2lkdGgobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5tYXhXaWR0aCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBtaW5IZWlnaHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubWluSGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG1pbkhlaWdodChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm1pbkhlaWdodCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBtaW5XaWR0aCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5taW5XaWR0aDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtaW5XaWR0aChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm1pbldpZHRoID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9wYWNpdHkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub3BhY2l0eTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvcGFjaXR5KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub3BhY2l0eSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvcnBoYW5zKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ycGhhbnM7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb3JwaGFucyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ycGhhbnMgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb3V0bGluZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vdXRsaW5lOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG91dGxpbmUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vdXRsaW5lID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG91dGxpbmVDb2xvcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vdXRsaW5lQ29sb3I7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb3V0bGluZUNvbG9yKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub3V0bGluZUNvbG9yID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG91dGxpbmVTdHlsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vdXRsaW5lU3R5bGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb3V0bGluZVN0eWxlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub3V0bGluZVN0eWxlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG91dGxpbmVXaWR0aCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vdXRsaW5lV2lkdGg7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb3V0bGluZVdpZHRoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub3V0bGluZVdpZHRoID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG92ZXJmbG93KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm92ZXJmbG93OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG92ZXJmbG93KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub3ZlcmZsb3cgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcGFkZGluZygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5wYWRkaW5nOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHBhZGRpbmcobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5wYWRkaW5nID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHBhZGRpbmdUb3AoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucGFkZGluZ1RvcDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwYWRkaW5nVG9wKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucGFkZGluZ1RvcCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwYWRkaW5nUmlnaHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucGFkZGluZ1JpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHBhZGRpbmdSaWdodChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBhZGRpbmdSaWdodCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwYWRkaW5nQm90dG9tKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnBhZGRpbmdCb3R0b207CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgcGFkZGluZ0JvdHRvbShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBhZGRpbmdCb3R0b20gPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcGFkZGluZ0xlZnQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucGFkZGluZ0xlZnQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgcGFkZGluZ0xlZnQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5wYWRkaW5nTGVmdCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwYWdlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnBhZ2U7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgcGFnZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBhZ2UgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcGFnZUJyZWFrQWZ0ZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucGFnZUJyZWFrQWZ0ZXI7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgcGFnZUJyZWFrQWZ0ZXIobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5wYWdlQnJlYWtBZnRlciA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwYWdlQnJlYWtCZWZvcmUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucGFnZUJyZWFrQmVmb3JlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHBhZ2VCcmVha0JlZm9yZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBhZ2VCcmVha0JlZm9yZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwYWdlQnJlYWtJbnNpZGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucGFnZUJyZWFrSW5zaWRlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHBhZ2VCcmVha0luc2lkZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBhZ2VCcmVha0luc2lkZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwb3NpdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5wb3NpdGlvbjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwb3NpdGlvbihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBvc2l0aW9uID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHF1b3RlcygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5xdW90ZXM7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgcXVvdGVzKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucXVvdGVzID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHJpZ2h0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnJpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHJpZ2h0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucmlnaHQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2l6ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zaXplOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNpemUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zaXplID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHRhYmxlTGF5b3V0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnRhYmxlTGF5b3V0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHRhYmxlTGF5b3V0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudGFibGVMYXlvdXQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdGV4dEFsaWduKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnRleHRBbGlnbjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB0ZXh0QWxpZ24obmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50ZXh0QWxpZ24gPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdGV4dERlY29yYXRpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudGV4dERlY29yYXRpb247CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdGV4dERlY29yYXRpb24obmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50ZXh0RGVjb3JhdGlvbiA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0ZXh0SW5kZW50KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnRleHRJbmRlbnQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdGV4dEluZGVudChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnRleHRJbmRlbnQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdGV4dFNoYWRvdygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50ZXh0U2hhZG93OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHRleHRTaGFkb3cobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50ZXh0U2hhZG93ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHRleHRUcmFuc2Zvcm0oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudGV4dFRyYW5zZm9ybTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB0ZXh0VHJhbnNmb3JtKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudGV4dFRyYW5zZm9ybSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0b3AoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudG9wOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHRvcChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnRvcCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB1bmljb2RlQmlkaSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS51bmljb2RlQmlkaTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB1bmljb2RlQmlkaShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnVuaWNvZGVCaWRpID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZlcnRpY2FsQWxpZ24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudmVydGljYWxBbGlnbjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB2ZXJ0aWNhbEFsaWduKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudmVydGljYWxBbGlnbiA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB2aXNpYmlsaXR5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnZpc2liaWxpdHk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdmlzaWJpbGl0eShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnZpc2liaWxpdHkgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgd2hpdGVTcGFjZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS53aGl0ZVNwYWNlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHdoaXRlU3BhY2UobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS53aGl0ZVNwYWNlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHdpZG93cygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS53aWRvd3M7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgd2lkb3dzKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykud2lkb3dzID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHdpZHRoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLndpZHRoOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHdpZHRoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykud2lkdGggPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgd29yZFNwYWNpbmcoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykud29yZFNwYWNpbmc7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgd29yZFNwYWNpbmcobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS53b3JkU3BhY2luZyA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB6SW5kZXgoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuekluZGV4OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHpJbmRleChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnpJbmRleCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5FbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBpbm5lckhUTUwoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaW5uZXJIVE1MOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGlubmVySFRNTChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmlubmVySFRNTCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvdXRlckhUTUwoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub3V0ZXJIVE1MOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG91dGVySFRNTChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm91dGVySFRNTCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGluc2VydEFkamFjZW50SFRNTDogZnVuY3Rpb24gaW5zZXJ0QWRqYWNlbnRIVE1MKHBvc2l0aW9uLCB0ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5pbnNlcnRBZGphY2VudEhUTUwoU3RyaW5nKHBvc2l0aW9uKSwgU3RyaW5nKHRleHQpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgaWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5pZCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0aXRsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50aXRsZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB0aXRsZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnRpdGxlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxhbmcoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubGFuZzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBsYW5nKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubGFuZyA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBkaXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGlyOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRpcihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRpciA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjbGFzc05hbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY2xhc3NOYW1lOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNsYXNzTmFtZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmNsYXNzTmFtZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjbGFzc0xpc3QoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5jbGFzc0xpc3QpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBkYXRhc2V0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuZGF0YXNldCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGl0ZW1TY29wZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5pdGVtU2NvcGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgaXRlbVNjb3BlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaXRlbVNjb3BlID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBpdGVtVHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5pdGVtVHlwZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBpdGVtVHlwZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLml0ZW1UeXBlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGl0ZW1JZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5pdGVtSWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgaXRlbUlkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaXRlbUlkID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGl0ZW1SZWYoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5pdGVtUmVmKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaXRlbVByb3AoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5pdGVtUHJvcCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHByb3BlcnRpZXMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5wcm9wZXJ0aWVzKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaXRlbVZhbHVlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLml0ZW1WYWx1ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBpdGVtVmFsdWUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5pdGVtVmFsdWUgPSBuZXd2YWw7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGhpZGRlbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5oaWRkZW47CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgaGlkZGVuKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaGlkZGVuID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiBjbGljaygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHRhYkluZGV4KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnRhYkluZGV4OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHRhYkluZGV4KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudGFiSW5kZXggPSB0b0xvbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBmb2N1czogZnVuY3Rpb24gZm9jdXMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGJsdXI6IGZ1bmN0aW9uIGJsdXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5ibHVyKCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGFjY2Vzc0tleSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5hY2Nlc3NLZXk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYWNjZXNzS2V5KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYWNjZXNzS2V5ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGFjY2Vzc0tleUxhYmVsKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmFjY2Vzc0tleUxhYmVsOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBkcmFnZ2FibGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZHJhZ2dhYmxlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRyYWdnYWJsZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRyYWdnYWJsZSA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZHJvcHpvbmUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5kcm9wem9uZSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvbnRlbnRFZGl0YWJsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jb250ZW50RWRpdGFibGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgY29udGVudEVkaXRhYmxlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuY29udGVudEVkaXRhYmxlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGlzQ29udGVudEVkaXRhYmxlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmlzQ29udGVudEVkaXRhYmxlOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjb250ZXh0TWVudSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmNvbnRleHRNZW51KTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBjb250ZXh0TWVudShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmNvbnRleHRNZW51ID0gdW53cmFwT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNwZWxsY2hlY2soKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc3BlbGxjaGVjazsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzcGVsbGNoZWNrKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc3BlbGxjaGVjayA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY29tbWFuZFR5cGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY29tbWFuZFR5cGU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvbW1hbmRMYWJlbCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jb21tYW5kTGFiZWw7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvbW1hbmRJY29uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNvbW1hbmRJY29uOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjb21tYW5kSGlkZGVuKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNvbW1hbmRIaWRkZW47CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvbW1hbmREaXNhYmxlZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jb21tYW5kRGlzYWJsZWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvbW1hbmRDaGVja2VkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNvbW1hbmRDaGVja2VkOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBzdHlsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnN0eWxlKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25hYm9ydCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmFib3J0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uYWJvcnQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmFib3J0ID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmJsdXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25ibHVyOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uYmx1cihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uYmx1ciA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25jYW5wbGF5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uY2FucGxheTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmNhbnBsYXkobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmNhbnBsYXkgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uY2FucGxheXRocm91Z2goKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25jYW5wbGF5dGhyb3VnaDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmNhbnBsYXl0aHJvdWdoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25jYW5wbGF5dGhyb3VnaCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25jaGFuZ2UoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25jaGFuZ2U7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25jaGFuZ2UobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmNoYW5nZSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25jbGljaygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmNsaWNrOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uY2xpY2sobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmNsaWNrID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmNvbnRleHRtZW51KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uY29udGV4dG1lbnU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25jb250ZXh0bWVudShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uY29udGV4dG1lbnUgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uY3VlY2hhbmdlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uY3VlY2hhbmdlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uY3VlY2hhbmdlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25jdWVjaGFuZ2UgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uZGJsY2xpY2soKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25kYmxjbGljazsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmRibGNsaWNrKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25kYmxjbGljayA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25kcmFnKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZHJhZzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmRyYWcobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmRyYWcgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uZHJhZ2VuZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmRyYWdlbmQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25kcmFnZW5kKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25kcmFnZW5kID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmRyYWdlbnRlcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmRyYWdlbnRlcjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmRyYWdlbnRlcihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uZHJhZ2VudGVyID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmRyYWdsZWF2ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmRyYWdsZWF2ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmRyYWdsZWF2ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uZHJhZ2xlYXZlID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmRyYWdvdmVyKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZHJhZ292ZXI7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25kcmFnb3ZlcihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uZHJhZ292ZXIgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uZHJhZ3N0YXJ0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZHJhZ3N0YXJ0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uZHJhZ3N0YXJ0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25kcmFnc3RhcnQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uZHJvcCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmRyb3A7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25kcm9wKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25kcm9wID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmR1cmF0aW9uY2hhbmdlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZHVyYXRpb25jaGFuZ2U7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25kdXJhdGlvbmNoYW5nZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uZHVyYXRpb25jaGFuZ2UgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uZW1wdGllZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmVtcHRpZWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25lbXB0aWVkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25lbXB0aWVkID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmVuZGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZW5kZWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25lbmRlZChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uZW5kZWQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uZXJyb3IoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25lcnJvcjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmVycm9yKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25lcnJvciA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25mb2N1cygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmZvY3VzOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uZm9jdXMobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmZvY3VzID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmlucHV0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uaW5wdXQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25pbnB1dChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uaW5wdXQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uaW52YWxpZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmludmFsaWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25pbnZhbGlkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25pbnZhbGlkID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmtleWRvd24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25rZXlkb3duOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ua2V5ZG93bihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ua2V5ZG93biA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25rZXlwcmVzcygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmtleXByZXNzOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ua2V5cHJlc3MobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmtleXByZXNzID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmtleXVwKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ua2V5dXA7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25rZXl1cChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ua2V5dXAgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ubG9hZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmxvYWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25sb2FkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25sb2FkID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmxvYWRlZGRhdGEoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25sb2FkZWRkYXRhOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ubG9hZGVkZGF0YShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ubG9hZGVkZGF0YSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25sb2FkZWRtZXRhZGF0YSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmxvYWRlZG1ldGFkYXRhOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ubG9hZGVkbWV0YWRhdGEobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmxvYWRlZG1ldGFkYXRhID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmxvYWRzdGFydCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmxvYWRzdGFydDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmxvYWRzdGFydChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ubG9hZHN0YXJ0ID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbm1vdXNlZG93bigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbm1vdXNlZG93bjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbm1vdXNlZG93bihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ubW91c2Vkb3duID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbm1vdXNlbW92ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbm1vdXNlbW92ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbm1vdXNlbW92ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ubW91c2Vtb3ZlID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbm1vdXNlb3V0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ubW91c2VvdXQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25tb3VzZW91dChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ubW91c2VvdXQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ubW91c2VvdmVyKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ubW91c2VvdmVyOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ubW91c2VvdmVyKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25tb3VzZW92ZXIgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ubW91c2V1cCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbm1vdXNldXA7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25tb3VzZXVwKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25tb3VzZXVwID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbm1vdXNld2hlZWwoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25tb3VzZXdoZWVsOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ubW91c2V3aGVlbChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ubW91c2V3aGVlbCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25wYXVzZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnBhdXNlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ucGF1c2UobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnBhdXNlID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnBsYXkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25wbGF5OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ucGxheShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ucGxheSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25wbGF5aW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ucGxheWluZzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnBsYXlpbmcobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnBsYXlpbmcgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ucHJvZ3Jlc3MoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25wcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnByb2dyZXNzKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25wcm9ncmVzcyA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25yYXRlY2hhbmdlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ucmF0ZWNoYW5nZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnJhdGVjaGFuZ2UobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnJhdGVjaGFuZ2UgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ucmVhZHlzdGF0ZWNoYW5nZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnJlYWR5c3RhdGVjaGFuZ2U7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25yZWFkeXN0YXRlY2hhbmdlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25yZWFkeXN0YXRlY2hhbmdlID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnJlc2V0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ucmVzZXQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25yZXNldChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ucmVzZXQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uc2Nyb2xsKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uc2Nyb2xsOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uc2Nyb2xsKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25zY3JvbGwgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uc2Vla2VkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uc2Vla2VkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uc2Vla2VkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25zZWVrZWQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uc2Vla2luZygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnNlZWtpbmc7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25zZWVraW5nKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25zZWVraW5nID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnNlbGVjdCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnNlbGVjdDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnNlbGVjdChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uc2VsZWN0ID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnNob3coKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25zaG93OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uc2hvdyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uc2hvdyA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25zdGFsbGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uc3RhbGxlZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnN0YWxsZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnN0YWxsZWQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uc3VibWl0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uc3VibWl0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uc3VibWl0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25zdWJtaXQgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uc3VzcGVuZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnN1c3BlbmQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25zdXNwZW5kKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25zdXNwZW5kID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnRpbWV1cGRhdGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub250aW1ldXBkYXRlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9udGltZXVwZGF0ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9udGltZXVwZGF0ZSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb252b2x1bWVjaGFuZ2UoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub252b2x1bWVjaGFuZ2U7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb252b2x1bWVjaGFuZ2UobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnZvbHVtZWNoYW5nZSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb253YWl0aW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ud2FpdGluZzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbndhaXRpbmcobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbndhaXRpbmcgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxVbmtub3duRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MVW5rbm93bkVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTFVua25vd25FbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxVbmtub3duRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxVbmtub3duRWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7fQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTEh0bWxFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxIdG1sRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MSHRtbEVsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTEh0bWxFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTEh0bWxFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHt9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MSGVhZEVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTEhlYWRFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxIZWFkRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MSGVhZEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MSGVhZEVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczoge30KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxUaXRsZUVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTFRpdGxlRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MVGl0bGVFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxUaXRsZUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MVGl0bGVFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgdGV4dCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50ZXh0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHRleHQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50ZXh0ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxCYXNlRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MQmFzZUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTEJhc2VFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxCYXNlRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxCYXNlRWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IGhyZWYoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaHJlZjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBocmVmKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaHJlZiA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0YXJnZXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudGFyZ2V0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHRhcmdldChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnRhcmdldCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MTGlua0VsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTExpbmtFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxMaW5rRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MTGlua0VsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MTGlua0VsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBkaXNhYmxlZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5kaXNhYmxlZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkaXNhYmxlZChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRpc2FibGVkID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBocmVmKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmhyZWY7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgaHJlZihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmhyZWYgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcmVsKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnJlbDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCByZWwobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5yZWwgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcmVsTGlzdCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnJlbExpc3QpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBtZWRpYSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5tZWRpYTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtZWRpYShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm1lZGlhID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGhyZWZsYW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmhyZWZsYW5nOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGhyZWZsYW5nKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaHJlZmxhbmcgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50eXBlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHR5cGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50eXBlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNpemVzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuc2l6ZXMpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MTWV0YUVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTE1ldGFFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxNZXRhRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MTWV0YUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MTWV0YUVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBuYW1lKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbmFtZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm5hbWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaHR0cEVxdWl2KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmh0dHBFcXVpdjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBodHRwRXF1aXYobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5odHRwRXF1aXYgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY29udGVudCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jb250ZW50OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNvbnRlbnQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5jb250ZW50ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxTdHlsZUVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTFN0eWxlRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MU3R5bGVFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxTdHlsZUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MU3R5bGVFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgZGlzYWJsZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGlzYWJsZWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgZGlzYWJsZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kaXNhYmxlZCA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbWVkaWEoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubWVkaWE7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbWVkaWEobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5tZWRpYSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0eXBlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnR5cGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdHlwZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnR5cGUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2NvcGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNjb3BlZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzY29wZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zY29wZWQgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxTY3JpcHRFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxTY3JpcHRFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxTY3JpcHRFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxTY3JpcHRFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTFNjcmlwdEVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBzcmMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc3JjOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNyYyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNyYyA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBhc3luYygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5hc3luYzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBhc3luYyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmFzeW5jID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBkZWZlcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5kZWZlcjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkZWZlcihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRlZmVyID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0eXBlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnR5cGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdHlwZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnR5cGUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY2hhcnNldCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jaGFyc2V0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNoYXJzZXQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5jaGFyc2V0ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHRleHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudGV4dDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB0ZXh0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudGV4dCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MQm9keUVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTEJvZHlFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxCb2R5RWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MQm9keUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MQm9keUVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBvbmFmdGVycHJpbnQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25hZnRlcnByaW50OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uYWZ0ZXJwcmludChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uYWZ0ZXJwcmludCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25iZWZvcmVwcmludCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmJlZm9yZXByaW50OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uYmVmb3JlcHJpbnQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmJlZm9yZXByaW50ID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmJlZm9yZXVubG9hZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmJlZm9yZXVubG9hZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmJlZm9yZXVubG9hZChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uYmVmb3JldW5sb2FkID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmJsdXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25ibHVyOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uYmx1cihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uYmx1ciA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25lcnJvcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmVycm9yOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uZXJyb3IobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmVycm9yID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmZvY3VzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZm9jdXM7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25mb2N1cyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uZm9jdXMgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uaGFzaGNoYW5nZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmhhc2hjaGFuZ2U7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25oYXNoY2hhbmdlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25oYXNoY2hhbmdlID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmxvYWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25sb2FkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ubG9hZChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ubG9hZCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25tZXNzYWdlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ubWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbm1lc3NhZ2UobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbm1lc3NhZ2UgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ub2ZmbGluZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbm9mZmxpbmU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25vZmZsaW5lKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25vZmZsaW5lID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbm9ubGluZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbm9ubGluZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbm9ubGluZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ub25saW5lID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnBvcHN0YXRlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ucG9wc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25wb3BzdGF0ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ucG9wc3RhdGUgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ucGFnZWhpZGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25wYWdlaGlkZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnBhZ2VoaWRlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25wYWdlaGlkZSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25wYWdlc2hvdygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnBhZ2VzaG93OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ucGFnZXNob3cobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnBhZ2VzaG93ID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnJlZG8oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25yZWRvOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ucmVkbyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ucmVkbyA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25yZXNpemUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25yZXNpemU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25yZXNpemUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnJlc2l6ZSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25zY3JvbGwoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25zY3JvbGw7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25zY3JvbGwobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnNjcm9sbCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25zdG9yYWdlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uc3RvcmFnZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnN0b3JhZ2UobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnN0b3JhZ2UgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9udW5kbygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnVuZG87CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb251bmRvKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub251bmRvID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnVubG9hZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnVubG9hZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnVubG9hZChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9udW5sb2FkID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MSGVhZGluZ0VsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTEhlYWRpbmdFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxIZWFkaW5nRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MSGVhZGluZ0VsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MSGVhZGluZ0VsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczoge30KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxQYXJhZ3JhcGhFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxQYXJhZ3JhcGhFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxQYXJhZ3JhcGhFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxQYXJhZ3JhcGhFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTFBhcmFncmFwaEVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczoge30KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxIUkVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTEhSRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MSFJFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxIUkVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MSFJFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHt9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MUHJlRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MUHJlRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MUHJlRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MUHJlRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxQcmVFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHt9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MUXVvdGVFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxRdW90ZUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTFF1b3RlRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MUXVvdGVFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTFF1b3RlRWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IGNpdGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY2l0ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBjaXRlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuY2l0ZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MT0xpc3RFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxPTGlzdEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTE9MaXN0RWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MT0xpc3RFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTE9MaXN0RWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IHJldmVyc2VkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnJldmVyc2VkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHJldmVyc2VkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucmV2ZXJzZWQgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHN0YXJ0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnN0YXJ0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHN0YXJ0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc3RhcnQgPSB0b0xvbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50eXBlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHR5cGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50eXBlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxVTGlzdEVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTFVMaXN0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MVUxpc3RFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxVTGlzdEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MVUxpc3RFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHt9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MTElFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxMSUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTExJRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MTElFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTExJRWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbHVlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHZhbHVlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudmFsdWUgPSB0b0xvbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTERMaXN0RWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MRExpc3RFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxETGlzdEVsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTERMaXN0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxETGlzdEVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczoge30KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxEaXZFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxEaXZFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxEaXZFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxEaXZFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTERpdkVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczoge30KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxBbmNob3JFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxBbmNob3JFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxBbmNob3JFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxBbmNob3JFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTEFuY2hvckVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBocmVmKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmhyZWY7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgaHJlZihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmhyZWYgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdGFyZ2V0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnRhcmdldDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB0YXJnZXQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50YXJnZXQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZG93bmxvYWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZG93bmxvYWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgZG93bmxvYWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kb3dubG9hZCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwaW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnBpbmc7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgcGluZyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBpbmcgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcmVsKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnJlbDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCByZWwobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5yZWwgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcmVsTGlzdCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnJlbExpc3QpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBtZWRpYSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5tZWRpYTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtZWRpYShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm1lZGlhID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGhyZWZsYW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmhyZWZsYW5nOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGhyZWZsYW5nKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaHJlZmxhbmcgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50eXBlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHR5cGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50eXBlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHRleHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudGV4dDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB0ZXh0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudGV4dCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwcm90b2NvbCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5wcm90b2NvbDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwcm90b2NvbChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnByb3RvY29sID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGhvc3QoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaG9zdDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBob3N0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaG9zdCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBob3N0bmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ob3N0bmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBob3N0bmFtZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmhvc3RuYW1lID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHBvcnQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucG9ydDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwb3J0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucG9ydCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwYXRobmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5wYXRobmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwYXRobmFtZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBhdGhuYW1lID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNlYXJjaCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zZWFyY2g7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgc2VhcmNoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2VhcmNoID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGhhc2goKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaGFzaDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBoYXNoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaGFzaCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MVGltZUVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTFRpbWVFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxUaW1lRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MVGltZUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MVGltZUVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBkYXRlVGltZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5kYXRlVGltZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkYXRlVGltZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRhdGVUaW1lID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHB1YkRhdGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucHViRGF0ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwdWJEYXRlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucHViRGF0ZSA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdmFsdWVBc0RhdGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS52YWx1ZUFzRGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxTcGFuRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MU3BhbkVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTFNwYW5FbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxTcGFuRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxTcGFuRWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7fQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTEJSRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MQlJFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxCUkVsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTEJSRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxCUkVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczoge30KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxNb2RFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxNb2RFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxNb2RFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxNb2RFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTE1vZEVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBjaXRlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNpdGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgY2l0ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmNpdGUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZGF0ZVRpbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGF0ZVRpbWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgZGF0ZVRpbWUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kYXRlVGltZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MSW1hZ2VFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxJbWFnZUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTEltYWdlRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MSW1hZ2VFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTEltYWdlRWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IGFsdCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5hbHQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYWx0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYWx0ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNyYygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zcmM7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgc3JjKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc3JjID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNyb3NzT3JpZ2luKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNyb3NzT3JpZ2luOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNyb3NzT3JpZ2luKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuY3Jvc3NPcmlnaW4gPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdXNlTWFwKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnVzZU1hcDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB1c2VNYXAobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS51c2VNYXAgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaXNNYXAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaXNNYXA7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgaXNNYXAobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5pc01hcCA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgd2lkdGgoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykud2lkdGg7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgd2lkdGgobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS53aWR0aCA9IHRvVUxvbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaGVpZ2h0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmhlaWdodDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBoZWlnaHQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5oZWlnaHQgPSB0b1VMb25nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG5hdHVyYWxXaWR0aCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5uYXR1cmFsV2lkdGg7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG5hdHVyYWxIZWlnaHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubmF0dXJhbEhlaWdodDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY29tcGxldGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY29tcGxldGU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxJRnJhbWVFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxJRnJhbWVFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxJRnJhbWVFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxJRnJhbWVFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTElGcmFtZUVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBzcmMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc3JjOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNyYyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNyYyA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBzcmNkb2MoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc3JjZG9jOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNyY2RvYyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNyY2RvYyA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBuYW1lKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbmFtZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm5hbWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2FuZGJveCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnNhbmRib3gpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBzZWFtbGVzcygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zZWFtbGVzczsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzZWFtbGVzcyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNlYW1sZXNzID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB3aWR0aCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS53aWR0aDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB3aWR0aChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLndpZHRoID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGhlaWdodCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5oZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgaGVpZ2h0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaGVpZ2h0ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvbnRlbnREb2N1bWVudCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmNvbnRlbnREb2N1bWVudCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvbnRlbnRXaW5kb3coKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5jb250ZW50V2luZG93KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTEVtYmVkRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MRW1iZWRFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxFbWJlZEVsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTEVtYmVkRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxFbWJlZEVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBzcmMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc3JjOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNyYyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNyYyA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0eXBlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnR5cGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdHlwZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnR5cGUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgd2lkdGgoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykud2lkdGg7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgd2lkdGgobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS53aWR0aCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBoZWlnaHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGhlaWdodChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmhlaWdodCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MT2JqZWN0RWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MT2JqZWN0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MT2JqZWN0RWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MT2JqZWN0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxPYmplY3RFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgZGF0YSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5kYXRhOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRhdGEobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kYXRhID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHR5cGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudHlwZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB0eXBlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudHlwZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0eXBlTXVzdE1hdGNoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnR5cGVNdXN0TWF0Y2g7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdHlwZU11c3RNYXRjaChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnR5cGVNdXN0TWF0Y2ggPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG5hbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBuYW1lKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubmFtZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB1c2VNYXAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudXNlTWFwOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHVzZU1hcChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnVzZU1hcCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBmb3JtKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuZm9ybSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHdpZHRoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLndpZHRoOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHdpZHRoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykud2lkdGggPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaGVpZ2h0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmhlaWdodDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBoZWlnaHQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5oZWlnaHQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY29udGVudERvY3VtZW50KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuY29udGVudERvY3VtZW50KTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY29udGVudFdpbmRvdygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmNvbnRlbnRXaW5kb3cpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB3aWxsVmFsaWRhdGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykud2lsbFZhbGlkYXRlOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB2YWxpZGl0eSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnZhbGlkaXR5KTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdmFsaWRhdGlvbk1lc3NhZ2UoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudmFsaWRhdGlvbk1lc3NhZ2U7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgY2hlY2tWYWxpZGl0eTogZnVuY3Rpb24gY2hlY2tWYWxpZGl0eSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jaGVja1ZhbGlkaXR5KCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgc2V0Q3VzdG9tVmFsaWRpdHk6IGZ1bmN0aW9uIHNldEN1c3RvbVZhbGlkaXR5KGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zZXRDdXN0b21WYWxpZGl0eShTdHJpbmcoZXJyb3IpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTFBhcmFtRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MUGFyYW1FbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxQYXJhbUVsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTFBhcmFtRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxQYXJhbUVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBuYW1lKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbmFtZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm5hbWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdmFsdWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdmFsdWUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS52YWx1ZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MTWVkaWFFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgLy8gQ29uc3RhbnRzIGRlZmluZWQgYnkgSFRNTE1lZGlhRWxlbWVudAogICAgICAgIHZhciBORVRXT1JLX0VNUFRZID0gMDsKICAgICAgICB2YXIgTkVUV09SS19JRExFID0gMTsKICAgICAgICB2YXIgTkVUV09SS19MT0FESU5HID0gMjsKICAgICAgICB2YXIgTkVUV09SS19OT19TT1VSQ0UgPSAzOwogICAgICAgIHZhciBIQVZFX05PVEhJTkcgPSAwOwogICAgICAgIHZhciBIQVZFX01FVEFEQVRBID0gMTsKICAgICAgICB2YXIgSEFWRV9DVVJSRU5UX0RBVEEgPSAyOwogICAgICAgIHZhciBIQVZFX0ZVVFVSRV9EQVRBID0gMzsKICAgICAgICB2YXIgSEFWRV9FTk9VR0hfREFUQSA9IDQ7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MTWVkaWFFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxNZWRpYUVsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTE1lZGlhRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxNZWRpYUVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgY29uc3RhbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgTkVUV09SS19FTVBUWTogTkVUV09SS19FTVBUWSwKICAgICAgICAgICAgICAgICAgICBORVRXT1JLX0lETEU6IE5FVFdPUktfSURMRSwKICAgICAgICAgICAgICAgICAgICBORVRXT1JLX0xPQURJTkc6IE5FVFdPUktfTE9BRElORywKICAgICAgICAgICAgICAgICAgICBORVRXT1JLX05PX1NPVVJDRTogTkVUV09SS19OT19TT1VSQ0UsCiAgICAgICAgICAgICAgICAgICAgSEFWRV9OT1RISU5HOiBIQVZFX05PVEhJTkcsCiAgICAgICAgICAgICAgICAgICAgSEFWRV9NRVRBREFUQTogSEFWRV9NRVRBREFUQSwKICAgICAgICAgICAgICAgICAgICBIQVZFX0NVUlJFTlRfREFUQTogSEFWRV9DVVJSRU5UX0RBVEEsCiAgICAgICAgICAgICAgICAgICAgSEFWRV9GVVRVUkVfREFUQTogSEFWRV9GVVRVUkVfREFUQSwKICAgICAgICAgICAgICAgICAgICBIQVZFX0VOT1VHSF9EQVRBOiBIQVZFX0VOT1VHSF9EQVRBCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBlcnJvcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmVycm9yKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc3JjKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNyYzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzcmMobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zcmMgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY3VycmVudFNyYygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jdXJyZW50U3JjOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjcm9zc09yaWdpbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jcm9zc09yaWdpbjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBjcm9zc09yaWdpbihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmNyb3NzT3JpZ2luID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG5ldHdvcmtTdGF0ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5uZXR3b3JrU3RhdGU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHByZWxvYWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucHJlbG9hZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwcmVsb2FkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucHJlbG9hZCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBidWZmZXJlZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmJ1ZmZlcmVkKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBsb2FkOiBmdW5jdGlvbiBsb2FkKCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubG9hZCgpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGNhblBsYXlUeXBlOiBmdW5jdGlvbiBjYW5QbGF5VHlwZSh0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY2FuUGxheVR5cGUoU3RyaW5nKHR5cGUpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcmVhZHlTdGF0ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5yZWFkeVN0YXRlOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBzZWVraW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNlZWtpbmc7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGN1cnJlbnRUaW1lKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmN1cnJlbnRUaW1lOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGN1cnJlbnRUaW1lKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuY3VycmVudFRpbWUgPSB0b0RvdWJsZShuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBpbml0aWFsVGltZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5pbml0aWFsVGltZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZHVyYXRpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZHVyYXRpb247CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHN0YXJ0T2Zmc2V0VGltZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnN0YXJ0T2Zmc2V0VGltZSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHBhdXNlZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5wYXVzZWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGRlZmF1bHRQbGF5YmFja1JhdGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGVmYXVsdFBsYXliYWNrUmF0ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkZWZhdWx0UGxheWJhY2tSYXRlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZGVmYXVsdFBsYXliYWNrUmF0ZSA9IHRvRG91YmxlKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHBsYXliYWNrUmF0ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5wbGF5YmFja1JhdGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgcGxheWJhY2tSYXRlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucGxheWJhY2tSYXRlID0gdG9Eb3VibGUobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcGxheWVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykucGxheWVkKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2Vla2FibGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5zZWVrYWJsZSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGVuZGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmVuZGVkOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBhdXRvcGxheSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5hdXRvcGxheTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBhdXRvcGxheShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmF1dG9wbGF5ID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsb29wKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmxvb3A7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbG9vcChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmxvb3AgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgcGxheTogZnVuY3Rpb24gcGxheSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBsYXkoKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBwYXVzZTogZnVuY3Rpb24gcGF1c2UoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5wYXVzZSgpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBtZWRpYUdyb3VwKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1lZGlhR3JvdXA7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbWVkaWFHcm91cChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm1lZGlhR3JvdXAgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY29udHJvbGxlcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmNvbnRyb2xsZXIpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNvbnRyb2xsZXIobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5jb250cm9sbGVyID0gdW53cmFwT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvbnRyb2xzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNvbnRyb2xzOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNvbnRyb2xzKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuY29udHJvbHMgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZvbHVtZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS52b2x1bWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdm9sdW1lKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudm9sdW1lID0gdG9Eb3VibGUobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbXV0ZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubXV0ZWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbXV0ZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5tdXRlZCA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZGVmYXVsdE11dGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmRlZmF1bHRNdXRlZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkZWZhdWx0TXV0ZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kZWZhdWx0TXV0ZWQgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGF1ZGlvVHJhY2tzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuYXVkaW9UcmFja3MpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB2aWRlb1RyYWNrcygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnZpZGVvVHJhY2tzKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdGV4dFRyYWNrcygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnRleHRUcmFja3MpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGFkZFRleHRUcmFjazogZnVuY3Rpb24gYWRkVGV4dFRyYWNrKGtpbmQsIGxhYmVsLCBsYW5ndWFnZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuYWRkVGV4dFRyYWNrKFN0cmluZyhraW5kKSwgT3B0aW9uYWxTdHJpbmcobGFiZWwpLCBPcHRpb25hbFN0cmluZyhsYW5ndWFnZSkpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTFZpZGVvRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MVmlkZW9FbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxWaWRlb0VsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTFZpZGVvRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxWaWRlb0VsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxNZWRpYUVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IHdpZHRoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLndpZHRoOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHdpZHRoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykud2lkdGggPSB0b1VMb25nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGhlaWdodCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5oZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgaGVpZ2h0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaGVpZ2h0ID0gdG9VTG9uZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB2aWRlb1dpZHRoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnZpZGVvV2lkdGg7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZpZGVvSGVpZ2h0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnZpZGVvSGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwb3N0ZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucG9zdGVyOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHBvc3RlcihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBvc3RlciA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MQXVkaW9FbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxBdWRpb0VsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTEF1ZGlvRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MQXVkaW9FbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTEF1ZGlvRWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTE1lZGlhRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHt9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MU291cmNlRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MU291cmNlRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MU291cmNlRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MU291cmNlRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxTb3VyY2VFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgc3JjKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNyYzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzcmMobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zcmMgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50eXBlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHR5cGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50eXBlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG1lZGlhKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1lZGlhOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG1lZGlhKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubWVkaWEgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTFRyYWNrRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MVHJhY2tFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxUcmFja0VsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTFRyYWNrRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxUcmFja0VsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBraW5kKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmtpbmQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQga2luZChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmtpbmQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc3JjKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNyYzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzcmMobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zcmMgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc3JjbGFuZygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zcmNsYW5nOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNyY2xhbmcobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zcmNsYW5nID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxhYmVsKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmxhYmVsOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGxhYmVsKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubGFiZWwgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZGVmYXVsdCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5kZWZhdWx0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRlZmF1bHQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kZWZhdWx0ID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0cmFjaygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnRyYWNrKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTE1hcEVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTE1hcEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTE1hcEVsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTE1hcEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MTWFwRWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IG5hbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBuYW1lKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubmFtZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBhcmVhcygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmFyZWFzKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaW1hZ2VzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuaW1hZ2VzKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTEFyZWFFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxBcmVhRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MQXJlYUVsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTEFyZWFFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTEFyZWFFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgYWx0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmFsdDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBhbHQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5hbHQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY29vcmRzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNvb3JkczsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBjb29yZHMobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5jb29yZHMgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2hhcGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc2hhcGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgc2hhcGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zaGFwZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBocmVmKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmhyZWY7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgaHJlZihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmhyZWYgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdGFyZ2V0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnRhcmdldDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB0YXJnZXQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50YXJnZXQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZG93bmxvYWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZG93bmxvYWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgZG93bmxvYWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kb3dubG9hZCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwaW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnBpbmc7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgcGluZyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBpbmcgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcmVsKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnJlbDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCByZWwobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5yZWwgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcmVsTGlzdCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnJlbExpc3QpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBtZWRpYSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5tZWRpYTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtZWRpYShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm1lZGlhID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGhyZWZsYW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmhyZWZsYW5nOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGhyZWZsYW5nKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaHJlZmxhbmcgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50eXBlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHR5cGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50eXBlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHByb3RvY29sKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnByb3RvY29sOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHByb3RvY29sKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucHJvdG9jb2wgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaG9zdCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ob3N0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGhvc3QobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5ob3N0ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGhvc3RuYW1lKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmhvc3RuYW1lOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGhvc3RuYW1lKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaG9zdG5hbWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcG9ydCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5wb3J0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHBvcnQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5wb3J0ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHBhdGhuYW1lKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnBhdGhuYW1lOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHBhdGhuYW1lKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucGF0aG5hbWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2VhcmNoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNlYXJjaDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzZWFyY2gobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zZWFyY2ggPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaGFzaCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5oYXNoOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGhhc2gobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5oYXNoID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxUYWJsZUVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTFRhYmxlRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MVGFibGVFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxUYWJsZUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MVGFibGVFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgY2FwdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmNhcHRpb24pOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNhcHRpb24obmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5jYXB0aW9uID0gdW53cmFwT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlQ2FwdGlvbjogZnVuY3Rpb24gY3JlYXRlQ2FwdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmNyZWF0ZUNhcHRpb24oKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlQ2FwdGlvbjogZnVuY3Rpb24gZGVsZXRlQ2FwdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRlbGV0ZUNhcHRpb24oKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdEhlYWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS50SGVhZCk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdEhlYWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50SGVhZCA9IHVud3JhcE9yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGNyZWF0ZVRIZWFkOiBmdW5jdGlvbiBjcmVhdGVUSGVhZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmNyZWF0ZVRIZWFkKCkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZVRIZWFkOiBmdW5jdGlvbiBkZWxldGVUSGVhZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRlbGV0ZVRIZWFkKCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHRGb290KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykudEZvb3QpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHRGb290KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudEZvb3QgPSB1bndyYXBPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBjcmVhdGVURm9vdDogZnVuY3Rpb24gY3JlYXRlVEZvb3QoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5jcmVhdGVURm9vdCgpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBkZWxldGVURm9vdDogZnVuY3Rpb24gZGVsZXRlVEZvb3QoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kZWxldGVURm9vdCgpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0Qm9kaWVzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykudEJvZGllcyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlVEJvZHk6IGZ1bmN0aW9uIGNyZWF0ZVRCb2R5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuY3JlYXRlVEJvZHkoKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHJvd3MoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5yb3dzKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBpbnNlcnRSb3c6IGZ1bmN0aW9uIGluc2VydFJvdyhpbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuaW5zZXJ0Um93KE9wdGlvbmFsdG9Mb25nKGluZGV4KSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZVJvdzogZnVuY3Rpb24gZGVsZXRlUm93KGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kZWxldGVSb3codG9Mb25nKGluZGV4KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGJvcmRlcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ib3JkZXI7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYm9yZGVyKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYm9yZGVyID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxUYWJsZUNhcHRpb25FbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxUYWJsZUNhcHRpb25FbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxUYWJsZUNhcHRpb25FbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxUYWJsZUNhcHRpb25FbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTFRhYmxlQ2FwdGlvbkVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczoge30KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxUYWJsZUNvbEVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTFRhYmxlQ29sRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MVGFibGVDb2xFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxUYWJsZUNvbEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MVGFibGVDb2xFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgc3BhbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zcGFuOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNwYW4obmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zcGFuID0gdG9VTG9uZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MVGFibGVTZWN0aW9uRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MVGFibGVTZWN0aW9uRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MVGFibGVTZWN0aW9uRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MVGFibGVTZWN0aW9uRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxUYWJsZVNlY3Rpb25FbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgcm93cygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnJvd3MpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGluc2VydFJvdzogZnVuY3Rpb24gaW5zZXJ0Um93KGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5pbnNlcnRSb3coT3B0aW9uYWx0b0xvbmcoaW5kZXgpKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlUm93OiBmdW5jdGlvbiBkZWxldGVSb3coaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRlbGV0ZVJvdyh0b0xvbmcoaW5kZXgpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTFRhYmxlUm93RWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MVGFibGVSb3dFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxUYWJsZVJvd0VsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTFRhYmxlUm93RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxUYWJsZVJvd0VsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCByb3dJbmRleCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5yb3dJbmRleDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2VjdGlvblJvd0luZGV4KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNlY3Rpb25Sb3dJbmRleDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY2VsbHMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5jZWxscyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0Q2VsbDogZnVuY3Rpb24gaW5zZXJ0Q2VsbChpbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuaW5zZXJ0Q2VsbChPcHRpb25hbHRvTG9uZyhpbmRleCkpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBkZWxldGVDZWxsOiBmdW5jdGlvbiBkZWxldGVDZWxsKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kZWxldGVDZWxsKHRvTG9uZyhpbmRleCkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MVGFibGVEYXRhQ2VsbEVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTFRhYmxlRGF0YUNlbGxFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxUYWJsZURhdGFDZWxsRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MVGFibGVEYXRhQ2VsbEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MVGFibGVEYXRhQ2VsbEVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxUYWJsZUNlbGxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczoge30KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxUYWJsZUhlYWRlckNlbGxFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxUYWJsZUhlYWRlckNlbGxFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxUYWJsZUhlYWRlckNlbGxFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxUYWJsZUhlYWRlckNlbGxFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTFRhYmxlSGVhZGVyQ2VsbEVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxUYWJsZUNlbGxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBzY29wZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zY29wZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzY29wZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNjb3BlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxUYWJsZUNlbGxFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxUYWJsZUNlbGxFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxUYWJsZUNlbGxFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxUYWJsZUNlbGxFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTFRhYmxlQ2VsbEVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBjb2xTcGFuKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNvbFNwYW47CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgY29sU3BhbihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmNvbFNwYW4gPSB0b1VMb25nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHJvd1NwYW4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucm93U3BhbjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCByb3dTcGFuKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucm93U3BhbiA9IHRvVUxvbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaGVhZGVycygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmhlYWRlcnMpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjZWxsSW5kZXgoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY2VsbEluZGV4OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MRm9ybUVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTEZvcm1FbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxGb3JtRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MRm9ybUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MRm9ybUVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBhY2NlcHRDaGFyc2V0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmFjY2VwdENoYXJzZXQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYWNjZXB0Q2hhcnNldChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmFjY2VwdENoYXJzZXQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYWN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmFjdGlvbjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBhY3Rpb24obmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5hY3Rpb24gPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgYXV0b2NvbXBsZXRlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmF1dG9jb21wbGV0ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBhdXRvY29tcGxldGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5hdXRvY29tcGxldGUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZW5jdHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5lbmN0eXBlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGVuY3R5cGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5lbmN0eXBlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGVuY29kaW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmVuY29kaW5nOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGVuY29kaW5nKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZW5jb2RpbmcgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbWV0aG9kKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1ldGhvZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtZXRob2QobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5tZXRob2QgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5uYW1lOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG5hbWUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5uYW1lID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG5vVmFsaWRhdGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubm9WYWxpZGF0ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBub1ZhbGlkYXRlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubm9WYWxpZGF0ZSA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdGFyZ2V0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnRhcmdldDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB0YXJnZXQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50YXJnZXQgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZWxlbWVudHMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5lbGVtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxlbmd0aCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgc3VibWl0OiBmdW5jdGlvbiBzdWJtaXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zdWJtaXQoKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICByZXNldDogZnVuY3Rpb24gcmVzZXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5yZXNldCgpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGNoZWNrVmFsaWRpdHk6IGZ1bmN0aW9uIGNoZWNrVmFsaWRpdHkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY2hlY2tWYWxpZGl0eSgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MRmllbGRTZXRFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxGaWVsZFNldEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTEZpZWxkU2V0RWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MRmllbGRTZXRFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTEZpZWxkU2V0RWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IGRpc2FibGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmRpc2FibGVkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRpc2FibGVkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZGlzYWJsZWQgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvcm0oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5mb3JtKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5uYW1lOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG5hbWUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5uYW1lID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHR5cGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudHlwZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZWxlbWVudHMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5lbGVtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHdpbGxWYWxpZGF0ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS53aWxsVmFsaWRhdGU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbGlkaXR5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykudmFsaWRpdHkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB2YWxpZGF0aW9uTWVzc2FnZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS52YWxpZGF0aW9uTWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBjaGVja1ZhbGlkaXR5OiBmdW5jdGlvbiBjaGVja1ZhbGlkaXR5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNoZWNrVmFsaWRpdHkoKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBzZXRDdXN0b21WYWxpZGl0eTogZnVuY3Rpb24gc2V0Q3VzdG9tVmFsaWRpdHkoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNldEN1c3RvbVZhbGlkaXR5KFN0cmluZyhlcnJvcikpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MTGVnZW5kRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MTGVnZW5kRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MTGVnZW5kRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MTGVnZW5kRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxMZWdlbmRFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgZm9ybSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmZvcm0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MTGFiZWxFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxMYWJlbEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTExhYmVsRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MTGFiZWxFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTExhYmVsRWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvcm0oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5mb3JtKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaHRtbEZvcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5odG1sRm9yOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGh0bWxGb3IobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5odG1sRm9yID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvbnRyb2woKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5jb250cm9sKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTElucHV0RWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MSW5wdXRFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxJbnB1dEVsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTElucHV0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxJbnB1dEVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBhY2NlcHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYWNjZXB0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGFjY2VwdChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmFjY2VwdCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBhbHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYWx0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGFsdChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmFsdCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBhdXRvY29tcGxldGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYXV0b2NvbXBsZXRlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGF1dG9jb21wbGV0ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmF1dG9jb21wbGV0ZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBhdXRvZm9jdXMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYXV0b2ZvY3VzOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGF1dG9mb2N1cyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmF1dG9mb2N1cyA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZGVmYXVsdENoZWNrZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGVmYXVsdENoZWNrZWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgZGVmYXVsdENoZWNrZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kZWZhdWx0Q2hlY2tlZCA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgY2hlY2tlZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jaGVja2VkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNoZWNrZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5jaGVja2VkID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBkaXJOYW1lKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmRpck5hbWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgZGlyTmFtZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRpck5hbWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZGlzYWJsZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGlzYWJsZWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgZGlzYWJsZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kaXNhYmxlZCA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZm9ybSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmZvcm0pOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBmaWxlcygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmZpbGVzKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZm9ybUFjdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5mb3JtQWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGZvcm1BY3Rpb24obmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5mb3JtQWN0aW9uID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvcm1FbmN0eXBlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmZvcm1FbmN0eXBlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGZvcm1FbmN0eXBlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZm9ybUVuY3R5cGUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZm9ybU1ldGhvZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5mb3JtTWV0aG9kOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGZvcm1NZXRob2QobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5mb3JtTWV0aG9kID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvcm1Ob1ZhbGlkYXRlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmZvcm1Ob1ZhbGlkYXRlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGZvcm1Ob1ZhbGlkYXRlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZm9ybU5vVmFsaWRhdGUgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvcm1UYXJnZXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZm9ybVRhcmdldDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBmb3JtVGFyZ2V0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZm9ybVRhcmdldCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBoZWlnaHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGhlaWdodChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmhlaWdodCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBpbmRldGVybWluYXRlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmluZGV0ZXJtaW5hdGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgaW5kZXRlcm1pbmF0ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmluZGV0ZXJtaW5hdGUgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxpc3QoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5saXN0KTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbWF4KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1heDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtYXgobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5tYXggPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbWF4TGVuZ3RoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1heExlbmd0aDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtYXhMZW5ndGgobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5tYXhMZW5ndGggPSB0b0xvbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbWluKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1pbjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtaW4obmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5taW4gPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbXVsdGlwbGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubXVsdGlwbGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbXVsdGlwbGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5tdWx0aXBsZSA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5uYW1lOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG5hbWUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5uYW1lID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHBhdHRlcm4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucGF0dGVybjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwYXR0ZXJuKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucGF0dGVybiA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwbGFjZWhvbGRlcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5wbGFjZWhvbGRlcjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwbGFjZWhvbGRlcihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBsYWNlaG9sZGVyID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHJlYWRPbmx5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnJlYWRPbmx5OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHJlYWRPbmx5KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucmVhZE9ubHkgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHJlcXVpcmVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnJlcXVpcmVkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHJlcXVpcmVkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucmVxdWlyZWQgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNpemUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc2l6ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzaXplKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2l6ZSA9IHRvVUxvbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc3JjKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNyYzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzcmMobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zcmMgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc3RlcCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zdGVwOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHN0ZXAobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zdGVwID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHR5cGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudHlwZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB0eXBlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudHlwZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBkZWZhdWx0VmFsdWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGVmYXVsdFZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRlZmF1bHRWYWx1ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRlZmF1bHRWYWx1ZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB2YWx1ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB2YWx1ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnZhbHVlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbHVlQXNEYXRlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykudmFsdWVBc0RhdGUpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHZhbHVlQXNEYXRlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudmFsdWVBc0RhdGUgPSB1bndyYXAobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdmFsdWVBc051bWJlcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS52YWx1ZUFzTnVtYmVyOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHZhbHVlQXNOdW1iZXIobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS52YWx1ZUFzTnVtYmVyID0gdG9Eb3VibGUobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2VsZWN0ZWRPcHRpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5zZWxlY3RlZE9wdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHdpZHRoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLndpZHRoOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHdpZHRoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykud2lkdGggPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBzdGVwVXA6IGZ1bmN0aW9uIHN0ZXBVcChuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zdGVwVXAoT3B0aW9uYWx0b0xvbmcobikpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHN0ZXBEb3duOiBmdW5jdGlvbiBzdGVwRG93bihuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zdGVwRG93bihPcHRpb25hbHRvTG9uZyhuKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHdpbGxWYWxpZGF0ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS53aWxsVmFsaWRhdGU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbGlkaXR5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykudmFsaWRpdHkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB2YWxpZGF0aW9uTWVzc2FnZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS52YWxpZGF0aW9uTWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBjaGVja1ZhbGlkaXR5OiBmdW5jdGlvbiBjaGVja1ZhbGlkaXR5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNoZWNrVmFsaWRpdHkoKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBzZXRDdXN0b21WYWxpZGl0eTogZnVuY3Rpb24gc2V0Q3VzdG9tVmFsaWRpdHkoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNldEN1c3RvbVZhbGlkaXR5KFN0cmluZyhlcnJvcikpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsYWJlbHMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5sYWJlbHMpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHNlbGVjdDogZnVuY3Rpb24gc2VsZWN0KCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2VsZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNlbGVjdGlvblN0YXJ0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNlbGVjdGlvblN0YXJ0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNlbGVjdGlvblN0YXJ0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2VsZWN0aW9uU3RhcnQgPSB0b1VMb25nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNlbGVjdGlvbkVuZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zZWxlY3Rpb25FbmQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgc2VsZWN0aW9uRW5kKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2VsZWN0aW9uRW5kID0gdG9VTG9uZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBzZWxlY3Rpb25EaXJlY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc2VsZWN0aW9uRGlyZWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNlbGVjdGlvbkRpcmVjdGlvbihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNlbGVjdGlvbkRpcmVjdGlvbiA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHNldFNlbGVjdGlvblJhbmdlOiBmdW5jdGlvbiBzZXRTZWxlY3Rpb25SYW5nZShzdGFydCwgZW5kLCBkaXJlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNldFNlbGVjdGlvblJhbmdlKHRvVUxvbmcoc3RhcnQpLCB0b1VMb25nKGVuZCksIE9wdGlvbmFsU3RyaW5nKGRpcmVjdGlvbikpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MQnV0dG9uRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MQnV0dG9uRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MQnV0dG9uRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MQnV0dG9uRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxCdXR0b25FbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgYXV0b2ZvY3VzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmF1dG9mb2N1czsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBhdXRvZm9jdXMobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5hdXRvZm9jdXMgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGRpc2FibGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmRpc2FibGVkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRpc2FibGVkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZGlzYWJsZWQgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvcm0oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5mb3JtKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZm9ybUFjdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5mb3JtQWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGZvcm1BY3Rpb24obmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5mb3JtQWN0aW9uID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvcm1FbmN0eXBlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmZvcm1FbmN0eXBlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGZvcm1FbmN0eXBlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZm9ybUVuY3R5cGUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZm9ybU1ldGhvZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5mb3JtTWV0aG9kOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGZvcm1NZXRob2QobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5mb3JtTWV0aG9kID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvcm1Ob1ZhbGlkYXRlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmZvcm1Ob1ZhbGlkYXRlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGZvcm1Ob1ZhbGlkYXRlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZm9ybU5vVmFsaWRhdGUgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvcm1UYXJnZXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZm9ybVRhcmdldDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBmb3JtVGFyZ2V0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZm9ybVRhcmdldCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBuYW1lKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbmFtZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm5hbWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50eXBlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHR5cGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50eXBlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbHVlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHZhbHVlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudmFsdWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgd2lsbFZhbGlkYXRlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLndpbGxWYWxpZGF0ZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdmFsaWRpdHkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS52YWxpZGl0eSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbGlkYXRpb25NZXNzYWdlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnZhbGlkYXRpb25NZXNzYWdlOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGNoZWNrVmFsaWRpdHk6IGZ1bmN0aW9uIGNoZWNrVmFsaWRpdHkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY2hlY2tWYWxpZGl0eSgpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHNldEN1c3RvbVZhbGlkaXR5OiBmdW5jdGlvbiBzZXRDdXN0b21WYWxpZGl0eShlcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2V0Q3VzdG9tVmFsaWRpdHkoU3RyaW5nKGVycm9yKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxhYmVscygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmxhYmVscyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxTZWxlY3RFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxTZWxlY3RFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxTZWxlY3RFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxTZWxlY3RFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTFNlbGVjdEVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBhdXRvZm9jdXMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuYXV0b2ZvY3VzOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGF1dG9mb2N1cyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmF1dG9mb2N1cyA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZGlzYWJsZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGlzYWJsZWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgZGlzYWJsZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kaXNhYmxlZCA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZm9ybSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmZvcm0pOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBtdWx0aXBsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5tdWx0aXBsZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtdWx0aXBsZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm11bHRpcGxlID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBuYW1lKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbmFtZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm5hbWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcmVxdWlyZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucmVxdWlyZWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgcmVxdWlyZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5yZXF1aXJlZCA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2l6ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zaXplOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNpemUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zaXplID0gdG9VTG9uZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0eXBlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnR5cGU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9wdGlvbnMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5vcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbGVuZ3RoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBsZW5ndGgobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5sZW5ndGggPSB0b1VMb25nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgbmFtZWRJdGVtOiBmdW5jdGlvbiBuYW1lZEl0ZW0obmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm5hbWVkSXRlbShTdHJpbmcobmFtZSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5yZW1vdmUodG9Mb25nKGluZGV4KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNlbGVjdGVkT3B0aW9ucygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLnNlbGVjdGVkT3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNlbGVjdGVkSW5kZXgoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc2VsZWN0ZWRJbmRleDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzZWxlY3RlZEluZGV4KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2VsZWN0ZWRJbmRleCA9IHRvTG9uZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB2YWx1ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB2YWx1ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnZhbHVlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHdpbGxWYWxpZGF0ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS53aWxsVmFsaWRhdGU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbGlkaXR5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykudmFsaWRpdHkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB2YWxpZGF0aW9uTWVzc2FnZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS52YWxpZGF0aW9uTWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBjaGVja1ZhbGlkaXR5OiBmdW5jdGlvbiBjaGVja1ZhbGlkaXR5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNoZWNrVmFsaWRpdHkoKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBzZXRDdXN0b21WYWxpZGl0eTogZnVuY3Rpb24gc2V0Q3VzdG9tVmFsaWRpdHkoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNldEN1c3RvbVZhbGlkaXR5KFN0cmluZyhlcnJvcikpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsYWJlbHMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5sYWJlbHMpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MRGF0YUxpc3RFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxEYXRhTGlzdEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTERhdGFMaXN0RWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MRGF0YUxpc3RFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTERhdGFMaXN0RWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IG9wdGlvbnMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5vcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTE9wdEdyb3VwRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MT3B0R3JvdXBFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxPcHRHcm91cEVsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTE9wdEdyb3VwRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxPcHRHcm91cEVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBkaXNhYmxlZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5kaXNhYmxlZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkaXNhYmxlZChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRpc2FibGVkID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsYWJlbCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5sYWJlbDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBsYWJlbChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmxhYmVsID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxPcHRpb25FbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxPcHRpb25FbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxPcHRpb25FbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxPcHRpb25FbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTE9wdGlvbkVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBkaXNhYmxlZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5kaXNhYmxlZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkaXNhYmxlZChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRpc2FibGVkID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBmb3JtKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuZm9ybSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxhYmVsKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmxhYmVsOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGxhYmVsKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubGFiZWwgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZGVmYXVsdFNlbGVjdGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmRlZmF1bHRTZWxlY3RlZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkZWZhdWx0U2VsZWN0ZWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kZWZhdWx0U2VsZWN0ZWQgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNlbGVjdGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNlbGVjdGVkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNlbGVjdGVkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2VsZWN0ZWQgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbHVlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHZhbHVlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudmFsdWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdGV4dCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50ZXh0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHRleHQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50ZXh0ID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGluZGV4KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmluZGV4OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MVGV4dEFyZWFFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxUZXh0QXJlYUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTFRleHRBcmVhRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MVGV4dEFyZWFFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTFRleHRBcmVhRWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IGF1dG9mb2N1cygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5hdXRvZm9jdXM7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgYXV0b2ZvY3VzKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuYXV0b2ZvY3VzID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjb2xzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNvbHM7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgY29scyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmNvbHMgPSB0b1VMb25nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGRpck5hbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZGlyTmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkaXJOYW1lKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZGlyTmFtZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBkaXNhYmxlZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5kaXNhYmxlZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkaXNhYmxlZChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmRpc2FibGVkID0gQm9vbGVhbihuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBmb3JtKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuZm9ybSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG1heExlbmd0aCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5tYXhMZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbWF4TGVuZ3RoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubWF4TGVuZ3RoID0gdG9Mb25nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG5hbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBuYW1lKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubmFtZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwbGFjZWhvbGRlcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5wbGFjZWhvbGRlcjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwbGFjZWhvbGRlcihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBsYWNlaG9sZGVyID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHJlYWRPbmx5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnJlYWRPbmx5OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHJlYWRPbmx5KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucmVhZE9ubHkgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHJlcXVpcmVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnJlcXVpcmVkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHJlcXVpcmVkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucmVxdWlyZWQgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHJvd3MoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucm93czsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCByb3dzKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucm93cyA9IHRvVUxvbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgd3JhcCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS53cmFwOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHdyYXAobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS53cmFwID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHR5cGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudHlwZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZGVmYXVsdFZhbHVlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmRlZmF1bHRWYWx1ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBkZWZhdWx0VmFsdWUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5kZWZhdWx0VmFsdWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdmFsdWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdmFsdWUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS52YWx1ZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0ZXh0TGVuZ3RoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnRleHRMZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHdpbGxWYWxpZGF0ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS53aWxsVmFsaWRhdGU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbGlkaXR5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykudmFsaWRpdHkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB2YWxpZGF0aW9uTWVzc2FnZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS52YWxpZGF0aW9uTWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBjaGVja1ZhbGlkaXR5OiBmdW5jdGlvbiBjaGVja1ZhbGlkaXR5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNoZWNrVmFsaWRpdHkoKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBzZXRDdXN0b21WYWxpZGl0eTogZnVuY3Rpb24gc2V0Q3VzdG9tVmFsaWRpdHkoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNldEN1c3RvbVZhbGlkaXR5KFN0cmluZyhlcnJvcikpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsYWJlbHMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5sYWJlbHMpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHNlbGVjdDogZnVuY3Rpb24gc2VsZWN0KCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2VsZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNlbGVjdGlvblN0YXJ0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNlbGVjdGlvblN0YXJ0OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNlbGVjdGlvblN0YXJ0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2VsZWN0aW9uU3RhcnQgPSB0b1VMb25nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNlbGVjdGlvbkVuZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zZWxlY3Rpb25FbmQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgc2VsZWN0aW9uRW5kKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2VsZWN0aW9uRW5kID0gdG9VTG9uZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBzZWxlY3Rpb25EaXJlY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc2VsZWN0aW9uRGlyZWN0aW9uOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHNlbGVjdGlvbkRpcmVjdGlvbihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNlbGVjdGlvbkRpcmVjdGlvbiA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHNldFNlbGVjdGlvblJhbmdlOiBmdW5jdGlvbiBzZXRTZWxlY3Rpb25SYW5nZShzdGFydCwgZW5kLCBkaXJlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNldFNlbGVjdGlvblJhbmdlKHRvVUxvbmcoc3RhcnQpLCB0b1VMb25nKGVuZCksIE9wdGlvbmFsU3RyaW5nKGRpcmVjdGlvbikpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MS2V5Z2VuRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MS2V5Z2VuRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MS2V5Z2VuRWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MS2V5Z2VuRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxLZXlnZW5FbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgYXV0b2ZvY3VzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmF1dG9mb2N1czsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBhdXRvZm9jdXMobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5hdXRvZm9jdXMgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNoYWxsZW5nZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jaGFsbGVuZ2U7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgY2hhbGxlbmdlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuY2hhbGxlbmdlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGRpc2FibGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmRpc2FibGVkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRpc2FibGVkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZGlzYWJsZWQgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGZvcm0oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5mb3JtKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQga2V5dHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5rZXl0eXBlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGtleXR5cGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5rZXl0eXBlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG5hbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBuYW1lKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubmFtZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0eXBlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnR5cGU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHdpbGxWYWxpZGF0ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS53aWxsVmFsaWRhdGU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbGlkaXR5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykudmFsaWRpdHkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB2YWxpZGF0aW9uTWVzc2FnZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS52YWxpZGF0aW9uTWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBjaGVja1ZhbGlkaXR5OiBmdW5jdGlvbiBjaGVja1ZhbGlkaXR5KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmNoZWNrVmFsaWRpdHkoKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBzZXRDdXN0b21WYWxpZGl0eTogZnVuY3Rpb24gc2V0Q3VzdG9tVmFsaWRpdHkoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnNldEN1c3RvbVZhbGlkaXR5KFN0cmluZyhlcnJvcikpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsYWJlbHMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5sYWJlbHMpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIVE1MT3V0cHV0RWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MT3V0cHV0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MT3V0cHV0RWxlbWVudC5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIVE1MT3V0cHV0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxPdXRwdXRFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgaHRtbEZvcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmh0bWxGb3IpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBmb3JtKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAodGhpcykuZm9ybSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG5hbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBuYW1lKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubmFtZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB0eXBlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnR5cGU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGRlZmF1bHRWYWx1ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5kZWZhdWx0VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgZGVmYXVsdFZhbHVlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZGVmYXVsdFZhbHVlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbHVlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHZhbHVlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudmFsdWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgd2lsbFZhbGlkYXRlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLndpbGxWYWxpZGF0ZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdmFsaWRpdHkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS52YWxpZGl0eSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHZhbGlkYXRpb25NZXNzYWdlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnZhbGlkYXRpb25NZXNzYWdlOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGNoZWNrVmFsaWRpdHk6IGZ1bmN0aW9uIGNoZWNrVmFsaWRpdHkoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY2hlY2tWYWxpZGl0eSgpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHNldEN1c3RvbVZhbGlkaXR5OiBmdW5jdGlvbiBzZXRDdXN0b21WYWxpZGl0eShlcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2V0Q3VzdG9tVmFsaWRpdHkoU3RyaW5nKGVycm9yKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxhYmVscygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmxhYmVscyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxQcm9ncmVzc0VsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTFByb2dyZXNzRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MUHJvZ3Jlc3NFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxQcm9ncmVzc0VsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MUHJvZ3Jlc3NFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgdmFsdWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdmFsdWUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS52YWx1ZSA9IHRvRG91YmxlKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG1heCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5tYXg7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbWF4KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubWF4ID0gdG9Eb3VibGUobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcG9zaXRpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxhYmVscygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmxhYmVscyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxNZXRlckVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTE1ldGVyRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MTWV0ZXJFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxNZXRlckVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MTWV0ZXJFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgdmFsdWUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgdmFsdWUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS52YWx1ZSA9IHRvRG91YmxlKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG1pbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5taW47CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbWluKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubWluID0gdG9Eb3VibGUobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbWF4KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1heDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtYXgobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5tYXggPSB0b0RvdWJsZShuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsb3coKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykubG93OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGxvdyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmxvdyA9IHRvRG91YmxlKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGhpZ2goKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaGlnaDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBoaWdoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaGlnaCA9IHRvRG91YmxlKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9wdGltdW0oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub3B0aW11bTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvcHRpbXVtKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub3B0aW11bSA9IHRvRG91YmxlKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxhYmVscygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmxhYmVscyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIFZhbGlkaXR5U3RhdGUKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiVmFsaWRpdHlTdGF0ZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5WYWxpZGl0eVN0YXRlLnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIlZhbGlkaXR5U3RhdGUiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJWYWxpZGl0eVN0YXRlIiwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgdmFsdWVNaXNzaW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnZhbHVlTWlzc2luZzsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdHlwZU1pc21hdGNoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnR5cGVNaXNtYXRjaDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcGF0dGVybk1pc21hdGNoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnBhdHRlcm5NaXNtYXRjaDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdG9vTG9uZygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50b29Mb25nOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCByYW5nZVVuZGVyZmxvdygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5yYW5nZVVuZGVyZmxvdzsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcmFuZ2VPdmVyZmxvdygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5yYW5nZU92ZXJmbG93OwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBzdGVwTWlzbWF0Y2goKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuc3RlcE1pc21hdGNoOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBjdXN0b21FcnJvcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jdXN0b21FcnJvcjsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgdmFsaWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudmFsaWQ7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxEZXRhaWxzRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MRGV0YWlsc0VsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTERldGFpbHNFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxEZXRhaWxzRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxEZXRhaWxzRWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IG9wZW4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub3BlbjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvcGVuKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub3BlbiA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTENvbW1hbmRFbGVtZW50CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhUTUxDb21tYW5kRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MQ29tbWFuZEVsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTENvbW1hbmRFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSFRNTENvbW1hbmRFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgdHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS50eXBlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHR5cGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS50eXBlID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGxhYmVsKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmxhYmVsOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGxhYmVsKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubGFiZWwgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgaWNvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5pY29uOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGljb24obmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5pY29uID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGRpc2FibGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmRpc2FibGVkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGRpc2FibGVkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuZGlzYWJsZWQgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNoZWNrZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuY2hlY2tlZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBjaGVja2VkKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuY2hlY2tlZCA9IEJvb2xlYW4obmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgcmFkaW9ncm91cCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5yYWRpb2dyb3VwOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IHJhZGlvZ3JvdXAobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5yYWRpb2dyb3VwID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxNZW51RWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MTWVudUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSFRNTE1lbnVFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxNZW51RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxNZW51RWxlbWVudCIsCiAgICAgICAgICAgICAgICBzdXBlcmNsYXNzOiBpZGwuSFRNTEVsZW1lbnQsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ2V0IHR5cGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudHlwZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCB0eXBlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykudHlwZSA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsYWJlbCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5sYWJlbDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBsYWJlbChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmxhYmVsID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gSW50ZXJmYWNlIEhUTUxGcmFtZVNldEVsZW1lbnQKICAgICAgICAvLwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoZ2xvYmFsLCAiSFRNTEZyYW1lU2V0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5IVE1MRnJhbWVTZXRFbGVtZW50LnB1YmxpY0ludGVyZmFjZTsKICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGlkbCwgIkhUTUxGcmFtZVNldEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSURMSW50ZXJmYWNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJIVE1MRnJhbWVTZXRFbGVtZW50IiwKICAgICAgICAgICAgICAgIHN1cGVyY2xhc3M6IGlkbC5IVE1MRWxlbWVudCwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgY29scygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5jb2xzOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGNvbHMobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5jb2xzID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHJvd3MoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucm93czsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCByb3dzKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucm93cyA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmFmdGVycHJpbnQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25hZnRlcnByaW50OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uYWZ0ZXJwcmludChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uYWZ0ZXJwcmludCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25iZWZvcmVwcmludCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmJlZm9yZXByaW50OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uYmVmb3JlcHJpbnQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmJlZm9yZXByaW50ID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmJlZm9yZXVubG9hZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmJlZm9yZXVubG9hZDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbmJlZm9yZXVubG9hZChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uYmVmb3JldW5sb2FkID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmJsdXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25ibHVyOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uYmx1cihuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uYmx1ciA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25lcnJvcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmVycm9yOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uZXJyb3IobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbmVycm9yID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmZvY3VzKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9uZm9jdXM7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25mb2N1cyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uZm9jdXMgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9uaGFzaGNoYW5nZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbmhhc2hjaGFuZ2U7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25oYXNoY2hhbmdlKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25oYXNoY2hhbmdlID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbmxvYWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25sb2FkOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ubG9hZChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ubG9hZCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25tZXNzYWdlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ubWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbm1lc3NhZ2UobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbm1lc3NhZ2UgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ub2ZmbGluZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbm9mZmxpbmU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25vZmZsaW5lKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25vZmZsaW5lID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbm9ubGluZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbm9ubGluZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbm9ubGluZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ub25saW5lID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnBhZ2VoaWRlKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm9ucGFnZWhpZGU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb25wYWdlaGlkZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ucGFnZWhpZGUgPSB0b0NhbGxiYWNrT3JOdWxsKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG9ucGFnZXNob3coKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25wYWdlc2hvdzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnBhZ2VzaG93KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykub25wYWdlc2hvdyA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb25wb3BzdGF0ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnBvcHN0YXRlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9ucG9wc3RhdGUobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnBvcHN0YXRlID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnJlc2l6ZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnJlc2l6ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnJlc2l6ZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9ucmVzaXplID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnNjcm9sbCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5vbnNjcm9sbDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBvbnNjcm9sbChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uc2Nyb2xsID0gdG9DYWxsYmFja09yTnVsbChuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBvbnN0b3JhZ2UoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub25zdG9yYWdlOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG9uc3RvcmFnZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm9uc3RvcmFnZSA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgb251bmxvYWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykub251bmxvYWQ7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgb251bmxvYWQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5vbnVubG9hZCA9IHRvQ2FsbGJhY2tPck51bGwobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgSFRNTEZyYW1lRWxlbWVudAogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJIVE1MRnJhbWVFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaWRsLkhUTUxGcmFtZUVsZW1lbnQucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiSFRNTEZyYW1lRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkhUTUxGcmFtZUVsZW1lbnQiLAogICAgICAgICAgICAgICAgc3VwZXJjbGFzczogaWRsLkhUTUxFbGVtZW50LAogICAgICAgICAgICAgICAgbWVtYmVyczogewogICAgICAgICAgICAgICAgICAgIGdldCBuYW1lKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgbmFtZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLm5hbWUgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc2Nyb2xsaW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNjcm9sbGluZzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzY3JvbGxpbmcobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zY3JvbGxpbmcgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgc3JjKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnNyYzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBzcmMobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5zcmMgPSBTdHJpbmcobmV3dmFsKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgZnJhbWVCb3JkZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuZnJhbWVCb3JkZXI7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgZnJhbWVCb3JkZXIobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5mcmFtZUJvcmRlciA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBsb25nRGVzYygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5sb25nRGVzYzsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBsb25nRGVzYyhuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmxvbmdEZXNjID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG5vUmVzaXplKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm5vUmVzaXplOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG5vUmVzaXplKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubm9SZXNpemUgPSBCb29sZWFuKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvbnRlbnREb2N1bWVudCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKHRoaXMpLmNvbnRlbnREb2N1bWVudCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGNvbnRlbnRXaW5kb3coKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3cmFwKHVud3JhcCh0aGlzKS5jb250ZW50V2luZG93KTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBnZXQgbWFyZ2luSGVpZ2h0KCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1hcmdpbkhlaWdodDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBtYXJnaW5IZWlnaHQobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5tYXJnaW5IZWlnaHQgPSBTdHJpbmdPckVtcHR5KG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IG1hcmdpbldpZHRoKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLm1hcmdpbldpZHRoOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IG1hcmdpbldpZHRoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykubWFyZ2luV2lkdGggPSBTdHJpbmdPckVtcHR5KG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgKiAgc3JjL3dpbmRvd29ianMuanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy93aW5kb3dvYmpzLmpzIgogICAgICAgIC8vCiAgICAgICAgLy8gRE8gTk9UIEVESVQuCiAgICAgICAgLy8gVGhpcyBmaWxlIHdhcyBnZW5lcmF0ZWQgYnkgaWRsMmRvbWpzIGZyb20gc3JjL2lkbC93aW5kb3dvYmpzLmlkbAogICAgICAgIC8vCgoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBMb2NhdGlvbgogICAgICAgIC8vCgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJMb2NhdGlvbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5Mb2NhdGlvbi5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJMb2NhdGlvbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJRExJbnRlcmZhY2UoewogICAgICAgICAgICAgICAgbmFtZTogIkxvY2F0aW9uIiwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgaHJlZigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ocmVmOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0IGhyZWYobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5ocmVmID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgYXNzaWduOiBmdW5jdGlvbiBhc3NpZ24odXJsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5hc3NpZ24oU3RyaW5nKHVybCkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHJlcGxhY2U6IGZ1bmN0aW9uIHJlcGxhY2UodXJsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5yZXBsYWNlKFN0cmluZyh1cmwpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICByZWxvYWQ6IGZ1bmN0aW9uIHJlbG9hZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwcm90b2NvbCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5wcm90b2NvbDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwcm90b2NvbChuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnByb3RvY29sID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGhvc3QoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaG9zdDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBob3N0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaG9zdCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBob3N0bmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5ob3N0bmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBob3N0bmFtZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmhvc3RuYW1lID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHBvcnQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykucG9ydDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwb3J0KG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykucG9ydCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBwYXRobmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5wYXRobmFtZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBwYXRobmFtZShuZXd2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLnBhdGhuYW1lID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHNlYXJjaCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5zZWFyY2g7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQgc2VhcmNoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuc2VhcmNoID0gU3RyaW5nKG5ld3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IGhhc2goKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykuaGFzaDsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldCBoYXNoKG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB1bndyYXAodGhpcykuaGFzaCA9IFN0cmluZyhuZXd2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLwogICAgICAgIC8vIEludGVyZmFjZSBIaXN0b3J5CiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIkhpc3RvcnkiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpZGwuSGlzdG9yeS5wdWJsaWNJbnRlcmZhY2U7CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpZGwsICJIaXN0b3J5IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiSGlzdG9yeSIsCiAgICAgICAgICAgICAgICBtZW1iZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgZ286IGZ1bmN0aW9uIGdvKGRlbHRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5nbyhPcHRpb25hbHRvTG9uZyhkZWx0YSkpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGJhY2s6IGZ1bmN0aW9uIGJhY2soKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCh0aGlzKS5iYWNrKCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZm9yd2FyZDogZnVuY3Rpb24gZm9yd2FyZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwKHRoaXMpLmZvcndhcmQoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8KICAgICAgICAvLyBJbnRlcmZhY2UgTmF2aWdhdG9yCiAgICAgICAgLy8KCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGdsb2JhbCwgIk5hdmlnYXRvciIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlkbC5OYXZpZ2F0b3IucHVibGljSW50ZXJmYWNlOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaWRsLCAiTmF2aWdhdG9yIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IElETEludGVyZmFjZSh7CiAgICAgICAgICAgICAgICBuYW1lOiAiTmF2aWdhdG9yIiwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IHsKICAgICAgICAgICAgICAgICAgICBnZXQgYXBwTmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVud3JhcCh0aGlzKS5hcHBOYW1lOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCBhcHBWZXJzaW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLmFwcFZlcnNpb247CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgZ2V0IHBsYXRmb3JtKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKHRoaXMpLnBsYXRmb3JtOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIGdldCB1c2VyQWdlbnQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAodGhpcykudXNlckFnZW50OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9BdHRyQXJyYXlQcm94eS5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL0F0dHJBcnJheVByb3h5LmpzIgogICAgICAgIC8vIFhYWAogICAgICAgIC8vIFRoaXMgY2xhc3MgaXMgbW9zdGx5IHRoZSBzYW1lIGFzIEFycmF5UHJveHksIGJ1dCBpdCB1c2VzIHRoZSBpdGVtKCkgbWV0aG9kCiAgICAgICAgLy8gb2YgdGhlIEF0dHJpYnV0ZXMgb2JqZWN0IGluc3RlYWQgb2YgZGlyZWN0bHkgaW5kZXhpbmcgYW4gYXJyYXkuICBNYXliZQogICAgICAgIC8vIGl0IGNvdWxkIGJlIG1lcmdlZCBpbnRvIGEgbW9yZSBnZW5lcmFsIEFycmF5LWxpa2UgUHJveHkgdHlwZS4KICAgICAgICAvLwoKICAgICAgICAvLyBBIGZhY3RvcnkgZnVuY3Rpb24gZm9yIEF0dHJBcnJheSBwcm94eSBvYmplY3RzCiAgICAgICAgZnVuY3Rpb24gQXR0ckFycmF5UHJveHkoYXR0cmlidXRlcykgewogICAgICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uIGV4cGVjdHMgYW4gQXR0cmlidXRlc0FycmF5IG9iamVjdCAoc2VlIGltcGwvRWxlbWVudC5qcykKICAgICAgICAgICAgLy8gTm90ZSwgdGhvdWdoIHRoYXQgdGhhdCBvYmplY3QganVzdCBoYXMgYW4gZWxlbWVudCBwcm9wZXJ0eSB0aGF0IHBvaW50cwogICAgICAgICAgICAvLyBiYWNrIHRvIHRoZSBFbGVtZW50IG9iamVjdC4gIFRoaXMgcHJveHkgaXMgYmFzZWQgb24gdGhlIGVsZW1lbnQgb2JqZWN0LgogICAgICAgICAgICB2YXIgaGFuZGxlciA9IE8uY3JlYXRlKEF0dHJBcnJheVByb3h5LmhhbmRsZXIpOwogICAgICAgICAgICBoYW5kbGVyLmVsZW1lbnQgPSBhdHRyaWJ1dGVzLmVsZW1lbnQ7CiAgICAgICAgICAgIGhhbmRsZXIubG9jYWxwcm9wcyA9IE8uY3JlYXRlKG51bGwpOwogICAgICAgICAgICByZXR1cm4gbmV3IFByb3h5KEFycmF5LnByb3RvdHlwZSwgaGFuZGxlcik7CiAgICAgICAgfQoKICAgICAgICAvLyBUaGlzIGlzIHRoZSBwcm90b3R5cGUgb2JqZWN0IGZvciB0aGUgcHJveHkgaGFuZGxlciBvYmplY3QKICAgICAgICAvLwogICAgICAgIC8vIEZvciBub3csIHdoaWxlIHRoZSBQcm94eSBzcGVjIGlzIHN0aWxsIGluIGZsdXgsIHRoaXMgaGFuZGxlcgogICAgICAgIC8vIGRlZmluZXMgb25seSB0aGUgZnVuZGFtZW50YWwgdHJhcHMuICBXZSBjYW4gYWRkIHRoZSBkZXJpdmVkIHRyYXBzCiAgICAgICAgLy8gbGF0ZXIgaWYgdGhlcmUgaXMgYSBwZXJmb3JtYW5jZSBib3R0bGVuZWNrLgogICAgICAgIEF0dHJBcnJheVByb3h5LmhhbmRsZXIgPSB7CiAgICAgICAgICAgIGlzQXJyYXlJbmRleDogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcodG9VTG9uZyhuYW1lKSkgPT09IG5hbWU7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihuYW1lKSB7CiAgICAgICAgICAgICAgICBpZiAobmFtZSA9PT0gImxlbmd0aCIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5lbGVtZW50Ll9udW1hdHRycywKICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQXJyYXlJbmRleChuYW1lKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChuYW1lIDwgdGhpcy5lbGVtZW50Ll9udW1hdHRycykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IHRoaXMuZWxlbWVudC5fYXR0cihuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHdyYXAodiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTy5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGhpcy5sb2NhbHByb3BzLCBuYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0UHJvcGVydHlEZXNjcmlwdG9yOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICAgICAgdmFyIGRlc2MgPSB0aGlzLmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuYW1lKSB8fCBPLmdldE93blByb3BlcnR5RGVzY3JpcHRvcihBLnByb3RvdHlwZSwgbmFtZSkgfHwgTy5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTy5wcm90b3R5cGUsIG5hbWUpOwogICAgICAgICAgICAgICAgaWYgKGRlc2MpIGRlc2MuY29uZmlndXJhYmxlID0gdHJ1ZTsgLy8gUHJveGllcyByZXF1aXJlIHRoaXMKICAgICAgICAgICAgICAgIHJldHVybiBkZXNjOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRPd25Qcm9wZXJ0eU5hbWVzOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKCkgewogICAgICAgICAgICAgICAgdmFyIHIgPSBbImxlbmd0aCJdOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSB0aGlzLmVsZW1lbnQuX251bWF0dHJzOyBpIDwgbjsgaSsrKSBwdXNoKHIsIFN0cmluZyhpKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gY29uY2F0KHIsIE8uZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzLmxvY2FscHJvcHMpKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmaW5lUHJvcGVydHk6IGZ1bmN0aW9uIChuYW1lLCBkZXNjKSB7CiAgICAgICAgICAgICAgICAvLyBYWFgKICAgICAgICAgICAgICAgIC8vIFRoZSBXZWJJREwgYWxnb3JpdGhtIHNheXMgd2Ugc2hvdWxkICJSZWplY3QiIHRoZXNlIGF0dGVtcHRzIGJ5CiAgICAgICAgICAgICAgICAvLyB0aHJvd2luZyBvciByZXR1cm5pbmcgZmFsc2UsIGRlcGVuZGluZyBvbiB0aGUgVGhyb3cgYXJndW1lbnQsIHdoaWNoCiAgICAgICAgICAgICAgICAvLyBpcyB1c3VhbGx5IHN0cmljdC1tb2RlIGRlcGVuZGVudC4gIFdoaWxlIHRoaXMgaXMgYmVpbmcgY2xhcmlmaWVkCiAgICAgICAgICAgICAgICAvLyBJJ2xsIGp1c3QgdGhyb3cgaGVyZS4gIE1heSBuZWVkIHRvIGNoYW5nZSB0aGlzIHRvIHJldHVybiBmYWxzZQogICAgICAgICAgICAgICAgLy8gaW5zdGVhZC4KICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQXJyYXlJbmRleChuYW1lKSB8fCBuYW1lID09PSAibGVuZ3RoIikgdGhyb3cgVHlwZUVycm9yKCJyZWFkLW9ubHkgYXJyYXkiKTsKICAgICAgICAgICAgICAgIGRlc2MuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIE8uZGVmaW5lUHJvcGVydHkodGhpcy5sb2NhbHByb3BzLCBuYW1lLCBkZXNjKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVsZXRlOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICAgICAgLy8gQ2FuJ3QgZGVsZXRlIHRoZSBsZW5ndGggcHJvcGVydHkKICAgICAgICAgICAgICAgIGlmIChuYW1lID09PSAibGVuZ3RoIikgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgICAgIC8vIENhbid0IGRlbGV0ZSBpbmRleCBwcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0FycmF5SW5kZXgobmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBJZiBhbiBpdGVtIGV4aXN0cyBhdCB0aGF0IGluZGV4LCByZXR1cm4gZmFsc2U6IHdvbid0IGRlbGV0ZSBpdAogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgaWYgbm8gaXRlbSwgdGhlbiB0aGUgaW5kZXggd2FzIG91dCBvZiBib3VuZHMgYW5kCiAgICAgICAgICAgICAgICAgICAgLy8gd2UgcmV0dXJuIHRydWUgdG8gaW5kaWNhdGUgdGhhdCB0aGUgZGVsZXRpb24gd2FzICJzdWNjZXNzZnVsIgogICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSB0b1VMb25nKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBpZHggPj0gdGhpcy5lbGVtZW50Ll9udW1hdHRyczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBkZWxldGUgdGhpcy5sb2NhbHByb3BzW25hbWVdOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLy8gV2ViSURMOiBIb3N0IG9iamVjdHMgaW1wbGVtZW50aW5nIGFuIGludGVyZmFjZSB0aGF0IHN1cHBvcnRzCiAgICAgICAgICAgIC8vIGluZGV4ZWQgb3IgbmFtZWQgcHJvcGVydGllcyBkZWZ5IGJlaW5nIGZpeGVkOyBpZiBPYmplY3QuZnJlZXplLAogICAgICAgICAgICAvLyBPYmplY3Quc2VhbCBvciBPYmplY3QucHJldmVudEV4dGVuc2lvbnMgaXMgY2FsbGVkIG9uIG9uZSwgdGhlc2UKICAgICAgICAgICAgLy8gdGhlIGZ1bmN0aW9uIE1VU1QgdGhyb3cgYSBUeXBlRXJyb3IuCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIFByb3h5IHByb3Bvc2FsOiBXaGVuIGhhbmRsZXIuZml4KCkgcmV0dXJucyB1bmRlZmluZWQsIHRoZQogICAgICAgICAgICAvLyBjb3JyZXNwb25kaW5nIGNhbGwgdG8gT2JqZWN0LmZyZWV6ZSwgT2JqZWN0LnNlYWwsIG9yCiAgICAgICAgICAgIC8vIE9iamVjdC5wcmV2ZW50RXh0ZW5zaW9ucyB3aWxsIHRocm93IGEgVHlwZUVycm9yLgogICAgICAgICAgICBmaXg6IGZ1bmN0aW9uICgpIHt9LAoKICAgICAgICAgICAgLy8gR2V0IGFsbCBlbnVtZXJhYmxlIHByb3BlcnRpZXMKICAgICAgICAgICAgLy8gWFhYOiBSZW1vdmUgdGhpcyBtZXRob2Qgd2hlbiB0aGlzIGJ1ZyBpcyBmaXhlZDoKICAgICAgICAgICAgLy8gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NjY1MTk4CiAgICAgICAgICAgIGVudW1lcmF0ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHIgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gdGhpcy5lbGVtZW50Ll9udW1hdHRyczsgaSA8IG47IGkrKykgcHVzaChyLCBTdHJpbmcoaSkpOwogICAgICAgICAgICAgICAgZm9yICh2YXIgbmFtZSBpbiB0aGlzLmxvY2FscHJvcHMpIHB1c2gociwgbmFtZSk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBuYW1lIGluIEFycmF5LnByb3RvdHlwZSkgcHVzaChyLCBuYW1lKTsKICAgICAgICAgICAgICAgIHJldHVybiByOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICAqICBzcmMvTm9kZUxpc3RQcm94eS5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL05vZGVMaXN0UHJveHkuanMiCiAgICAgICAgLy8gQSBmYWN0b3J5IGZ1bmN0aW9uIGZvciBOb2RlTGlzdCBwcm94eSBvYmplY3RzCiAgICAgICAgZnVuY3Rpb24gTm9kZUxpc3RQcm94eShsaXN0KSB7CiAgICAgICAgICAgIC8vIFRoaXMgZnVuY3Rpb24gZXhwZWN0cyBhbiBvYmplY3Qgd2l0aCBhIGxlbmd0aCBwcm9wZXJ0eSBhbmQgYW4gaXRlbSgpCiAgICAgICAgICAgIC8vIG1ldGhvZC4gIElmIHdlIHBhc3MgaXQgYSBwbGFpbiBhcnJheSwgaXQgd2lsbCBhZGQgdGhlIGl0ZW0oKSBtZXRob2QKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gV2Ugc2hvdWxkIGF2b2lkIHJlYWRpbmcgdGhlIGxlbmd0aCBwcm9wZXJ0eSBvZiB0aGUgbGlzdCB3aGVuIHBvc3NpYmxlCiAgICAgICAgICAgIC8vIGJlY2F1c2UgaW4gbGF6eSBpbXBsZW1lbnRhdGlvbnMgc3VjaCBhcyBpbXBsL0ZpbHRlcmVkRWxlbWVudExpc3QsCiAgICAgICAgICAgIC8vIHJlYWRpbmcgdGhlIGxlbmd0aCBmb3JjZXMgdGhlIGZpbHRlciB0byBwcm9jZXNzIHRoZSBlbnRpcmUgZG9jdW1lbnQKICAgICAgICAgICAgLy8gdHJlZSB1bmRvaW5nIHRoZSBsYXppbmVzcy4KICAgICAgICAgICAgaWYgKGlzQXJyYXkobGlzdCkpIHsKICAgICAgICAgICAgICAgIGlmICghaGFzT3duUHJvcGVydHkobGlzdCwgIml0ZW0iKSkgbGlzdC5pdGVtID0gZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGlzdFtuXTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoYW5kbGVyID0gTy5jcmVhdGUoTm9kZUxpc3RQcm94eS5oYW5kbGVyKTsKICAgICAgICAgICAgaGFuZGxlci5saXN0ID0gbGlzdDsKICAgICAgICAgICAgaGFuZGxlci5sb2NhbHByb3BzID0gTy5jcmVhdGUobnVsbCk7CiAgICAgICAgICAgIHZhciBwID0gbmV3IFByb3h5KGlkbC5Ob2RlTGlzdC5wcm90b3R5cGUsIGhhbmRsZXIpOwoKICAgICAgICAgICAgcmV0dXJuIHA7CiAgICAgICAgfQoKICAgICAgICAvLyBUaGlzIGlzIHRoZSBwcm90b3R5cGUgb2JqZWN0IGZvciB0aGUgcHJveHkgaGFuZGxlciBvYmplY3QKICAgICAgICAvLwogICAgICAgIC8vIEZvciBub3csIHdoaWxlIHRoZSBQcm94eSBzcGVjIGlzIHN0aWxsIGluIGZsdXgsIHRoaXMgaGFuZGxlcgogICAgICAgIC8vIGRlZmluZXMgb25seSB0aGUgZnVuZGFtZW50YWwgdHJhcHMuICBXZSBjYW4gYWRkIHRoZSBkZXJpdmVkIHRyYXBzCiAgICAgICAgLy8gbGF0ZXIgaWYgdGhlcmUgaXMgYSBwZXJmb3JtYW5jZSBib3R0bGVuZWNrLgogICAgICAgIE5vZGVMaXN0UHJveHkuaGFuZGxlciA9IHsKICAgICAgICAgICAgaXNBcnJheUluZGV4OiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZyh0b1VMb25nKG5hbWUpKSA9PT0gbmFtZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8vIHRyeSBhZGRpbmcgdGhpcyB0byBtYWtlIE5vZGUgcHJveGllcyB3b3JrIHJpZ2h0CiAgICAgICAgICAgIC8vIE5lZWQgdG8gd29yayBhcm91bmQgdGhlICJpbGxlZ2FsIGFjY2VzcyIgZXJyb3IKICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24ocmVjZWl2ZXIsIG5hbWUpIHsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNBcnJheUluZGV4KG5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxpc3QuaXRlbShuYW1lKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobmFtZSBpbiB0aGlzLmxvY2FscHJvcHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxwcm9wc1tuYW1lXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpZGwuTm9kZUxpc3QucHJvdG90eXBlW25hbWVdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKi8KICAgICAgICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobmFtZSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNBcnJheUluZGV4KG5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGluZGV4IGlzIGdyZWF0ZXIgdGhhbiB0aGUgbGVuZ3RoLCB0aGVuIHdlJ2xsIGp1c3QKICAgICAgICAgICAgICAgICAgICAvLyBnZXQgbnVsbCBvciB1bmRlZmluZWQgaGVyZSBhbmQgZG8gbm90aGluZy4gVGhhdCBpcyBiZXR0ZXIKICAgICAgICAgICAgICAgICAgICAvLyB0aGFuIHRlc3RpbmcgbGVuZ3RoLgogICAgICAgICAgICAgICAgICAgIHZhciB2ID0gdGhpcy5saXN0Lml0ZW0obmFtZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB3cmFwKHYsIGlkbC5Ob2RlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSdyZSBuZXZlciBnb2luZyB0byBhbGxvdyBhcnJheSBpbmRleCBwcm9wZXJ0aWVzIHRvIGJlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCBvbiBsb2NhbHByb3BzLCBzbyB3ZSBkb24ndCBoYXZlIHRvIGRvIHRoZSB0ZXN0CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJlbG93IGFuZCBjYW4ganVzdCByZXR1cm4gbm90aGluZyBub3cuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gTy5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGhpcy5sb2NhbHByb3BzLCBuYW1lKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0UHJvcGVydHlEZXNjcmlwdG9yOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICAgICAgdmFyIGRlc2MgPSB0aGlzLmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuYW1lKSB8fCBPLmdldE93blByb3BlcnR5RGVzY3JpcHRvcihpZGwuTm9kZUxpc3QucHJvdG90eXBlLCBuYW1lKSB8fCBPLmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLnByb3RvdHlwZSwgbmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoZGVzYykgZGVzYy5jb25maWd1cmFibGUgPSB0cnVlOyAvLyBQcm94aWVzIHJlcXVpcmUgdGhpcwogICAgICAgICAgICAgICAgcmV0dXJuIGRlc2M7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldE93blByb3BlcnR5TmFtZXM6IGZ1bmN0aW9uIGdldE93blByb3BlcnR5TmFtZXMoKSB7CiAgICAgICAgICAgICAgICB2YXIgciA9IFtdOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSB0aGlzLmxpc3QubGVuZ3RoOyBpIDwgbjsgaSsrKSBwdXNoKHIsIFN0cmluZyhpKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gY29uY2F0KHIsIE8uZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzLmxvY2FscHJvcHMpKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmaW5lUHJvcGVydHk6IGZ1bmN0aW9uIChuYW1lLCBkZXNjKSB7CiAgICAgICAgICAgICAgICAvLyBYWFgKICAgICAgICAgICAgICAgIC8vIFRoZSBXZWJJREwgYWxnb3JpdGhtIHNheXMgd2Ugc2hvdWxkICJSZWplY3QiIHRoZXNlIGF0dGVtcHRzIGJ5CiAgICAgICAgICAgICAgICAvLyB0aHJvd2luZyBvciByZXR1cm5pbmcgZmFsc2UsIGRlcGVuZGluZyBvbiB0aGUgVGhyb3cgYXJndW1lbnQsIHdoaWNoCiAgICAgICAgICAgICAgICAvLyBpcyB1c3VhbGx5IHN0cmljdC1tb2RlIGRlcGVuZGVudC4gIFdoaWxlIHRoaXMgaXMgYmVpbmcgY2xhcmlmaWVkCiAgICAgICAgICAgICAgICAvLyBJJ2xsIGp1c3QgdGhyb3cgaGVyZS4gIE1heSBuZWVkIHRvIGNoYW5nZSB0aGlzIHRvIHJldHVybiBmYWxzZQogICAgICAgICAgICAgICAgLy8gaW5zdGVhZC4KICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQXJyYXlJbmRleChuYW1lKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiY2FuJ3Qgc2V0IG9yIGNyZWF0ZSBpbmRleGVkIHByb3BlcnRpZXMgJyIgKyBuYW1lICsgIiciKTsKCiAgICAgICAgICAgICAgICBPLmRlZmluZVByb3BlcnR5KHRoaXMubG9jYWxwcm9wcywgbmFtZSwgZGVzYyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlbGV0ZTogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgICAgIC8vIENhbid0IGRlbGV0ZSBpbmRleCBwcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0FycmF5SW5kZXgobmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBJZiBhbiBpdGVtIGV4aXN0cyBhdCB0aGF0IGluZGV4LCByZXR1cm4gZmFsc2U6IHdvbid0IGRlbGV0ZSBpdAogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgaWYgbm8gaXRlbSwgdGhlbiB0aGUgaW5kZXggd2FzIG91dCBvZiBib3VuZHMgYW5kCiAgICAgICAgICAgICAgICAgICAgLy8gd2UgcmV0dXJuIHRydWUgdG8gaW5kaWNhdGUgdGhhdCB0aGUgZGVsZXRpb24gd2FzICJzdWNjZXNzZnVsIgogICAgICAgICAgICAgICAgICAgIHJldHVybiAhdGhpcy5saXN0Lml0ZW0obmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZGVsZXRlIHRoaXMubG9jYWxwcm9wc1tuYW1lXTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8vIFdlYklETDogSG9zdCBvYmplY3RzIGltcGxlbWVudGluZyBhbiBpbnRlcmZhY2UgdGhhdCBzdXBwb3JzdAogICAgICAgICAgICAvLyBpbmRleGVkIG9yIG5hbWVkIHByb3BlcnRpZXMgZGVmeSBiZWluZyBmaXhlZDsgaWYgT2JqZWN0LmZyZWV6ZSwKICAgICAgICAgICAgLy8gT2JqZWN0LnNlYWwgb3IgT2JqZWN0LnByZXZlbnRFeHRlbnNpb25zIGlzIGNhbGxlZCBvbiBvbmUsIHRoZXNlCiAgICAgICAgICAgIC8vIHRoZSBmdW5jdGlvbiBNVVNUIHRocm93IGEgVHlwZUVycm9yLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBQcm94eSBwcm9wb3NhbDogV2hlbiBoYW5kbGVyLmZpeCgpIHJldHVybnMgdW5kZWZpbmVkLCB0aGUKICAgICAgICAgICAgLy8gY29ycmVzcG9uZGluZyBjYWxsIHRvIE9iamVjdC5mcmVlemUsIE9iamVjdC5zZWFsLCBvcgogICAgICAgICAgICAvLyBPYmplY3QucHJldmVudEV4dGVuc2lvbnMgd2lsbCB0aHJvdyBhIFR5cGVFcnJvci4KICAgICAgICAgICAgZml4OiBmdW5jdGlvbiAoKSB7fSwKCiAgICAgICAgICAgIC8vIEdldCBhbGwgZW51bWVyYWJsZSBwcm9wZXJ0aWVzCiAgICAgICAgICAgIC8vIFhYWDogUmVtb3ZlIHRoaXMgbWV0aG9kIHdoZW4gdGhpcyBidWcgaXMgZml4ZWQ6CiAgICAgICAgICAgIC8vIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTY2NTE5OAogICAgICAgICAgICBlbnVtZXJhdGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciByID0gW107CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IHRoaXMubGlzdC5sZW5ndGg7IGkgPCBuOyBpKyspIHB1c2gociwgU3RyaW5nKGkpKTsKICAgICAgICAgICAgICAgIGZvciAodmFyIG5hbWUgaW4gdGhpcy5sb2NhbHByb3BzKSBwdXNoKHIsIG5hbWUpOwogICAgICAgICAgICAgICAgZm9yICh2YXIgbmFtZSBpbiBpZGwuTm9kZUxpc3QucHJvdG90eXBlKSBwdXNoKHIsIG5hbWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIHI7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9IVE1MQ29sbGVjdGlvblByb3h5LmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvSFRNTENvbGxlY3Rpb25Qcm94eS5qcyIKICAgICAgICAvLyBBIGZhY3RvcnkgZnVuY3Rpb24gZm9yIEhUTUxDb2xsZWN0aW9uIHByb3h5IG9iamVjdHMuCiAgICAgICAgLy8gRXhwZWN0cyBhbiBvYmplY3Qgd2l0aCBhIGxlbmd0aCBwcm9wZXJ0eSBhbmQgaXRlbSgpIGFuZCBuYW1lZEl0ZW0oKSBtZXRob2RzLgogICAgICAgIC8vIFRoYXQgb2JqZWN0IG11c3QgYWxzbyBoYXZlIGEgbmFtZWRJdGVtcyBwcm9wZXJ0eSB0aGF0IHJldHVybnMgYW4gb2JqZWN0CiAgICAgICAgLy8gdGhhdCBtYXBzIGVsZW1lbnQgbmFtZXMgdG8gc29tZSB2YWx1ZS4KICAgICAgICAvLwogICAgICAgIC8vIFhYWDogYnVnIEkgY2FuJ3QgZGVmaW5lIGFuIGV4cGFuZG8gcHJvcGVydHkgaWYgdGhlcmUgaXMgYSBuYW1lZCBwcm9wZXJ0eQogICAgICAgIC8vIHdpdGggdGhlIHNhbWUgbmFtZS4gSSB0aGluayBpdCBpcyBhIGJ1ZyBpbiB0aGUgUHJveHkgaXRzZWxmLiAgTG9va3MgbGlrZQogICAgICAgIC8vIGRlZmluZSBwcm9wZXJ0eSBpcyBub3QgZXZlbiBiZWluZyBjYWxsZWQuCiAgICAgICAgLy8KICAgICAgICBmdW5jdGlvbiBIVE1MQ29sbGVjdGlvblByb3h5KGNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgdmFyIGhhbmRsZXIgPSBPLmNyZWF0ZShIVE1MQ29sbGVjdGlvblByb3h5LmhhbmRsZXIpOwogICAgICAgICAgICBoYW5kbGVyLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uOwogICAgICAgICAgICBoYW5kbGVyLmxvY2FscHJvcHMgPSBPLmNyZWF0ZShudWxsKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm94eShpZGwuSFRNTENvbGxlY3Rpb24ucHJvdG90eXBlLCBoYW5kbGVyKTsKICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgaXMgdGhlIHByb3RvdHlwZSBvYmplY3QgZm9yIHRoZSBwcm94eSBoYW5kbGVyIG9iamVjdAogICAgICAgIEhUTUxDb2xsZWN0aW9uUHJveHkuaGFuZGxlciA9IHsKICAgICAgICAgICAgaXNBcnJheUluZGV4OiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZyh0b1VMb25nKG5hbWUpKSA9PT0gbmFtZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlICJuYW1lZCBwcm9wZXJ0eSB2aXNpYmlsaXR5IGFsZ29yaXRobSIgZnJvbSBXZWJJREwKICAgICAgICAgICAgaXNWaXNpYmxlOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICAgICAgLy8gMSkgSWYgUCBpcyBub3QgYSBzdXBwb3J0ZWQgcHJvcGVydHkgbmFtZSBvZiBPLCB0aGVuIHJldHVybiBmYWxzZS4KICAgICAgICAgICAgICAgIGlmICghKG5hbWUgaW4gdGhpcy5jb2xsZWN0aW9uLm5hbWVkSXRlbXMpKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAgICAgLy8gMikgSWYgTyBpbXBsZW1lbnRzIGFuIGludGVyZmFjZSB0aGF0IGhhcyB0aGUKICAgICAgICAgICAgICAgIC8vIFtPdmVycmlkZUJ1aWx0aW5zXSBleHRlbmRlZCBhdHRyaWJ1dGUsIHRoZW4gcmV0dXJuIHRydWUuCiAgICAgICAgICAgICAgICAvLyBIVE1MQ29sbGVjdGlvbiBkb2VzIG5vdCBPdmVycmlkZUJ1aWx0aW5zLCBzbyBza2lwIHRoaXMgc3RlcAoKICAgICAgICAgICAgICAgIC8vIDMpIElmIE8gaGFzIGFuIG93biBwcm9wZXJ0eSBuYW1lZCBQLCB0aGVuIHJldHVybiBmYWxzZS4KICAgICAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eSh0aGlzLmxvY2FscHJvcHMsIG5hbWUpKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAgICAgLy8gNCkgTGV0IHByb3RvdHlwZSBiZSB0aGUgdmFsdWUgb2YgdGhlIGludGVybmFsIFtbUHJvdG90eXBlXV0KICAgICAgICAgICAgICAgIC8vIHByb3BlcnR5IG9mIE8uCiAgICAgICAgICAgICAgICAvLyA1KSBJZiBwcm90b3R5cGUgaXMgbnVsbCwgdGhlbiByZXR1cm4gdHJ1ZS4KICAgICAgICAgICAgICAgIC8vIDYpIElmIHRoZSByZXN1bHQgb2YgY2FsbGluZyB0aGUgW1tIYXNQcm9wZXJ0eV1dIGludGVybmFsCiAgICAgICAgICAgICAgICAvLyBtZXRob2Qgb24gcHJvdG90eXBlIHdpdGggcHJvcGVydHkgbmFtZSBQIGlzIHRydWUsIHRoZW4KICAgICAgICAgICAgICAgIC8vIHJldHVybiBmYWxzZS4KICAgICAgICAgICAgICAgIGlmIChuYW1lIGluIGlkbC5IVE1MQ29sbGVjdGlvbi5wcm90b3R5cGUpIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICAvLyA3KSBSZXR1cm4gdHJ1ZS4KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobmFtZSkgewogICAgICAgICAgICAgICAgdmFyIGl0ZW07CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0FycmF5SW5kZXgobmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gdG9VTG9uZyhuYW1lKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaWR4IDwgdGhpcy5jb2xsZWN0aW9uLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHdyYXAodGhpcy5jb2xsZWN0aW9uLml0ZW0oaWR4KSwgaWRsLkVsZW1lbnQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1Zpc2libGUobmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogd3JhcCh0aGlzLmNvbGxlY3Rpb24ubmFtZWRJdGVtKG5hbWUpLCBpZGwuRWxlbWVudCksCiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gTy5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGhpcy5sb2NhbHByb3BzLCBuYW1lKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGdldFByb3BlcnR5RGVzY3JpcHRvcjogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgICAgIHZhciBkZXNjID0gdGhpcy5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobmFtZSkgfHwgTy5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoaWRsLkhUTUxDb2xsZWN0aW9uLnByb3RvdHlwZSwgbmFtZSkgfHwgTy5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoT2JqZWN0LnByb3RvdHlwZSwgbmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoZGVzYykgZGVzYy5jb25maWd1cmFibGUgPSB0cnVlOyAvLyBQcm94aWVzIHJlcXVpcmUgdGhpcwogICAgICAgICAgICAgICAgcmV0dXJuIGRlc2M7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXRPd25Qcm9wZXJ0eU5hbWVzOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKCkgewogICAgICAgICAgICAgICAgdmFyIG5hbWVzID0gW107CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IHRoaXMuY29sbGVjdGlvbi5sZW5ndGg7IGkgPCBuOyBpKyspIHB1c2gobmFtZXMsIFN0cmluZyhpKSk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBuIGluIHRoaXMuY29sbGVjdGlvbi5uYW1lZEl0ZW1zKSBwdXNoKG5hbWVzLCBuKTsKICAgICAgICAgICAgICAgIHJldHVybiBjb25jYXQociwgTy5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMubG9jYWxwcm9wcykpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZGVmaW5lUHJvcGVydHk6IGZ1bmN0aW9uIChuYW1lLCBkZXNjKSB7CiAgICAgICAgICAgICAgICAvLyBYWFgKICAgICAgICAgICAgICAgIC8vIEZvciBub3csIHdlICJSZWplY3QiIGJ5IHRocm93aW5nIFR5cGVFcnJvci4gIFByb3hpZXMgbWF5IGNoYW5nZQogICAgICAgICAgICAgICAgLy8gc28gd2Ugb25seSBoYXZlIHRvIHJldHVybiBmYWxzZS4KICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQXJyYXlJbmRleChuYW1lKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiY2FuJ3Qgc2V0IG9yIGNyZWF0ZSBpbmRleGVkIHByb3BlcnR5ICciICsgbmFtZSArICInIik7CgogICAgICAgICAgICAgICAgLy8gRG9uJ3QgYWxsb3cgbmFtZWQgcHJvcGVydGllcyB0byBvdmVycmlkZGVuIGJ5IGV4cGFuZG8gcHJvcGVydGllcywKICAgICAgICAgICAgICAgIC8vIGV2ZW4gd2l0aCBhbiBleHBsaWNpdCBPYmplY3QuZGVmaW5lUHJvcGVydHkoKSBjYWxsLgogICAgICAgICAgICAgICAgLy8gWFhYCiAgICAgICAgICAgICAgICAvLyBUaGUgcmVzb2x1dGlvbiBvZiB0aGlzIGlzc3VlIGlzIHN0aWxsIHBlbmRpbmcgb24gdGhlIG1haWxpbmcgbGlzdC4KICAgICAgICAgICAgICAgIGlmIChuYW1lIGluIHRoaXMuY29sbGVjdGlvbi5uYW1lZEl0ZW1zKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJjYW4ndCBvdmVycmlkZSBuYW1lZCBwcm9wZXJ0eSAnIiArIG5hbWUgKyAiJyIpOwoKICAgICAgICAgICAgICAgIGRlc2MuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIE8uZGVmaW5lUHJvcGVydHkodGhpcy5sb2NhbHByb3BzLCBuYW1lLCBkZXNjKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGRlbGV0ZTogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgICAgIC8vIENhbid0IGRlbGV0ZSBhcnJheSBlbGVtZW50cywgYnV0IGlmIHRoZXkgZG9uJ3QgZXhpc3QsIGRvbid0IGNvbXBsYWluCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0FycmF5SW5kZXgobmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gdG9VTG9uZyhuYW1lKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWR4ID49IHRoaXMuY29sbGVjdGlvbi5sZW5ndGg7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQ2FuJ3QgZGVsZXRlIG5hbWVkIHByb3BlcnRpZXMKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzVmlzaWJsZShuYW1lKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBGaW5hbGx5LCB0cnkgZGVsZXRpbmcgYW4gZXhwYW5kbwogICAgICAgICAgICAgICAgcmV0dXJuIGRlbGV0ZSB0aGlzLmxvY2FscHJvcHNbbmFtZV07CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBmaXg6IGZ1bmN0aW9uICgpIHt9LAoKICAgICAgICAgICAgLy8gR2V0IGFsbCBlbnVtZXJhYmxlIHByb3BlcnRpZXMKICAgICAgICAgICAgLy8gWFhYOiBSZW1vdmUgdGhpcyBtZXRob2Qgd2hlbiB0aGlzIGJ1ZyBpcyBmaXhlZDoKICAgICAgICAgICAgLy8gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NjY1MTk4CiAgICAgICAgICAgIGVudW1lcmF0ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIG5hbWVzID0gW107CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IHRoaXMuY29sbGVjdGlvbi5sZW5ndGg7IGkgPCBuOyBpKyspIHB1c2gobmFtZXMsIFN0cmluZyhpKSk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBuIGluIHRoaXMuY29sbGVjdGlvbi5uYW1lZEl0ZW1zKSBwdXNoKG5hbWVzLCBuKTsKICAgICAgICAgICAgICAgIGZvciAodmFyIG5hbWUgaW4gdGhpcy5sb2NhbHByb3BzKSBwdXNoKG5hbWVzLCBuYW1lKTsKICAgICAgICAgICAgICAgIGZvciAodmFyIG5hbWUgaW4gaWRsLkhUTUxDb2xsZWN0aW9uLnByb3RvdHlwZSkgcHVzaChuYW1lcywgbmFtZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmFtZXM7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9ET01FeGNlcHRpb24uanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy9ET01FeGNlcHRpb24uanMiCiAgICAgICAgLy8KICAgICAgICAvLyBUaGlzIERPTUV4Y2VwdGlvbiBpbXBsZW1lbnRhdGlvbiBpcyBub3QgV2ViSURMIGNvbXBhdGlibGUuCiAgICAgICAgLy8gV2ViSURMIGV4Y2VwdGlvbnMgYXJlIGluIGZsdXggcmlnaHQgbm93LCBzbyBJJ20ganVzdCBkb2luZyBzb21ldGhpbmcKICAgICAgICAvLyBzaW1wbGUgYW5kIGFwcHJveGltYXRlbHkgd2ViIGNvbXBhdGlibGUgZm9yIG5vdy4KICAgICAgICAvLwogICAgICAgIHZhciBJTkRFWF9TSVpFX0VSUiA9IDE7CiAgICAgICAgdmFyIEhJRVJBUkNIWV9SRVFVRVNUX0VSUiA9IDM7CiAgICAgICAgdmFyIFdST05HX0RPQ1VNRU5UX0VSUiA9IDQ7CiAgICAgICAgdmFyIElOVkFMSURfQ0hBUkFDVEVSX0VSUiA9IDU7CiAgICAgICAgdmFyIE5PX01PRElGSUNBVElPTl9BTExPV0VEX0VSUiA9IDc7CiAgICAgICAgdmFyIE5PVF9GT1VORF9FUlIgPSA4OwogICAgICAgIHZhciBOT1RfU1VQUE9SVEVEX0VSUiA9IDk7CiAgICAgICAgdmFyIElOVkFMSURfU1RBVEVfRVJSID0gMTE7CiAgICAgICAgdmFyIFNZTlRBWF9FUlIgPSAxMjsKICAgICAgICB2YXIgSU5WQUxJRF9NT0RJRklDQVRJT05fRVJSID0gMTM7CiAgICAgICAgdmFyIE5BTUVTUEFDRV9FUlIgPSAxNDsKICAgICAgICB2YXIgSU5WQUxJRF9BQ0NFU1NfRVJSID0gMTU7CiAgICAgICAgdmFyIFRZUEVfTUlTTUFUQ0hfRVJSID0gMTc7CiAgICAgICAgdmFyIFNFQ1VSSVRZX0VSUiA9IDE4OwogICAgICAgIHZhciBORVRXT1JLX0VSUiA9IDE5OwogICAgICAgIHZhciBBQk9SVF9FUlIgPSAyMDsKICAgICAgICB2YXIgVVJMX01JU01BVENIX0VSUiA9IDIxOwogICAgICAgIHZhciBRVU9UQV9FWENFRURFRF9FUlIgPSAyMjsKICAgICAgICB2YXIgVElNRU9VVF9FUlIgPSAyMzsKICAgICAgICB2YXIgSU5WQUxJRF9OT0RFX1RZUEVfRVJSID0gMjQ7CiAgICAgICAgdmFyIERBVEFfQ0xPTkVfRVJSID0gMjU7CgogICAgICAgIGdsb2JhbC5ET01FeGNlcHRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIENvZGUgdG8gbmFtZQogICAgICAgICAgICB2YXIgbmFtZXMgPSBbbnVsbCwgLy8gTm8gZXJyb3Igd2l0aCBjb2RlIDAKICAgICAgICAgICAgIklOREVYX1NJWkVfRVJSIiwgbnVsbCwgLy8gaGlzdG9yaWNhbAogICAgICAgICAgICAiSElFUkFSQ0hZX1JFUVVFU1RfRVJSIiwgIldST05HX0RPQ1VNRU5UX0VSUiIsICJJTlZBTElEX0NIQVJBQ1RFUl9FUlIiLCBudWxsLCAvLyBoaXN0b3JpY2FsCiAgICAgICAgICAgICJOT19NT0RJRklDQVRJT05fQUxMT1dFRF9FUlIiLCAiTk9UX0ZPVU5EX0VSUiIsICJOT1RfU1VQUE9SVEVEX0VSUiIsIG51bGwsIC8vIGhpc3RvcmljYWwKICAgICAgICAgICAgIklOVkFMSURfU1RBVEVfRVJSIiwgIlNZTlRBWF9FUlIiLCAiSU5WQUxJRF9NT0RJRklDQVRJT05fRVJSIiwgIk5BTUVTUEFDRV9FUlIiLCAiSU5WQUxJRF9BQ0NFU1NfRVJSIiwgbnVsbCwgLy8gaGlzdG9yaWNhbAogICAgICAgICAgICAiVFlQRV9NSVNNQVRDSF9FUlIiLCAiU0VDVVJJVFlfRVJSIiwgIk5FVFdPUktfRVJSIiwgIkFCT1JUX0VSUiIsICJVUkxfTUlTTUFUQ0hfRVJSIiwgIlFVT1RBX0VYQ0VFREVEX0VSUiIsICJUSU1FT1VUX0VSUiIsICJJTlZBTElEX05PREVfVFlQRV9FUlIiLCAiREFUQV9DTE9ORV9FUlIiXTsKCiAgICAgICAgICAgIC8vIENvZGUgdG8gbWVzc2FnZQogICAgICAgICAgICAvLyBUaGVzZSBzdHJpbmdzIGFyZSBmcm9tIHRoZSAxMyBNYXkgMjAxMSBFZGl0b3IncyBEcmFmdCBvZiBET00gQ29yZS4KICAgICAgICAgICAgLy8gaHR0cDovL2R2Y3MudzMub3JnL2hnL2RvbWNvcmUvcmF3LWZpbGUvdGlwL092ZXJ2aWV3Lmh0bWwKICAgICAgICAgICAgLy8gQ29weXJpZ2h0IMKpIDIwMTEgVzNDwq4gKE1JVCwgRVJDSU0sIEtlaW8pLCBBbGwgUmlnaHRzIFJlc2VydmVkLgogICAgICAgICAgICAvLyBVc2VkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgVzNDIERvY3VtZW50IExpY2Vuc2U6CiAgICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL0NvbnNvcnRpdW0vTGVnYWwvMjAwMi9jb3B5cmlnaHQtZG9jdW1lbnRzLTIwMDIxMjMxCiAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9IFtudWxsLCAvLyBObyBlcnJvciB3aXRoIGNvZGUgMAogICAgICAgICAgICAiSU5ERVhfU0laRV9FUlIgKDEpOiB0aGUgaW5kZXggaXMgbm90IGluIHRoZSBhbGxvd2VkIHJhbmdlIiwgbnVsbCwgIkhJRVJBUkNIWV9SRVFVRVNUX0VSUiAoMyk6IHRoZSBvcGVyYXRpb24gd291bGQgeWllbGQgYW4gaW5jb3JyZWN0IG5vZGVzIG1vZGVsIiwgIldST05HX0RPQ1VNRU5UX0VSUiAoNCk6IHRoZSBvYmplY3QgaXMgaW4gdGhlIHdyb25nIERvY3VtZW50LCBhIGNhbGwgdG8gaW1wb3J0Tm9kZSBpcyByZXF1aXJlZCIsICJJTlZBTElEX0NIQVJBQ1RFUl9FUlIgKDUpOiB0aGUgc3RyaW5nIGNvbnRhaW5zIGludmFsaWQgY2hhcmFjdGVycyIsIG51bGwsICJOT19NT0RJRklDQVRJT05fQUxMT1dFRF9FUlIgKDcpOiB0aGUgb2JqZWN0IGNhbiBub3QgYmUgbW9kaWZpZWQiLCAiTk9UX0ZPVU5EX0VSUiAoOCk6IHRoZSBvYmplY3QgY2FuIG5vdCBiZSBmb3VuZCBoZXJlIiwgIk5PVF9TVVBQT1JURURfRVJSICg5KTogdGhpcyBvcGVyYXRpb24gaXMgbm90IHN1cHBvcnRlZCIsIG51bGwsICJJTlZBTElEX1NUQVRFX0VSUiAoMTEpOiB0aGUgb2JqZWN0IGlzIGluIGFuIGludmFsaWQgc3RhdGUiLCAiU1lOVEFYX0VSUiAoMTIpOiB0aGUgc3RyaW5nIGRpZCBub3QgbWF0Y2ggdGhlIGV4cGVjdGVkIHBhdHRlcm4iLCAiSU5WQUxJRF9NT0RJRklDQVRJT05fRVJSICgxMyk6IHRoZSBvYmplY3QgY2FuIG5vdCBiZSBtb2RpZmllZCBpbiB0aGlzIHdheSIsICJOQU1FU1BBQ0VfRVJSICgxNCk6IHRoZSBvcGVyYXRpb24gaXMgbm90IGFsbG93ZWQgYnkgTmFtZXNwYWNlcyBpbiBYTUwiLCAiSU5WQUxJRF9BQ0NFU1NfRVJSICgxNSk6IHRoZSBvYmplY3QgZG9lcyBub3Qgc3VwcG9ydCB0aGUgb3BlcmF0aW9uIG9yIGFyZ3VtZW50IiwgbnVsbCwgIlRZUEVfTUlTTUFUQ0hfRVJSICgxNyk6IHRoZSB0eXBlIG9mIHRoZSBvYmplY3QgZG9lcyBub3QgbWF0Y2ggdGhlIGV4cGVjdGVkIHR5cGUiLCAiU0VDVVJJVFlfRVJSICgxOCk6IHRoZSBvcGVyYXRpb24gaXMgaW5zZWN1cmUiLCAiTkVUV09SS19FUlIgKDE5KTogYSBuZXR3b3JrIGVycm9yIG9jY3VycmVkIiwgIkFCT1JUX0VSUiAoMjApOiB0aGUgdXNlciBhYm9ydGVkIGFuIG9wZXJhdGlvbiIsICJVUkxfTUlTTUFUQ0hfRVJSICgyMSk6IHRoZSBnaXZlbiBVUkwgZG9lcyBub3QgbWF0Y2ggYW5vdGhlciBVUkwiLCAiUVVPVEFfRVhDRUVERURfRVJSICgyMik6IHRoZSBxdW90YSBoYXMgYmVlbiBleGNlZWRlZCIsICJUSU1FT1VUX0VSUiAoMjMpOiBhIHRpbWVvdXQgb2NjdXJyZWQiLCAiSU5WQUxJRF9OT0RFX1RZUEVfRVJSICgyNCk6IHRoZSBzdXBwbGllZCBub2RlIGlzIGludmFsaWQgb3IgaGFzIGFuIGludmFsaWQgYW5jZXN0b3IgZm9yIHRoaXMgb3BlcmF0aW9uIiwgIkRBVEFfQ0xPTkVfRVJSICgyNSk6IHRoZSBvYmplY3QgY2FuIG5vdCBiZSBjbG9uZWQuIl07CgogICAgICAgICAgICAvLyBOYW1lIHRvIGNvZGUKICAgICAgICAgICAgdmFyIGNvbnN0YW50cyA9IHsKICAgICAgICAgICAgICAgIElOREVYX1NJWkVfRVJSOiBJTkRFWF9TSVpFX0VSUiwKICAgICAgICAgICAgICAgIERPTVNUUklOR19TSVpFX0VSUjogMiwgLy8gaGlzdG9yaWNhbAogICAgICAgICAgICAgICAgSElFUkFSQ0hZX1JFUVVFU1RfRVJSOiBISUVSQVJDSFlfUkVRVUVTVF9FUlIsCiAgICAgICAgICAgICAgICBXUk9OR19ET0NVTUVOVF9FUlI6IFdST05HX0RPQ1VNRU5UX0VSUiwKICAgICAgICAgICAgICAgIElOVkFMSURfQ0hBUkFDVEVSX0VSUjogSU5WQUxJRF9DSEFSQUNURVJfRVJSLAogICAgICAgICAgICAgICAgTk9fREFUQV9BTExPV0VEX0VSUjogNiwgLy8gaGlzdG9yaWNhbAogICAgICAgICAgICAgICAgTk9fTU9ESUZJQ0FUSU9OX0FMTE9XRURfRVJSOiBOT19NT0RJRklDQVRJT05fQUxMT1dFRF9FUlIsCiAgICAgICAgICAgICAgICBOT1RfRk9VTkRfRVJSOiBOT1RfRk9VTkRfRVJSLAogICAgICAgICAgICAgICAgTk9UX1NVUFBPUlRFRF9FUlI6IE5PVF9TVVBQT1JURURfRVJSLAogICAgICAgICAgICAgICAgSU5VU0VfQVRUUklCVVRFX0VSUjogMTAsIC8vIGhpc3RvcmljYWwKICAgICAgICAgICAgICAgIElOVkFMSURfU1RBVEVfRVJSOiBJTlZBTElEX1NUQVRFX0VSUiwKICAgICAgICAgICAgICAgIFNZTlRBWF9FUlI6IFNZTlRBWF9FUlIsCiAgICAgICAgICAgICAgICBJTlZBTElEX01PRElGSUNBVElPTl9FUlI6IElOVkFMSURfTU9ESUZJQ0FUSU9OX0VSUiwKICAgICAgICAgICAgICAgIE5BTUVTUEFDRV9FUlI6IE5BTUVTUEFDRV9FUlIsCiAgICAgICAgICAgICAgICBJTlZBTElEX0FDQ0VTU19FUlI6IElOVkFMSURfQUNDRVNTX0VSUiwKICAgICAgICAgICAgICAgIFZBTElEQVRJT05fRVJSOiAxNiwgLy8gaGlzdG9yaWNhbAogICAgICAgICAgICAgICAgVFlQRV9NSVNNQVRDSF9FUlI6IFRZUEVfTUlTTUFUQ0hfRVJSLAogICAgICAgICAgICAgICAgU0VDVVJJVFlfRVJSOiBTRUNVUklUWV9FUlIsCiAgICAgICAgICAgICAgICBORVRXT1JLX0VSUjogTkVUV09SS19FUlIsCiAgICAgICAgICAgICAgICBBQk9SVF9FUlI6IEFCT1JUX0VSUiwKICAgICAgICAgICAgICAgIFVSTF9NSVNNQVRDSF9FUlI6IFVSTF9NSVNNQVRDSF9FUlIsCiAgICAgICAgICAgICAgICBRVU9UQV9FWENFRURFRF9FUlI6IFFVT1RBX0VYQ0VFREVEX0VSUiwKICAgICAgICAgICAgICAgIFRJTUVPVVRfRVJSOiBUSU1FT1VUX0VSUiwKICAgICAgICAgICAgICAgIElOVkFMSURfTk9ERV9UWVBFX0VSUjogSU5WQUxJRF9OT0RFX1RZUEVfRVJSLAogICAgICAgICAgICAgICAgREFUQV9DTE9ORV9FUlI6IERBVEFfQ0xPTkVfRVJSCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBmdW5jdGlvbiBET01FeGNlcHRpb24oY29kZSkgewogICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBrdWRnZSBpcyBzbyB3ZSBnZXQgbGluZU51bWJlciwgZmlsZU5hbWUgYW5kIHN0YWNrIHByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBFcnJvcihtZXNzYWdlc1tjb2RlXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUuX19wcm90b19fID0gRE9NRXhjZXB0aW9uLnByb3RvdHlwZTsKICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgdmFyIGUgPSBPLmNyZWF0ZShET01FeGNlcHRpb24ucHJvdG90eXBlKTsKICAgICAgICAgICAgICAgIGUuY29kZSA9IGNvZGU7CiAgICAgICAgICAgICAgICBlLm1lc3NhZ2UgPSBtZXNzYWdlc1tjb2RlXTsKICAgICAgICAgICAgICAgIGUubmFtZSA9IG5hbWVzW2NvZGVdOwoKICAgICAgICAgICAgICAgIC8vIEdldCBzdGFjaywgbGluZU51bWJlciBhbmQgZmlsZU5hbWUgcHJvcGVydGllcyBsaWtlIGEgcmVhbAogICAgICAgICAgICAgICAgLy8gRXJyb3Igb2JqZWN0IGhhcy4KICAgICAgICAgICAgICAgIHZhciB4ID0gRXJyb3IoKTsKICAgICAgICAgICAgICAgIHZhciBmcmFtZXMgPSBzcGxpdCh4LnN0YWNrLCAiXG4iKTsKICAgICAgICAgICAgICAgIEEuc2hpZnQoZnJhbWVzKTsKICAgICAgICAgICAgICAgIGUuc3RhY2sgPSBqb2luKGZyYW1lcywgIlxuIik7CiAgICAgICAgICAgICAgICB2YXIgcGFydHMgPSBtYXRjaChmcmFtZXNbMF0sIC9bXkBdKltAKF0oW146XSopOihcZCopLyk7CgogICAgICAgICAgICAgICAgaWYgKHBhcnRzKSB7CiAgICAgICAgICAgICAgICAgICAgZS5maWxlTmFtZSA9IHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICAgIGUubGluZU51bWJlciA9IHBhcnRzWzJdOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBlLmZpbGVOYW1lID0gIiI7CiAgICAgICAgICAgICAgICAgICAgZS5saW5lTnVtYmVyID0gLTE7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIERPTUV4Y2VwdGlvbi5wcm90b3R5cGUgPSBPLmNyZWF0ZShFcnJvci5wcm90b3R5cGUpOwoKICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgY29uc3RhbnRzIG9uIERPTUV4Y2VwdGlvbiBhbmQgRE9NRXhjZXB0aW9uLnByb3RvdHlwZQogICAgICAgICAgICBmb3IgKHZhciBjIGluIGNvbnN0YW50cykgewogICAgICAgICAgICAgICAgdmFyIHYgPSBjb25zdGFudHNbY107CiAgICAgICAgICAgICAgICBkZWZpbmVDb25zdGFudFByb3AoRE9NRXhjZXB0aW9uLCBjLCB2KTsKICAgICAgICAgICAgICAgIGRlZmluZUNvbnN0YW50UHJvcChET01FeGNlcHRpb24ucHJvdG90eXBlLCBjLCB2KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIERPTUV4Y2VwdGlvbjsKICAgICAgICB9KCk7CgogICAgICAgIC8vCiAgICAgICAgLy8gU2hvcnRjdXQgZnVuY3Rpb25zIGZvciB0aHJvd2luZyBlcnJvcnMgb2YgdmFyaW91cyB0eXBlcy4KICAgICAgICAvLwogICAgICAgIGZ1bmN0aW9uIEluZGV4U2l6ZUVycm9yKCkgewogICAgICAgICAgICB0aHJvdyBET01FeGNlcHRpb24oSU5ERVhfU0laRV9FUlIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBIaWVyYXJjaHlSZXF1ZXN0RXJyb3IoKSB7CiAgICAgICAgICAgIHRocm93IERPTUV4Y2VwdGlvbihISUVSQVJDSFlfUkVRVUVTVF9FUlIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBXcm9uZ0RvY3VtZW50RXJyb3IoKSB7CiAgICAgICAgICAgIHRocm93IERPTUV4Y2VwdGlvbihXUk9OR19ET0NVTUVOVF9FUlIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBJbnZhbGlkQ2hhcmFjdGVyRXJyb3IoKSB7CiAgICAgICAgICAgIHRocm93IERPTUV4Y2VwdGlvbihJTlZBTElEX0NIQVJBQ1RFUl9FUlIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBOb01vZGlmaWNhdGlvbkFsbG93ZWRFcnJvcigpIHsKICAgICAgICAgICAgdGhyb3cgRE9NRXhjZXB0aW9uKE5PX01PRElGSUNBVElPTl9BTExPV0VEX0VSUik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE5vdEZvdW5kRXJyb3IoKSB7CiAgICAgICAgICAgIHRocm93IERPTUV4Y2VwdGlvbihOT1RfRk9VTkRfRVJSKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gTm90U3VwcG9ydGVkRXJyb3IoKSB7CiAgICAgICAgICAgIHRocm93IERPTUV4Y2VwdGlvbihOT1RfU1VQUE9SVEVEX0VSUik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEludmFsaWRTdGF0ZUVycm9yKCkgewogICAgICAgICAgICB0aHJvdyBET01FeGNlcHRpb24oSU5WQUxJRF9TVEFURV9FUlIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBTeW50YXhFcnJvcigpIHsKICAgICAgICAgICAgdGhyb3cgRE9NRXhjZXB0aW9uKFNZTlRBWF9FUlIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBJbnZhbGlkTW9kaWZpY2F0aW9uRXJyb3IoKSB7CiAgICAgICAgICAgIHRocm93IERPTUV4Y2VwdGlvbihJTlZBTElEX01PRElGSUNBVElPTl9FUlIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBOYW1lc3BhY2VFcnJvcigpIHsKICAgICAgICAgICAgdGhyb3cgRE9NRXhjZXB0aW9uKE5BTUVTUEFDRV9FUlIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBJbnZhbGlkQWNjZXNzRXJyb3IoKSB7CiAgICAgICAgICAgIHRocm93IERPTUV4Y2VwdGlvbihJTlZBTElEX0FDQ0VTU19FUlIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBUeXBlTWlzbWF0Y2hFcnJvcigpIHsKICAgICAgICAgICAgdGhyb3cgRE9NRXhjZXB0aW9uKFRZUEVfTUlTTUFUQ0hfRVJSKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gU2VjdXJpdHlFcnJvcigpIHsKICAgICAgICAgICAgdGhyb3cgRE9NRXhjZXB0aW9uKFNFQ1VSSVRZX0VSUik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE5ldHdvcmtFcnJvcigpIHsKICAgICAgICAgICAgdGhyb3cgRE9NRXhjZXB0aW9uKE5FVFdPUktfRVJSKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQWJvcnRFcnJvcigpIHsKICAgICAgICAgICAgdGhyb3cgRE9NRXhjZXB0aW9uKEFCT1JUX0VSUik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFVybE1pc21hdGNoRXJyb3IoKSB7CiAgICAgICAgICAgIHRocm93IERPTUV4Y2VwdGlvbihVUkxfTUlTTUFUQ0hfRVJSKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gUXVvdGFFeGNlZWRlZEVycm9yKCkgewogICAgICAgICAgICB0aHJvdyBET01FeGNlcHRpb24oUVVPVEFfRVhDRUVERURfRVJSKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVGltZW91dEVycm9yKCkgewogICAgICAgICAgICB0aHJvdyBET01FeGNlcHRpb24oVElNRU9VVF9FUlIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBJbnZhbGlkTm9kZVR5cGVFcnJvcigpIHsKICAgICAgICAgICAgdGhyb3cgRE9NRXhjZXB0aW9uKElOVkFMSURfTk9ERV9UWVBFX0VSUik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIERhdGFDbG9uZUVycm9yKCkgewogICAgICAgICAgICB0aHJvdyBET01FeGNlcHRpb24oREFUQV9DTE9ORV9FUlIpOwogICAgICAgIH0KCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICAqICBzcmMvaW1wbC9FdmVudFRhcmdldC5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL2ltcGwvRXZlbnRUYXJnZXQuanMiCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJFdmVudFRhcmdldCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gRXZlbnRUYXJnZXQoKSB7fQoKICAgICAgICAgICAgRXZlbnRUYXJnZXQucHJvdG90eXBlID0gewogICAgICAgICAgICAgICAgX2lkbE5hbWU6ICJFdmVudFRhcmdldCIsCgogICAgICAgICAgICAgICAgLy8gWFhYCiAgICAgICAgICAgICAgICAvLyBTZWUgV2ViSURMIMKnNC44IGZvciBkZXRhaWxzIG9uIG9iamVjdCBldmVudCBoYW5kbGVycwogICAgICAgICAgICAgICAgLy8gYW5kIGhvdyB0aGV5IHNob3VsZCBiZWhhdmUuICBXZSBhY3R1YWxseSBoYXZlIHRvIGFjY2VwdAogICAgICAgICAgICAgICAgLy8gYW55IG9iamVjdCB0byBhZGRFdmVudExpc3RlbmVyLi4uIENhbid0IHR5cGUgY2hlY2sgaXQuCiAgICAgICAgICAgICAgICAvLyBvbiByZWdpc3RyYXRpb24uCgogICAgICAgICAgICAgICAgLy8gWFhYOgogICAgICAgICAgICAgICAgLy8gQ2FwdHVyaW5nIGV2ZW50IGxpc3RlbmVycyBhcmUgc29ydCBvZiByYXJlLiAgSSB0aGluayBJIGNhbiBvcHRpbWl6ZQogICAgICAgICAgICAgICAgLy8gdGhlbSBzbyB0aGF0IGRpc3BhdGNoRXZlbnQgY2FuIHNraXAgdGhlIGNhcHR1cmluZyBwaGFzZSAob3IgbXVjaCBvZgogICAgICAgICAgICAgICAgLy8gaXQpLiAgRWFjaCB0aW1lIGEgY2FwdHVyaW5nIGxpc3RlbmVyIGlzIGFkZGVkLCBpbmNyZW1lbnQgYSBmbGFnIG9uCiAgICAgICAgICAgICAgICAvLyB0aGUgdGFyZ2V0IG5vZGUgYW5kIGVhY2ggb2YgaXRzIGFuY2VzdG9ycy4gIERlY3JlbWVudCB3aGVuIHJlbW92ZWQuCiAgICAgICAgICAgICAgICAvLyBBbmQgdXBkYXRlIHRoZSBjb3VudGVyIHdoZW4gbm9kZXMgYXJlIGFkZGVkIGFuZCByZW1vdmVkIGZyb20gdGhlCiAgICAgICAgICAgICAgICAvLyB0cmVlIGFzIHdlbGwuICBUaGVuLCBpbiBkaXNwYXRjaCBldmVudCwgdGhlIGNhcHR1cmluZyBwaGFzZSBjYW4KICAgICAgICAgICAgICAgIC8vIGFib3J0IGlmIGl0IHNlZXMgYW55IG5vZGUgd2l0aCBhIHplcm8gY291bnQuCiAgICAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyOiBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyLCBjYXB0dXJlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFsaXN0ZW5lcikgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGlmIChjYXB0dXJlID09PSB1bmRlZmluZWQpIGNhcHR1cmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2xpc3RlbmVycykgdGhpcy5fbGlzdGVuZXJzID0ge307CiAgICAgICAgICAgICAgICAgICAgaWYgKCEodHlwZSBpbiB0aGlzLl9saXN0ZW5lcnMpKSB0aGlzLl9saXN0ZW5lcnNbdHlwZV0gPSB7fTsKICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdCA9IHRoaXMuX2xpc3RlbmVyc1t0eXBlXTsKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBsaXN0ZW5lciBoYXMgYWxyZWFkeSBiZWVuIHJlZ2lzdGVyZWQsIGp1c3QgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBsaXN0Lmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IGxpc3RbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsLmxpc3RlbmVyID09PSBsaXN0ZW5lciAmJiBsLmNhcHR1cmUgPT09IGNhcHR1cmUpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBhbiBvYmplY3QgdG8gdGhlIGxpc3Qgb2YgbGlzdGVuZXJzCiAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHsgbGlzdGVuZXI6IGxpc3RlbmVyLCBjYXB0dXJlOiBjYXB0dXJlIH07CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lciA9PT0gImZ1bmN0aW9uIikgb2JqLmYgPSBsaXN0ZW5lcjsKICAgICAgICAgICAgICAgICAgICBwdXNoKGxpc3QsIG9iaik7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIsIGNhcHR1cmUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY2FwdHVyZSA9PT0gdW5kZWZpbmVkKSBjYXB0dXJlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdCA9IHRoaXMuX2xpc3RlbmVyc1t0eXBlXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpbmQgdGhlIGxpc3RlbmVyIGluIHRoZSBsaXN0IGFuZCByZW1vdmUgaXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gbGlzdC5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IGxpc3RbaV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGwubGlzdGVuZXIgPT09IGxpc3RlbmVyICYmIGwuY2FwdHVyZSA9PT0gY2FwdHVyZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpY2UobGlzdCwgaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fbGlzdGVuZXJzW3R5cGVdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBwdWJsaWMgQVBJIGZvciBkaXNwYXRjaGluZyB1bnRydXN0ZWQgcHVibGljIGV2ZW50cy4KICAgICAgICAgICAgICAgIC8vIFNlZSBfZGlzcGF0Y2hFdmVudCBmb3IgdGhlIGltcGxlbWVudGF0aW9uCiAgICAgICAgICAgICAgICBkaXNwYXRjaEV2ZW50OiBmdW5jdGlvbiBkaXNwYXRjaEV2ZW50KGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRGlzcGF0Y2ggYW4gdW50cnVzdGVkIGV2ZW50CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc3BhdGNoRXZlbnQoZXZlbnQsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgcG9zdE1lc3NhZ2U6IGZ1bmN0aW9uIHBvc3RNZXNzYWdlKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29uc3RydWN0b3IgPSBpbXBsLkV2ZW50OwoKICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IG5ldyBjb25zdHJ1Y3RvcignbWVzc2FnZScpOwogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZGF0YSA9IGRhdGE7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5faWRsID0gbWVzc2FnZTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc3BhdGNoRXZlbnQobWVzc2FnZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gU2VlIERPTUNvcmUgwqc0LjQKICAgICAgICAgICAgICAgIC8vIFhYWDogSSdsbCBwcm9iYWJseSBuZWVkIGFub3RoZXIgdmVyc2lvbiBvZiB0aGlzIG1ldGhvZCBmb3IKICAgICAgICAgICAgICAgIC8vIGludGVybmFsIHVzZSwgb25lIHRoYXQgZG9lcyBub3Qgc2V0IGlzVHJ1c3RlZCB0byBmYWxzZS4KICAgICAgICAgICAgICAgIC8vIFhYWDogc2VlIERvY3VtZW50Ll9kaXNwYXRjaEV2ZW50OiBwZXJoYXBzIHRoYXQgYW5kIHRoaXMgY291bGQKICAgICAgICAgICAgICAgIC8vIGNhbGwgYSBjb21tb24gaW50ZXJuYWwgZnVuY3Rpb24gd2l0aCBkaWZmZXJlbnQgc2V0dGluZ3Mgb2YKICAgICAgICAgICAgICAgIC8vIGEgdHJ1c3RlZCBib29sZWFuIGFyZ3VtZW50CiAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gWFhYOgogICAgICAgICAgICAgICAgLy8gVGhlIHNwZWMgaGFzIGNoYW5nZWQgaW4gaG93IHRvIGRlYWwgd2l0aCBoYW5kbGVycyByZWdpc3RlcmVkCiAgICAgICAgICAgICAgICAvLyBvbiBpZGwgb3IgY29udGVudCBhdHRyaWJ1dGVzIHJhdGhlciB0aGFuIHdpdGggYWRkRXZlbnRMaXN0ZW5lci4KICAgICAgICAgICAgICAgIC8vIFVzZWQgdG8gc2F5IHRoYXQgdGhleSBhbHdheXMgcmFuIGZpcnN0LiAgVGhhdCdzIGhvdyB3ZWJraXQgZG9lcyBpdAogICAgICAgICAgICAgICAgLy8gU3BlYyBub3cgc2F5cyB0aGF0IHRoZXkgcnVuIGluIGEgcG9zaXRpb24gZGV0ZXJtaW5lZCBieQogICAgICAgICAgICAgICAgLy8gd2hlbiB0aGV5IHdlcmUgZmlyc3Qgc2V0LiAgRkYgZG9lcyBpdCB0aGF0IHdheS4gIFNlZToKICAgICAgICAgICAgICAgIC8vIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvbXVsdGlwYWdlL3dlYmFwcGFwaXMuaHRtbCNldmVudC1oYW5kbGVycwogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIF9kaXNwYXRjaEV2ZW50OiBmdW5jdGlvbiBfZGlzcGF0Y2hFdmVudChldmVudCwgdHJ1c3RlZCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdHJ1c3RlZCAhPT0gImJvb2xlYW4iKSB0cnVzdGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gaW52b2tlKHRhcmdldCwgZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBldmVudC50eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGhhc2UgPSBldmVudC5ldmVudFBoYXNlOwogICAgICAgICAgICAgICAgICAgICAgICBldmVudC5jdXJyZW50VGFyZ2V0ID0gdGFyZ2V0OwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgd2FzIGFuIGluZGl2aWR1YWwgaGFuZGxlciBkZWZpbmVkLCBpbnZva2UgaXQgZmlyc3QKICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBzZWUgY29tbWVudCBhYm92ZTogdGhpcyBzaG91bGRuJ3QgYWx3YXlzIGJlIGZpcnN0LgogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGhhc2UgIT09IENBUFRVUklOR19QSEFTRSAmJiB0YXJnZXQuX2hhbmRsZXJzICYmIHRhcmdldC5faGFuZGxlcnNbdHlwZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoYW5kbGVyID0gdGFyZ2V0Ll9oYW5kbGVyc1t0eXBlXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBydjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaGFuZGxlciA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ2ID0gaGFuZGxlci5jYWxsKHdyYXAoZXZlbnQuY3VycmVudFRhcmdldCksIHdyYXAoZXZlbnQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBoYW5kbGVyLmhhbmRsZUV2ZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZiAhPT0gImZ1bmN0aW9uIikgdGhyb3cgVHlwZUVycm9yKCJoYW5kbGVFdmVudCBwcm9wZXJ0eSBvZiAiICsgImV2ZW50IGhhbmRsZXIgb2JqZWN0IGlzIiArICJub3QgYSBmdW5jdGlvbi4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBydiA9IGYuY2FsbChoYW5kbGVyLCB3cmFwKGV2ZW50KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChldmVudC50eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibW91c2VvdmVyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJ2ID09PSB0cnVlKSAvLyBIaXN0b3JpY2FsIGJhZ2dhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJlZm9yZXVubG9hZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBldmVudHVhbGx5IHdlIG5lZWQgYSBzcGVjaWFsIGNhc2UgaGVyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChydiA9PT0gZmFsc2UpIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3cgaW52b2tlIGxpc3QgbGlzdCBvZiBsaXN0ZW5lcnMgZm9yIHRoaXMgdGFyZ2V0IGFuZCB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gdGFyZ2V0Ll9saXN0ZW5lcnMgJiYgdGFyZ2V0Ll9saXN0ZW5lcnNbdHlwZV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbGlzdCkgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuX3N0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbikgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSBsaXN0W2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBoYXNlID09PSBDQVBUVVJJTkdfUEhBU0UgJiYgIWwuY2FwdHVyZSB8fCBwaGFzZSA9PT0gQlVCQkxJTkdfUEhBU0UgJiYgbC5jYXB0dXJlKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsLmYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXcmFwIGJvdGggdGhlIHRoaXMgdmFsdWUgb2YgdGhlIGNhbGwgYW5kIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFyZ3VtZW50IHBhc3NlZCB0byB0aGUgY2FsbCwgc2luY2UgdGhlc2Ugb2JqZWN0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGltcGwgYXJlIGJlaW5nIGV4cG9zZWQgdGhyb3VnaCB0aGUgcHVibGljIEFQSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwuZi5jYWxsKHdyYXAoZXZlbnQuY3VycmVudFRhcmdldCksIHdyYXAoZXZlbnQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBsLmxpc3RlbmVyLmhhbmRsZUV2ZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZiAhPT0gImZ1bmN0aW9uIikgdGhyb3cgVHlwZUVycm9yKCJoYW5kbGVFdmVudCBwcm9wZXJ0eSBvZiAiICsgImV2ZW50IGxpc3RlbmVyIG9iamVjdCBpcyAiICsgIm5vdCBhIGZ1bmN0aW9uLiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhlcmUgd2Ugb25seSBoYXZlIHRvIHdyYXAgdGhlIGV2ZW50IG9iamVjdCwgc2luY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbGlzdGVuZXIgb2JqZWN0IHdhcyBwYXNzZWQgaW4gdG8gdXMgZnJvbQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBwdWJsaWMgQVBJLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuY2FsbChsLmxpc3RlbmVyLCB3cmFwKGV2ZW50KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICghZXZlbnQuX2luaXRpYWxpemVkIHx8IGV2ZW50Ll9kaXNwYXRjaGluZykgSW52YWxpZFN0YXRlRXJyb3IoKTsKICAgICAgICAgICAgICAgICAgICBldmVudC5pc1RydXN0ZWQgPSB0cnVzdGVkOwoKICAgICAgICAgICAgICAgICAgICAvLyBCZWdpbiBkaXNwYXRjaGluZyB0aGUgZXZlbnQgbm93CiAgICAgICAgICAgICAgICAgICAgZXZlbnQuX2Rpc3BhdGNoaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICAgICAgICAgICAgICAvLyBCdWlsZCB0aGUgbGlzdCBvZiB0YXJnZXRzIGZvciB0aGUgY2FwdHVyaW5nIGFuZCBidWJibGluZyBwaGFzZXMKICAgICAgICAgICAgICAgICAgICAvLyBYWFg6IHdlJ2xsIGV2ZW50dWFsbHkgaGF2ZSB0byBhZGQgV2luZG93IHRvIHRoaXMgbGlzdC4KICAgICAgICAgICAgICAgICAgICB2YXIgYW5jZXN0b3JzID0gW107CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IHRoaXMucGFyZW50Tm9kZTsgbjsgbiA9IG4ucGFyZW50Tm9kZSkgcHVzaChhbmNlc3RvcnMsIG4pOwoKICAgICAgICAgICAgICAgICAgICAvLyBDYXB0dXJpbmcgcGhhc2UKICAgICAgICAgICAgICAgICAgICBldmVudC5ldmVudFBoYXNlID0gQ0FQVFVSSU5HX1BIQVNFOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBhbmNlc3RvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW52b2tlKGFuY2VzdG9yc1tpXSwgZXZlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuX3Byb3BhZ2F0aW9uU3RvcHBlZCkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBBdCB0YXJnZXQgcGhhc2UKICAgICAgICAgICAgICAgICAgICBpZiAoIWV2ZW50Ll9wcm9wYWdhdGlvblN0b3BwZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuZXZlbnRQaGFzZSA9IEFUX1RBUkdFVDsKICAgICAgICAgICAgICAgICAgICAgICAgaW52b2tlKHRoaXMsIGV2ZW50KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIEJ1YmJsaW5nIHBoYXNlCiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmJ1YmJsZXMgJiYgIWV2ZW50Ll9wcm9wYWdhdGlvblN0b3BwZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuZXZlbnRQaGFzZSA9IEJVQkJMSU5HX1BIQVNFOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IGFuY2VzdG9ycy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludm9rZShhbmNlc3RvcnNbaV0sIGV2ZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5fcHJvcGFnYXRpb25TdG9wcGVkKSBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZXZlbnQuX2Rpc3BhdGNoaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQuZXZlbnRQaGFzZSA9IEFUX1RBUkdFVDsKICAgICAgICAgICAgICAgICAgICBldmVudC5jdXJyZW50VGFyZ2V0ID0gbnVsbDsKCiAgICAgICAgICAgICAgICAgICAgLy8gRGVhbCB3aXRoIG1vdXNlIGV2ZW50cyBhbmQgZmlndXJlIG91dCB3aGVuCiAgICAgICAgICAgICAgICAgICAgLy8gYSBjbGljayBoYXMgaGFwcGVuZWQKICAgICAgICAgICAgICAgICAgICBpZiAodHJ1c3RlZCAmJiAhZXZlbnQuZGVmYXVsdFByZXZlbnRlZCAmJiBldmVudCBpbnN0YW5jZW9mIGltcGwuTW91c2VFdmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm1vdXNlZG93biI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXJtZWQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IGV2ZW50LmNsaWVudFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IGV2ZW50LmNsaWVudFksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQ6IGV2ZW50LnRpbWVTdGFtcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJtb3VzZW91dCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJtb3VzZW92ZXIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FybWVkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm1vdXNldXAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0NsaWNrKGV2ZW50KSkgdGhpcy5fZG9DbGljayhldmVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXJtZWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQ7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8vIERldGVybWluZSB3aGV0aGVyIGEgY2xpY2sgb2NjdXJyZWQKICAgICAgICAgICAgICAgIC8vIFhYWCBXZSBkb24ndCBzdXBwb3J0IGRvdWJsZSBjbGlja3MgZm9yIG5vdwogICAgICAgICAgICAgICAgX2lzQ2xpY2s6IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hcm1lZCAhPT0gbnVsbCAmJiBldmVudC50eXBlID09PSAibW91c2V1cCIgJiYgZXZlbnQuaXNUcnVzdGVkICYmIGV2ZW50LmJ1dHRvbiA9PT0gMCAmJiBldmVudC50aW1lU3RhbXAgLSB0aGlzLl9hcm1lZC50IDwgMTAwMCAmJiBNYXRoLmFicyhldmVudC5jbGllbnRYIC0gdGhpcy5fYXJtZWQueCkgPCAxMCAmJiBNYXRoLmFicyhldmVudC5jbGllbnRZIC0gdGhpcy5fYXJtZWQuWSkgPCAxMDsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLy8gQ2xpY2tzIGFyZSBoYW5kbGVkIGxpa2UgdGhpczoKICAgICAgICAgICAgICAgIC8vIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvbXVsdGlwYWdlL2VsZW1lbnRzLmh0bWwjaW50ZXJhY3RpdmUtY29udGVudC0wCiAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgbWV0aG9kIGlzIHNpbWlsYXIgdG8gdGhlIEhUTUxFbGVtZW50LmNsaWNrKCkgbWV0aG9kCiAgICAgICAgICAgICAgICAvLyBUaGUgZXZlbnQgYXJndW1lbnQgbXVzdCBiZSB0aGUgdHJ1c3RlZCBtb3VzZXVwIGV2ZW50CiAgICAgICAgICAgICAgICBfZG9DbGljazogZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NsaWNrX2luX3Byb2dyZXNzKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2xpY2tfaW5fcHJvZ3Jlc3MgPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgICAvLyBGaW5kIHRoZSBuZWFyZXN0IGVuY2xvc2luZyBlbGVtZW50IHRoYXQgaXMgYWN0aXZhdGFibGUKICAgICAgICAgICAgICAgICAgICAvLyBBbiBlbGVtZW50IGlzIGFjdGl2YXRhYmxlIGlmIGl0IGhhcyBhCiAgICAgICAgICAgICAgICAgICAgLy8gX3Bvc3RfY2xpY2tfYWN0aXZhdGlvbl9zdGVwcyBob29rCiAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2YXRlZCA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGFjdGl2YXRlZCAmJiAhYWN0aXZhdGVkLl9wb3N0X2NsaWNrX2FjdGl2YXRpb25fc3RlcHMpIGFjdGl2YXRlZCA9IGFjdGl2YXRlZC5wYXJlbnROb2RlOwoKICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZhdGVkICYmIGFjdGl2YXRlZC5fcHJlX2NsaWNrX2FjdGl2YXRpb25fc3RlcHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZhdGVkLl9wcmVfY2xpY2tfYWN0aXZhdGlvbl9zdGVwcygpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdmFyIGNsaWNrID0gdGhpcy5vd25lckRvY3VtZW50LmNyZWF0ZUV2ZW50KCJNb3VzZUV2ZW50Iik7CiAgICAgICAgICAgICAgICAgICAgY2xpY2suaW5pdE1vdXNlRXZlbnQoImNsaWNrIiwgdHJ1ZSwgdHJ1ZSwgdGhpcy5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LCAxLCBldmVudC5zY3JlZW5YLCBldmVudC5zY3JlZW5ZLCBldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZLCBldmVudC5jdHJsS2V5LCBldmVudC5hbHRLZXksIGV2ZW50LnNoaWZ0S2V5LCBldmVudC5tZXRhS2V5LCBldmVudC5idXR0b24sIG51bGwpOwoKICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5fZGlzcGF0Y2hFdmVudChjbGljaywgdHJ1ZSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmF0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB3aGVyZSBoeXBlcmxpbmtzIGdldCBmb2xsb3dlZCwgZm9yIGV4YW1wbGUuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZhdGVkLl9wb3N0X2NsaWNrX2FjdGl2YXRpb25fc3RlcHMpIGFjdGl2YXRlZC5fcG9zdF9jbGlja19hY3RpdmF0aW9uX3N0ZXBzKGNsaWNrKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmF0ZWQuX2NhbmNlbGxlZF9hY3RpdmF0aW9uX3N0ZXBzKSBhY3RpdmF0ZWQuX2NhbmNlbGxlZF9hY3RpdmF0aW9uX3N0ZXBzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBBbiBldmVudCBoYW5kbGVyIGlzIGxpa2UgYW4gZXZlbnQgbGlzdGVuZXIsIGJ1dCBpdCByZWdpc3RlcmVkCiAgICAgICAgICAgICAgICAvLyBieSBzZXR0aW5nIGFuIElETCBvciBjb250ZW50IGF0dHJpYnV0ZSBsaWtlIG9ubG9hZCBvciBvbmNsaWNrLgogICAgICAgICAgICAgICAgLy8gVGhlcmUgY2FuIG9ubHkgYmUgb25lIG9mIHRoZXNlIGF0IGEgdGltZSBmb3IgYW55IGV2ZW50IHR5cGUuCiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGFuIGludGVybmFsIG1ldGhvZCBmb3IgdGhlIGF0dHJpYnV0ZSBhY2Nlc3NvcnMgYW5kCiAgICAgICAgICAgICAgICAvLyBjb250ZW50IGF0dHJpYnV0ZSBoYW5kbGVycyB0aGF0IG5lZWQgdG8gcmVnaXN0ZXIgZXZlbnRzIGhhbmRsZXJzLgogICAgICAgICAgICAgICAgLy8gVGhlIHR5cGUgYXJndW1lbnQgaXMgdGhlIHNhbWUgYXMgaW4gYWRkRXZlbnRMaXN0ZW5lcigpLgogICAgICAgICAgICAgICAgLy8gVGhlIGhhbmRsZXIgYXJndW1lbnQgaXMgdGhlIHNhbWUgYXMgbGlzdGVuZXJzIGluIGFkZEV2ZW50TGlzdGVuZXI6CiAgICAgICAgICAgICAgICAvLyBpdCBjYW4gYmUgYSBmdW5jdGlvbiBvciBhbiBvYmplY3QuIFBhc3MgbnVsbCB0byByZW1vdmUgYW55IGV4aXN0aW5nCiAgICAgICAgICAgICAgICAvLyBoYW5kbGVyLiAgSGFuZGxlcnMgYXJlIGFsd2F5cyBpbnZva2VkIGJlZm9yZSBhbnkgbGlzdGVuZXJzIG9mCiAgICAgICAgICAgICAgICAvLyB0aGUgc2FtZSB0eXBlLiAgVGhleSBhcmUgbm90IGludm9rZWQgZHVyaW5nIHRoZSBjYXB0dXJpbmcgcGhhc2UKICAgICAgICAgICAgICAgIC8vIG9mIGV2ZW50IGRpc3BhdGNoLgogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIF9zZXRFdmVudEhhbmRsZXI6IGZ1bmN0aW9uIF9zZXRFdmVudEhhbmRsZXIodHlwZSwgaGFuZGxlcikgewogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5faGFuZGxlcnMpIHRoaXMuX2hhbmRsZXJzID0ge307CgogICAgICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyKSB0aGlzLl9oYW5kbGVyc1t0eXBlXSA9IGhhbmRsZXI7ZWxzZSBkZWxldGUgdGhpcy5faGFuZGxlcnNbdHlwZV07CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIF9nZXRFdmVudEhhbmRsZXI6IGZ1bmN0aW9uIF9nZXRFdmVudEhhbmRsZXIodHlwZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVycyAmJiB0aGlzLl9oYW5kbGVyc1t0eXBlXSB8fCBudWxsOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiBFdmVudFRhcmdldDsKICAgICAgICB9KTsKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICAqICBzcmMvaW1wbC9Ob2RlLmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9Ob2RlLmpzIgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiTm9kZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy8gQWxsIG5vZGVzIGhhdmUgYSBub2RlVHlwZSBhbmQgYW4gb3duZXJEb2N1bWVudC4KICAgICAgICAgICAgLy8gT25jZSBpbnNlcnRlZCwgdGhleSBhbHNvIGhhdmUgYSBwYXJlbnROb2RlLgogICAgICAgICAgICAvLyBUaGlzIGlzIGFuIGFic3RyYWN0IGNsYXNzOyBhbGwgbm9kZXMgaW4gYSBkb2N1bWVudCBhcmUgaW5zdGFuY2VzCiAgICAgICAgICAgIC8vIG9mIGEgc3VidHlwZSwgc28gYWxsIHRoZSBwcm9wZXJ0aWVzIGFyZSBkZWZpbmVkIGJ5IG1vcmUgc3BlY2lmaWMKICAgICAgICAgICAgLy8gY29uc3RydWN0b3JzLgogICAgICAgICAgICBmdW5jdGlvbiBOb2RlKCkge30KCiAgICAgICAgICAgIE5vZGUucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5FdmVudFRhcmdldC5wcm90b3R5cGUsIHsKCiAgICAgICAgICAgICAgICAvLyBOb2RlIHRoYXQgYXJlIG5vdCBpbnNlcnRlZCBpbnRvIHRoZSB0cmVlIGluaGVyaXQgYSBudWxsIHBhcmVudAogICAgICAgICAgICAgICAgLy8gWFhYCiAgICAgICAgICAgICAgICAvLyBDYW4ndCB1c2UgY29uc3RhbnQobnVsbCkgaGVyZSBiZWNhdXNlIHRoZW4gSSBjb3VsZG4ndCBzZXQgYSBub24tbnVsbAogICAgICAgICAgICAgICAgLy8gdmFsdWUgdGhhdCB3b3VsZCBvdmVycmlkZSB0aGUgaW5oZXJpdGVkIGNvbnN0YW50LiAgUGVyaGFwcyB0aGF0CiAgICAgICAgICAgICAgICAvLyBtZWFucyBJIHNob3VsZG4ndCB1c2UgdGhlIHByb3RvdHlwZSBhbmQgc2hvdWxkIGp1c3Qgc2V0IHRoZQogICAgICAgICAgICAgICAgLy8gdmFsdWUgaW4gZWFjaCBub2RlIGNvbnN0cnVjdG9yPwogICAgICAgICAgICAgICAgcGFyZW50Tm9kZTogeyB2YWx1ZTogbnVsbCwgd3JpdGFibGU6IHRydWUgfSwKCiAgICAgICAgICAgICAgICAvLyBYWFg6IHRoZSBiYXNlVVJJIGF0dHJpYnV0ZSBpcyBkZWZpbmVkIGJ5IGRvbSBjb3JlLCBidXQKICAgICAgICAgICAgICAgIC8vIGEgY29ycmVjdCBpbXBsZW1lbnRhdGlvbiBvZiBpdCByZXF1aXJlcyBIVE1MIGZlYXR1cmVzLCBzbwogICAgICAgICAgICAgICAgLy8gd2UnbGwgY29tZSBiYWNrIHRvIHRoaXMgbGF0ZXIuCiAgICAgICAgICAgICAgICBiYXNlVVJJOiBhdHRyaWJ1dGUobnlpKSwKCiAgICAgICAgICAgICAgICBwYXJlbnRFbGVtZW50OiBhdHRyaWJ1dGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcmVudE5vZGUgJiYgdGhpcy5wYXJlbnROb2RlLm5vZGVUeXBlID09PSBFTEVNRU5UX05PREUgPyB0aGlzLnBhcmVudE5vZGUgOiBudWxsOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgaGFzQ2hpbGROb2RlczogY29uc3RhbnQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIC8vIE92ZXJyaWRkZW4gaW4gbGVhZi5qcwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkTm9kZXMubGVuZ3RoID4gMDsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIGZpcnN0Q2hpbGQ6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGROb2Rlcy5sZW5ndGggPT09IDAgPyBudWxsIDogdGhpcy5jaGlsZE5vZGVzWzBdOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgbGFzdENoaWxkOiBhdHRyaWJ1dGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkTm9kZXMubGVuZ3RoID09PSAwID8gbnVsbCA6IHRoaXMuY2hpbGROb2Rlc1t0aGlzLmNoaWxkTm9kZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICBwcmV2aW91c1NpYmxpbmc6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnBhcmVudE5vZGUpIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgIHZhciBzaWJzID0gdGhpcy5wYXJlbnROb2RlLmNoaWxkTm9kZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSB0aGlzLmluZGV4OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBpID09PSAwID8gbnVsbCA6IHNpYnNbaSAtIDFdOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgbmV4dFNpYmxpbmc6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnBhcmVudE5vZGUpIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgIHZhciBzaWJzID0gdGhpcy5wYXJlbnROb2RlLmNoaWxkTm9kZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSB0aGlzLmluZGV4OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBpICsgMSA9PT0gc2licy5sZW5ndGggPyBudWxsIDogc2lic1tpICsgMV07CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICBpbnNlcnRCZWZvcmU6IGNvbnN0YW50KGZ1bmN0aW9uIGluc2VydEJlZm9yZShjaGlsZCwgcmVmQ2hpbGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gdGhpczsKICAgICAgICAgICAgICAgICAgICBpZiAocmVmQ2hpbGQgPT09IG51bGwpIHJldHVybiB0aGlzLmFwcGVuZENoaWxkKGNoaWxkKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVmQ2hpbGQucGFyZW50Tm9kZSAhPT0gcGFyZW50KSBOb3RGb3VuZEVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLmlzQW5jZXN0b3IocGFyZW50KSkgSGllcmFyY2h5UmVxdWVzdEVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBET0NVTUVOVF9OT0RFKSBIaWVyYXJjaHlSZXF1ZXN0RXJyb3IoKTsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQuZW5zdXJlU2FtZURvYyhjaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgY2hpbGQuaW5zZXJ0KHBhcmVudCwgcmVmQ2hpbGQuaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZDsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIGFwcGVuZENoaWxkOiBjb25zdGFudChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gdGhpczsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQuaXNBbmNlc3RvcihwYXJlbnQpKSBIaWVyYXJjaHlSZXF1ZXN0RXJyb3IoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT09IERPQ1VNRU5UX05PREUpIEhpZXJhcmNoeVJlcXVlc3RFcnJvcigpOwogICAgICAgICAgICAgICAgICAgIHBhcmVudC5lbnN1cmVTYW1lRG9jKGNoaWxkKTsKICAgICAgICAgICAgICAgICAgICBjaGlsZC5pbnNlcnQocGFyZW50LCBwYXJlbnQuY2hpbGROb2Rlcy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZDsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIHJlbW92ZUNoaWxkOiBjb25zdGFudChmdW5jdGlvbiByZW1vdmVDaGlsZChjaGlsZCkgewogICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC5wYXJlbnROb2RlICE9PSBwYXJlbnQpIE5vdEZvdW5kRXJyb3IoKTsKICAgICAgICAgICAgICAgICAgICBjaGlsZC5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGQ7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICByZXBsYWNlQ2hpbGQ6IGNvbnN0YW50KGZ1bmN0aW9uIHJlcGxhY2VDaGlsZChuZXdDaGlsZCwgb2xkQ2hpbGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gdGhpczsKICAgICAgICAgICAgICAgICAgICBpZiAob2xkQ2hpbGQucGFyZW50Tm9kZSAhPT0gcGFyZW50KSBOb3RGb3VuZEVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld0NoaWxkLmlzQW5jZXN0b3IocGFyZW50KSkgSGllcmFyY2h5UmVxdWVzdEVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgcGFyZW50LmVuc3VyZVNhbWVEb2MobmV3Q2hpbGQpOwoKICAgICAgICAgICAgICAgICAgICB2YXIgcmVmQ2hpbGQgPSBvbGRDaGlsZC5uZXh0U2libGluZzsKICAgICAgICAgICAgICAgICAgICBvbGRDaGlsZC5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKG5ld0NoaWxkLCByZWZDaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9sZENoaWxkOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgY29tcGFyZURvY3VtZW50UG9zaXRpb246IGNvbnN0YW50KGZ1bmN0aW9uIGNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKHRoYXQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBCYXNpYyBhbGdvcml0aG0gZm9yIGZpbmRpbmcgdGhlIHJlbGF0aXZlIHBvc2l0aW9uIG9mIHR3byBub2Rlcy4KICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIGEgbGlzdCB0aGUgYW5jZXN0b3JzIG9mIGVhY2ggbm9kZSwgc3RhcnRpbmcgd2l0aCB0aGUKICAgICAgICAgICAgICAgICAgICAvLyBkb2N1bWVudCBlbGVtZW50IGFuZCBwcm9jZWVkaW5nIGRvd24gdG8gdGhlIG5vZGVzIHRoZW1zZWx2ZXMuCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlbiwgbG9vcCB0aHJvdWdoIHRoZSBsaXN0cywgbG9va2luZyBmb3IgdGhlIGZpcnN0IGVsZW1lbnQKICAgICAgICAgICAgICAgICAgICAvLyB0aGF0IGRpZmZlcnMuICBUaGUgb3JkZXIgb2YgdGhvc2UgdHdvIGVsZW1lbnRzIGdpdmUgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gb3JkZXIgb2YgdGhlaXIgZGVzY2VuZGFudCBub2Rlcy4gIE9yLCBpZiBvbmUgbGlzdCBpcyBhIHByZWZpeAogICAgICAgICAgICAgICAgICAgIC8vIG9mIHRoZSBvdGhlciBvbmUsIHRoZW4gdGhhdCBub2RlIGNvbnRhaW5zIHRoZSBvdGhlci4KCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMgPT09IHRoYXQpIHJldHVybiAwOwoKICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGV5J3JlIG5vdCBvd25lZCBieSB0aGUgc2FtZSBkb2N1bWVudCBvciBpZiBvbmUgaXMgcm9vdGVkCiAgICAgICAgICAgICAgICAgICAgLy8gYW5kIG9uZSBpcyBub3QsIHRoZW4gdGhleSdyZSBkaXNjb25uZWN0ZWQuCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3duZXJEb2N1bWVudCAhPSB0aGF0Lm93bmVyRG9jdW1lbnQgfHwgdGhpcy5yb290ZWQgIT09IHRoYXQucm9vdGVkKSByZXR1cm4gRE9DVU1FTlRfUE9TSVRJT05fRElTQ09OTkVDVEVEICsgRE9DVU1FTlRfUE9TSVRJT05fSU1QTEVNRU5UQVRJT05fU1BFQ0lGSUM7CgogICAgICAgICAgICAgICAgICAgIC8vIEdldCBhcnJheXMgb2YgYW5jZXN0b3JzIGZvciB0aGlzIGFuZCB0aGF0CiAgICAgICAgICAgICAgICAgICAgdmFyIHRoZXNlID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgIHRob3NlID0gW107CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IHRoaXM7IG4gIT09IG51bGw7IG4gPSBuLnBhcmVudE5vZGUpIHB1c2godGhlc2UsIG4pOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG4gPSB0aGF0OyBuICE9PSBudWxsOyBuID0gbi5wYXJlbnROb2RlKSBwdXNoKHRob3NlLCBuKTsKICAgICAgICAgICAgICAgICAgICB0aGVzZS5yZXZlcnNlKCk7IC8vIFNvIHdlIHN0YXJ0IHdpdGggdGhlIG91dGVybW9zdAogICAgICAgICAgICAgICAgICAgIHRob3NlLnJldmVyc2UoKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoZXNlWzBdICE9PSB0aG9zZVswXSkgLy8gTm8gY29tbW9uIGFuY2VzdG9yCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBET0NVTUVOVF9QT1NJVElPTl9ESVNDT05ORUNURUQgKyBET0NVTUVOVF9QT1NJVElPTl9JTVBMRU1FTlRBVElPTl9TUEVDSUZJQzsKCiAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBNYXRoLm1pbih0aGVzZS5sZW5ndGgsIHRob3NlLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoZXNlW2ldICE9PSB0aG9zZVtpXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgZm91bmQgdHdvIGRpZmZlcmVudCBhbmNlc3RvcnMsIHNvIGNvbXBhcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZWlyIHBvc2l0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoZXNlW2ldLmluZGV4IDwgdGhvc2VbaV0uaW5kZXgpIHJldHVybiBET0NVTUVOVF9QT1NJVElPTl9GT0xMT1dJTkc7ZWxzZSByZXR1cm4gRE9DVU1FTlRfUE9TSVRJT05fUFJFQ0VESU5HOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSBnZXQgdG8gaGVyZSwgdGhlbiBvbmUgb2YgdGhlIG5vZGVzICh0aGUgb25lIHdpdGggdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gc2hvcnRlciBsaXN0IG9mIGFuY2VzdG9ycykgY29udGFpbnMgdGhlIG90aGVyIG9uZS4KICAgICAgICAgICAgICAgICAgICBpZiAodGhlc2UubGVuZ3RoIDwgdGhvc2UubGVuZ3RoKSByZXR1cm4gRE9DVU1FTlRfUE9TSVRJT05fRk9MTE9XSU5HICsgRE9DVU1FTlRfUE9TSVRJT05fQ09OVEFJTkVEX0JZO2Vsc2UgcmV0dXJuIERPQ1VNRU5UX1BPU0lUSU9OX1BSRUNFRElORyArIERPQ1VNRU5UX1BPU0lUSU9OX0NPTlRBSU5TOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgaXNTYW1lTm9kZTogY29uc3RhbnQoZnVuY3Rpb24gaXNTYW1lTm9kZShub2RlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMgPT09IG5vZGU7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBUaGlzIG1ldGhvZCBpbXBsZW1lbnRzIHRoZSBnZW5lcmljIHBhcnRzIG9mIG5vZGUgZXF1YWxpdHkgdGVzdGluZwogICAgICAgICAgICAgICAgLy8gYW5kIGRlZmVycyB0byB0aGUgKG5vbi1yZWN1cnNpdmUpIHR5cGUtc3BlY2lmaWMgaXNFcXVhbCgpIG1ldGhvZAogICAgICAgICAgICAgICAgLy8gZGVmaW5lZCBieSBzdWJjbGFzc2VzCiAgICAgICAgICAgICAgICBpc0VxdWFsTm9kZTogY29uc3RhbnQoZnVuY3Rpb24gaXNFcXVhbE5vZGUobm9kZSkgewogICAgICAgICAgICAgICAgICAgIGlmICghbm9kZSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlICE9PSB0aGlzLm5vZGVUeXBlKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBzYW1lIG51bWJlciBvZiBjaGlsZHJlbgogICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBjaGlsZHJlbiB0aGlzIHdheSBiZWNhdXNlIGl0IGlzIG1vcmUgZWZmaWNpZW50CiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIGNoaWxkbGVzcyBsZWFmIG5vZGVzLgogICAgICAgICAgICAgICAgICAgIHZhciBuOyAvLyBudW1iZXIgb2YgY2hpbGQgbm9kZXMKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZmlyc3RDaGlsZCkgewogICAgICAgICAgICAgICAgICAgICAgICBuID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuZmlyc3RDaGlsZCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG4gPSB0aGlzLmNoaWxkTm9kZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5jaGlsZE5vZGVzLmxlbmd0aCAhPSBuKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayB0eXBlLXNwZWNpZmljIHByb3BlcnRpZXMgZm9yIGVxdWFsaXR5CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzRXF1YWwobm9kZSkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgLy8gTm93IGNoZWNrIGNoaWxkcmVuIGZvciBlcXVhbGl0eQogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjMSA9IHRoaXMuY2hpbGROb2Rlc1tpXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMyID0gbm9kZS5jaGlsZE5vZGVzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWMxLmlzRXF1YWxOb2RlKGMyKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBUaGlzIG1ldGhvZCBkZWxlZ2F0ZXMgc2hhbGxvdyBjbG9uaW5nIHRvIGEgY2xvbmUoKSBtZXRob2QKICAgICAgICAgICAgICAgIC8vIHRoYXQgZWFjaCBjb25jcmV0ZSBzdWJjbGFzcyBtdXN0IGltcGxlbWVudAogICAgICAgICAgICAgICAgY2xvbmVOb2RlOiBjb25zdGFudChmdW5jdGlvbiAoZGVlcCkgewogICAgICAgICAgICAgICAgICAgIC8vIENsb25lIHRoaXMgbm9kZQogICAgICAgICAgICAgICAgICAgIHZhciBjbG9uZSA9IHRoaXMuY2xvbmUoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIHRoZSByZWN1cnNpdmUgY2FzZSBpZiBuZWNlc3NhcnkKICAgICAgICAgICAgICAgICAgICBpZiAoZGVlcCAmJiB0aGlzLmZpcnN0Q2hpbGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSB0aGlzLmNoaWxkTm9kZXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9uZS5hcHBlbmRDaGlsZCh0aGlzLmNoaWxkTm9kZXNbaV0uY2xvbmVOb2RlKHRydWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNsb25lOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgbG9va3VwUHJlZml4OiBjb25zdGFudChmdW5jdGlvbiBsb29rdXBQcmVmaXgobnMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZTsKICAgICAgICAgICAgICAgICAgICBpZiAobnMgPT09ICIiKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMubm9kZVR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFTEVNRU5UX05PREU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhdGVOYW1lc3BhY2VQcmVmaXgobnMpOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERPQ1VNRU5UX05PREU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gdGhpcy5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZSA/IGUubG9jYXRlTmFtZXNwYWNlUHJlZml4KG5zKSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRE9DVU1FTlRfVFlQRV9OT0RFOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERPQ1VNRU5UX0ZSQUdNRU5UX05PREU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSB0aGlzLnBhcmVudEVsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZSA/IGUubG9jYXRlTmFtZXNwYWNlUHJlZml4KG5zKSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgbG9va3VwTmFtZXNwYWNlVVJJOiBjb25zdGFudChmdW5jdGlvbiBsb29rdXBOYW1lc3BhY2VVUkkocHJlZml4KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGU7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLm5vZGVUeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRUxFTUVOVF9OT0RFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYXRlTmFtZXNwYWNlKHByZWZpeCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRE9DVU1FTlRfTk9ERToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSB0aGlzLmRvY3VtZW50RWxlbWVudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlID8gZS5sb2NhdGVOYW1lc3BhY2UocHJlZml4KSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRE9DVU1FTlRfVFlQRV9OT0RFOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERPQ1VNRU5UX0ZSQUdNRU5UX05PREU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSB0aGlzLnBhcmVudEVsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZSA/IGUubG9jYXRlTmFtZXNwYWNlKHByZWZpeCkgOiBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIGlzRGVmYXVsdE5hbWVzcGFjZTogY29uc3RhbnQoZnVuY3Rpb24gaXNEZWZhdWx0TmFtZXNwYWNlKG5zKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGRlZmF1bHRucyA9IHRoaXMubG9va3VwTmFtZXNwYWNlVVJJKG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChkZWZhdWx0bnMgPT0gbnVsbCkgZGVmYXVsdG5zID0gIiI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5zID09PSBkZWZhdWx0bnM7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBVdGlsaXR5IG1ldGhvZHMgZm9yIG5vZGVzLiAgTm90IHBhcnQgb2YgdGhlIERPTQoKICAgICAgICAgICAgICAgIC8vIFJldHVybiB0aGUgaW5kZXggb2YgdGhpcyBub2RlIGluIGl0cyBwYXJlbnQuCiAgICAgICAgICAgICAgICAvLyBUaHJvdyBpZiBubyBwYXJlbnQsIG9yIGlmIHRoaXMgbm9kZSBpcyBub3QgYSBjaGlsZCBvZiBpdHMgcGFyZW50CiAgICAgICAgICAgICAgICBpbmRleDogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBhc3NlcnQodGhpcy5wYXJlbnROb2RlKTsKICAgICAgICAgICAgICAgICAgICB2YXIga2lkcyA9IHRoaXMucGFyZW50Tm9kZS5jaGlsZE5vZGVzOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pbmRleCA9PSB1bmRlZmluZWQgfHwga2lkc1t0aGlzLl9pbmRleF0gIT0gdGhpcykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbmRleCA9IEEuaW5kZXhPZihraWRzLCB0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXJ0KHRoaXMuX2luZGV4ICE9IC0xKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luZGV4OwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRydWUgaWYgdGhpcyBub2RlIGlzIGVxdWFsIHRvIG9yIGlzIGFuIGFuY2VzdG9yIG9mIHRoYXQgbm9kZQogICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IG5vZGVzIGFyZSBjb25zaWRlcmVkIHRvIGJlIGFuY2VzdG9ycyBvZiB0aGVtc2VsdmVzCiAgICAgICAgICAgICAgICBpc0FuY2VzdG9yOiBjb25zdGFudChmdW5jdGlvbiAodGhhdCkgewogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZXkgYmVsb25nIHRvIGRpZmZlcmVudCBkb2N1bWVudHMsIHRoZW4gdGhleSdyZSB1bnJlbGF0ZWQuCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3duZXJEb2N1bWVudCAhPSB0aGF0Lm93bmVyRG9jdW1lbnQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAvLyBJZiBvbmUgaXMgcm9vdGVkIGFuZCBvbmUgaXNuJ3QgdGhlbiB0aGV5J3JlIG5vdCByZWxhdGVkCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucm9vdGVkICE9PSB0aGF0LnJvb3RlZCkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UgY2hlY2sgYnkgdHJhdmVyc2luZyB0aGUgcGFyZW50Tm9kZSBjaGFpbgogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGUgPSB0aGF0OyBlOyBlID0gZS5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlID09PSB0aGlzKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gV2hlbiBhIHVzZXIgYWdlbnQgaXMgdG8gZW5zdXJlIHRoYXQgdHdvIE5vZGVzLCBvbGQgYW5kIG5ldywgYXJlCiAgICAgICAgICAgICAgICAvLyBpbiB0aGUgc2FtZSBEb2N1bWVudCwgaXQgbXVzdCBydW4gdGhlIGZvbGxvd2luZyBzdGVwczoKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyAgICAgSWYgbmV3IGlzIGEgRG9jdW1lbnRUeXBlLCBydW4gdGhlIGZvbGxvd2luZyBzdGVwczoKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyAgICAgICAgIElmIG5ldydzIG93bmVyRG9jdW1lbnQgaXMgbm90IG51bGwsIGFuZCBpdCBpcyBub3QgZXF1YWwKICAgICAgICAgICAgICAgIC8vICAgICAgICAgdG8gb2xkJ3Mgb3duZXJEb2N1bWVudCwgdGhyb3cgYSBXUk9OR19ET0NVTUVOVF9FUlIKICAgICAgICAgICAgICAgIC8vICAgICAgICAgZXhjZXB0aW9uIGFuZCB0ZXJtaW5hdGUgdGhlc2Ugc3RlcHMuCiAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gICAgICAgICBPdGhlcndpc2UsIHNldCBpdHMgb3duZXJEb2N1bWVudCB0byBvbGQncwogICAgICAgICAgICAgICAgLy8gICAgICAgICBvd25lckRvY3VtZW50LgogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vICAgICBPdGhlcndpc2UsIGludm9rZSBvbGQncyBvd25lckRvY3VtZW50J3MgYWRvcHROb2RlIG1ldGhvZAogICAgICAgICAgICAgICAgLy8gICAgIHdpdGggbmV3IGFzIGl0cyBhcmd1bWVudC4KICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyAgICAgSWYgb2xkJ3Mgb3duZXJEb2N1bWVudCBhbmQgbmV3J3Mgb3duZXJEb2N1bWVudCBhcmUgbm90IHRoZQogICAgICAgICAgICAgICAgLy8gICAgIHNhbWUsIHRocm93IGEgSElFUkFSQ0hZX1JFUVVFU1RfRVJSCiAgICAgICAgICAgICAgICBlbnN1cmVTYW1lRG9jOiBjb25zdGFudChmdW5jdGlvbiAodGhhdCkgewogICAgICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgb3duZXIgb2YgdGhlIG5vZGUsIHRoZSBub2RlIGl0c2VsZiwgaWYgaXQgaXMgYSBkb2N1bWVudAogICAgICAgICAgICAgICAgICAgIHZhciBvd25lcmRvYyA9IHRoaXMub3duZXJEb2N1bWVudCB8fCB0aGlzOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5ub2RlVHlwZSA9PT0gRE9DVU1FTlRfVFlQRV9OT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGF0Lm93bmVyRG9jdW1lbnQgIT09IG51bGwgJiYgdGhhdC5vd25lckRvY3VtZW50ICE9PSBvd25lcmRvYykgV3JvbmdEb2N1bWVudEVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQub3duZXJEb2N1bWVudCA9IG93bmVyZG9jOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBzcGVjJ3MgYWxnb3JpdGhtIHNheXMgdG8gY2FsbCBhZG9wdE5vZGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdW5jb25kaXRpb25hbGx5LCB3aGljaCB3aWxsIHJlbW92ZSBpdCBmcm9tIGl0cyBjdXJyZW50CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvY2F0aW9uIGluIHRoZSBkb2N1bWVudCBldmVuIGl0IGlmIGlzIG5vdCBjaGFuZ2luZwogICAgICAgICAgICAgICAgICAgICAgICAvLyBkb2N1bWVudHMuICBJIGRvbid0IGRvIHRoYXQgaGVyZSBiZWNhdXNlIHRoYXQgd291bGQgY2F1c2UgYQogICAgICAgICAgICAgICAgICAgICAgICAvLyBsb3Qgb2YgdW5uZWNlc3NhcnkgdXByb290IGFuZCByZXJvb3QgbXV0YXRpb24gZXZlbnRzLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5vd25lckRvY3VtZW50ICE9PSBvd25lcmRvYykgb3duZXJkb2MuYWRvcHROb2RlKHRoYXQpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiB0aGlzIHN0ZXAgZG9lcyBub3Qgc2VlbSBuZWNlc3NhcnkuCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgbXV0YXRpb24gZXZlbnRzIGFyZSBhZGRlZCwgaG93ZXZlciwgaXQgYmVjb21lcyBuZWNlc3NhcnkKICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5vd25lckRvY3VtZW50ICE9PSBvd25lcmRvYykgSGllcmFyY2h5UmVxdWVzdEVycm9yKCk7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhpcyBub2RlIGZyb20gaXRzIHBhcmVudAogICAgICAgICAgICAgICAgcmVtb3ZlOiBjb25zdGFudChmdW5jdGlvbiByZW1vdmUoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoaXMgbm9kZSBmcm9tIGl0cyBwYXJlbnRzIGFycmF5IG9mIGNoaWxkcmVuCiAgICAgICAgICAgICAgICAgICAgc3BsaWNlKHRoaXMucGFyZW50Tm9kZS5jaGlsZE5vZGVzLCB0aGlzLmluZGV4LCAxKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBzdHJ1Y3R1cmUgaWQgZm9yIGFsbCBhbmNlc3RvcnMKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudE5vZGUubW9kaWZ5KCk7CgogICAgICAgICAgICAgICAgICAgIC8vIEZvcmdldCB0aGlzIG5vZGUncyBwYXJlbnQKICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5wYXJlbnROb2RlOwoKICAgICAgICAgICAgICAgICAgICAvLyBTZW5kIG11dGF0aW9uIGV2ZW50cyBpZiBuZWNlc3NhcnkKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yb290ZWQpIHRoaXMub3duZXJEb2N1bWVudC5tdXRhdGVSZW1vdmUodGhpcyk7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgYWxsIG9mIHRoaXMgbm9kZSdzIGNoaWxkcmVuLiAgVGhpcyBpcyBhIG1pbm9yCiAgICAgICAgICAgICAgICAvLyBvcHRpbWl6YXRpb24gdGhhdCBvbmx5IGNhbGxzIG1vZGlmeSgpIG9uY2UuCiAgICAgICAgICAgICAgICByZW1vdmVDaGlsZHJlbjogY29uc3RhbnQoZnVuY3Rpb24gcmVtb3ZlQ2hpbGRyZW4oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJvb3QgPSB0aGlzLnJvb3RlZCA/IHRoaXMub3duZXJEb2N1bWVudCA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSB0aGlzLmNoaWxkTm9kZXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNoaWxkTm9kZXNbaV0ucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvb3QpIHJvb3QubXV0YXRlUmVtb3ZlKHRoaXMuY2hpbGROb2Rlc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuY2hpbGROb2Rlcy5sZW5ndGggPSAwOyAvLyBGb3JnZXQgYWxsIGNoaWxkcmVuCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RpZnkoKTsgLy8gVXBkYXRlIGxhc3QgbW9kaWZpZWQgdHlwZSBvbmNlIG9ubHkKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIEluc2VydCB0aGlzIG5vZGUgYXMgYSBjaGlsZCBvZiBwYXJlbnQgYXQgdGhlIHNwZWNpZmllZCBpbmRleCwKICAgICAgICAgICAgICAgIC8vIGZpcmluZyBtdXRhdGlvbiBldmVudHMgYXMgbmVjZXNzYXJ5CiAgICAgICAgICAgICAgICBpbnNlcnQ6IGNvbnN0YW50KGZ1bmN0aW9uIGluc2VydChwYXJlbnQsIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAga2lkcyA9IHBhcmVudC5jaGlsZE5vZGVzOwoKICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSBhcmUgYWxyZWFkeSBhIGNoaWxkIG9mIHRoZSBzcGVjaWZpZWQgcGFyZW50LCB0aGVuIHQKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgaW5kZXggbWF5IGhhdmUgdG8gYmUgYWRqdXN0ZWQuCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLnBhcmVudE5vZGUgPT09IHBhcmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudEluZGV4ID0gY2hpbGQuaW5kZXg7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHdlJ3JlIG5vdCBtb3ZpbmcgdGhlIG5vZGUsIHdlJ3JlIGRvbmUgbm93CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWDogb3IgZG8gRE9NIG11dGF0aW9uIGV2ZW50cyBzdGlsbCBoYXZlIHRvIGJlIGZpcmVkPwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEluZGV4ID09PSBpbmRleCkgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkIGlzIGJlZm9yZSB0aGUgc3BvdCBpdCBpcyB0byBiZSBpbnNlcnRlZCBhdCwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlbiB3aGVuIGl0IGlzIHJlbW92ZWQsIHRoZSBpbmRleCBvZiB0aGF0IHNwb3Qgd2lsbCBiZQogICAgICAgICAgICAgICAgICAgICAgICAvLyByZWR1Y2VkLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEluZGV4IDwgaW5kZXgpIGluZGV4LS07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UgZm9yIGRvY3VtZW50IGZyYWdtZW50cwogICAgICAgICAgICAgICAgICAgIC8vIFhYWDogaXQgaXMgbm90IGF0IGFsbCBjbGVhciB0aGF0IEknbSBoYW5kbGluZyB0aGlzIGNvcnJlY3RseS4KICAgICAgICAgICAgICAgICAgICAvLyBTY3JpcHRzIHNob3VsZCBuZXZlciBnZXQgdG8gc2VlIHBhcnRpYWxseQogICAgICAgICAgICAgICAgICAgIC8vIGluc2VydGVkIGZyYWdtZW50cywgSSB0aGluay4gIFNlZToKICAgICAgICAgICAgICAgICAgICAvLyBodHRwOi8vbGlzdHMudzMub3JnL0FyY2hpdmVzL1B1YmxpYy93d3ctZG9tLzIwMTFPY3REZWMvMDEzMC5odG1sCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBET0NVTUVOVF9GUkFHTUVOVF9OT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYyA9IGNoaWxkLmZpcnN0Q2hpbGQpIGMuaW5zZXJ0KHBhcmVudCwgaW5kZXgrKyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIElmIGJvdGggdGhlIGNoaWxkIGFuZCB0aGUgcGFyZW50IGFyZSByb290ZWQsIHRoZW4gd2Ugd2FudCB0bwogICAgICAgICAgICAgICAgICAgIC8vIHRyYW5zcGxhbnQgdGhlIGNoaWxkIHdpdGhvdXQgdXByb290aW5nIGFuZCByZXJvb3RpbmcgaXQuCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLnJvb3RlZCAmJiBwYXJlbnQucm9vdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgY2hpbGQgZnJvbSBpdHMgY3VycmVudCBwb3NpdGlvbiBpbiB0aGUgdHJlZQogICAgICAgICAgICAgICAgICAgICAgICAvLyB3aXRob3V0IGNhbGxpbmcgcmVtb3ZlKCksIHNpbmNlIHdlIGRvbid0IHdhbnQgdG8gdXByb290IGl0LgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycGFyID0gY2hpbGQucGFyZW50Tm9kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cmlkeCA9IGNoaWxkLmluZGV4OwogICAgICAgICAgICAgICAgICAgICAgICBzcGxpY2UoY2hpbGQucGFyZW50Tm9kZS5jaGlsZE5vZGVzLCBjaGlsZC5pbmRleCwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnBhci5tb2RpZnkoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFuZCBpbnNlcnQgaXQgYXMgYSBjaGlsZCBvZiBpdHMgbmV3IHBhcmVudAogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5wYXJlbnROb2RlID0gcGFyZW50OwogICAgICAgICAgICAgICAgICAgICAgICBzcGxpY2Uoa2lkcywgaW5kZXgsIDAsIGNoaWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuX2luZGV4ID0gaW5kZXg7IC8vIE9wdGltaXphdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQubW9kaWZ5KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBhIG1vdmUgbXV0YXRpb24gZXZlbnQKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Lm93bmVyRG9jdW1lbnQubXV0YXRlTW92ZShjaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkIGFscmVhZHkgaGFzIGEgcGFyZW50LCBpdCBuZWVkcyB0byBiZQogICAgICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmVkIGZyb20gdGhhdCBwYXJlbnQsIHdoaWNoIG1heSBhbHNvIHVwcm9vdCBpdAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQucGFyZW50Tm9kZSkgY2hpbGQucmVtb3ZlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3cgaW5zZXJ0IHRoZSBjaGlsZCBpbnRvIHRoZSBwYXJlbnQncyBhcnJheSBvZiBjaGlsZHJlbgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5wYXJlbnROb2RlID0gcGFyZW50OwogICAgICAgICAgICAgICAgICAgICAgICBzcGxpY2Uoa2lkcywgaW5kZXgsIDAsIGNoaWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Lm1vZGlmeSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5faW5kZXggPSBpbmRleDsgLy8gT3B0aW1pemF0aW9uCgogICAgICAgICAgICAgICAgICAgICAgICAvLyBBbmQgcm9vdCB0aGUgY2hpbGQgaWYgbmVjZXNzYXJ5CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQucm9vdGVkKSBwYXJlbnQub3duZXJEb2N1bWVudC5tdXRhdGVJbnNlcnQoY2hpbGQpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gU2NyaXB0IHRhZ3MgdXNlIHRoaXMgaG9vawogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuX2FkZGNoaWxkaG9vaykgcGFyZW50Ll9hZGRjaGlsZGhvb2sodGhpcyk7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIGxhc3RNb2RUaW1lIHZhbHVlIGZvciB0aGlzIG5vZGUuIChGb3IgdXNlIGFzIGEKICAgICAgICAgICAgICAgIC8vIGNhY2hlIGludmFsaWRhdGlvbiBtZWNoYW5pc20uIElmIHRoZSBub2RlIGRvZXMgbm90IGFscmVhZHkKICAgICAgICAgICAgICAgIC8vIGhhdmUgb25lLCBpbml0aWFsaXplIGl0IGZyb20gdGhlIG93bmVyIGRvY3VtZW50J3MgbW9kY2xvY2sKICAgICAgICAgICAgICAgIC8vIHByb3BlcnR5LiAgKE5vdGUgdGhhdCBtb2RjbG9jayBkb2VzIG5vdCByZXR1cm4gdGhlIGFjdHVhbAogICAgICAgICAgICAgICAgLy8gdGltZTsgaXQgaXMgc2ltcGx5IGEgY291bnRlciBpbmNyZW1lbnRlZCBvbiBlYWNoIGRvY3VtZW50CiAgICAgICAgICAgICAgICAvLyBtb2RpZmljYXRpb24pCiAgICAgICAgICAgICAgICBsYXN0TW9kVGltZTogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2xhc3RNb2RUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RNb2RUaW1lID0gdGhpcy5kb2MubW9kY2xvY2s7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbGFzdE1vZFRpbWU7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIG93bmVyIGRvY3VtZW50J3MgbW9kY2xvY2sgYW5kIHVzZSB0aGUgbmV3CiAgICAgICAgICAgICAgICAvLyB2YWx1ZSB0byB1cGRhdGUgdGhlIGxhc3RNb2RUaW1lIHZhbHVlIGZvciB0aGlzIG5vZGUgYW5kCiAgICAgICAgICAgICAgICAvLyBhbGwgb2YgaXRzIGFuY2VzdG9ycy4gIE5vZGVzIHRoYXQgaGF2ZSBuZXZlciBoYWQgdGhlaXIKICAgICAgICAgICAgICAgIC8vIGxhc3RNb2RUaW1lIHZhbHVlIHF1ZXJpZWQgZG8gbm90IG5lZWQgdG8gaGF2ZSBhCiAgICAgICAgICAgICAgICAvLyBsYXN0TW9kVGltZSBwcm9wZXJ0eSBzZXQgb24gdGhlbSBzaW5jZSB0aGVyZSBpcyBubwogICAgICAgICAgICAgICAgLy8gcHJldmlvdXNseSBxdWVyaWVkIHZhbHVlIHRvIGV2ZXIgY29tcGFyZSB0aGUgbmV3IHZhbHVlCiAgICAgICAgICAgICAgICAvLyBhZ2FpbnN0LCBzbyBvbmx5IHVwZGF0ZSBub2RlcyB0aGF0IGFscmVhZHkgaGF2ZSBhCiAgICAgICAgICAgICAgICAvLyBfbGFzdE1vZFRpbWUgcHJvcGVydHkuCiAgICAgICAgICAgICAgICBtb2RpZnk6IGNvbnN0YW50KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdGltZSA9ICsrdGhpcy5kb2MubW9kY2xvY2s7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IHRoaXM7IG47IG4gPSBuLnBhcmVudEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG4uX2xhc3RNb2RUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLl9sYXN0TW9kVGltZSA9IHRpbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBUaGlzIGF0dHJpYnV0ZSBpcyBub3QgcGFydCBvZiB0aGUgRE9NIGJ1dCBpcyBxdWl0ZSBoZWxwZnVsLgogICAgICAgICAgICAgICAgLy8gSXQgcmV0dXJucyB0aGUgZG9jdW1lbnQgd2l0aCB3aGljaCBhIG5vZGUgaXMgYXNzb2NpYXRlZC4gIFVzdWFsbHkKICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgdGhlIG93bmVyRG9jdW1lbnQuIEJ1dCBvd25lckRvY3VtZW50IGlzIG51bGwgZm9yIHRoZQogICAgICAgICAgICAgICAgLy8gZG9jdW1lbnQgb2JqZWN0IGl0c2VsZiwgc28gdGhpcyBpcyBhIGhhbmR5IHdheSB0byBnZXQgdGhlIGRvY3VtZW50CiAgICAgICAgICAgICAgICAvLyByZWdhcmRsZXNzIG9mIHRoZSBub2RlIHR5cGUKICAgICAgICAgICAgICAgIGRvYzogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vd25lckRvY3VtZW50IHx8IHRoaXM7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbm9kZSBoYXMgYSBuaWQgKG5vZGUgaWQpLCB0aGVuIGl0IGlzIHJvb3RlZCBpbiBhIGRvY3VtZW50CiAgICAgICAgICAgICAgICByb290ZWQ6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5fbmlkOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gQ29udmVydCB0aGUgY2hpbGRyZW4gb2YgYSBub2RlIHRvIGFuIEhUTUwgc3RyaW5nLgogICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB1c2VkIGJ5IHRoZSBpbm5lckhUTUwgZ2V0dGVyCiAgICAgICAgICAgICAgICAvLyBUaGUgc2VyaWFsaXphdGlvbiBzcGVjIGlzIGF0OgogICAgICAgICAgICAgICAgLy8gaHR0cDovL3d3dy53aGF0d2cub3JnL3NwZWNzL3dlYi1hcHBzL2N1cnJlbnQtd29yay9tdWx0aXBhZ2UvdGhlLWVuZC5odG1sI3NlcmlhbGl6aW5nLWh0bWwtZnJhZ21lbnRzCiAgICAgICAgICAgICAgICBzZXJpYWxpemU6IGNvbnN0YW50KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcyA9ICIiOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gdGhpcy5jaGlsZE5vZGVzLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIga2lkID0gdGhpcy5jaGlsZE5vZGVzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGtpZC5ub2RlVHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT01NRU5UX05PREU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAiPCEtLSIgKyBraWQuZGF0YSArICItLT4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBQUk9DRVNTSU5HX0lOU1RSVUNUSU9OX05PREU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAiPD8iICsga2lkLnRhcmdldCArICIgIiArIGtpZC5kYXRhICsgIj4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBET0NVTUVOVF9UWVBFX05PREU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAiPCFET0NUWVBFICIgKyBraWQubmFtZSArICI+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEVYVF9OT0RFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDREFUQV9TRUNUSU9OX05PREU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudHRhZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlVHlwZSA9PT0gRUxFTUVOVF9OT0RFICYmIHRoaXMubmFtZXNwYWNlVVJJID09PSBIVE1MX05BTUVTUEFDRSkgcGFyZW50dGFnID0gdGhpcy50YWdOYW1lO2Vsc2UgcGFyZW50dGFnID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChwYXJlbnR0YWcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiU1RZTEUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJTQ1JJUFQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJYTVAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJJRlJBTUUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJOT0VNQkVEIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiTk9GUkFNRVMiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJQTEFJTlRFWFQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJOT1NDUklQVCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9IGtpZC5kYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9IGVzY2FwZShraWQuZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVMRU1FTlRfTk9ERToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVFbGVtZW50KGtpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEludmFsaWRTdGF0ZUVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzOwoKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBzZXJpYWxpemVFbGVtZW50KGtpZCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbCA9IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnbmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChraWQubmFtZXNwYWNlVVJJKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEhUTUxfTkFNRVNQQUNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0bWwgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogZmFsbHRocm91Z2ggKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgU1ZHX05BTUVTUEFDRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTUFUSE1MX05BTUVTUEFDRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWduYW1lID0ga2lkLmxvY2FsTmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnbmFtZSA9IGtpZC50YWdOYW1lOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBzICs9ICc8JyArIHRhZ25hbWU7CgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IGtpZC5fbnVtYXR0cnM7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0ga2lkLl9hdHRyKGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAnICcgKyBhdHRybmFtZShhKSArICc9IicgKyBlc2NhcGVBdHRyKGEudmFsdWUpICsgJyInOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gJz4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWx0YWcgPSBodG1sID8gdGFnbmFtZSA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGh0bWx0YWcpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhcmVhIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJhc2UiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYmFzZWZvbnQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYmdzb3VuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJiciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb2wiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29tbWFuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbWJlZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJmcmFtZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJociI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJpbWciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaW5wdXQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAia2V5Z2VuIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImxpbmsiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibWV0YSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJwYXJhbSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzb3VyY2UiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidHJhY2siOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAid2JyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIFRoZXNlIGNhbid0IGhhdmUga2lkcywgc28gd2UncmUgZG9uZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3ByZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd0ZXh0YXJlYSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdsaXN0aW5nJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzICs9ICJcbiI7IC8vIEV4dHJhIG5ld2xpbmUgZm9yIHRoZXNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBmYWxsdGhyb3VnaCAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXJpYWxpemUgY2hpbGRyZW4gYW5kIGFkZCBlbmQgdGFnIGZvciBhbGwgb3RoZXJzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSBraWQuc2VyaWFsaXplKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcyArPSAiPC8iICsgdGFnbmFtZSArICI+IjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZXNjYXBlKHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMucmVwbGFjZSgvWyY8Plx1MDBBMF0vZywgZnVuY3Rpb24gKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIiYiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiZhbXA7IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICI8IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICImbHQ7IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICI+IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICImZ3Q7IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJcdTAwQTAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiZuYnNwOyI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZXNjYXBlQXR0cihzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzLnJlcGxhY2UoL1smIlx1MDBBMF0vZywgZnVuY3Rpb24gKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJyYnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiZhbXA7IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICciJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICImcXVvdDsiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1x1MDBBMCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiJm5ic3A7IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBhdHRybmFtZShhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYS5uYW1lc3BhY2VVUkkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgbnVsbDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5sb2NhbE5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFhNTF9OQU1FU1BBQ0U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJ4bWw6IiArIGEubG9jYWxOYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBYTElOS19OQU1FU1BBQ0U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJ4bGluazoiICsgYS5sb2NhbE5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFhNTE5TX05BTUVTUEFDRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5sb2NhbE5hbWUgPT09ICJ4bWxucyIpIHJldHVybiAieG1sbnMiO2Vsc2UgcmV0dXJuICJ4bWxuczoiICsgYS5sb2NhbE5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gTm9kZTsKICAgICAgICB9KTsKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICAqICBzcmMvaW1wbC9MZWFmLmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9MZWFmLmpzIgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiTGVhZiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy8gVGhpcyBjbGFzcyBkZWZpbmVzIGNvbW1vbiBmdW5jdGlvbmFsaXR5IGZvciBub2RlIHN1YnR5cGVzIHRoYXQKICAgICAgICAgICAgLy8gY2FuIG5ldmVyIGhhdmUgY2hpbGRyZW4KICAgICAgICAgICAgZnVuY3Rpb24gTGVhZigpIHt9CgogICAgICAgICAgICBMZWFmLnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuTm9kZS5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIGhhc0NoaWxkTm9kZXM6IGNvbnN0YW50KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGZpcnN0Q2hpbGQ6IGNvbnN0YW50KG51bGwpLAogICAgICAgICAgICAgICAgbGFzdENoaWxkOiBjb25zdGFudChudWxsKSwKICAgICAgICAgICAgICAgIGluc2VydEJlZm9yZTogY29uc3RhbnQoSGllcmFyY2h5UmVxdWVzdEVycm9yKSwKICAgICAgICAgICAgICAgIHJlcGxhY2VDaGlsZDogY29uc3RhbnQoSGllcmFyY2h5UmVxdWVzdEVycm9yKSwKICAgICAgICAgICAgICAgIHJlbW92ZUNoaWxkOiBjb25zdGFudChIaWVyYXJjaHlSZXF1ZXN0RXJyb3IpLAogICAgICAgICAgICAgICAgYXBwZW5kQ2hpbGQ6IGNvbnN0YW50KEhpZXJhcmNoeVJlcXVlc3RFcnJvciksCgogICAgICAgICAgICAgICAgLy8gRWFjaCBub2RlIG11c3QgaGF2ZSBpdHMgb3duIHVuaXF1ZSBjaGlsZE5vZGVzIGFycmF5LiAgQnV0CiAgICAgICAgICAgICAgICAvLyBsZWF2ZXMgYWx3YXlzIGhhdmUgYW4gZW1wdHkgYXJyYXksIHNvIGluaXRpYWxpemUgaXQgbGF6aWx5LgogICAgICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkTm9kZXMgcHJvcGVydHkgaXMgcmVhZCwgd2UnbGwgcmV0dXJuIGFuIGFycmF5CiAgICAgICAgICAgICAgICAvLyBhbmQgZGVmaW5lIGEgcmVhZC1vbmx5IHByb3BlcnR5IGRpcmVjdGx5IG9uIHRoZSBvYmplY3QgdGhhdAogICAgICAgICAgICAgICAgLy8gd2lsbCBzaGFkb3cgdGhpcyBvbmUuIEknZCBsaWtlIHRvIGZyZWV6ZSB0aGUgYXJyYXksIHRvbywgc2luY2UKICAgICAgICAgICAgICAgIC8vIGxlYWYgbm9kZXMgY2FuIG5ldmVyIGhhdmUgY2hpbGRyZW4sIGJ1dCBJJ2xsIGVuZCB1cCBoYXZpbmcgdG8gYWRkCiAgICAgICAgICAgICAgICAvLyBhIHByb3BlcnR5IHRvIHJlZmVyIGJhY2sgdG8gdGhlIElETCBOb2RlTGlzdCB3cmFwcGVyLgogICAgICAgICAgICAgICAgY2hpbGROb2RlczogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IFtdOwogICAgICAgICAgICAgICAgICAgIGEuX2lkbE5hbWUgPSAiTm9kZUxpc3QiOwogICAgICAgICAgICAgICAgICAgIE8uZGVmaW5lUHJvcGVydHkodGhpcywgImNoaWxkTm9kZXMiLCBjb25zdGFudChhKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBMZWFmOwogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL0NoYXJhY3RlckRhdGEuanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy9pbXBsL0NoYXJhY3RlckRhdGEuanMiCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJDaGFyYWN0ZXJEYXRhIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBDaGFyYWN0ZXJEYXRhKCkge30KCiAgICAgICAgICAgIENoYXJhY3RlckRhdGEucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5MZWFmLnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJDaGFyYWN0ZXJEYXRhIiksCgogICAgICAgICAgICAgICAgLy8gRE9NU3RyaW5nIHN1YnN0cmluZ0RhdGEodW5zaWduZWQgbG9uZyBvZmZzZXQsCiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBsb25nIGNvdW50KTsKICAgICAgICAgICAgICAgIC8vIFRoZSBzdWJzdHJpbmdEYXRhKG9mZnNldCwgY291bnQpIG1ldGhvZCBtdXN0IHJ1biB0aGVzZSBzdGVwczoKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyAgICAgSWYgb2Zmc2V0IGlzIGdyZWF0ZXIgdGhhbiB0aGUgY29udGV4dCBvYmplY3QncwogICAgICAgICAgICAgICAgLy8gICAgIGxlbmd0aCwgdGhyb3cgYW4gSU5ERVhfU0laRV9FUlIgZXhjZXB0aW9uIGFuZAogICAgICAgICAgICAgICAgLy8gICAgIHRlcm1pbmF0ZSB0aGVzZSBzdGVwcy4KICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyAgICAgSWYgb2Zmc2V0K2NvdW50IGlzIGdyZWF0ZXIgdGhhbiB0aGUgY29udGV4dAogICAgICAgICAgICAgICAgLy8gICAgIG9iamVjdCdzIGxlbmd0aCwgcmV0dXJuIGEgRE9NU3RyaW5nIHdob3NlIHZhbHVlIGlzCiAgICAgICAgICAgICAgICAvLyAgICAgdGhlIFVURi0xNiBjb2RlIHVuaXRzIGZyb20gdGhlIG9mZnNldHRoIFVURi0xNiBjb2RlCiAgICAgICAgICAgICAgICAvLyAgICAgdW5pdCB0byB0aGUgZW5kIG9mIGRhdGEuCiAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gICAgIFJldHVybiBhIERPTVN0cmluZyB3aG9zZSB2YWx1ZSBpcyB0aGUgVVRGLTE2IGNvZGUKICAgICAgICAgICAgICAgIC8vICAgICB1bml0cyBmcm9tIHRoZSBvZmZzZXR0aCBVVEYtMTYgY29kZSB1bml0IHRvIHRoZQogICAgICAgICAgICAgICAgLy8gICAgIG9mZnNldCtjb3VudHRoIFVURi0xNiBjb2RlIHVuaXQgaW4gZGF0YS4KICAgICAgICAgICAgICAgIHN1YnN0cmluZ0RhdGE6IGNvbnN0YW50KGZ1bmN0aW9uIHN1YnN0cmluZ0RhdGEob2Zmc2V0LCBjb3VudCkgewogICAgICAgICAgICAgICAgICAgIGlmIChvZmZzZXQgPiB0aGlzLmRhdGEubGVuZ3RoKSBJbmRleFNpemVFcnJvcigpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdWJzdHJpbmcodGhpcy5kYXRhLCBvZmZzZXQsIG9mZnNldCArIGNvdW50KTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIHZvaWQgYXBwZW5kRGF0YShET01TdHJpbmcgZGF0YSk7CiAgICAgICAgICAgICAgICAvLyBUaGUgYXBwZW5kRGF0YShkYXRhKSBtZXRob2QgbXVzdCBhcHBlbmQgZGF0YSB0byB0aGUgY29udGV4dAogICAgICAgICAgICAgICAgLy8gb2JqZWN0J3MgZGF0YS4KICAgICAgICAgICAgICAgIGFwcGVuZERhdGE6IGNvbnN0YW50KGZ1bmN0aW9uIGFwcGVuZERhdGEoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHRoaXMuZGF0YSArIGRhdGE7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyB2b2lkIGluc2VydERhdGEodW5zaWduZWQgbG9uZyBvZmZzZXQsIERPTVN0cmluZyBkYXRhKTsKICAgICAgICAgICAgICAgIC8vIFRoZSBpbnNlcnREYXRhKG9mZnNldCwgZGF0YSkgbWV0aG9kIG11c3QgcnVuIHRoZXNlIHN0ZXBzOgogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vICAgICBJZiBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIHRoZSBjb250ZXh0IG9iamVjdCdzCiAgICAgICAgICAgICAgICAvLyAgICAgbGVuZ3RoLCB0aHJvdyBhbiBJTkRFWF9TSVpFX0VSUiBleGNlcHRpb24gYW5kCiAgICAgICAgICAgICAgICAvLyAgICAgdGVybWluYXRlIHRoZXNlIHN0ZXBzLgogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vICAgICBJbnNlcnQgZGF0YSBpbnRvIHRoZSBjb250ZXh0IG9iamVjdCdzIGRhdGEgYWZ0ZXIKICAgICAgICAgICAgICAgIC8vICAgICBvZmZzZXQgVVRGLTE2IGNvZGUgdW5pdHMuCiAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgaW5zZXJ0RGF0YTogY29uc3RhbnQoZnVuY3Rpb24gaW5zZXJ0RGF0YShvZmZzZXQsIGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY3VydGV4dCA9IHRoaXMuZGF0YTsKICAgICAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ID4gY3VydGV4dC5sZW5ndGgpIEluZGV4U2l6ZUVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHByZWZpeCA9IHN1YnN0cmluZyhjdXJ0ZXh0LCAwLCBvZmZzZXQpLAogICAgICAgICAgICAgICAgICAgICAgICBzdWZmaXggPSBzdWJzdHJpbmcoY3VydGV4dCwgb2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBwcmVmaXggKyBkYXRhICsgc3VmZml4OwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gdm9pZCBkZWxldGVEYXRhKHVuc2lnbmVkIGxvbmcgb2Zmc2V0LCB1bnNpZ25lZCBsb25nIGNvdW50KTsKICAgICAgICAgICAgICAgIC8vIFRoZSBkZWxldGVEYXRhKG9mZnNldCwgY291bnQpIG1ldGhvZCBtdXN0IHJ1biB0aGVzZSBzdGVwczoKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyAgICAgSWYgb2Zmc2V0IGlzIGdyZWF0ZXIgdGhhbiB0aGUgY29udGV4dCBvYmplY3QncwogICAgICAgICAgICAgICAgLy8gICAgIGxlbmd0aCwgdGhyb3cgYW4gSU5ERVhfU0laRV9FUlIgZXhjZXB0aW9uIGFuZAogICAgICAgICAgICAgICAgLy8gICAgIHRlcm1pbmF0ZSB0aGVzZSBzdGVwcy4KICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyAgICAgSWYgb2Zmc2V0K2NvdW50IGlzIGdyZWF0ZXIgdGhhbiB0aGUgY29udGV4dAogICAgICAgICAgICAgICAgLy8gICAgIG9iamVjdCdzIGxlbmd0aCB2YXIgY291bnQgYmUgbGVuZ3RoLW9mZnNldC4KICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyAgICAgU3RhcnRpbmcgZnJvbSBvZmZzZXQgVVRGLTE2IGNvZGUgdW5pdHMgcmVtb3ZlIGNvdW50CiAgICAgICAgICAgICAgICAvLyAgICAgVVRGLTE2IGNvZGUgdW5pdHMgZnJvbSB0aGUgY29udGV4dCBvYmplY3QncyBkYXRhLgogICAgICAgICAgICAgICAgZGVsZXRlRGF0YTogY29uc3RhbnQoZnVuY3Rpb24gZGVsZXRlRGF0YShvZmZzZXQsIGNvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnRleHQgPSB0aGlzLmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlbiA9IGN1cnRleHQubGVuZ3RoOwoKICAgICAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ID4gbGVuKSBJbmRleFNpemVFcnJvcigpOwoKICAgICAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ICsgY291bnQgPiBsZW4pIGNvdW50ID0gbGVuIC0gb2Zmc2V0OwoKICAgICAgICAgICAgICAgICAgICB2YXIgcHJlZml4ID0gc3Vic3RyaW5nKGN1cnRleHQsIDAsIG9mZnNldCksCiAgICAgICAgICAgICAgICAgICAgICAgIHN1ZmZpeCA9IHN1YnN0cmluZyhjdXJ0ZXh0LCBvZmZzZXQgKyBjb3VudCk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHByZWZpeCArIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIHZvaWQgcmVwbGFjZURhdGEodW5zaWduZWQgbG9uZyBvZmZzZXQsIHVuc2lnbmVkIGxvbmcgY291bnQsCiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgIERPTVN0cmluZyBkYXRhKTsKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBUaGUgcmVwbGFjZURhdGEob2Zmc2V0LCBjb3VudCwgZGF0YSkgbWV0aG9kIG11c3QgYWN0IGFzCiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgZGVsZXRlRGF0YSgpIG1ldGhvZCBpcyBpbnZva2VkIHdpdGggb2Zmc2V0IGFuZAogICAgICAgICAgICAgICAgLy8gY291bnQgYXMgYXJndW1lbnRzIGZvbGxvd2VkIGJ5IHRoZSBpbnNlcnREYXRhKCkgbWV0aG9kCiAgICAgICAgICAgICAgICAvLyB3aXRoIG9mZnNldCBhbmQgZGF0YSBhcyBhcmd1bWVudHMgYW5kIHJlLXRocm93IGFueQogICAgICAgICAgICAgICAgLy8gZXhjZXB0aW9ucyB0aGVzZSBtZXRob2RzIG1pZ2h0IGhhdmUgdGhyb3duLgogICAgICAgICAgICAgICAgcmVwbGFjZURhdGE6IGNvbnN0YW50KGZ1bmN0aW9uIHJlcGxhY2VEYXRhKG9mZnNldCwgY291bnQsIGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY3VydGV4dCA9IHRoaXMuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVuID0gY3VydGV4dC5sZW5ndGg7CgogICAgICAgICAgICAgICAgICAgIGlmIChvZmZzZXQgPiBsZW4pIEluZGV4U2l6ZUVycm9yKCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChvZmZzZXQgKyBjb3VudCA+IGxlbikgY291bnQgPSBsZW4gLSBvZmZzZXQ7CgogICAgICAgICAgICAgICAgICAgIHZhciBwcmVmaXggPSBzdWJzdHJpbmcoY3VydGV4dCwgMCwgb2Zmc2V0KSwKICAgICAgICAgICAgICAgICAgICAgICAgc3VmZml4ID0gc3Vic3RyaW5nKGN1cnRleHQsIG9mZnNldCArIGNvdW50KTsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gcHJlZml4ICsgZGF0YSArIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIFV0aWxpdHkgbWV0aG9kIHRoYXQgTm9kZS5pc0VxdWFsTm9kZSgpIGNhbGxzIHRvIHRlc3QgVGV4dCBhbmQKICAgICAgICAgICAgICAgIC8vIENvbW1lbnQgbm9kZXMgZm9yIGVxdWFsaXR5LiAgSXQgaXMgb2theSB0byBwdXQgaXQgaGVyZSwgc2luY2UKICAgICAgICAgICAgICAgIC8vIE5vZGUgd2lsbCBoYXZlIGFscmVhZHkgdmVyaWZpZWQgdGhhdCBub2RlVHlwZSBpcyBlcXVhbAogICAgICAgICAgICAgICAgaXNFcXVhbDogY29uc3RhbnQoZnVuY3Rpb24gaXNFcXVhbChuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGEgPT09IG4uX2RhdGE7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gQ2hhcmFjdGVyRGF0YTsKICAgICAgICB9KTsKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICAqICBzcmMvaW1wbC9UZXh0LmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9UZXh0LmpzIgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiVGV4dCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gVGV4dChkb2MsIGRhdGEpIHsKICAgICAgICAgICAgICAgIHRoaXMubm9kZVR5cGUgPSBURVhUX05PREU7CiAgICAgICAgICAgICAgICB0aGlzLm93bmVyRG9jdW1lbnQgPSBkb2M7CiAgICAgICAgICAgICAgICB0aGlzLl9kYXRhID0gZGF0YTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG5vZGVWYWx1ZSA9IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0YTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgIGlmICh2ID09PSB0aGlzLl9kYXRhKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9kYXRhID0gdjsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvb3RlZCkgdGhpcy5vd25lckRvY3VtZW50Lm11dGF0ZVZhbHVlKHRoaXMpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50Tm9kZSAmJiB0aGlzLnBhcmVudE5vZGUuX3RleHRjaGFuZ2Vob29rKSB0aGlzLnBhcmVudE5vZGUuX3RleHRjaGFuZ2Vob29rKHRoaXMpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIFRleHQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5DaGFyYWN0ZXJEYXRhLnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJUZXh0IiksCiAgICAgICAgICAgICAgICAvLyAgICAgICAgbm9kZVR5cGU6IGNvbnN0YW50KFRFWFRfTk9ERSksCiAgICAgICAgICAgICAgICBub2RlTmFtZTogY29uc3RhbnQoIiN0ZXh0IiksCiAgICAgICAgICAgICAgICAvLyBUaGVzZSB0aHJlZSBhdHRyaWJ1dGVzIGFyZSBhbGwgdGhlIHNhbWUuCiAgICAgICAgICAgICAgICAvLyBUaGUgZGF0YSBhdHRyaWJ1dGUgaGFzIGEgW1RyZWF0TnVsbEFzPUVtcHR5U3RyaW5nXSBidXQgd2UnbGwKICAgICAgICAgICAgICAgIC8vIGltcGxlbWVudCB0aGF0IGF0IHRoZSBpbnRlcmZhY2UgbGV2ZWwKICAgICAgICAgICAgICAgIG5vZGVWYWx1ZTogbm9kZVZhbHVlLAogICAgICAgICAgICAgICAgdGV4dENvbnRlbnQ6IG5vZGVWYWx1ZSwKICAgICAgICAgICAgICAgIGRhdGE6IG5vZGVWYWx1ZSwKICAgICAgICAgICAgICAgIGxlbmd0aDogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0YS5sZW5ndGg7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICBzcGxpdFRleHQ6IGNvbnN0YW50KGZ1bmN0aW9uIHNwbGl0VGV4dChvZmZzZXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ID4gdGhpcy5fZGF0YS5sZW5ndGgpIEluZGV4U2l6ZUVycm9yKCk7CgogICAgICAgICAgICAgICAgICAgIHZhciBuZXdkYXRhID0gc3Vic3RyaW5nKHRoaXMuX2RhdGEsIG9mZnNldCksCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld25vZGUgPSB0aGlzLm93bmVyRG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobmV3ZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gc3Vic3RyaW5nKHRoaXMuZGF0YSwgMCwgb2Zmc2V0KTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50ICE9PSBudWxsKSBwYXJlbnQuaW5zZXJ0QmVmb3JlKG5ld25vZGUsIHRoaXMubmV4dFNpYmxpbmcpOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3bm9kZTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIFhYWAogICAgICAgICAgICAgICAgLy8gd2hvbGVUZXh0IGFuZCByZXBsYWNlV2hvbGVUZXh0KCkgYXJlIG5vdCBpbXBsZW1lbnRlZCB5ZXQgYmVjYXVzZQogICAgICAgICAgICAgICAgLy8gdGhlIERPTUNvcmUgc3BlY2lmaWNhdGlvbiBpcyBjb25zaWRlcmluZyByZW1vdmluZyBvciBhbHRlcmluZyB0aGVtLgogICAgICAgICAgICAgICAgd2hvbGVUZXh0OiBhdHRyaWJ1dGUobnlpKSwKICAgICAgICAgICAgICAgIHJlcGxhY2VXaG9sZVRleHQ6IGNvbnN0YW50KG55aSksCgogICAgICAgICAgICAgICAgLy8gVXRpbGl0eSBtZXRob2RzCiAgICAgICAgICAgICAgICBjbG9uZTogY29uc3RhbnQoZnVuY3Rpb24gY2xvbmUoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBpbXBsLlRleHQodGhpcy5vd25lckRvY3VtZW50LCB0aGlzLl9kYXRhKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBUZXh0OwogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL0NvbW1lbnQuanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy9pbXBsL0NvbW1lbnQuanMiCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJDb21tZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBDb21tZW50KGRvYywgZGF0YSkgewogICAgICAgICAgICAgICAgdGhpcy5ub2RlVHlwZSA9IENPTU1FTlRfTk9ERTsKICAgICAgICAgICAgICAgIHRoaXMub3duZXJEb2N1bWVudCA9IGRvYzsKICAgICAgICAgICAgICAgIHRoaXMuX2RhdGEgPSBkYXRhOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbm9kZVZhbHVlID0gYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRhOwogICAgICAgICAgICB9LCBmdW5jdGlvbiAodikgewogICAgICAgICAgICAgICAgdGhpcy5fZGF0YSA9IHY7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5yb290ZWQpIHRoaXMub3duZXJEb2N1bWVudC5tdXRhdGVWYWx1ZSh0aGlzKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBDb21tZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuQ2hhcmFjdGVyRGF0YS5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiQ29tbWVudCIpLAogICAgICAgICAgICAgICAgLy8gICAgICAgIG5vZGVUeXBlOiBjb25zdGFudChDT01NRU5UX05PREUpLAogICAgICAgICAgICAgICAgbm9kZU5hbWU6IGNvbnN0YW50KCIjY29tbWVudCIpLAogICAgICAgICAgICAgICAgbm9kZVZhbHVlOiBub2RlVmFsdWUsCiAgICAgICAgICAgICAgICB0ZXh0Q29udGVudDogbm9kZVZhbHVlLAogICAgICAgICAgICAgICAgZGF0YTogbm9kZVZhbHVlLAogICAgICAgICAgICAgICAgbGVuZ3RoOiBhdHRyaWJ1dGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRhLmxlbmd0aDsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIFV0aWxpdHkgbWV0aG9kcwogICAgICAgICAgICAgICAgY2xvbmU6IGNvbnN0YW50KGZ1bmN0aW9uIGNsb25lKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgaW1wbC5Db21tZW50KHRoaXMub3duZXJEb2N1bWVudCwgdGhpcy5fZGF0YSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBDb21tZW50OwogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL1Byb2Nlc3NpbmdJbnN0cnVjdGlvbi5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL2ltcGwvUHJvY2Vzc2luZ0luc3RydWN0aW9uLmpzIgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiUHJvY2Vzc2luZ0luc3RydWN0aW9uIiwgZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgZnVuY3Rpb24gUHJvY2Vzc2luZ0luc3RydWN0aW9uKGRvYywgdGFyZ2V0LCBkYXRhKSB7CiAgICAgICAgICAgICAgICB0aGlzLm5vZGVUeXBlID0gUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFOwogICAgICAgICAgICAgICAgdGhpcy5vd25lckRvY3VtZW50ID0gZG9jOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICAgICAgICB0aGlzLl9kYXRhID0gZGF0YTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG5vZGVWYWx1ZSA9IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0YTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2RhdGEgPSB2OwogICAgICAgICAgICAgICAgaWYgKHRoaXMucm9vdGVkKSB0aGlzLm93bmVyRG9jdW1lbnQubXV0YXRlVmFsdWUodGhpcyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgUHJvY2Vzc2luZ0luc3RydWN0aW9uLnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuTGVhZi5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiUHJvY2Vzc2luZ0luc3RydWN0aW9uIiksCiAgICAgICAgICAgICAgICAvLyAgICAgICAgbm9kZVR5cGU6IGNvbnN0YW50KFBST0NFU1NJTkdfSU5TVFJVQ1RJT05fTk9ERSksCiAgICAgICAgICAgICAgICBub2RlTmFtZTogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50YXJnZXQ7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIG5vZGVWYWx1ZTogbm9kZVZhbHVlLAogICAgICAgICAgICAgICAgdGV4dENvbnRlbnQ6IG5vZGVWYWx1ZSwKICAgICAgICAgICAgICAgIGRhdGE6IG5vZGVWYWx1ZSwKCiAgICAgICAgICAgICAgICAvLyBVdGlsaXR5IG1ldGhvZHMKICAgICAgICAgICAgICAgIGNsb25lOiBjb25zdGFudChmdW5jdGlvbiBjbG9uZSgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGltcGwuUHJvY2Vzc2luZ0luc3RydWN0aW9uKHRoaXMub3duZXJEb2N1bWVudCwgdGhpcy50YXJnZXQsIHRoaXMuX2RhdGEpOwogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBpc0VxdWFsOiBjb25zdGFudChmdW5jdGlvbiBpc0VxdWFsKG4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50YXJnZXQgPT09IG4udGFyZ2V0ICYmIHRoaXMuX2RhdGEgPT09IG4uX2RhdGE7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gUHJvY2Vzc2luZ0luc3RydWN0aW9uOwogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL0VsZW1lbnQuanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy9pbXBsL0VsZW1lbnQuanMiCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBuYW1lc3BhY2VVUkksIHByZWZpeCkgewogICAgICAgICAgICAgICAgdGhpcy5ub2RlVHlwZSA9IEVMRU1FTlRfTk9ERTsKICAgICAgICAgICAgICAgIHRoaXMub3duZXJEb2N1bWVudCA9IGRvYzsKICAgICAgICAgICAgICAgIHRoaXMubG9jYWxOYW1lID0gbG9jYWxOYW1lOwogICAgICAgICAgICAgICAgdGhpcy5uYW1lc3BhY2VVUkkgPSBuYW1lc3BhY2VVUkk7CiAgICAgICAgICAgICAgICB0aGlzLnByZWZpeCA9IHByZWZpeDsKCiAgICAgICAgICAgICAgICB0aGlzLnRhZ05hbWUgPSBwcmVmaXggIT09IG51bGwgPyBwcmVmaXggKyAiOiIgKyBsb2NhbE5hbWUgOiBsb2NhbE5hbWU7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNIVE1MKSB0aGlzLnRhZ05hbWUgPSB0b1VwcGVyQ2FzZSh0aGlzLnRhZ05hbWUpOwoKICAgICAgICAgICAgICAgIHRoaXMuY2hpbGROb2RlcyA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5jaGlsZE5vZGVzLl9pZGxOYW1lID0gIk5vZGVMaXN0IjsKCiAgICAgICAgICAgICAgICAvLyBUaGVzZSBwcm9wZXJ0aWVzIG1haW50YWluIHRoZSBzZXQgb2YgYXR0cmlidXRlcwogICAgICAgICAgICAgICAgdGhpcy5fYXR0cnNCeVFOYW1lID0gT2JqZWN0LmNyZWF0ZShudWxsKTsgLy8gVGhlIHFuYW1lLT5BdHRyIG1hcAogICAgICAgICAgICAgICAgdGhpcy5fYXR0cnNCeUxOYW1lID0gT2JqZWN0LmNyZWF0ZShudWxsKTsgLy8gVGhlIG5zfGxuYW1lLT5BdHRyIG1hcAogICAgICAgICAgICAgICAgdGhpcy5fYXR0cktleXMgPSBbXTsgLy8gYXR0ciBpbmRleCAtPiBuc3xsbmFtZQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiByZWN1cnNpdmVHZXRUZXh0KG5vZGUsIGEpIHsKICAgICAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSBURVhUX05PREUpIHsKICAgICAgICAgICAgICAgICAgICBhLnB1c2gobm9kZS5fZGF0YSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gbm9kZS5jaGlsZE5vZGVzLmxlbmd0aDsgaSA8IG47IGkrKykgcmVjdXJzaXZlR2V0VGV4dChub2RlLmNoaWxkTm9kZXNbaV0sIGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiB0ZXh0Q29udGVudEdldHRlcigpIHsKICAgICAgICAgICAgICAgIHZhciBzdHJpbmdzID0gW107CiAgICAgICAgICAgICAgICByZWN1cnNpdmVHZXRUZXh0KHRoaXMsIHN0cmluZ3MpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZ3Muam9pbigiIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHRleHRDb250ZW50U2V0dGVyKG5ld3RleHQpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRyZW4oKTsKICAgICAgICAgICAgICAgIGlmIChuZXd0ZXh0ICE9PSBudWxsICYmIG5ld3RleHQgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLm93bmVyRG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobmV3dGV4dCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuTm9kZS5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiRWxlbWVudCIpLAogICAgICAgICAgICAgICAgLy8gICAgICAgIG5vZGVUeXBlOiBjb25zdGFudChFTEVNRU5UX05PREUpLAogICAgICAgICAgICAgICAgbm9kZU5hbWU6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudGFnTmFtZTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgbm9kZVZhbHVlOiBhdHRyaWJ1dGUoZm51bGwsIGZub29wKSwKICAgICAgICAgICAgICAgIHRleHRDb250ZW50OiBhdHRyaWJ1dGUodGV4dENvbnRlbnRHZXR0ZXIsIHRleHRDb250ZW50U2V0dGVyKSwKCiAgICAgICAgICAgICAgICBjaGlsZHJlbjogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2NoaWxkcmVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoaWxkcmVuID0gbmV3IENoaWxkcmVuQ29sbGVjdGlvbih0aGlzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2F0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXR0cmlidXRlcyA9IG5ldyBBdHRyaWJ1dGVzQXJyYXkodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hdHRyaWJ1dGVzOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgZmlyc3RFbGVtZW50Q2hpbGQ6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGtpZHMgPSB0aGlzLmNoaWxkTm9kZXM7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBraWRzLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2lkc1tpXS5ub2RlVHlwZSA9PT0gRUxFTUVOVF9OT0RFKSByZXR1cm4ga2lkc1tpXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICBsYXN0RWxlbWVudENoaWxkOiBhdHRyaWJ1dGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBraWRzID0gdGhpcy5jaGlsZE5vZGVzOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBraWRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChraWRzW2ldLm5vZGVUeXBlID09PSBFTEVNRU5UX05PREUpIHJldHVybiBraWRzW2ldOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIG5leHRFbGVtZW50U2libGluZzogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzaWJzID0gdGhpcy5wYXJlbnROb2RlLmNoaWxkTm9kZXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmluZGV4ICsgMSwgbiA9IHNpYnMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2lic1tpXS5ub2RlVHlwZSA9PT0gRUxFTUVOVF9OT0RFKSByZXR1cm4gc2lic1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIHByZXZpb3VzRWxlbWVudFNpYmxpbmc6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50Tm9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2licyA9IHRoaXMucGFyZW50Tm9kZS5jaGlsZE5vZGVzOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5pbmRleCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2lic1tpXS5ub2RlVHlwZSA9PT0gRUxFTUVOVF9OT0RFKSByZXR1cm4gc2lic1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIGNoaWxkRWxlbWVudENvdW50OiBhdHRyaWJ1dGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuLmxlbmd0aDsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIFJldHVybiB0aGUgbmV4dCBlbGVtZW50LCBpbiBzb3VyY2Ugb3JkZXIsIGFmdGVyIHRoaXMgb25lIG9yCiAgICAgICAgICAgICAgICAvLyBudWxsIGlmIHRoZXJlIGFyZSBubyBtb3JlLiAgSWYgcm9vdCBlbGVtZW50IGlzIHNwZWNpZmllZCwKICAgICAgICAgICAgICAgIC8vIHRoZW4gZG9uJ3QgdHJhdmVyc2UgYmV5b25kIGl0cyBzdWJ0cmVlLgogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgbm90IGEgRE9NIG1ldGhvZCwgYnV0IGlzIGNvbnZlbmllbnQgZm9yCiAgICAgICAgICAgICAgICAvLyBsYXp5IHRyYXZlcnNhbHMgb2YgdGhlIHRyZWUuCiAgICAgICAgICAgICAgICBuZXh0RWxlbWVudDogY29uc3RhbnQoZnVuY3Rpb24gKHJvb3QpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dCA9IHRoaXMuZmlyc3RFbGVtZW50Q2hpbGQgfHwgdGhpcy5uZXh0RWxlbWVudFNpYmxpbmc7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHQpIHJldHVybiBuZXh0OwoKICAgICAgICAgICAgICAgICAgICBpZiAoIXJvb3QpIHJvb3QgPSB0aGlzLm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoKICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSBjYW4ndCBnbyBkb3duIG9yIGFjcm9zcywgdGhlbiB3ZSBoYXZlIHRvIGdvIHVwCiAgICAgICAgICAgICAgICAgICAgLy8gYW5kIGFjcm9zcyB0byB0aGUgcGFyZW50IHNpYmxpbmcgb3IgYW5vdGhlciBhbmNlc3RvcidzCiAgICAgICAgICAgICAgICAgICAgLy8gc2libGluZy4gIEJlIGNhcmVmdWwsIHRob3VnaDogaWYgd2UgcmVhY2ggdGhlIHJvb3QKICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50LCBvciBpZiB3ZSByZWFjaCB0aGUgZG9jdW1lbnRFbGVtZW50LCB0aGVuCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHRyYXZlcnNhbCBlbmRzLgogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHBhcmVudCA9IHRoaXMucGFyZW50RWxlbWVudDsgcGFyZW50ICYmIHBhcmVudCAhPT0gcm9vdDsgcGFyZW50ID0gcGFyZW50LnBhcmVudEVsZW1lbnQpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgPSBwYXJlbnQubmV4dEVsZW1lbnRTaWJsaW5nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV4dCkgcmV0dXJuIG5leHQ7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIEp1c3QgY29weSB0aGlzIG1ldGhvZCBmcm9tIHRoZSBEb2N1bWVudCBwcm90b3R5cGUKICAgICAgICAgICAgICAgIGdldEVsZW1lbnRzQnlUYWdOYW1lOiBjb25zdGFudChpbXBsLkRvY3VtZW50LnByb3RvdHlwZS5nZXRFbGVtZW50c0J5VGFnTmFtZSksCgogICAgICAgICAgICAgICAgZ2V0RWxlbWVudHNCeVRhZ05hbWVOUzogY29uc3RhbnQoaW1wbC5Eb2N1bWVudC5wcm90b3R5cGUuZ2V0RWxlbWVudHNCeVRhZ05hbWVOUyksCgogICAgICAgICAgICAgICAgZ2V0RWxlbWVudHNCeUNsYXNzTmFtZTogY29uc3RhbnQoaW1wbC5Eb2N1bWVudC5wcm90b3R5cGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSksCgogICAgICAgICAgICAgICAgLy8gVXRpbGl0eSBtZXRob2RzIHVzZWQgYnkgdGhlIHB1YmxpYyBBUEkgbWV0aG9kcyBhYm92ZQoKICAgICAgICAgICAgICAgIGlzSFRNTDogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lc3BhY2VVUkkgPT09IEhUTUxfTkFNRVNQQUNFICYmIHRoaXMub3duZXJEb2N1bWVudC5pc0hUTUw7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICBjbG9uZTogY29uc3RhbnQoZnVuY3Rpb24gY2xvbmUoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGU7CgogICAgICAgICAgICAgICAgICAgIC8vIFhYWDoKICAgICAgICAgICAgICAgICAgICAvLyBNb2RpZnkgdGhpcyB0byB1c2UgdGhlIGNvbnN0cnVjdG9yIGRpcmVjdGx5IG9yCiAgICAgICAgICAgICAgICAgICAgLy8gYXZvaWQgZXJyb3IgY2hlY2tpbmcgaW4gc29tZSBvdGhlciB3YXkuIEluIGNhc2Ugd2UgdHJ5CiAgICAgICAgICAgICAgICAgICAgLy8gdG8gY2xvbmUgYW4gaW52YWxpZCBub2RlIHRoYXQgdGhlIHBhcnNlciBpbnNlcnRlZC4KICAgICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm5hbWVzcGFjZVVSSSAhPT0gSFRNTF9OQU1FU1BBQ0UgfHwgdGhpcy5wcmVmaXgpIGUgPSB0aGlzLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHRoaXMubmFtZXNwYWNlVVJJLCB0aGlzLnRhZ05hbWUpO2Vsc2UgZSA9IHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KHRoaXMubG9jYWxOYW1lKTsKCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSB0aGlzLl9udW1hdHRyczsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuX2F0dHIoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVzZSBfIHZlcnNpb24gb2YgdGhlIGZ1bmN0aW9uIHRvIGF2b2lkIGVycm9yIGNoZWNraW5nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluIGNhc2Ugd2UncmUgY2xvbmluZyBhbiBhdHRyaWJ1dGUgdGhhdCBpcyBpbnZhbGlkIGJ1dAogICAgICAgICAgICAgICAgICAgICAgICAvLyB3YXMgaW5zZXJ0ZWQgYnkgdGhlIHBhcnNlci4KICAgICAgICAgICAgICAgICAgICAgICAgZS5fc2V0QXR0cmlidXRlTlMoYS5uYW1lc3BhY2VVUkksIGEubmFtZSwgYS52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIGlzRXF1YWw6IGNvbnN0YW50KGZ1bmN0aW9uIGlzRXF1YWwodGhhdCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvY2FsTmFtZSAhPT0gdGhhdC5sb2NhbE5hbWUgfHwgdGhpcy5uYW1lc3BhY2VVUkkgIT09IHRoYXQubmFtZXNwYWNlVVJJIHx8IHRoaXMucHJlZml4ICE9PSB0aGF0LnByZWZpeCB8fCB0aGlzLl9udW1hdHRycyAhPT0gdGhhdC5fbnVtYXR0cnMpIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgLy8gQ29tcGFyZSB0aGUgc2V0cyBvZiBhdHRyaWJ1dGVzLCBpZ25vcmluZyBvcmRlcgogICAgICAgICAgICAgICAgICAgIC8vIGFuZCBpZ25vcmluZyBhdHRyaWJ1dGUgcHJlZml4ZXMuCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSB0aGlzLl9udW1hdHRyczsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuX2F0dHIoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhhdC5oYXNBdHRyaWJ1dGVOUyhhLm5hbWVzcGFjZVVSSSwgYS5sb2NhbE5hbWUpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmdldEF0dHJpYnV0ZU5TKGEubmFtZXNwYWNlVVJJLCBhLmxvY2FsTmFtZSkgIT09IGEudmFsdWUpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgImxvY2F0ZSBhIG5hbWVzcGFjZSBwcmVmaXgiIGFsZ29yaXRobSBmcm9tIHRoZQogICAgICAgICAgICAgICAgLy8gRE9NQ29yZSBzcGVjaWZpY2F0aW9uLiAgSXQgaXMgdXNlZCBieSBOb2RlLmxvb2t1cFByZWZpeCgpCiAgICAgICAgICAgICAgICBsb2NhdGVOYW1lc3BhY2VQcmVmaXg6IGNvbnN0YW50KGZ1bmN0aW9uIGxvY2F0ZU5hbWVzcGFjZVByZWZpeChucykgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm5hbWVzcGFjZVVSSSA9PT0gbnMgJiYgdGhpcy5wcmVmaXggIT09IG51bGwpIHJldHVybiB0aGlzLnByZWZpeDsKCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSB0aGlzLl9udW1hdHRyczsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuX2F0dHIoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnByZWZpeCA9PT0gInhtbG5zIiAmJiBhLnZhbHVlID09PSBucykgcmV0dXJuIGEubG9jYWxOYW1lOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMucGFyZW50RWxlbWVudDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50ID8gcGFyZW50LmxvY2F0ZU5hbWVzcGFjZVByZWZpeChucykgOiBudWxsOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgImxvY2F0ZSBhIG5hbWVzcGFjZSIgYWxnb3JpdGhtIGZvciBFbGVtZW50IG5vZGVzCiAgICAgICAgICAgICAgICAvLyBmcm9tIHRoZSBET00gQ29yZSBzcGVjLiAgSXQgaXMgdXNlZCBieSBOb2RlLmxvb2t1cE5hbWVzcGFjZVVSSQogICAgICAgICAgICAgICAgbG9jYXRlTmFtZXNwYWNlOiBjb25zdGFudChmdW5jdGlvbiBsb2NhdGVOYW1lc3BhY2UocHJlZml4KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJlZml4ID09PSBwcmVmaXggJiYgdGhpcy5uYW1lc3BhY2VVUkkgIT09IG51bGwpIHJldHVybiB0aGlzLm5hbWVzcGFjZVVSSTsKCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSB0aGlzLl9udW1hdHRyczsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuX2F0dHIoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnByZWZpeCA9PT0gInhtbG5zIiAmJiBhLmxvY2FsTmFtZSA9PT0gcHJlZml4IHx8IGEucHJlZml4ID09PSBudWxsICYmIGEubG9jYWxOYW1lID09PSAieG1sbnMiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS52YWx1ZSB8fCBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5wYXJlbnRFbGVtZW50OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnQgPyBwYXJlbnQubG9jYXRlTmFtZXNwYWNlKHByZWZpeCkgOiBudWxsOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vIEF0dHJpYnV0ZSBoYW5kbGluZyBtZXRob2RzIGFuZCB1dGlsaXRpZXMKICAgICAgICAgICAgICAgIC8vCgogICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAqIEF0dHJpYnV0ZXMgaW4gdGhlIERPTSBhcmUgdHJpY2t5OgogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIC0gdGhlcmUgYXJlIHRoZSA4IGJhc2ljIGdldC9zZXQvaGFzL3JlbW92ZUF0dHJpYnV0ZXtOU30gbWV0aG9kcwogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIC0gYnV0IG1hbnkgSFRNTCBhdHRyaWJ1dGVzIGFyZSBhbHNvICJyZWZsZWN0ZWQiIHRocm91Z2ggSURMCiAgICAgICAgICAgICAgICAgKiAgIGF0dHJpYnV0ZXMgd2hpY2ggbWVhbnMgdGhhdCB0aGV5IGNhbiBiZSBxdWVyaWVkIGFuZCBzZXQgdGhyb3VnaAogICAgICAgICAgICAgICAgICogICByZWd1bGFyIHByb3BlcnRpZXMgb2YgdGhlIGVsZW1lbnQuICBUaGVyZSBpcyBqdXN0IG9uZSBhdHRyaWJ1dGUKICAgICAgICAgICAgICAgICAqICAgdmFsdWUsIGJ1dCB0d28gd2F5cyB0byBnZXQgYW5kIHNldCBpdC4KICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgKiAtIERpZmZlcmVudCBIVE1MIGVsZW1lbnQgdHlwZXMgaGF2ZSBkaWZmZXJlbnQgc2V0cyBvZiByZWZsZWN0ZWQKICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlcy4KICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgKiAtIGF0dHJpYnV0ZXMgY2FuIGFsc28gYmUgcXVlcmllZCBhbmQgc2V0IHRocm91Z2ggdGhlIC5hdHRyaWJ1dGVzCiAgICAgICAgICAgICAgICAgKiAgIHByb3BlcnR5IG9mIGFuIGVsZW1lbnQuICBUaGlzIHByb3BlcnR5IGJlaGF2ZXMgbGlrZSBhbiBhcnJheSBvZgogICAgICAgICAgICAgICAgICogICBBdHRyIG9iamVjdHMuICBUaGUgdmFsdWUgcHJvcGVydHkgb2YgZWFjaCBBdHRyIGlzIHdyaXRlYWJsZSwgc28KICAgICAgICAgICAgICAgICAqICAgdGhpcyBpcyBhIHRoaXJkIHdheSB0byByZWFkIGFuZCB3cml0ZSBhdHRyaWJ1dGVzLgogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIC0gZm9yIGVmZmljaWVuY3ksIHdlIHJlYWxseSB3YW50IHRvIHN0b3JlIGF0dHJpYnV0ZXMgaW4gc29tZSBraW5kCiAgICAgICAgICAgICAgICAgKiAgIG9mIG5hbWUtPmF0dHIgbWFwLiAgQnV0IHRoZSBhdHRyaWJ1dGVzW10gYXJyYXkgaXMgYW4gYXJyYXksIG5vdCBhCiAgICAgICAgICAgICAgICAgKiAgIG1hcCwgd2hpY2ggaXMga2luZCBvZiB1bm5hdHVyYWwuCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogLSBXaGVuIHVzaW5nIG5hbWVzcGFjZXMgYW5kIHByZWZpeGVzLCBhbmQgbWl4aW5nIHRoZSBOUyBtZXRob2RzCiAgICAgICAgICAgICAgICAgKiAgIHdpdGggdGhlIG5vbi1OUyBtZXRob2RzLCBpdCBpcyBhcHBhcmVudGx5IGFjdHVhbGx5IHBvc3NpYmxlIGZvcgogICAgICAgICAgICAgICAgICogICBhbiBhdHRyaWJ1dGVzW10gYXJyYXkgdG8gaGF2ZSBtb3JlIHRoYW4gb25lIGF0dHJpYnV0ZSB3aXRoIHRoZQogICAgICAgICAgICAgICAgICogICBzYW1lIHF1YWxpZmllZCBuYW1lLiAgQW5kIGNlcnRhaW4gbWV0aG9kcyBtdXN0IG9wZXJhdGUgb24gb25seQogICAgICAgICAgICAgICAgICogICB0aGUgZmlyc3QgYXR0cmlidXRlIHdpdGggc3VjaCBhIG5hbWUuICBTbyBmb3IgdGhlc2UgbWV0aG9kcywgYW4KICAgICAgICAgICAgICAgICAqICAgaW5lZmZpY2llbnQgYXJyYXktbGlrZSBkYXRhIHN0cnVjdHVyZSB3b3VsZCBiZSBlYXNpZXIgdG8KICAgICAgICAgICAgICAgICAqICAgaW1wbGVtZW50LgogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIC0gVGhlIGF0dHJpYnV0ZXNbXSBhcnJheSBpcyBsaXZlLCBub3QgYSBzbmFwc2hvdCwgc28gY2hhbmdlcyB0byB0aGUKICAgICAgICAgICAgICAgICAqICAgYXR0cmlidXRlcyBtdXN0IGJlIGltbWVkaWF0ZWx5IHZpc2libGUgdGhyb3VnaCBleGlzdGluZyBhcnJheXMuCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogLSBXaGVuIGF0dHJpYnV0ZXMgYXJlIHF1ZXJpZWQgYW5kIHNldCB0aHJvdWdoIElETCBwcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgKiAgIChpbnN0ZWFkIG9mIHRoZSBnZXQvc2V0QXR0cmlidXRlcygpIG1ldGhvZCBvciB0aGUgYXR0cmlidXRlc1tdCiAgICAgICAgICAgICAgICAgKiAgIGFycmF5KSB0aGV5IG1heSBiZSBzdWJqZWN0IHRvIHR5cGUgY29udmVyc2lvbnMsIFVSTAogICAgICAgICAgICAgICAgICogICBub3JtYWxpemF0aW9uLCBldGMuLCBzbyBzb21lIGV4dHJhIHByb2Nlc3NpbmcgaXMgcmVxdWlyZWQgaW4gdGhhdAogICAgICAgICAgICAgICAgICogICBjYXNlLgogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIC0gQnV0IGFjY2VzcyB0aHJvdWdoIElETCBwcm9wZXJ0aWVzIGlzIHByb2JhYmx5IHRoZSBtb3N0IGNvbW1vbgogICAgICAgICAgICAgICAgICogICBjYXNlLCBzbyB3ZSdkIGxpa2UgdGhhdCB0byBiZSBhcyBmYXN0IGFzIHBvc3NpYmxlLgogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIC0gV2UgY2FuJ3QganVzdCBzdG9yZSBhdHRyaWJ1dGUgdmFsdWVzIGluIHRoZWlyIHBhcnNlZCBpZGwgZm9ybSwKICAgICAgICAgICAgICAgICAqICAgYmVjYXVzZSBzZXRBdHRyaWJ1dGUoKSBoYXMgdG8gcmV0dXJuIHdoYXRldmVyIHN0cmluZyBpcyBwYXNzZWQgdG8KICAgICAgICAgICAgICAgICAqICAgZ2V0QXR0cmlidXRlIGV2ZW4gaWYgaXQgaXMgbm90IGEgbGVnYWwsIHBhcnNlYWJsZSB2YWx1ZS4gU28KICAgICAgICAgICAgICAgICAqICAgYXR0cmlidXRlIHZhbHVlcyBtdXN0IGJlIHN0b3JlZCBpbiB1bnBhcnNlZCBzdHJpbmcgZm9ybS4KICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgKiAtIFdlIG5lZWQgdG8gYmUgYWJsZSB0byBzZW5kIGNoYW5nZSBub3RpZmljYXRpb25zIG9yIG11dGF0aW9uCiAgICAgICAgICAgICAgICAgKiAgIGV2ZW50cyBvZiBzb21lIHNvcnQgdG8gdGhlIHJlbmRlcmVyIHdoZW5ldmVyIGFuIGF0dHJpYnV0ZSB2YWx1ZQogICAgICAgICAgICAgICAgICogICBjaGFuZ2VzLCByZWdhcmRsZXNzIG9mIHRoZSB3YXkgaW4gd2hpY2ggaXQgY2hhbmdlcy4KICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgKiAtIFNvbWUgYXR0cmlidXRlcywgc3VjaCBhcyBpZCBhbmQgY2xhc3MgYWZmZWN0IG90aGVyIHBhcnRzIG9mIHRoZQogICAgICAgICAgICAgICAgICogICBET00gQVBJLCBsaWtlIGdldEVsZW1lbnRCeUlkIGFuZCBnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIGFuZCBzbwogICAgICAgICAgICAgICAgICogICBmb3IgZWZmaWNpZW5jeSwgd2UgbmVlZCB0byBzcGVjaWFsbHkgdHJhY2sgY2hhbmdlcyB0byB0aGVzZQogICAgICAgICAgICAgICAgICogICBzcGVjaWFsIGF0dHJpYnV0ZXMuCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogLSBTb21lIGF0dHJpYnV0ZXMgbGlrZSBjbGFzcyBoYXZlIGRpZmZlcmVudCBuYW1lcyAoY2xhc3NOYW1lKSB3aGVuCiAgICAgICAgICAgICAgICAgKiAgIHJlZmxlY3RlZC4KICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgKiAtIEF0dHJpYnV0ZXMgd2hvc2UgbmFtZXMgYmVnaW4gd2l0aCB0aGUgc3RyaW5nICJkYXRhLSIgYXJlIHRyZWF0ZWQKICAgICAgICAgICAgICAgICAgICAgc3BlY2lhbGx5LgogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIC0gUmVmbGVjdGVkIGF0dHJpYnV0ZXMgdGhhdCBoYXZlIGEgYm9vbGVhbiB0eXBlIGluIElETCBoYXZlIHNwZWNpYWwKICAgICAgICAgICAgICAgICAqICAgYmVoYXZpb3I6IHNldHRpbmcgdGhlbSB0byBmYWxzZSAoaW4gSURMKSBpcyB0aGUgc2FtZSBhcyByZW1vdmluZwogICAgICAgICAgICAgICAgICogICB0aGVtIHdpdGggcmVtb3ZlQXR0cmlidXRlKCkKICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgKiAtIG51bWVyaWMgYXR0cmlidXRlcyAobGlrZSBIVE1MRWxlbWVudC50YWJJbmRleCkgY2FuIGhhdmUgZGVmYXVsdAogICAgICAgICAgICAgICAgICogICB2YWx1ZXMgdGhhdCBtdXN0IGJlIHJldHVybmVkIGJ5IHRoZSBpZGwgZ2V0dGVyIGV2ZW4gaWYgdGhlCiAgICAgICAgICAgICAgICAgKiAgIGNvbnRlbnQgYXR0cmlidXRlIGRvZXMgbm90IGV4aXN0LiAoVGhlIGRlZmF1bHQgdGFiSW5kZXggdmFsdWUKICAgICAgICAgICAgICAgICAqICAgYWN0dWFsbHkgdmFyaWVzIGJhc2VkIG9uIHRoZSB0eXBlIG9mIHRoZSBlbGVtZW50LCBzbyB0aGF0IGlzIGEKICAgICAgICAgICAgICAgICAqICAgdHJpY2t5IG9uZSkuCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogU2VlCiAgICAgICAgICAgICAgICAgKiBodHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrL211bHRpcGFnZS91cmxzLmh0bWwjcmVmbGVjdAogICAgICAgICAgICAgICAgICogZm9yIHJ1bGVzIG9uIGhvdyBhdHRyaWJ1dGVzIGFyZSByZWZsZWN0ZWQuCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgZ2V0QXR0cmlidXRlOiBjb25zdGFudChmdW5jdGlvbiBnZXRBdHRyaWJ1dGUocW5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0hUTUwpIHFuYW1lID0gdG9Mb3dlckNhc2UocW5hbWUpOwogICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0cnNCeVFOYW1lW3FuYW1lXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWF0dHIpIHJldHVybiBudWxsOwoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNBcnJheShhdHRyKSkgLy8gSWYgdGhlcmUgaXMgbW9yZSB0aGFuIG9uZQogICAgICAgICAgICAgICAgICAgICAgICBhdHRyID0gYXR0clswXTsgLy8gdXNlIHRoZSBmaXJzdAoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXR0ci52YWx1ZTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIGdldEF0dHJpYnV0ZU5TOiBjb25zdGFudChmdW5jdGlvbiBnZXRBdHRyaWJ1dGVOUyhucywgbG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IHRoaXMuX2F0dHJzQnlMTmFtZVtucyArICJ8IiArIGxuYW1lXTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXR0ciA/IGF0dHIudmFsdWUgOiBudWxsOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgaGFzQXR0cmlidXRlOiBjb25zdGFudChmdW5jdGlvbiBoYXNBdHRyaWJ1dGUocW5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0hUTUwpIHFuYW1lID0gdG9Mb3dlckNhc2UocW5hbWUpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBxbmFtZSBpbiB0aGlzLl9hdHRyc0J5UU5hbWU7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICBoYXNBdHRyaWJ1dGVOUzogY29uc3RhbnQoZnVuY3Rpb24gaGFzQXR0cmlidXRlTlMobnMsIGxuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IG5zICsgInwiICsgbG5hbWU7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleSBpbiB0aGlzLl9hdHRyc0J5TE5hbWU7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGF0dHJpYnV0ZSB3aXRob3V0IGVycm9yIGNoZWNraW5nLiBUaGUgcGFyc2VyIHVzZXMgdGhpcy4KICAgICAgICAgICAgICAgIF9zZXRBdHRyaWJ1dGU6IGNvbnN0YW50KGZ1bmN0aW9uIF9zZXRBdHRyaWJ1dGUocW5hbWUsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiB0aGUgc3BlYyBzYXlzIHRoYXQgdGhpcyBuZXh0IHNlYXJjaCBzaG91bGQgYmUgZG9uZQogICAgICAgICAgICAgICAgICAgIC8vIG9uIHRoZSBsb2NhbCBuYW1lLCBidXQgSSB0aGluayB0aGF0IGlzIGFuIGVycm9yLgogICAgICAgICAgICAgICAgICAgIC8vIGVtYWlsIHBlbmRpbmcgb24gd3d3LWRvbSBhYm91dCBpdC4KICAgICAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IHRoaXMuX2F0dHJzQnlRTmFtZVtxbmFtZV07CiAgICAgICAgICAgICAgICAgICAgdmFyIGlzbmV3OwogICAgICAgICAgICAgICAgICAgIGlmICghYXR0cikgewogICAgICAgICAgICAgICAgICAgICAgICBhdHRyID0gdGhpcy5fbmV3YXR0cihxbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlzbmV3ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNBcnJheShhdHRyKSkgYXR0ciA9IGF0dHJbMF07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBOb3cgc2V0IHRoZSBhdHRyaWJ1dGUgdmFsdWUgb24gdGhlIG5ldyBvciBleGlzdGluZyBBdHRyIG9iamVjdC4KICAgICAgICAgICAgICAgICAgICAvLyBUaGUgQXR0ci52YWx1ZSBzZXR0ZXIgbWV0aG9kIGhhbmRsZXMgbXV0YXRpb24gZXZlbnRzLCBldGMuCiAgICAgICAgICAgICAgICAgICAgYXR0ci52YWx1ZSA9IHZhbHVlOwoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNuZXcgJiYgdGhpcy5fbmV3YXR0cmhvb2spIHRoaXMuX25ld2F0dHJob29rKHFuYW1lLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgZXJyb3JzLCBhbmQgdGhlbiBzZXQgdGhlIGF0dHJpYnV0ZQogICAgICAgICAgICAgICAgc2V0QXR0cmlidXRlOiBjb25zdGFudChmdW5jdGlvbiBzZXRBdHRyaWJ1dGUocW5hbWUsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF4bWwuaXNWYWxpZE5hbWUocW5hbWUpKSBJbnZhbGlkQ2hhcmFjdGVyRXJyb3IoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0hUTUwpIHFuYW1lID0gdG9Mb3dlckNhc2UocW5hbWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChzdWJzdHJpbmcocW5hbWUsIDAsIDUpID09PSAieG1sbnMiKSBOYW1lc3BhY2VFcnJvcigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldEF0dHJpYnV0ZShxbmFtZSwgdmFsdWUpOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gVGhlIHZlcnNpb24gd2l0aCBubyBlcnJvciBjaGVja2luZyB1c2VkIGJ5IHRoZSBwYXJzZXIKICAgICAgICAgICAgICAgIF9zZXRBdHRyaWJ1dGVOUzogY29uc3RhbnQoZnVuY3Rpb24gX3NldEF0dHJpYnV0ZU5TKG5zLCBxbmFtZSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gUy5pbmRleE9mKHFuYW1lLCAiOiIpLAogICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXgsCiAgICAgICAgICAgICAgICAgICAgICAgIGxuYW1lOwogICAgICAgICAgICAgICAgICAgIGlmIChwb3MgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByZWZpeCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIGxuYW1lID0gcW5hbWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJlZml4ID0gc3Vic3RyaW5nKHFuYW1lLCAwLCBwb3MpOwogICAgICAgICAgICAgICAgICAgICAgICBsbmFtZSA9IHN1YnN0cmluZyhxbmFtZSwgcG9zICsgMSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gbnMgKyAifCIgKyBsbmFtZTsKICAgICAgICAgICAgICAgICAgICBpZiAobnMgPT09ICIiKSBucyA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0cnNCeUxOYW1lW2tleV07CiAgICAgICAgICAgICAgICAgICAgdmFyIGlzbmV3OwogICAgICAgICAgICAgICAgICAgIGlmICghYXR0cikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IG5ldyBBdHRyKHRoaXMsIGxuYW1lLCBwcmVmaXgsIG5zKTsKICAgICAgICAgICAgICAgICAgICAgICAgaXNuZXcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdHRyc0J5TE5hbWVba2V5XSA9IGF0dHI7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2F0dHJLZXlzID0gTy5rZXlzKHRoaXMuX2F0dHJzQnlMTmFtZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBhbHNvIGhhdmUgdG8gbWFrZSB0aGUgYXR0ciBzZWFyY2hhYmxlIGJ5IHFuYW1lLgogICAgICAgICAgICAgICAgICAgICAgICAvLyBCdXQgd2UgaGF2ZSB0byBiZSBjYXJlZnVsIGJlY2F1c2UgdGhlcmUgbWF5IGFscmVhZHkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmUgYW4gYXR0ciB3aXRoIHRoaXMgcW5hbWUuCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FkZFFOYW1lKGF0dHIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhbGxpbmcgc2V0QXR0cmlidXRlTlMoKSBjYW4gY2hhbmdlIHRoZSBwcmVmaXggb2YgYW4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhpc3RpbmcgYXR0cmlidXRlIQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0ci5wcmVmaXggIT09IHByZWZpeCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVW5iaW5kIHRoZSBvbGQgcW5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZVFOYW1lKGF0dHIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBwcmVmaXgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHIucHJlZml4ID0gcHJlZml4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQmluZCB0aGUgbmV3IHFuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hZGRRTmFtZShhdHRyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhdHRyLnZhbHVlID0gdmFsdWU7IC8vIEF1dG9tYXRpY2FsbHkgc2VuZHMgbXV0YXRpb24gZXZlbnQKICAgICAgICAgICAgICAgICAgICBpZiAoaXNuZXcgJiYgdGhpcy5fbmV3YXR0cmhvb2spIHRoaXMuX25ld2F0dHJob29rKHFuYW1lLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBEbyBlcnJvciBjaGVja2luZyB0aGVuIGNhbGwgX3NldEF0dHJpYnV0ZU5TCiAgICAgICAgICAgICAgICBzZXRBdHRyaWJ1dGVOUzogY29uc3RhbnQoZnVuY3Rpb24gc2V0QXR0cmlidXRlTlMobnMsIHFuYW1lLCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmICgheG1sLmlzVmFsaWROYW1lKHFuYW1lKSkgSW52YWxpZENoYXJhY3RlckVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF4bWwuaXNWYWxpZFFOYW1lKHFuYW1lKSkgTmFtZXNwYWNlRXJyb3IoKTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIHBvcyA9IFMuaW5kZXhPZihxbmFtZSwgIjoiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgcHJlZml4ID0gcG9zID09PSAtMSA/IG51bGwgOiBzdWJzdHJpbmcocW5hbWUsIDAsIHBvcyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5zID09PSAiIikgbnMgPSBudWxsOwoKICAgICAgICAgICAgICAgICAgICBpZiAocHJlZml4ICE9PSBudWxsICYmIG5zID09PSBudWxsIHx8IHByZWZpeCA9PT0gInhtbCIgJiYgbnMgIT09IFhNTF9OQU1FU1BBQ0UgfHwgKHFuYW1lID09PSAieG1sbnMiIHx8IHByZWZpeCA9PT0gInhtbG5zIikgJiYgbnMgIT09IFhNTE5TX05BTUVTUEFDRSB8fCBucyA9PT0gWE1MTlNfTkFNRVNQQUNFICYmICEocW5hbWUgPT09ICJ4bWxucyIgfHwgcHJlZml4ID09PSAieG1sbnMiKSkgTmFtZXNwYWNlRXJyb3IoKTsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0QXR0cmlidXRlTlMobnMsIHFuYW1lLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICByZW1vdmVBdHRyaWJ1dGU6IGNvbnN0YW50KGZ1bmN0aW9uIHJlbW92ZUF0dHJpYnV0ZShxbmFtZSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzSFRNTCkgcW5hbWUgPSB0b0xvd2VyQ2FzZShxbmFtZSk7CgogICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0cnNCeVFOYW1lW3FuYW1lXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWF0dHIpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgbW9yZSB0aGFuIG9uZSBtYXRjaCBmb3IgdGhpcyBxbmFtZQogICAgICAgICAgICAgICAgICAgIC8vIHNvIGRvbid0IGRlbGV0ZSB0aGUgcW5hbWUgbWFwcGluZywganVzdCByZW1vdmUgdGhlIGZpcnN0CiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCBmcm9tIGl0LgogICAgICAgICAgICAgICAgICAgIGlmIChpc0FycmF5KGF0dHIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdHRyLmxlbmd0aCA+IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHIgPSBBLnNoaWZ0KGF0dHIpOyAvLyByZW1vdmUgaXQgZnJvbSB0aGUgYXJyYXkKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2F0dHJzQnlRTmFtZVtxbmFtZV0gPSBhdHRyWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0ciA9IGF0dHJbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IGEgc2luZ2xlIG1hdGNoLCBzbyByZW1vdmUgdGhlIHFuYW1lIG1hcHBpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2F0dHJzQnlRTmFtZVtxbmFtZV07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBOb3cgYXR0ciBpcyB0aGUgcmVtb3ZlZCBhdHRyaWJ1dGUuICBGaWd1cmUgb3V0IGl0cwogICAgICAgICAgICAgICAgICAgIC8vIG5zK2xuYW1lIGtleSBhbmQgcmVtb3ZlIGl0IGZyb20gdGhlIG90aGVyIG1hcHBpbmcgYXMgd2VsbC4KICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gKGF0dHIubmFtZXNwYWNlVVJJIHx8ICIiKSArICJ8IiArIGF0dHIubG9jYWxOYW1lOwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9hdHRyc0J5TE5hbWVba2V5XTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdHRyS2V5cyA9IE8ua2V5cyh0aGlzLl9hdHRyc0J5TE5hbWUpOwoKICAgICAgICAgICAgICAgICAgICAvLyBPbmNoYW5nZSBoYW5kbGVyIGZvciB0aGUgYXR0cmlidXRlCiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHIub25jaGFuZ2UpIGF0dHIub25jaGFuZ2UodGhpcywgYXR0ci5sb2NhbE5hbWUsIGF0dHIudmFsdWUsIG51bGwpOwoKICAgICAgICAgICAgICAgICAgICAvLyBNdXRhdGlvbiBldmVudAogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvb3RlZCkgdGhpcy5vd25lckRvY3VtZW50Lm11dGF0ZVJlbW92ZUF0dHIoYXR0cik7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICByZW1vdmVBdHRyaWJ1dGVOUzogY29uc3RhbnQoZnVuY3Rpb24gcmVtb3ZlQXR0cmlidXRlTlMobnMsIGxuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IChucyB8fCAiIikgKyAifCIgKyBsbmFtZTsKICAgICAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IHRoaXMuX2F0dHJzQnlMTmFtZVtrZXldOwogICAgICAgICAgICAgICAgICAgIGlmICghYXR0cikgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fYXR0cnNCeUxOYW1lW2tleV07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXR0cktleXMgPSBPLmtleXModGhpcy5fYXR0cnNCeUxOYW1lKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gTm93IGZpbmQgdGhlIHNhbWUgQXR0ciBvYmplY3QgaW4gdGhlIHFuYW1lIG1hcHBpbmcgYW5kIHJlbW92ZSBpdAogICAgICAgICAgICAgICAgICAgIC8vIEJ1dCBiZSBjYXJlZnVsIGJlY2F1c2UgdGhlcmUgbWF5IGJlIG1vcmUgdGhhbiBvbmUgbWF0Y2guCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlUU5hbWUoYXR0cik7CgogICAgICAgICAgICAgICAgICAgIC8vIE9uY2hhbmdlIGhhbmRsZXIgZm9yIHRoZSBhdHRyaWJ1dGUKICAgICAgICAgICAgICAgICAgICBpZiAoYXR0ci5vbmNoYW5nZSkgYXR0ci5vbmNoYW5nZSh0aGlzLCBhdHRyLmxvY2FsTmFtZSwgYXR0ci52YWx1ZSwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgLy8gTXV0YXRpb24gZXZlbnQKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yb290ZWQpIHRoaXMub3duZXJEb2N1bWVudC5tdXRhdGVSZW1vdmVBdHRyKGF0dHIpOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gVGhpcyAicmF3IiB2ZXJzaW9uIG9mIGdldEF0dHJpYnV0ZSBpcyB1c2VkIGJ5IHRoZSBnZXR0ZXIgZnVuY3Rpb25zCiAgICAgICAgICAgICAgICAvLyBvZiByZWZsZWN0ZWQgYXR0cmlidXRlcy4gSXQgc2tpcHMgc29tZSBlcnJvciBjaGVja2luZyBhbmQKICAgICAgICAgICAgICAgIC8vIG5hbWVzcGFjZSBzdGVwcwogICAgICAgICAgICAgICAgX2dldGF0dHI6IGNvbnN0YW50KGZ1bmN0aW9uIF9nZXRhdHRyKHFuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQXNzdW1lIHRoYXQgcW5hbWUgaXMgYWxyZWFkeSBsb3dlcmNhc2VkLCBzbyBkb24ndCBkbyBpdCBoZXJlLgogICAgICAgICAgICAgICAgICAgIC8vIEFsc28gZG9uJ3QgY2hlY2sgd2hldGhlciBhdHRyIGlzIGFuIGFycmF5OiBhIHFuYW1lIHdpdGggbm8KICAgICAgICAgICAgICAgICAgICAvLyBwcmVmaXggd2lsbCBuZXZlciBoYXZlIHR3byBtYXRjaGluZyBBdHRyIG9iamVjdHMgKGJlY2F1c2UKICAgICAgICAgICAgICAgICAgICAvLyBzZXRBdHRyaWJ1dGVOUyBkb2Vzbid0IGFsbG93IGEgbm9uLW51bGwgbmFtZXNwYWNlIHdpdGggYQogICAgICAgICAgICAgICAgICAgIC8vIG51bGwgcHJlZml4LgogICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0cnNCeVFOYW1lW3FuYW1lXTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXR0ciA/IGF0dHIudmFsdWUgOiBudWxsOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gVGhlIHJhdyB2ZXJzaW9uIG9mIHNldEF0dHJpYnV0ZSBmb3IgcmVmbGVjdGVkIGlkbCBhdHRyaWJ1dGVzLgogICAgICAgICAgICAgICAgX3NldGF0dHI6IGNvbnN0YW50KGZ1bmN0aW9uIF9zZXRhdHRyKHFuYW1lLCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gdGhpcy5fYXR0cnNCeVFOYW1lW3FuYW1lXTsKICAgICAgICAgICAgICAgICAgICB2YXIgaXNuZXc7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFhdHRyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHIgPSB0aGlzLl9uZXdhdHRyKHFuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgaXNuZXcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhdHRyLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzbmV3ICYmIHRoaXMuX25ld2F0dHJob29rKSB0aGlzLl9uZXdhdHRyaG9vayhxbmFtZSwgdmFsdWUpOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IEF0dHIgb2JqZWN0LCBpbnNlcnQgaXQsIGFuZCByZXR1cm4gaXQuCiAgICAgICAgICAgICAgICAvLyBVc2VkIGJ5IHNldEF0dHJpYnV0ZSgpIGFuZCBieSBzZXQoKQogICAgICAgICAgICAgICAgX25ld2F0dHI6IGNvbnN0YW50KGZ1bmN0aW9uIF9uZXdhdHRyKHFuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHIgPSBuZXcgQXR0cih0aGlzLCBxbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXR0cnNCeVFOYW1lW3FuYW1lXSA9IGF0dHI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXR0cnNCeUxOYW1lWyJ8IiArIHFuYW1lXSA9IGF0dHI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXR0cktleXMgPSBPLmtleXModGhpcy5fYXR0cnNCeUxOYW1lKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXR0cjsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIEFkZCBhIHFuYW1lLT5BdHRyIG1hcHBpbmcgdG8gdGhlIF9hdHRyc0J5UU5hbWUgb2JqZWN0LCB0YWtpbmcgaW50bwogICAgICAgICAgICAgICAgLy8gYWNjb3VudCB0aGF0IHRoZXJlIG1heSBiZSBtb3JlIHRoYW4gb25lIGF0dHIgb2JqZWN0IHdpdGggdGhlCiAgICAgICAgICAgICAgICAvLyBzYW1lIHFuYW1lCiAgICAgICAgICAgICAgICBfYWRkUU5hbWU6IGNvbnN0YW50KGZ1bmN0aW9uIChhdHRyKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHFuYW1lID0gYXR0ci5uYW1lOwogICAgICAgICAgICAgICAgICAgIHZhciBleGlzdGluZyA9IHRoaXMuX2F0dHJzQnlRTmFtZVtxbmFtZV07CiAgICAgICAgICAgICAgICAgICAgaWYgKCFleGlzdGluZykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdHRyc0J5UU5hbWVbcW5hbWVdID0gYXR0cjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzQXJyYXkoZXhpc3RpbmcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1c2goZXhpc3RpbmcsIGF0dHIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2F0dHJzQnlRTmFtZVtxbmFtZV0gPSBbZXhpc3RpbmcsIGF0dHJdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBhIHFuYW1lLT5BdHRyIG1hcHBpbmcgdG8gdGhlIF9hdHRyc0J5UU5hbWUgb2JqZWN0LCB0YWtpbmcgaW50bwogICAgICAgICAgICAgICAgLy8gYWNjb3VudCB0aGF0IHRoZXJlIG1heSBiZSBtb3JlIHRoYW4gb25lIGF0dHIgb2JqZWN0IHdpdGggdGhlCiAgICAgICAgICAgICAgICAvLyBzYW1lIHFuYW1lCiAgICAgICAgICAgICAgICBfcmVtb3ZlUU5hbWU6IGNvbnN0YW50KGZ1bmN0aW9uIChhdHRyKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHFuYW1lID0gYXR0ci5uYW1lOwogICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLl9hdHRyc0J5UU5hbWVbcW5hbWVdOwoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNBcnJheSh0YXJnZXQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSBBLmluZGV4T2YodGFyZ2V0LCBhdHRyKTsKICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXJ0KGlkeCAhPT0gLTEpOyAvLyBJdCBtdXN0IGJlIGhlcmUgc29tZXdoZXJlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdHRyc0J5UU5hbWVbcW5hbWVdID0gdGFyZ2V0WzEgLSBpZHhdOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BsaWNlKHRhcmdldCwgaWR4LCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydCh0YXJnZXQgPT09IGF0dHIpOyAvLyBJZiBvbmx5IG9uZSwgaXQgbXVzdCBtYXRjaAogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fYXR0cnNCeVFOYW1lW3FuYW1lXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIG51bWJlciBvZiBhdHRyaWJ1dGVzCiAgICAgICAgICAgICAgICBfbnVtYXR0cnM6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2F0dHJLZXlzLmxlbmd0aDsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBudGggQXR0ciBvYmplY3QKICAgICAgICAgICAgICAgIF9hdHRyOiBjb25zdGFudChmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hdHRyc0J5TE5hbWVbdGhpcy5fYXR0cktleXNbbl1dOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBBIHV0aWxpdHkgZnVuY3Rpb24gdXNlZCBieSB0aG9zZSBiZWxvdwogICAgICAgICAgICBmdW5jdGlvbiBkZWZpbmVBdHRyaWJ1dGUoYywgaWRsbmFtZSwgZ2V0dGVyLCBzZXR0ZXIpIHsKICAgICAgICAgICAgICAgIC8vIEkgZG9uJ3QgdGhpbmsgd2Ugc2hvdWxkIGV2ZXIgb3ZlcnJpZGUgYW4gZXhpc3RpbmcgYXR0cmlidXRlCiAgICAgICAgICAgICAgICBhc3NlcnQoIShpZGxuYW1lIGluIGMucHJvdG90eXBlKSwgIlJlZGVjbGFyZWQgYXR0cmlidXRlICIgKyBpZGxuYW1lKTsKICAgICAgICAgICAgICAgIE8uZGVmaW5lUHJvcGVydHkoYy5wcm90b3R5cGUsIGlkbG5hbWUsIHsgZ2V0OiBnZXR0ZXIsIHNldDogc2V0dGVyIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBUaGlzIGlzIGEgdXRpbGl0eSBmdW5jdGlvbiBmb3Igc2V0dGluZyB1cCByZWZsZWN0ZWQgYXR0cmlidXRlcy4KICAgICAgICAgICAgLy8gUGFzcyBhbiBlbGVtZW50IGltcGwgY2xhc3MgbGlrZSBpbXBsLkhUTUxFbGVtZW50IGFzIHRoZSBmaXJzdAogICAgICAgICAgICAvLyBhcmd1bWVudC4gIFBhc3MgdGhlIGNvbnRlbnQgYXR0cmlidXRlIG5hbWUgYXMgdGhlIHNlY29uZCBhcmd1bWVudC4KICAgICAgICAgICAgLy8gQW5kIHBhc3MgdGhlIGlkbCBhdHRyaWJ1dGUgbmFtZSBhcyB0aGUgdGhpcmQsIGlmIGl0IGlzIGRpZmZlcmVudC4KICAgICAgICAgICAgRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlID0gZnVuY3Rpb24gKGMsIG5hbWUsIGlkbG5hbWUpIHsKICAgICAgICAgICAgICAgIGRlZmluZUF0dHJpYnV0ZShjLCBpZGxuYW1lIHx8IG5hbWUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0YXR0cihuYW1lKSB8fCAiIjsKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh2KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0YXR0cihuYW1lLCB2KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gRGVmaW5lIGFuIGlkbCBhdHRyaWJ1dGUgdGhhdCByZWZsZWN0cyBhbiBlbnVtZXJhdGVkIGNvbnRlbnQKICAgICAgICAgICAgLy8gYXR0cmlidXRlLiAgVGhpcyBpcyBmb3IgYXR0cmlidXRlcyB0aGF0IHRoZSBIVE1MIHNwZWMgZGVzY3JpYmVzIGFzCiAgICAgICAgICAgIC8vICJsaW1pdGVkIHRvIG9ubHkga25vd24gdmFsdWVzIi4gIGxlZ2FsdmFscyBzaG91bGQgYmUgYW4gYXJyYXkgdGhhdAogICAgICAgICAgICAvLyBtYXBzIHRoZSBsb3dlcmNhc2VkIHZlcnNpb25zIG9mIGFsbG93ZWQgZW51bWVyYXRlZCB2YWx1ZXMgdG8gdGhlCiAgICAgICAgICAgIC8vIGNhbm9uaWNhbCB2YWx1ZSB0aGF0IGl0IHNob3VsZCBjb252ZXJ0IHRvLiBVc3VhbGx5IHRoZSBuYW1lIGFuZAogICAgICAgICAgICAvLyB2YWx1ZSBvZiBtb3N0IHByb3BlcnRpZXMgaW4gdGhlIG9iamVjdCB3aWxsIGJlIHRoZSBzYW1lLgogICAgICAgICAgICBFbGVtZW50LnJlZmxlY3RFbnVtZXJhdGVkQXR0cmlidXRlID0gZnVuY3Rpb24gKGMsIG5hbWUsIGlkbG5hbWUsIGxlZ2FsdmFscywgbWlzc2luZ19kZWZhdWx0LCBpbnZhbGlkX2RlZmF1bHQpIHsKICAgICAgICAgICAgICAgIGRlZmluZUF0dHJpYnV0ZShjLCBpZGxuYW1lIHx8IG5hbWUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IHRoaXMuX2dldGF0dHIobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHYgPT09IG51bGwpIHJldHVybiBtaXNzaW5nX2RlZmF1bHQgfHwgIiI7CgogICAgICAgICAgICAgICAgICAgIHYgPSBsZWdhbHZhbHNbdi50b0xvd2VyQ2FzZSgpXTsKICAgICAgICAgICAgICAgICAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSByZXR1cm4gdjsKICAgICAgICAgICAgICAgICAgICBpZiAoaW52YWxpZF9kZWZhdWx0ICE9PSB1bmRlZmluZWQpIHJldHVybiBpbnZhbGlkX2RlZmF1bHQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1pc3NpbmdfZGVmYXVsdCAhPT0gdW5kZWZpbmVkKSByZXR1cm4gbWlzc2luZ19kZWZhdWx0OwogICAgICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh2KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0YXR0cihuYW1lLCB2KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgRWxlbWVudC5yZWZsZWN0Qm9vbGVhbkF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChjLCBuYW1lLCBpZGxuYW1lKSB7CiAgICAgICAgICAgICAgICBkZWZpbmVBdHRyaWJ1dGUoYywgaWRsbmFtZSB8fCBuYW1lLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFzQXR0cmlidXRlKG5hbWUpOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRhdHRyKG5hbWUsICIiKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUF0dHJpYnV0ZShuYW1lKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIFNlZSBodHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrLyNyZWZsZWN0CiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIGRlZnZhbCBpcyB0aGUgZGVmYXVsdCB2YWx1ZS4gSWYgaXQgaXMgYSBmdW5jdGlvbiwgdGhlbiB0aGF0IGZ1bmN0aW9uCiAgICAgICAgICAgIC8vIHdpbGwgYmUgaW52b2tlZCBhcyBhIG1ldGhvZCBvZiB0aGUgZWxlbWVudCB0byBvYnRhaW4gdGhlIGRlZmF1bHQuCiAgICAgICAgICAgIC8vIElmIG5vIGRlZmF1bHQgaXMgc3BlY2lmaWVkIGZvciBhIGdpdmVuIGF0dHJpYnV0ZSwgdGhlbiB0aGUgZGVmYXVsdAogICAgICAgICAgICAvLyBkZXBlbmRzIG9uIHRoZSB0eXBlIG9mIHRoZSBhdHRyaWJ1dGUsIGJ1dCBzaW5jZSB0aGlzIGZ1bmN0aW9uIGhhbmRsZXMKICAgICAgICAgICAgLy8gNCBpbnRlZ2VyIGNhc2VzLCB5b3UgbXVzdCBzcGVjaWZ5IHRoZSBkZWZhdWx0IHZhbHVlIGluIGVhY2ggY2FsbAogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBtaW4gYW5kIG1heCBkZWZpbmUgYSB2YWxpZCByYW5nZSBmb3IgZ2V0dGluZyB0aGUgYXR0cmlidXRlLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBzZXRtaW4gZGVmaW5lcyBhIG1pbmltdW0gdmFsdWUgd2hlbiBzZXR0aW5nLiAgSWYgdGhlIHZhbHVlIGlzIGxlc3MKICAgICAgICAgICAgLy8gdGhhbiB0aGF0LCB0aGVuIHRocm93IElOREVYX1NJWkVfRVJSLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBDb252ZW5pZW50bHksIEphdmFTY3JpcHQncyBwYXJzZUludCBmdW5jdGlvbiBhcHBlYXJzIHRvIGJlCiAgICAgICAgICAgIC8vIGNvbXBhdGlibGUgd2l0aCBIVE1MJ3MgInJ1bGVzIGZvciBwYXJzaW5nIGludGVnZXJzIgogICAgICAgICAgICBFbGVtZW50LnJlZmxlY3RJbnRlZ2VyQXR0cmlidXRlID0gZnVuY3Rpb24gKGMsIG5hbWUsIGRlZnZhbCwgaWRsbmFtZSwgbWluLCBtYXgsIHNldG1pbikgewogICAgICAgICAgICAgICAgdmFyIGdldHRlciwgc2V0dGVyOwoKICAgICAgICAgICAgICAgIGlmIChtaW4gIT0gbnVsbCB8fCBtYXggIT0gbnVsbCB8fCB0eXBlb2YgZGVmdmFsID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgZ2V0dGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IHRoaXMuX2dldGF0dHIobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gcGFyc2VJbnQodiwgMTApOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4obikgfHwgbWluICE9IG51bGwgJiYgbiA8IG1pbiB8fCBtYXggIT0gbnVsbCAmJiBuID4gbWF4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBkZWZ2YWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdmdW5jdGlvbic6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZ2YWwuY2FsbCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmdmFsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydChmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGdldHRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSB0aGlzLl9nZXRhdHRyKG5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBQbGVhc2FudGx5LCBKYXZhU2NyaXB0J3MgcGFyc2VJbnQgZnVuY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXMgY29tcGF0aWJsZSB3aXRoIEhUTUwncyAicnVsZXMgZm9yIHBhcnNpbmcKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW50ZWdlcnMiCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gcGFyc2VJbnQodiwgMTApOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNOYU4obikgPyBkZWZ2YWwgOiBuOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHNldG1pbiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0dGVyID0gZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYgPCBzZXRtaW4pIEluZGV4U2l6ZUVycm9yKG5hbWUgKyAiIHNldCB0byAiICsgdik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldGF0dHIobmFtZSwgU3RyaW5nKHYpKTsKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZXR0ZXIgPSBmdW5jdGlvbiAodikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRhdHRyKG5hbWUsIFN0cmluZyh2KSk7CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkZWZpbmVBdHRyaWJ1dGUoYywgaWRsbmFtZSB8fCBuYW1lLCBnZXR0ZXIsIHNldHRlcik7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBFbGVtZW50LnJlZmxlY3RGbG9hdEF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChjLCBuYW1lLCBkZWZ2YWwsIGlkbG5hbWUpIHsKICAgICAgICAgICAgICAgIGRlZmluZUF0dHJpYnV0ZShjLCBpZGxuYW1lIHx8IG5hbWUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IHRoaXMuX2dldGF0dHIobmFtZSksCiAgICAgICAgICAgICAgICAgICAgICAgIHg7CiAgICAgICAgICAgICAgICAgICAgaWYgKHMpIHggPSBwYXJzZUZsb2F0KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHggJiYgaXNGaW5pdGUoeCkgPyB4IDogZGVmdmFsOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRhdHRyKG5hbWUsIFN0cmluZyh2KSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIEVsZW1lbnQucmVmbGVjdFBvc2l0aXZlRmxvYXRBdHRyaWJ1dGUgPSBmdW5jdGlvbiAoYywgbmFtZSwgZGVmdmFsLCBpZGxuYW1lKSB7CiAgICAgICAgICAgICAgICBkZWZpbmVBdHRyaWJ1dGUoYywgaWRsbmFtZSB8fCBuYW1lLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSB0aGlzLl9nZXRhdHRyKG5hbWUpLAogICAgICAgICAgICAgICAgICAgICAgICB4OwogICAgICAgICAgICAgICAgICAgIGlmIChzKSB4ID0gcGFyc2VGbG9hdChzKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4geCAmJiBpc0Zpbml0ZSh4KSAmJiB4ID4gMCA/IHggOiBkZWZ2YWw7CiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAodikgewogICAgICAgICAgICAgICAgICAgIGlmICh2IDwgMCkgcmV0dXJuOyAvLyBJZ25vcmUgbmVnYXRpdmUgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0YXR0cihuYW1lLCBTdHJpbmcodikpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBUaGlzIGlzIGEgdXRpbGl0eSBmdW5jdGlvbiBmb3Igc2V0dGluZyB1cCBjaGFuZ2UgaGFuZGxlciBmdW5jdGlvbnMKICAgICAgICAgICAgLy8gZm9yIGF0dHJpYnV0ZXMgbGlrZSAnaWQnIHRoYXQgcmVxdWlyZSBzcGVjaWFsIGhhbmRsaW5nIHdoZW4gdGhleSBjaGFuZ2UuCiAgICAgICAgICAgIEVsZW1lbnQucmVnaXN0ZXJBdHRyaWJ1dGVDaGFuZ2VIYW5kbGVyID0gZnVuY3Rpb24gKGMsIG5hbWUsIGhhbmRsZXIpIHsKICAgICAgICAgICAgICAgIHZhciBwID0gYy5wcm90b3R5cGU7CgogICAgICAgICAgICAgICAgLy8gSWYgcCBkb2VzIG5vdCBhbHJlYWR5IGhhdmUgaXRzIG93biBfYXR0cmlidXRlQ2hhbmdlSGFuZGxlcnMKICAgICAgICAgICAgICAgIC8vIHRoZW4gY3JlYXRlIG9uZSBmb3IgaXQsIGluaGVyaXRpbmcgZnJvbSB0aGUgaW5oZXJpdGVkCiAgICAgICAgICAgICAgICAvLyBfYXR0cmlidXRlQ2hhbmdlSGFuZGxlcnMuIEF0IHRoZSB0b3AgKGZvciB0aGUgaW1wbC5FbGVtZW50CiAgICAgICAgICAgICAgICAvLyBjbGFzcykgdGhlIF9hdHRyaWJ1dGVDaGFuZ2VIYW5kbGVycyBvYmplY3Qgd2lsbCBiZSBjcmVhdGVkCiAgICAgICAgICAgICAgICAvLyB3aXRoIGEgbnVsbCBwcm90b3R5cGUuCiAgICAgICAgICAgICAgICBpZiAoIWhhc093blByb3BlcnR5KHAsICJfYXR0cmlidXRlQ2hhbmdlSGFuZGxlcnMiKSkgewogICAgICAgICAgICAgICAgICAgIHAuX2F0dHJpYnV0ZUNoYW5nZUhhbmRsZXJzID0gT2JqZWN0LmNyZWF0ZShwLl9hdHRyaWJ1dGVDaGFuZ2VIYW5kbGVycyB8fCBudWxsKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBUaGVyZSBjYW4gb25seSBiZSBvbmUKICAgICAgICAgICAgICAgIC8vIFhYWDogSSd2ZSBjb21tZW50ZWQgb3V0IHRoaXMgYXNzZXJ0aW9uLiAgQWN0dWFsbHksIEhUTUxCb2R5RWxlbWVudAogICAgICAgICAgICAgICAgLy8gd2FudHMgdG8gb3ZlcnJpZGUgdGhlIGF0dHJpYnV0ZSBjaGFuZ2UgaGFuZGxlcnMgZm9yIGNlcnRhaW4KICAgICAgICAgICAgICAgIC8vIGV2ZW50IGhhbmRsZXIgYXR0cmlidXRlcyBpdCBpbmhlcml0cyBmcm9tIEhUTUxFbGVtZW50Li4uCiAgICAgICAgICAgICAgICAvLyBhc3NlcnQoIShuYW1lIGluIHAuX2F0dHJpYnV0ZUNoYW5nZUhhbmRsZXJzKSk7CgogICAgICAgICAgICAgICAgcC5fYXR0cmlidXRlQ2hhbmdlSGFuZGxlcnNbbmFtZV0gPSBoYW5kbGVyOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gUmVnaXN0ZXIgc3BlY2lhbCBoYW5kbGluZyBmb3IgdGhlIGlkIGF0dHJpYnV0ZQogICAgICAgICAgICBFbGVtZW50LnJlZ2lzdGVyQXR0cmlidXRlQ2hhbmdlSGFuZGxlcihFbGVtZW50LCAiaWQiLCBmdW5jdGlvbiAoZWxlbWVudCwgbG5hbWUsIG9sZHZhbCwgbmV3dmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5yb290ZWQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob2xkdmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQub3duZXJEb2N1bWVudC5kZWxJZChvbGR2YWwsIGVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAobmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQub3duZXJEb2N1bWVudC5hZGRJZChuZXd2YWwsIGVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBEZWZpbmUgZ2V0dGVycyBhbmQgc2V0dGVycyBmb3IgYW4gImlkIiBwcm9wZXJ0eSB0aGF0IHJlZmxlY3RzCiAgICAgICAgICAgIC8vIHRoZSBjb250ZW50IGF0dHJpYnV0ZSAiaWQiLgogICAgICAgICAgICBFbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoRWxlbWVudCwgImlkIik7CgogICAgICAgICAgICAvLyBEZWZpbmUgZ2V0dGVycyBhbmQgc2V0dGVycyBmb3IgYSAiY2xhc3NOYW1lIiBwcm9wZXJ0eSB0aGF0IHJlZmxlY3RzCiAgICAgICAgICAgIC8vIHRoZSBjb250ZW50IGF0dHJpYnV0ZSAiY2xhc3MiLgogICAgICAgICAgICBFbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoRWxlbWVudCwgImNsYXNzIiwgImNsYXNzTmFtZSIpOwoKICAgICAgICAgICAgLy8gVGhlIEF0dHIgY2xhc3MgcmVwcmVzZW50cyBhIHNpbmdsZSBhdHRyaWJ1dGUuICBUaGUgdmFsdWVzIGluCiAgICAgICAgICAgIC8vIF9hdHRyc0J5UU5hbWUgYW5kIF9hdHRyc0J5TE5hbWUgYXJlIGluc3RhbmNlcyBvZiB0aGlzIGNsYXNzLgogICAgICAgICAgICBmdW5jdGlvbiBBdHRyKGVsdCwgbG5hbWUsIHByZWZpeCwgbmFtZXNwYWNlKSB7CiAgICAgICAgICAgICAgICAvLyBBbHdheXMgcmVtZW1iZXIgd2hhdCBlbGVtZW50IHdlJ3JlIGFzc29jaWF0ZWQgd2l0aC4KICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdGhpcyB0byBwcm9wZXJ0eSBoYW5kbGUgbXV0YXRpb25zCiAgICAgICAgICAgICAgICB0aGlzLm93bmVyRWxlbWVudCA9IGVsdDsKCiAgICAgICAgICAgICAgICBpZiAoIW5hbWVzcGFjZSAmJiAhcHJlZml4ICYmIGxuYW1lIGluIGVsdC5fYXR0cmlidXRlQ2hhbmdlSGFuZGxlcnMpIHRoaXMub25jaGFuZ2UgPSBlbHQuX2F0dHJpYnV0ZUNoYW5nZUhhbmRsZXJzW2xuYW1lXTsKCiAgICAgICAgICAgICAgICAvLyBsb2NhbE5hbWUgYW5kIG5hbWVzcGFjZSBhcmUgY29uc3RhbnQgZm9yIGFueSBhdHRyIG9iamVjdC4KICAgICAgICAgICAgICAgIC8vIEJ1dCB2YWx1ZSBtYXkgY2hhbmdlLiAgQW5kIHNvIGNhbiBwcmVmaXgsIGFuZCBzbywgdGhlcmVmb3JlIGNhbiBuYW1lLgogICAgICAgICAgICAgICAgdGhpcy5sb2NhbE5hbWUgPSBsbmFtZTsKICAgICAgICAgICAgICAgIHRoaXMucHJlZml4ID0gcHJlZml4IHx8IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLm5hbWVzcGFjZVVSSSA9IG5hbWVzcGFjZSB8fCBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBBdHRyLnByb3RvdHlwZSA9IHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiAiQXR0ciIsCiAgICAgICAgICAgICAgICBnZXQgbmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wcmVmaXggPyB0aGlzLnByZWZpeCArICI6IiArIHRoaXMubG9jYWxOYW1lIDogdGhpcy5sb2NhbE5hbWU7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIGdldCB2YWx1ZSgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBzZXQgdmFsdWUodikgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhdGEgPT09IHYpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB2YXIgb2xkdmFsID0gdGhpcy5kYXRhOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHY7CgogICAgICAgICAgICAgICAgICAgIC8vIFJ1biB0aGUgb25jaGFuZ2UgaG9vayBmb3IgdGhlIGF0dHJpYnV0ZQogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG9uZS4KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vbmNoYW5nZSkgdGhpcy5vbmNoYW5nZSh0aGlzLm93bmVyRWxlbWVudCwgdGhpcy5sb2NhbE5hbWUsIG9sZHZhbCwgdik7CgogICAgICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIGEgbXV0YXRpb24gZXZlbnQgaWYgdGhlIGVsZW1lbnQgaXMgcm9vdGVkCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3duZXJFbGVtZW50LnJvb3RlZCkgdGhpcy5vd25lckVsZW1lbnQub3duZXJEb2N1bWVudC5tdXRhdGVBdHRyKHRoaXMsIG9sZHZhbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBUaGUgYXR0cmlidXRlcyBwcm9wZXJ0eSBvZiBhbiBFbGVtZW50IHdpbGwgYmUgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcy4KICAgICAgICAgICAgLy8gVGhpcyBjbGFzcyBpcyByZWFsbHkganVzdCBhIGR1bW15LCB0aG91Z2guIEl0IG9ubHkgZGVmaW5lcyBhIGxlbmd0aAogICAgICAgICAgICAvLyBwcm9wZXJ0eSBhbmQgYW4gaXRlbSgpIG1ldGhvZC4gVGhlIEF0dHJBcnJheVByb3h5IHRoYXQKICAgICAgICAgICAgLy8gZGVmaW5lcyB0aGUgcHVibGljIEFQSSBqdXN0IHVzZXMgdGhlIEVsZW1lbnQgb2JqZWN0IGl0c2VsZi4gIEJ1dCBpbgogICAgICAgICAgICAvLyBvcmRlciB0byBnZXQgd3JhcHBlZCBwcm9wZXJseSwgd2UgbmVlZCB0byByZXR1cm4gYW4gb2JqZWN0IHdpdGggdGhlCiAgICAgICAgICAgIC8vIHJpZ2h0IF9pZGxOYW1lIHByb3BlcnR5CiAgICAgICAgICAgIGZ1bmN0aW9uIEF0dHJpYnV0ZXNBcnJheShlbHQpIHsKICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IGVsdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBBdHRyaWJ1dGVzQXJyYXkucHJvdG90eXBlID0gewogICAgICAgICAgICAgICAgX2lkbE5hbWU6ICJBdHRyQXJyYXkiLAogICAgICAgICAgICAgICAgZ2V0IGxlbmd0aCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50Ll9hdHRyS2V5cy5sZW5ndGg7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXRlbTogZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50Ll9hdHRyc0J5TE5hbWVbdGhpcy5lbGVtZW50Ll9hdHRyS2V5c1tuXV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBUaGUgY2hpbGRyZW4gcHJvcGVydHkgb2YgYW4gRWxlbWVudCB3aWxsIGJlIGFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MuCiAgICAgICAgICAgIC8vIEl0IGRlZmluZXMgbGVuZ3RoLCBpdGVtKCkgYW5kIG5hbWVkSXRlbSgpIGFuZCB3aWxsIGJlIHdyYXBwZWQgYnkgYW4KICAgICAgICAgICAgLy8gSFRNTENvbGxlY3Rpb24gd2hlbiBleHBvc2VkIHRocm91Z2ggdGhlIERPTS4KICAgICAgICAgICAgZnVuY3Rpb24gQ2hpbGRyZW5Db2xsZWN0aW9uKGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIENoaWxkcmVuQ29sbGVjdGlvbi5wcm90b3R5cGUgPSB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogIkhUTUxDb2xsZWN0aW9uIiwKICAgICAgICAgICAgICAgIGdldCBsZW5ndGgoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDYWNoZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuQnlOdW1iZXIubGVuZ3RoOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBpdGVtOiBmdW5jdGlvbiBpdGVtKG4pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNhY2hlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW5CeU51bWJlcltuXSB8fCBudWxsOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBuYW1lZEl0ZW06IGZ1bmN0aW9uIG5hbWVkSXRlbShuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDYWNoZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuQnlOYW1lW25hbWVdIHx8IG51bGw7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8vIFRoaXMgYXR0cmlidXRlIHJldHVybnMgdGhlIGVudGlyZSBuYW1lLT5lbGVtZW50IG1hcC4KICAgICAgICAgICAgICAgIC8vIEl0IGlzIG5vdCBwYXJ0IG9mIHRoZSBIVE1MQ29sbGVjdGlvbiBBUEksIGJ1dCB3ZSBuZWVkIGl0IGluCiAgICAgICAgICAgICAgICAvLyBzcmMvSFRNTENvbGxlY3Rpb25Qcm94eQogICAgICAgICAgICAgICAgZ2V0IG5hbWVkSXRlbXMoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDYWNoZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuQnlOYW1lOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICB1cGRhdGVDYWNoZTogZnVuY3Rpb24gdXBkYXRlQ2FjaGUoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWVkRWx0cyA9IC9eKGF8YXBwbGV0fGFyZWF8ZW1iZWR8Zm9ybXxmcmFtZXxmcmFtZXNldHxpZnJhbWV8aW1nfG9iamVjdCkkLzsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5sYXN0TW9kVGltZSAhPT0gdGhpcy5lbGVtZW50Lmxhc3RNb2RUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdE1vZFRpbWUgPSB0aGlzLmVsZW1lbnQubGFzdE1vZFRpbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRyZW5CeU51bWJlciA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuQnlOYW1lID0ge307CgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IHRoaXMuZWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmVsZW1lbnQuY2hpbGROb2Rlc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjLm5vZGVUeXBlID09IEVMRU1FTlRfTk9ERSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGhpcy5jaGlsZHJlbkJ5TnVtYmVyLCBjKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYIEFyZSB0aGVyZSBhbnkgcmVxdWlyZW1lbnRzIGFib3V0IHRoZSBuYW1lc3BhY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvZiB0aGUgaWQgcHJvcGVydHk/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gYy5nZXRBdHRyaWJ1dGUoImlkIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGFuIGlkIHRoYXQgaXMgbm90IGFscmVhZHkgaW4gdXNlLi4uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkICYmICF0aGlzLmNoaWxkcmVuQnlOYW1lW2lkXSkgdGhpcy5jaGlsZHJlbkJ5TmFtZVtpZF0gPSBjOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3IgY2VydGFpbiBIVE1MIGVsZW1lbnRzIHdlIGNoZWNrIHRoZSBuYW1lIGF0dHJpYnV0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gYy5nZXRBdHRyaWJ1dGUoIm5hbWUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmFtZSAmJiB0aGlzLmVsZW1lbnQubmFtZXNwYWNlVVJJID09PSBIVE1MX05BTUVTUEFDRSAmJiBuYW1lZEVsdHMudGVzdCh0aGlzLmVsZW1lbnQubG9jYWxOYW1lKSAmJiAhdGhpcy5jaGlsZHJlbkJ5TmFtZVtuYW1lXSkgdGhpcy5jaGlsZHJlbkJ5TmFtZVtpZF0gPSBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmV0dXJuIEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgKiAgc3JjL2ltcGwvTXV0YXRpb25Db25zdGFudHMuanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy9pbXBsL011dGF0aW9uQ29uc3RhbnRzLmpzIgogICAgICAgIC8vIFRoZSB2YWx1ZSBvZiBhIFRleHQsIENvbW1lbnQgb3IgUEkgbm9kZSBjaGFuZ2VkCiAgICAgICAgdmFyIE1VVEFURV9WQUxVRSA9IDE7CgogICAgICAgIC8vIEEgbmV3IGF0dHJpYnV0ZSB3YXMgYWRkZWQgb3IgYW4gYXR0cmlidXRlIHZhbHVlIGFuZC9vciBwcmVmaXggY2hhbmdlZAogICAgICAgIHZhciBNVVRBVEVfQVRUUiA9IDI7CgogICAgICAgIC8vIEFuIGF0dHJpYnV0ZSB3YXMgcmVtb3ZlZAogICAgICAgIHZhciBNVVRBVEVfUkVNT1ZFX0FUVFIgPSAzOwoKICAgICAgICAvLyBBIG5vZGUgd2FzIHJlbW92ZWQKICAgICAgICB2YXIgTVVUQVRFX1JFTU9WRSA9IDQ7CgogICAgICAgIC8vIEEgbm9kZSB3YXMgbW92ZWQKICAgICAgICB2YXIgTVVUQVRFX01PVkUgPSA1OwoKICAgICAgICAvLyBBIG5vZGUgKG9yIGEgc3VidHJlZSBvZiBub2Rlcykgd2FzIGluc2VydGVkCiAgICAgICAgdmFyIE1VVEFURV9JTlNFUlQgPSA2OwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL2RvbXN0ci5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL2ltcGwvZG9tc3RyLmpzIgogICAgICAgIC8vIEEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIERPTSB0cmVlcwogICAgICAgIHZhciBET01TVFIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBOVUwgPSAiXDAiOwoKICAgICAgICAgICAgdmFyIEhUTUxfTkFNRVNQQUNFID0gImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiOwogICAgICAgICAgICB2YXIgWE1MX05BTUVTUEFDRSA9ICJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiOwogICAgICAgICAgICB2YXIgWE1MTlNfTkFNRVNQQUNFID0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAveG1sbnMvIjsKICAgICAgICAgICAgdmFyIE1BVEhNTF9OQU1FU1BBQ0UgPSAiaHR0cDovL3d3dy53My5vcmcvMTk5OC9NYXRoL01hdGhNTCI7CiAgICAgICAgICAgIHZhciBTVkdfTkFNRVNQQUNFID0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIjsKCiAgICAgICAgICAgIHZhciBzdWJzdHJpbmcgPSBTdHJpbmcuc3Vic3RyaW5nOwogICAgICAgICAgICB2YXIgaW5kZXhPZiA9IFN0cmluZy5pbmRleE9mOwogICAgICAgICAgICB2YXIgY2hhckNvZGVBdCA9IFN0cmluZy5jaGFyQ29kZUF0OwogICAgICAgICAgICB2YXIgZnJvbUNoYXJDb2RlID0gU3RyaW5nLmZyb21DaGFyQ29kZTsKCiAgICAgICAgICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZShuKSB7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzZXJpYWxpemVOb2RlKG4pIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG4ubm9kZVR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBOb2RlLlRFWFRfTk9ERToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTm9kZS5DT01NRU5UX05PREU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBjb21tZW50OiBuLmRhdGEgfTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBOb2RlLlBST0NFU1NJTkdfSU5TVFJVQ1RJT05fTk9ERToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHBpOiBuLnRhcmdldCwgZGF0YTogbi5kYXRhIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTm9kZS5ET0NVTUVOVF9UWVBFX05PREU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIVE1MIGlnbm9yZXMgdGhlIHB1YmxpY0lEIGFuZCBzeXN0ZW1JRCB3aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXJpYWxpemluZyBub2Rlcywgc28gaWdub3JlIHRoZW0gaGVyZSwgdG9vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBkb2N0eXBlOiBuLm5hbWUgfTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBOb2RlLkVMRU1FTlRfTk9ERToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXJpYWxpemVFbGVtZW50KG4pOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE5PREUuRE9DVU1FTlRfRlJBR01FTlRfTk9ERToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXJpYWxpemVGcmFnbWVudChuKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2VyaWFsaXplRWxlbWVudChuKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVsdCA9IHt9OwogICAgICAgICAgICAgICAgICAgIGlmIChuLm5hbWVzcGFjZVVSSSA9PT0gSFRNTF9OQU1FU1BBQ0UgJiYgIW4ucHJlZml4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsdC5odG1sID0gbi5sb2NhbE5hbWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWx0Lm5zID0gc2VyaWFsaXplTmFtZXNwYWNlKG4ubmFtZXNwYWNlVVJJKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWx0LnRhZyA9IG4udGFnTmFtZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSB0aGUgYXR0cmlidXRlcwogICAgICAgICAgICAgICAgICAgIGlmIChuLmF0dHJpYnV0ZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsdC5hdHRyID0gbmV3IEFycmF5KG4uYXR0cmlidXRlcy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG4uYXR0cmlidXRlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWx0LmF0dHJbaV0gPSBzZXJpYWxpemVBdHRyKG4uYXR0cmlidXRlcy5pdGVtKGkpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIE5vdyB0aGUgY2hpbGRyZW4KICAgICAgICAgICAgICAgICAgICBpZiAobi5jaGlsZE5vZGVzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBlbHQuY2hpbGQgPSBuZXcgQXJyYXkobi5jaGlsZE5vZGVzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbi5jaGlsZE5vZGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBlbHQuY2hpbGRbaV0gPSBzZXJpYWxpemVOb2RlKG4uY2hpbGROb2Rlc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWx0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBsYXN0Q3VzdG9tTlMgPSBudWxsOwoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZU5hbWVzcGFjZShucykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBIVE1MX05BTUVTUEFDRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiaCI7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgbnVsbDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAidSI7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgWE1MX05BTUVTUEFDRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAieCI7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgWE1MTlNfTkFNRVNQQUNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJuIjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBNQVRITUxfTkFNRVNQQUNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJtIjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBTVkdfTkFNRVNQQUNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJzIjsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChucyA9PT0gbGFzdEN1c3RvbU5TKSByZXR1cm4gImwiO2Vsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RDdXN0b21OUyA9IG5zOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiYyIgKyBuczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2VyaWFsaXplQXR0cihhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEubmFtZXNwYWNlVVJJID09PSBudWxsICYmIGEucHJlZml4ID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCB3aXRoIHNldEF0dHJpYnV0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGE6IGEubmFtZSwgdjogYS52YWx1ZSB9OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCB3aXRoIHNldEF0dHJpYnV0ZU5TKCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgbnM6IHNlcmlhbGl6ZU5hbWVzcGFjZShhLm5hbWVzcGFjZVVSSSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhOiBhLm5hbWUsIHY6IGEudmFsdWUgfTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2VyaWFsaXplTGVuZ3RoKG4pIHsKICAgICAgICAgICAgICAgICAgICBpZiAobiA8IDApIHRocm93IG5ldyBFcnJvcigibmVnYXRpdmUgbGVuZ3RoIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKG4gPD0gMHhEN0ZGKSByZXR1cm4gZnJvbUNoYXJDb2RlKG4pO2Vsc2UgcmV0dXJuIGZyb21DaGFyQ29kZSgiMHhGRkZGIikgKyBTdHJpbmcobikgKyBOVUw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2VyaWFsaXplRnJhZ21lbnQobikgewogICAgICAgICAgICAgICAgICAgIHZhciBmcmFnID0geyBmcmFnOiBuZXcgQXJyYXkobi5jaGlsZE5vZGVzLmxlbmd0aCkgfTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG4uY2hpbGROb2Rlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnJhZ1tpXSA9IHNlcmlhbGl6ZU5vZGUobi5jaGlsZE5vZGVzW2ldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZyYWc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHNlcmlhbGl6ZU5vZGUobik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlKG5vZGUsIGQpIHsKICAgICAgICAgICAgICAgIGlmICghZCkgZCA9IGRvY3VtZW50OwoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlTm9kZShuKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBuID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5jcmVhdGVUZXh0Tm9kZShuKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG4uY29tbWVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLmNyZWF0ZUNvbW1lbnQobi5jb21tZW50KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG4ucGkgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5jcmVhdGVQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24obi5waSwgbi5kYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG4uZG9jdHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLmltcGxlbWVudGF0aW9uLmNyZWF0ZURvY3VtZW50VHlwZShuLmRvY3R5cGUsICIiLCAiIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChuLmh0bWwgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VFbGVtZW50KCJIIiwgbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChuLm5zICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRWxlbWVudCgiRSIsIG4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAobi5mcmFnICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRnJhZ21lbnQobik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlRWxlbWVudCh0eXBlLCBuKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGU7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICJIIikgZSA9IGQuY3JlYXRlRWxlbWVudChuLmh0bWwpO2Vsc2UgZSA9IGQuY3JlYXRlRWxlbWVudE5TKHBhcnNlTmFtZXNwYWNlKG4ubnMpLCBuLnRhZyk7CgogICAgICAgICAgICAgICAgICAgIHZhciBudW1hdHRycyA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKG4uYXR0ciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG51bWF0dHJzID0gbi5hdHRyLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1hdHRyczsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gbi5hdHRyW2ldOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0ci5hICE9PSB1bmRlZmluZWQpIGUuc2V0QXR0cmlidXRlKGF0dHIuYSwgYXR0ci52KTtlbHNlIGUuc2V0QXR0cmlidXRlTlMoYXR0ci5ucywgYXR0ci5hLCBhdHRyLnYpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdmFyIG51bWtpZHMgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmIChuLmNoaWxkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbnVta2lkcyA9IG4uY2hpbGQubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bWtpZHM7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHBhcnNlTm9kZShuLmNoaWxkW2ldKSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgbGFzdEN1c3RvbU5TID0gbnVsbDsKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBwYXJzZU5hbWVzcGFjZShuKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChuWzBdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2gnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEhUTUxfTkFNRVNQQUNFOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd1JzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd4JzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBYTUxfTkFNRVNQQUNFOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICduJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBYTUxOU19OQU1FU1BBQ0U7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ20nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1BVEhNTF9OQU1FU1BBQ0U7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3MnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNWR19OQU1FU1BBQ0U7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2wnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxhc3RDdXN0b21OUzsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYyc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5zbGljZSgxKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2VGcmFnbWVudChuKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBkLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgbGVuID0gbi5mcmFnLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSBmLmFwcGVuZENoaWxkKHBhcnNlTm9kZShuLmZyYWdbaV0pKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VOb2RlKG5vZGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4geyBzZXJpYWxpemU6IHNlcmlhbGl6ZSwgcGFyc2U6IHBhcnNlIH07CiAgICAgICAgfSgpOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL0RvY3VtZW50LmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9Eb2N1bWVudC5qcyIKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkRvY3VtZW50IiwgZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgZnVuY3Rpb24gRG9jdW1lbnQoaXNIVE1MLCBhZGRyZXNzKSB7CiAgICAgICAgICAgICAgICB0aGlzLm5vZGVUeXBlID0gRE9DVU1FTlRfTk9ERTsKICAgICAgICAgICAgICAgIHRoaXMuaXNIVE1MID0gaXNIVE1MOwogICAgICAgICAgICAgICAgdGhpcy5fYWRkcmVzcyA9IGFkZHJlc3MgfHwgImFib3V0OmJsYW5rIjsKICAgICAgICAgICAgICAgIHRoaXMuaW1wbGVtZW50YXRpb24gPSBuZXcgaW1wbC5ET01JbXBsZW1lbnRhdGlvbigpOwoKICAgICAgICAgICAgICAgIC8vIERPTUNvcmUgc2F5cyB0aGF0IGRvY3VtZW50cyBhcmUgYWx3YXlzIGFzc29jaWF0ZWQgd2l0aCB0aGVtc2VsdmVzLgogICAgICAgICAgICAgICAgdGhpcy5vd25lckRvY3VtZW50ID0gdGhpczsKCiAgICAgICAgICAgICAgICAvLyBUaGVzZSB3aWxsIGJlIGluaXRpYWxpemVkIGJ5IG91ciBjdXN0b20gdmVyc2lvbnMgb2YKICAgICAgICAgICAgICAgIC8vIGFwcGVuZENoaWxkIGFuZCBpbnNlcnRCZWZvcmUgdGhhdCBvdmVycmlkZSB0aGUgaW5oZXJpdGVkCiAgICAgICAgICAgICAgICAvLyBOb2RlIG1ldGhvZHMuCiAgICAgICAgICAgICAgICAvLyBYWFg6IG92ZXJyaWRlIHRob3NlIG1ldGhvZHMhCiAgICAgICAgICAgICAgICB0aGlzLmRvY3R5cGUgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5kb2N1bWVudEVsZW1lbnQgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5jaGlsZE5vZGVzID0gW107CiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkTm9kZXMuX2lkbE5hbWUgPSAiTm9kZUxpc3QiOwoKICAgICAgICAgICAgICAgIC8vIERvY3VtZW50cyBhcmUgYWx3YXlzIHJvb3RlZCwgYnkgZGVmaW5pdGlvbgogICAgICAgICAgICAgICAgdGhpcy5fbmlkID0gMTsKICAgICAgICAgICAgICAgIHRoaXMuX25leHRuaWQgPSAyOyAvLyBGb3IgbnVtYmVyaW5nIGNoaWxkcmVuIG9mIHRoZSBkb2N1bWVudAogICAgICAgICAgICAgICAgdGhpcy5fbm9kZXMgPSBbbnVsbCwgdGhpc107IC8vIG5pZCB0byBub2RlIG1hcAoKICAgICAgICAgICAgICAgIC8vIFRoaXMgbWFpbnRhaW5zIHRoZSBtYXBwaW5nIGZyb20gZWxlbWVudCBpZHMgdG8gZWxlbWVudCBub2Rlcy4KICAgICAgICAgICAgICAgIC8vIFdlIG1heSBuZWVkIHRvIHVwZGF0ZSB0aGlzIG1hcHBpbmcgZXZlcnkgdGltZSBhIG5vZGUgaXMgcm9vdGVkCiAgICAgICAgICAgICAgICAvLyBvciB1cHJvb3RlZCwgYW5kIGFueSB0aW1lIGFuIGF0dHJpYnV0ZSBpcyBhZGRlZCwgcmVtb3ZlZCBvciBjaGFuZ2VkCiAgICAgICAgICAgICAgICAvLyBvbiBhIHJvb3RlZCBlbGVtZW50LgogICAgICAgICAgICAgICAgdGhpcy5ieUlkID0gTy5jcmVhdGUobnVsbCk7IC8vIGluaGVyaXQgbm90aGluZwoKICAgICAgICAgICAgICAgIC8vIFRoaXMgcHJvcGVydHkgaG9sZHMgYSBtb25vdG9uaWNhbGx5IGluY3JlYXNpbmcgdmFsdWUgYWtpbiB0bwogICAgICAgICAgICAgICAgLy8gYSB0aW1lc3RhbXAgdXNlZCB0byByZWNvcmQgdGhlIGxhc3QgbW9kaWZpY2F0aW9uIHRpbWUgb2Ygbm9kZXMKICAgICAgICAgICAgICAgIC8vIGFuZCB0aGVpciBzdWJ0cmVlcy4gU2VlIHRoZSBsYXN0TW9kVGltZSBhdHRyaWJ1dGUgYW5kIG1vZGlmeSgpCiAgICAgICAgICAgICAgICAvLyBtZXRob2Qgb2YgdGhlIE5vZGUgY2xhc3MuICBBbmQgc2VlIEZpbHRlcmVkRWxlbWVudExpc3QgZm9yIGFuIGV4YW1wbGUKICAgICAgICAgICAgICAgIC8vIG9mIHRoZSB1c2Ugb2YgbGFzdE1vZFRpbWUKICAgICAgICAgICAgICAgIHRoaXMubW9kY2xvY2sgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBNYXAgZnJvbSBsb3dlcmNhc2UgZXZlbnQgY2F0ZWdvcnkgbmFtZXMgKHVzZWQgYXMgYXJndW1lbnRzIHRvCiAgICAgICAgICAgIC8vIGNyZWF0ZUV2ZW50KCkpIHRvIHRoZSBwcm9wZXJ0eSBuYW1lIGluIHRoZSBpbXBsIG9iamVjdCBvZiB0aGUKICAgICAgICAgICAgLy8gZXZlbnQgY29uc3RydWN0b3IuCiAgICAgICAgICAgIHZhciBzdXBwb3J0ZWRFdmVudHMgPSB7CiAgICAgICAgICAgICAgICBldmVudDogIkV2ZW50IiwKICAgICAgICAgICAgICAgIGN1c3RvbWV2ZW50OiAiQ3VzdG9tRXZlbnQiLAogICAgICAgICAgICAgICAgdWlldmVudDogIlVJRXZlbnQiLAogICAgICAgICAgICAgICAgbW91c2VldmVudDogIk1vdXNlRXZlbnQiCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBDZXJ0YWluIGFyZ3VtZW50cyB0byBkb2N1bWVudC5jcmVhdGVFdmVudCgpIG11c3QgYmUgdHJlYXRlZCBzcGVjaWFsbHkKICAgICAgICAgICAgdmFyIHJlcGxhY2VtZW50RXZlbnQgPSB7CiAgICAgICAgICAgICAgICBodG1sZXZlbnRzOiAiZXZlbnQiLAogICAgICAgICAgICAgICAgbW91c2VldmVudHM6ICJtb3VzZWV2ZW50IiwKICAgICAgICAgICAgICAgIG11dGF0aW9uZXZlbnRzOiAibXV0YXRpb25ldmVudCIsCiAgICAgICAgICAgICAgICB1aWV2ZW50czogInVpZXZlbnQiCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBEb2N1bWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLk5vZGUucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkRvY3VtZW50IiksCgogICAgICAgICAgICAgICAgLy8gVGhpcyBtZXRob2QgYWxsb3dzIGRvbS5qcyB0byBjb21tdW5pY2F0ZSB3aXRoIGEgcmVuZGVyZXIKICAgICAgICAgICAgICAgIC8vIHRoYXQgZGlzcGxheXMgdGhlIGRvY3VtZW50IGluIHNvbWUgd2F5CiAgICAgICAgICAgICAgICAvLyBYWFg6IEkgc2hvdWxkIHByb2JhYmx5IG1vdmUgdGhpcyB0byB0aGUgd2luZG93IG9iamVjdAogICAgICAgICAgICAgICAgX3NldE11dGF0aW9uSGFuZGxlcjogY29uc3RhbnQoZnVuY3Rpb24gKGhhbmRsZXIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm11dGF0aW9uSGFuZGxlciA9IGhhbmRsZXI7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBUaGlzIG1ldGhvZCBhbGxvd3MgZG9tLmpzIHRvIHJlY2VpdmUgZXZlbnQgbm90aWZpY2F0aW9ucwogICAgICAgICAgICAgICAgLy8gZnJvbSB0aGUgcmVuZGVyZXIuCiAgICAgICAgICAgICAgICAvLyBYWFg6IEkgc2hvdWxkIHByb2JhYmx5IG1vdmUgdGhpcyB0byB0aGUgd2luZG93IG9iamVjdAogICAgICAgICAgICAgICAgX2Rpc3BhdGNoUmVuZGVyZXJFdmVudDogY29uc3RhbnQoZnVuY3Rpb24gKHRhcmdldE5pZCwgdHlwZSwgZGV0YWlscykgewogICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLl9ub2Rlc1t0YXJnZXROaWRdOwogICAgICAgICAgICAgICAgICAgIGlmICghdGFyZ2V0KSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Ll9kaXNwYXRjaEV2ZW50KG5ldyBpbXBsLkV2ZW50KHR5cGUsIGRldGFpbHMpLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vICAgICAgICBub2RlVHlwZTogY29uc3RhbnQoRE9DVU1FTlRfTk9ERSksCiAgICAgICAgICAgICAgICBub2RlTmFtZTogY29uc3RhbnQoIiNkb2N1bWVudCIpLAogICAgICAgICAgICAgICAgbm9kZVZhbHVlOiBhdHRyaWJ1dGUoZm51bGwsIGZub29wKSwKCiAgICAgICAgICAgICAgICAvLyBYWFg6IERPTUNvcmUgbWF5IHJlbW92ZSBkb2N1bWVudFVSSSwgc28gaXQgaXMgTllJIGZvciBub3cKICAgICAgICAgICAgICAgIGRvY3VtZW50VVJJOiBhdHRyaWJ1dGUobnlpLCBueWkpLAogICAgICAgICAgICAgICAgY29tcGF0TW9kZTogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAvLyBUaGUgX3F1aXJrcyBwcm9wZXJ0eSBpcyBzZXQgYnkgdGhlIEhUTUwgcGFyc2VyCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3F1aXJrcyA/ICJCYWNrQ29tcGF0IiA6ICJDU1MxQ29tcGF0IjsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgcGFyZW50Tm9kZTogY29uc3RhbnQobnVsbCksCgogICAgICAgICAgICAgICAgY3JlYXRlVGV4dE5vZGU6IGNvbnN0YW50KGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBpbXBsLlRleHQodGhpcywgZGF0YSk7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGNyZWF0ZUNvbW1lbnQ6IGNvbnN0YW50KGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBpbXBsLkNvbW1lbnQodGhpcywgZGF0YSk7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGNyZWF0ZURvY3VtZW50RnJhZ21lbnQ6IGNvbnN0YW50KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGltcGwuRG9jdW1lbnRGcmFnbWVudCh0aGlzKTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgY3JlYXRlUHJvY2Vzc2luZ0luc3RydWN0aW9uOiBjb25zdGFudChmdW5jdGlvbiAodGFyZ2V0LCBkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNIVE1MKSBOb3RTdXBwb3J0ZWRFcnJvcigpOwogICAgICAgICAgICAgICAgICAgIGlmICgheG1sLmlzVmFsaWROYW1lKHRhcmdldCkgfHwgUy5pbmRleE9mKGRhdGEsICI/PiIpICE9PSAtMSkgSW52YWxpZENoYXJhY3RlckVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBpbXBsLlByb2Nlc3NpbmdJbnN0cnVjdGlvbih0aGlzLCB0YXJnZXQsIGRhdGEpOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgY3JlYXRlRWxlbWVudDogY29uc3RhbnQoZnVuY3Rpb24gKGxvY2FsTmFtZSkgewogICAgICAgICAgICAgICAgICAgIGlmICgheG1sLmlzVmFsaWROYW1lKGxvY2FsTmFtZSkpIEludmFsaWRDaGFyYWN0ZXJFcnJvcigpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0hUTUwpIGxvY2FsTmFtZSA9IHRvTG93ZXJDYXNlKGxvY2FsTmFtZSk7CgogICAgICAgICAgICAgICAgICAgIHZhciBpbnRlcmZhY2VOYW1lID0gdGFnTmFtZVRvSW50ZXJmYWNlTmFtZVtsb2NhbE5hbWVdIHx8ICJIVE1MVW5rbm93bkVsZW1lbnQiOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgaW1wbFtpbnRlcmZhY2VOYW1lXSh0aGlzLCBsb2NhbE5hbWUsIG51bGwpOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgY3JlYXRlRWxlbWVudE5TOiBjb25zdGFudChmdW5jdGlvbiAobmFtZXNwYWNlLCBxdWFsaWZpZWROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF4bWwuaXNWYWxpZE5hbWUocXVhbGlmaWVkTmFtZSkpIEludmFsaWRDaGFyYWN0ZXJFcnJvcigpOwogICAgICAgICAgICAgICAgICAgIGlmICgheG1sLmlzVmFsaWRRTmFtZShxdWFsaWZpZWROYW1lKSkgTmFtZXNwYWNlRXJyb3IoKTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIHBvcywgcHJlZml4LCBsb2NhbE5hbWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKChwb3MgPSBTLmluZGV4T2YocXVhbGlmaWVkTmFtZSwgIjoiKSkgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByZWZpeCA9IHN1YnN0cmluZyhxdWFsaWZpZWROYW1lLCAwLCBwb3MpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbE5hbWUgPSBzdWJzdHJpbmcocXVhbGlmaWVkTmFtZSwgcG9zICsgMSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmFtZXNwYWNlID09PSAiIiB8fCBwcmVmaXggPT09ICJ4bWwiICYmIG5hbWVzcGFjZSAhPT0gWE1MX05BTUVTUEFDRSkgTmFtZXNwYWNlRXJyb3IoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXggPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbE5hbWUgPSBxdWFsaWZpZWROYW1lOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKChxdWFsaWZpZWROYW1lID09PSAieG1sbnMiIHx8IHByZWZpeCA9PT0gInhtbG5zIikgJiYgbmFtZXNwYWNlICE9PSBYTUxOU19OQU1FU1BBQ0UgfHwgbmFtZXNwYWNlID09PSBYTUxOU19OQU1FU1BBQ0UgJiYgcXVhbGlmaWVkTmFtZSAhPT0gInhtbG5zIiAmJiBwcmVmaXggIT09ICJ4bWxucyIpIE5hbWVzcGFjZUVycm9yKCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChuYW1lc3BhY2UgPT09IEhUTUxfTkFNRVNQQUNFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnRlcmZhY2VOYW1lID0gdGFnTmFtZVRvSW50ZXJmYWNlTmFtZVtsb2NhbE5hbWVdIHx8ICJIVE1MVW5rbm93bkVsZW1lbnQiOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGltcGxbaW50ZXJmYWNlTmFtZV0odGhpcywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBpbXBsLkVsZW1lbnQodGhpcywgbG9jYWxOYW1lLCBuYW1lc3BhY2UsIHByZWZpeCk7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICBjcmVhdGVFdmVudDogY29uc3RhbnQoZnVuY3Rpb24gY3JlYXRlRXZlbnQoaW50ZXJmYWNlTmFtZSkgewogICAgICAgICAgICAgICAgICAgIGludGVyZmFjZU5hbWUgPSB0b0xvd2VyQ2FzZShpbnRlcmZhY2VOYW1lKTsKICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHJlcGxhY2VtZW50RXZlbnRbaW50ZXJmYWNlTmFtZV0gfHwgaW50ZXJmYWNlTmFtZTsKICAgICAgICAgICAgICAgICAgICB2YXIgY29uc3RydWN0b3IgPSBpbXBsW3N1cHBvcnRlZEV2ZW50c1tuYW1lXV07CgogICAgICAgICAgICAgICAgICAgIGlmIChjb25zdHJ1Y3RvcikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IG5ldyBjb25zdHJ1Y3RvcigpOwogICAgICAgICAgICAgICAgICAgICAgICBlLl9pbml0aWFsaXplZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBOb3RTdXBwb3J0ZWRFcnJvcigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIEFkZCBzb21lIChzdXJwcmlzaW5nbHkgY29tcGxleCkgZG9jdW1lbnQgaGllcmFyY2h5IHZhbGlkaXR5CiAgICAgICAgICAgICAgICAvLyBjaGVja3Mgd2hlbiBhZGRpbmcsIHJlbW92aW5nIGFuZCByZXBsYWNpbmcgbm9kZXMgaW50byBhCiAgICAgICAgICAgICAgICAvLyBkb2N1bWVudCBvYmplY3QsIGFuZCBhbHNvIG1haW50YWluIHRoZSBkb2N1bWVudEVsZW1lbnQgYW5kCiAgICAgICAgICAgICAgICAvLyBkb2N0eXBlIHByb3BlcnRpZXMgb2YgdGhlIGRvY3VtZW50LiAgRWFjaCBvZiB0aGUgZm9sbG93aW5nCiAgICAgICAgICAgICAgICAvLyA0IG1ldGhvZHMgY2hhaW5zIHRvIHRoZSBOb2RlIGltcGxlbWVudGF0aW9uIG9mIHRoZSBtZXRob2QKICAgICAgICAgICAgICAgIC8vIHRvIGRvIHRoZSBhY3R1YWwgaW5zZXJ0aW5nLCByZW1vdmFsIG9yIHJlcGxhY2VtZW50LgoKICAgICAgICAgICAgICAgIGFwcGVuZENoaWxkOiBjb25zdGFudChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT09IFRFWFRfTk9ERSkgSGllcmFyY2h5UmVxdWVzdEVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBFTEVNRU5UX05PREUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZG9jdW1lbnRFbGVtZW50KSAvLyBXZSBhbHJlYWR5IGhhdmUgYSByb290IGVsZW1lbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhpZXJhcmNoeVJlcXVlc3RFcnJvcigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb2N1bWVudEVsZW1lbnQgPSBjaGlsZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBET0NVTUVOVF9UWVBFX05PREUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZG9jdHlwZSB8fCAvLyBBbHJlYWR5IGhhdmUgb25lCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRFbGVtZW50KSAvLyBPciBvdXQtb2Ytb3JkZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhpZXJhcmNoeVJlcXVlc3RFcnJvcigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb2N0eXBlID0gY2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBOb3cgY2hhaW4gdG8gb3VyIHN1cGVyY2xhc3MKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbChpbXBsLk5vZGUucHJvdG90eXBlLmFwcGVuZENoaWxkLCB0aGlzLCBjaGlsZCk7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICBpbnNlcnRCZWZvcmU6IGNvbnN0YW50KGZ1bmN0aW9uIGluc2VydEJlZm9yZShjaGlsZCwgcmVmQ2hpbGQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVmQ2hpbGQgPT09IG51bGwpIHJldHVybiBjYWxsKGltcGwuRG9jdW1lbnQucHJvdG90eXBlLmFwcGVuZENoaWxkLCB0aGlzLCBjaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZkNoaWxkLnBhcmVudE5vZGUgIT09IHRoaXMpIE5vdEZvdW5kRXJyb3IoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT09IFRFWFRfTk9ERSkgSGllcmFyY2h5UmVxdWVzdEVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBFTEVNRU5UX05PREUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UgYWxyZWFkeSBoYXZlIGEgcm9vdCBlbGVtZW50IG9yIGlmIHdlJ3JlIHRyeWluZyB0bwogICAgICAgICAgICAgICAgICAgICAgICAvLyBpbnNlcnQgaXQgYmVmb3JlIHRoZSBkb2N0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvY3VtZW50RWxlbWVudCB8fCB0aGlzLmRvY3R5cGUgJiYgdGhpcy5kb2N0eXBlLmluZGV4ID49IHJlZkNoaWxkLmluZGV4KSBIaWVyYXJjaHlSZXF1ZXN0RXJyb3IoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRFbGVtZW50ID0gY2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC5ub2RlVHlwZSA9PT0gRE9DVU1FTlRfVFlQRV9OT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvY3R5cGUgfHwgdGhpcy5kb2N1bWVudEVsZW1lbnQgJiYgcmVmQ2hpbGQuaW5kZXggPiB0aGlzLmRvY3VtZW50RWxlbWVudC5pbmRleCkgSGllcmFyY2h5UmVxdWVzdEVycm9yKCk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRvY3R5cGUgPSBjaGlsZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwoaW1wbC5Ob2RlLnByb3RvdHlwZS5pbnNlcnRCZWZvcmUsIHRoaXMsIGNoaWxkLCByZWZDaGlsZCk7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICByZXBsYWNlQ2hpbGQ6IGNvbnN0YW50KGZ1bmN0aW9uIHJlcGxhY2VDaGlsZChjaGlsZCwgb2xkQ2hpbGQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob2xkQ2hpbGQucGFyZW50Tm9kZSAhPT0gdGhpcykgTm90Rm91bmRFcnJvcigpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT09IFRFWFRfTk9ERSkgSGllcmFyY2h5UmVxdWVzdEVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBFTEVNRU5UX05PREUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UgYWxyZWFkeSBoYXZlIGEgcm9vdCBlbGVtZW50IGFuZCB3ZSdyZSBub3QgcmVwbGFjaW5nIGl0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvY3VtZW50RWxlbWVudCAmJiB0aGlzLmRvY3VtZW50RWxlbWVudCAhPT0gb2xkQ2hpbGQpIEhpZXJhcmNoeVJlcXVlc3RFcnJvcigpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBPciBpZiB3ZSdyZSB0cnlpbmcgdG8gcHV0IHRoZSBlbGVtZW50IGJlZm9yZSB0aGUgZG9jdHlwZQogICAgICAgICAgICAgICAgICAgICAgICAvLyAocmVwbGFjaW5nIHRoZSBkb2N0eXBlIGlzIG9rYXkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvY3R5cGUgJiYgb2xkQ2hpbGQuaW5kZXggPCB0aGlzLmRvY3R5cGUuaW5kZXgpIEhpZXJhcmNoeVJlcXVlc3RFcnJvcigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9sZENoaWxkID09PSB0aGlzLmRvY3R5cGUpIHRoaXMuZG9jdHlwZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGlsZC5ub2RlVHlwZSA9PT0gRE9DVU1FTlRfVFlQRV9OT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHdlIGFscmVhZHkgaGF2ZSBhIGRvY3R5cGUgYW5kIHdlJ3JlIG5vdCByZXBsYWNpbmcgaXQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZG9jdHlwZSAmJiBvbGRDaGlsZCAhPT0gdGhpcy5kb2N0eXBlKSBIaWVyYXJjaHlSZXF1ZXN0RXJyb3IoKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIGRvY3VtZW50IGVsZW1lbnQgYW5kIHRoZSBvbGQgY2hpbGQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29tZXMgYWZ0ZXIgaXQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZG9jdW1lbnRFbGVtZW50ICYmIG9sZENoaWxkLmluZGV4ID4gdGhpcy5kb2N1bWVudEVsZW1lbnQuaW5kZXgpIEhpZXJhcmNoeVJlcXVlc3RFcnJvcigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9sZENoaWxkID09PSB0aGlzLmRvY3VtZW50RWxlbWVudCkgdGhpcy5kb2N1bWVudEVsZW1lbnQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvbGRDaGlsZCA9PT0gdGhpcy5kb2N1bWVudEVsZW1lbnQpIHRoaXMuZG9jdW1lbnRFbGVtZW50ID0gbnVsbDtlbHNlIGlmIChvbGRDaGlsZCA9PT0gdGhpcy5kb2N0eXBlKSB0aGlzLmRvY3R5cGUgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbChpbXBsLk5vZGUucHJvdG90eXBlLnJlcGxhY2VDaGlsZCwgdGhpcywgY2hpbGQsIG9sZENoaWxkKTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIHJlbW92ZUNoaWxkOiBjb25zdGFudChmdW5jdGlvbiByZW1vdmVDaGlsZChjaGlsZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC5ub2RlVHlwZSA9PT0gRE9DVU1FTlRfVFlQRV9OT0RFKSB0aGlzLmRvY3R5cGUgPSBudWxsO2Vsc2UgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBFTEVNRU5UX05PREUpIHRoaXMuZG9jdW1lbnRFbGVtZW50ID0gbnVsbDsKCiAgICAgICAgICAgICAgICAgICAgLy8gTm93IGNoYWluIHRvIG91ciBzdXBlcmNsYXNzCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwoaW1wbC5Ob2RlLnByb3RvdHlwZS5yZW1vdmVDaGlsZCwgdGhpcywgY2hpbGQpOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgZ2V0RWxlbWVudEJ5SWQ6IGNvbnN0YW50KGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgICAgICAgICAgIHZhciBuID0gdGhpcy5ieUlkW2lkXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIW4pIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmIChpc0FycmF5KG4pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZXJlIHdhcyBtb3JlIHRoYW4gb25lIGVsZW1lbnQgd2l0aCB0aGlzIGlkCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuWzBdOyAvLyBhcnJheSBpcyBzb3J0ZWQgaW4gZG9jdW1lbnQgb3JkZXIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG47CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBYWFg6CiAgICAgICAgICAgICAgICAvLyBUZXN0cyBhcmUgY3VycmVudGx5IGZhaWxpbmcgZm9yIHRoaXMgZnVuY3Rpb24uCiAgICAgICAgICAgICAgICAvLyBBd2FpdGluZyByZXNvbHV0aW9uIG9mOgogICAgICAgICAgICAgICAgLy8gaHR0cDovL2xpc3RzLnczLm9yZy9BcmNoaXZlcy9QdWJsaWMvd3d3LWRvbS8yMDExSnVsU2VwLzAwMTYuaHRtbAogICAgICAgICAgICAgICAgZ2V0RWxlbWVudHNCeVRhZ05hbWU6IGNvbnN0YW50KGZ1bmN0aW9uIGdldEVsZW1lbnRzQnlUYWdOYW1lKGxuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbHRlcjsKICAgICAgICAgICAgICAgICAgICBpZiAobG5hbWUgPT09ICIqIikgZmlsdGVyID0gZnRydWU7ZWxzZSBpZiAodGhpcy5kb2MuaXNIVE1MKSBmaWx0ZXIgPSBodG1sTG9jYWxOYW1lRWxlbWVudEZpbHRlcihsbmFtZSk7ZWxzZSBmaWx0ZXIgPSBsb2NhbE5hbWVFbGVtZW50RmlsdGVyKGxuYW1lKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBpbXBsLkZpbHRlcmVkRWxlbWVudExpc3QodGhpcywgZmlsdGVyKTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIGdldEVsZW1lbnRzQnlUYWdOYW1lTlM6IGNvbnN0YW50KGZ1bmN0aW9uIGdldEVsZW1lbnRzQnlUYWdOYW1lTlMobnMsIGxuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbHRlcjsKICAgICAgICAgICAgICAgICAgICBpZiAobnMgPT09ICIqIiAmJiBsbmFtZSA9PT0gIioiKSBmaWx0ZXIgPSBmdHJ1ZTtlbHNlIGlmIChucyA9PT0gIioiKSBmaWx0ZXIgPSBsb2NhbE5hbWVFbGVtZW50RmlsdGVyKGxuYW1lKTtlbHNlIGlmIChsbmFtZSA9PT0gIioiKSBmaWx0ZXIgPSBuYW1lc3BhY2VFbGVtZW50RmlsdGVyKG5zKTtlbHNlIGZpbHRlciA9IG5hbWVzcGFjZUxvY2FsTmFtZUVsZW1lbnRGaWx0ZXIobnMsIGxuYW1lKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBpbXBsLkZpbHRlcmVkRWxlbWVudExpc3QodGhpcywgZmlsdGVyKTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIGdldEVsZW1lbnRzQnlDbGFzc05hbWU6IGNvbnN0YW50KGZ1bmN0aW9uIGdldEVsZW1lbnRzQnlDbGFzc05hbWUobmFtZXMpIHsKICAgICAgICAgICAgICAgICAgICBuYW1lcyA9IG5hbWVzLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBpZiAobmFtZXMgPT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTsgLy8gRW1wdHkgbm9kZSBsaXN0CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5faWRsTmFtZSA9ICJOb2RlTGlzdCI7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG5hbWVzID0gbmFtZXMuc3BsaXQoL1xzKy8pOyAvLyBTcGxpdCBvbiBzcGFjZXMKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGltcGwuRmlsdGVyZWRFbGVtZW50TGlzdCh0aGlzLCBjbGFzc05hbWVzRWxlbWVudEZpbHRlcihuYW1lcykpOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgZ2V0RWxlbWVudHNCeU5hbWU6IGNvbnN0YW50KGZ1bmN0aW9uIGdldEVsZW1lbnRzQnlOYW1lKG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGltcGwuRmlsdGVyZWRFbGVtZW50TGlzdCh0aGlzLCBlbGVtZW50TmFtZUZpbHRlcihuYW1lKSk7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICBxdWVyeVNlbGVjdG9yOiBjb25zdGFudChmdW5jdGlvbiBxdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gWFhYIGFsZXhleW06IG1ha2UgcXVlcnlTZWxlY3RvciB3b3JrCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICBxdWVyeVNlbGVjdG9yQWxsOiBjb25zdGFudChmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gWFhYIGFsZXhleW06IG1ha2UgcXVlcnlTZWxlY3RvckFsbCB3b3JrCiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdOyAvLyBFbXB0eSBub2RlIGxpc3QKICAgICAgICAgICAgICAgICAgICByZXN1bHQuX2lkbE5hbWUgPSAiTm9kZUxpc3QiOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICBhZG9wdE5vZGU6IGNvbnN0YW50KGZ1bmN0aW9uIGFkb3B0Tm9kZShub2RlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IERPQ1VNRU5UX05PREUgfHwgbm9kZS5ub2RlVHlwZSA9PT0gRE9DVU1FTlRfVFlQRV9OT0RFKSBOb3RTdXBwb3J0ZWRFcnJvcigpOwoKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5wYXJlbnROb2RlKSBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLm93bmVyRG9jdW1lbnQgIT09IHRoaXMpIHJlY3Vyc2l2ZWx5U2V0T3duZXIobm9kZSwgdGhpcyk7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBub2RlOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgaW1wb3J0Tm9kZTogY29uc3RhbnQoZnVuY3Rpb24gaW1wb3J0Tm9kZShub2RlLCBkZWVwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRvcHROb2RlKG5vZGUuY2xvbmVOb2RlKCkpOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhdHRyaWJ1dGVzIGFuZCBtZXRob2RzIGFyZSBmcm9tIHRoZSBIVE1MIHNwZWMKICAgICAgICAgICAgICAgIFVSTDogYXR0cmlidXRlKG55aSksCiAgICAgICAgICAgICAgICBkb21haW46IGF0dHJpYnV0ZShueWksIG55aSksCiAgICAgICAgICAgICAgICByZWZlcnJlcjogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGNvb2tpZTogYXR0cmlidXRlKG55aSwgbnlpKSwKICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogYXR0cmlidXRlKG55aSksCiAgICAgICAgICAgICAgICAvLyBYWFggVGVtcG9yYXJ5IGhhY2sKICAgICAgICAgICAgICAgIHJlYWR5U3RhdGU6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJjb21wbGV0ZSI7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHRpdGxlOiBhdHRyaWJ1dGUoZm5vb3AsIG55aSksCiAgICAgICAgICAgICAgICBkaXI6IGF0dHJpYnV0ZShueWksIG55aSksCiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIGZpcnN0IDxib2R5PiBjaGlsZCBvZiB0aGUgZG9jdW1lbnQgZWxlbWVudC4KICAgICAgICAgICAgICAgIC8vIFhYWCBGb3Igbm93LCBzZXR0aW5nIHRoaXMgYXR0cmlidXRlIGlzIG5vdCBpbXBsZW1lbnRlZC4KICAgICAgICAgICAgICAgIGJvZHk6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNIVE1MICYmIHRoaXMuZG9jdW1lbnRFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBraWRzID0gdGhpcy5kb2N1bWVudEVsZW1lbnQuY2hpbGROb2RlczsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBraWRzLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtpZHNbaV0ubm9kZVR5cGUgPT09IEVMRU1FTlRfTk9ERSAmJiBraWRzW2ldLmxvY2FsTmFtZSA9PT0gImJvZHkiICYmIGtpZHNbaV0ubmFtZXNwYWNlVVJJID09PSBIVE1MX05BTUVTUEFDRSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBraWRzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgfSwgbnlpKSwKICAgICAgICAgICAgICAgIC8vIFJldHVybiB0aGUgZmlyc3QgPGhlYWQ+IGNoaWxkIG9mIHRoZSBkb2N1bWVudCBlbGVtZW50LgogICAgICAgICAgICAgICAgaGVhZDogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0hUTUwgJiYgdGhpcy5kb2N1bWVudEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGtpZHMgPSB0aGlzLmRvY3VtZW50RWxlbWVudC5jaGlsZE5vZGVzOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IGtpZHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2lkc1tpXS5ub2RlVHlwZSA9PT0gRUxFTUVOVF9OT0RFICYmIGtpZHNbaV0ubG9jYWxOYW1lID09PSAiaGVhZCIgJiYga2lkc1tpXS5uYW1lc3BhY2VVUkkgPT09IEhUTUxfTkFNRVNQQUNFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtpZHNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGltYWdlczogYXR0cmlidXRlKG55aSksCiAgICAgICAgICAgICAgICBlbWJlZHM6IGF0dHJpYnV0ZShueWkpLAogICAgICAgICAgICAgICAgcGx1Z2luczogYXR0cmlidXRlKG55aSksCiAgICAgICAgICAgICAgICBsaW5rczogYXR0cmlidXRlKG55aSksCiAgICAgICAgICAgICAgICBmb3JtczogYXR0cmlidXRlKG55aSksCiAgICAgICAgICAgICAgICBzY3JpcHRzOiBhdHRyaWJ1dGUobnlpKSwKICAgICAgICAgICAgICAgIGlubmVySFRNTDogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJpYWxpemUoKTsKICAgICAgICAgICAgICAgIH0sIG55aSksCgogICAgICAgICAgICAgICAgd3JpdGU6IGNvbnN0YW50KGZ1bmN0aW9uIChhcmdzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzSFRNTCkgSW52YWxpZFN0YXRlRXJyb3IoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBzdGlsbCBoYXZlIHRvIGltcGxlbWVudCB0aGUgaWdub3JlIHBhcnQKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3BhcnNlciAvKiAmJiB0aGlzLl9pZ25vcmVfZGVzdHJ1Y3RpdmVfd3JpdGVzID4gMCAqLykgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3BhcnNlcikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBYWFggY2FsbCBkb2N1bWVudC5vcGVuLCBldGMuCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGpvaW4oYXJndW1lbnRzLCAiIik7CgogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBEb2N1bWVudCBvYmplY3QncyByZWxvYWQgb3ZlcnJpZGUgZmxhZyBpcyBzZXQsIHRoZW4KICAgICAgICAgICAgICAgICAgICAvLyBhcHBlbmQgdGhlIHN0cmluZyBjb25zaXN0aW5nIG9mIHRoZSBjb25jYXRlbmF0aW9uIG9mIGFsbCB0aGUKICAgICAgICAgICAgICAgICAgICAvLyBhcmd1bWVudHMgdG8gdGhlIG1ldGhvZCB0byB0aGUgRG9jdW1lbnQncyByZWxvYWQgb3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAvLyBidWZmZXIuCiAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBkb24ndCBrbm93IHdoYXQgdGhpcyBpcyBhYm91dC4gIFN0aWxsIGhhdmUgdG8gZG8gaXQKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gcGVuZGluZyBwYXJzaW5nLWJsb2NraW5nIHNjcmlwdCwgaGF2ZSB0aGUKICAgICAgICAgICAgICAgICAgICAvLyB0b2tlbml6ZXIgcHJvY2VzcyB0aGUgY2hhcmFjdGVycyB0aGF0IHdlcmUgaW5zZXJ0ZWQsIG9uZSBhdCBhCiAgICAgICAgICAgICAgICAgICAgLy8gdGltZSwgcHJvY2Vzc2luZyByZXN1bHRpbmcgdG9rZW5zIGFzIHRoZXkgYXJlIGVtaXR0ZWQsIGFuZAogICAgICAgICAgICAgICAgICAgIC8vIHN0b3BwaW5nIHdoZW4gdGhlIHRva2VuaXplciByZWFjaGVzIHRoZSBpbnNlcnRpb24gcG9pbnQgb3Igd2hlbgogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBwcm9jZXNzaW5nIG9mIHRoZSB0b2tlbml6ZXIgaXMgYWJvcnRlZCBieSB0aGUgdHJlZQogICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0cnVjdGlvbiBzdGFnZSAodGhpcyBjYW4gaGFwcGVuIGlmIGEgc2NyaXB0IGVuZCB0YWcgdG9rZW4gaXMKICAgICAgICAgICAgICAgICAgICAvLyBlbWl0dGVkIGJ5IHRoZSB0b2tlbml6ZXIpLgoKICAgICAgICAgICAgICAgICAgICAvLyBYWFg6IHN0aWxsIGhhdmUgdG8gZG8gdGhlIGFib3ZlLiBTb3VuZHMgYXMgaWYgd2UgZG9uJ3QKICAgICAgICAgICAgICAgICAgICAvLyBhbHdheXMgY2FsbCBwYXJzZSgpIGhlcmUuICBJZiB3ZSdyZSBibG9ja2VkLCB0aGVuIHdlIGp1c3QKICAgICAgICAgICAgICAgICAgICAvLyBpbnNlcnQgdGhlIHRleHQgaW50byB0aGUgc3RyZWFtIGJ1dCBkb24ndCBwYXJzZSBpdCByZWVudHJhbnRseS4uLgoKICAgICAgICAgICAgICAgICAgICAvLyBJbnZva2UgdGhlIHBhcnNlciByZWVudHJhbnRseQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcnNlci5wYXJzZShzKTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIHdyaXRlbG46IGNvbnN0YW50KGZ1bmN0aW9uIHdyaXRlbG4oYXJncykgewogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGUoam9pbihhcmd1bWVudHMsICIiKSArICJcbiIpOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gVXRpbGl0eSBtZXRob2RzCiAgICAgICAgICAgICAgICBjbG9uZTogY29uc3RhbnQoZnVuY3Rpb24gY2xvbmUoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ2FuJ3QgY2xvbmUgYW4gZW50aXJlIGRvY3VtZW50CiAgICAgICAgICAgICAgICAgICAgRGF0YUNsb25lRXJyb3IoKTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgaXNFcXVhbDogY29uc3RhbnQoZnVuY3Rpb24gaXNFcXVhbChuKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQW55IHR3byBkb2N1bWVudHMgYXJlIHNoYWxsb3dseSBlcXVhbC4KICAgICAgICAgICAgICAgICAgICAvLyBOb2RlLmlzRXF1YWxOb2RlIHdpbGwgYWxzbyB0ZXN0IHRoZSBjaGlsZHJlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gSW1wbGVtZW50YXRpb24tc3BlY2lmaWMgZnVuY3Rpb24uICBDYWxsZWQgd2hlbiBhIHRleHQsIGNvbW1lbnQsCiAgICAgICAgICAgICAgICAvLyBvciBwaSB2YWx1ZSBjaGFuZ2VzLgogICAgICAgICAgICAgICAgbXV0YXRlVmFsdWU6IGNvbnN0YW50KGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubXV0YXRpb25IYW5kbGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubXV0YXRpb25IYW5kbGVyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IE1VVEFURV9WQUxVRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogbm9kZS5fbmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogbm9kZS5kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIEludm9rZWQgd2hlbiBhbiBhdHRyaWJ1dGUncyB2YWx1ZSBjaGFuZ2VzLiBBdHRyIGhvbGRzIHRoZSBuZXcKICAgICAgICAgICAgICAgIC8vIHZhbHVlLiAgb2xkdmFsIGlzIHRoZSBvbGQgdmFsdWUuICBBdHRyaWJ1dGUgbXV0YXRpb25zIGNhbiBhbHNvCiAgICAgICAgICAgICAgICAvLyBpbnZvbHZlIGNoYW5nZXMgdG8gdGhlIHByZWZpeCAoYW5kIHRoZXJlZm9yZSB0aGUgcXVhbGlmaWVkIG5hbWUpCiAgICAgICAgICAgICAgICBtdXRhdGVBdHRyOiBjb25zdGFudChmdW5jdGlvbiAoYXR0ciwgb2xkdmFsKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTWFuYWdlIGlkLT5lbGVtZW50IG1hcHBpbmcgZm9yIGdldEVsZW1lbnRzQnlJZCgpCiAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiB0aGlzIHNwZWNpYWwgY2FzZSBpZCBoYW5kbGluZyBzaG91bGQgbm90IGdvIGhlcmUsCiAgICAgICAgICAgICAgICAgICAgLy8gYnV0IGluIHRoZSBhdHRyaWJ1dGUgZGVjbGFyYXRpb24gZm9yIHRoZSBpZCBhdHRyaWJ1dGUKICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgIGlmIChhdHRyLmxvY2FsTmFtZSA9PT0gImlkIiAmJiBhdHRyLm5hbWVzcGFjZVVSSSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAob2xkdmFsKSBkZWxJZChvbGR2YWwsIGF0dHIub3duZXJFbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkSWQoYXR0ci52YWx1ZSwgYXR0ci5vd25lckVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm11dGF0aW9uSGFuZGxlcikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm11dGF0aW9uSGFuZGxlcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBNVVRBVEVfQVRUUiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogYXR0ci5vd25lckVsZW1lbnQuX25pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGF0dHIubG9jYWxOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnM6IGF0dHIubmFtZXNwYWNlVVJJLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGF0dHIudmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXg6IGF0dHIucHJlZml4CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIFVzZWQgYnkgcmVtb3ZlQXR0cmlidXRlIGFuZCByZW1vdmVBdHRyaWJ1dGVOUyBmb3IgYXR0cmlidXRlcy4KICAgICAgICAgICAgICAgIG11dGF0ZVJlbW92ZUF0dHI6IGNvbnN0YW50KGZ1bmN0aW9uIChhdHRyKSB7CiAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgKiBUaGlzIGlzIG5vdyBoYW5kbGVkIGluIEF0dHJpYnV0ZXMuanMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBNYW5hZ2UgaWQgdG8gZWxlbWVudCBtYXBwaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHIubG9jYWxOYW1lID09PSAiaWQiICYmIGF0dHIubmFtZXNwYWNlVVJJID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVsSWQoYXR0ci52YWx1ZSwgYXR0ci5vd25lckVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm11dGF0aW9uSGFuZGxlcikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm11dGF0aW9uSGFuZGxlcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBNVVRBVEVfUkVNT1ZFX0FUVFIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IGF0dHIub3duZXJFbGVtZW50Ll9uaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBhdHRyLmxvY2FsTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5zOiBhdHRyLm5hbWVzcGFjZVVSSQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBDYWxsZWQgYnkgTm9kZS5yZW1vdmVDaGlsZCwgZXRjLiB0byByZW1vdmUgYSByb290ZWQgZWxlbWVudCBmcm9tCiAgICAgICAgICAgICAgICAvLyB0aGUgdHJlZS4gT25seSBuZWVkcyB0byBnZW5lcmF0ZSBhIHNpbmdsZSBtdXRhdGlvbiBldmVudCB3aGVuIGEKICAgICAgICAgICAgICAgIC8vIG5vZGUgaXMgcmVtb3ZlZCwgYnV0IG11c3QgcmVjdXJzaXZlbHkgbWFyayBhbGwgZGVzY2VuZGFudHMgYXMgbm90CiAgICAgICAgICAgICAgICAvLyByb290ZWQuCiAgICAgICAgICAgICAgICBtdXRhdGVSZW1vdmU6IGNvbnN0YW50KGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2VuZCBhIHNpbmdsZSBtdXRhdGlvbiBldmVudAogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm11dGF0aW9uSGFuZGxlcikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm11dGF0aW9uSGFuZGxlcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBNVVRBVEVfUkVNT1ZFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBub2RlLl9uaWQKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBNYXJrIHRoaXMgYW5kIGFsbCBkZXNjZW5kYW50cyBhcyBub3Qgcm9vdGVkCiAgICAgICAgICAgICAgICAgICAgcmVjdXJzaXZlbHlVcHJvb3Qobm9kZSk7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBDYWxsZWQgd2hlbiBhIG5ldyBlbGVtZW50IGJlY29tZXMgcm9vdGVkLiAgSXQgbXVzdCByZWN1cnNpdmVseQogICAgICAgICAgICAgICAgLy8gZ2VuZXJhdGUgbXV0YXRpb24gZXZlbnRzIGZvciBlYWNoIG9mIHRoZSBjaGlsZHJlbiwgYW5kIG1hcmsgdGhlbSBhbGwKICAgICAgICAgICAgICAgIC8vIGFzIHJvb3RlZC4KICAgICAgICAgICAgICAgIG11dGF0ZUluc2VydDogY29uc3RhbnQoZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBNYXJrIG5vZGUgYW5kIGl0cyBkZXNjZW5kYW50cyBhcyByb290ZWQKICAgICAgICAgICAgICAgICAgICByZWN1cnNpdmVseVJvb3Qobm9kZSk7CgogICAgICAgICAgICAgICAgICAgIC8vIFNlbmQgYSBzaW5nbGUgbXV0YXRpb24gZXZlbnQKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tdXRhdGlvbkhhbmRsZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tdXRhdGlvbkhhbmRsZXIoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogTVVUQVRFX0lOU0VSVCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogbm9kZS5wYXJlbnROb2RlLl9uaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogbm9kZS5pbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5pZDogbm9kZS5fbmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQ6IERPTVNUUi5zZXJpYWxpemUobm9kZSkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gQ2FsbGVkIHdoZW4gYSByb290ZWQgZWxlbWVudCBpcyBtb3ZlZCB3aXRoaW4gdGhlIGRvY3VtZW50CiAgICAgICAgICAgICAgICBtdXRhdGVNb3ZlOiBjb25zdGFudChmdW5jdGlvbiAobm9kZSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm11dGF0aW9uSGFuZGxlcikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm11dGF0aW9uSGFuZGxlcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBNVVRBVEVfTU9WRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogbm9kZS5fbmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50OiBub2RlLnBhcmVudE5vZGUuX25pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBub2RlLmluZGV4CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIEFkZCBhIG1hcHBpbmcgZnJvbSAgaWQgdG8gbiBmb3Igbi5vd25lckRvY3VtZW50CiAgICAgICAgICAgICAgICBhZGRJZDogY29uc3RhbnQoZnVuY3Rpb24gYWRkSWQoaWQsIG4pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gdGhpcy5ieUlkW2lkXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ5SWRbaWRdID0gbjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB3YXJuKCJEdXBsaWNhdGUgZWxlbWVudCBpZCAiICsgaWQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzQXJyYXkodmFsKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gW3ZhbF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ5SWRbaWRdID0gdmFsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbC5wdXNoKG4pOwogICAgICAgICAgICAgICAgICAgICAgICBzb3J0KHZhbCwgZG9jdW1lbnRPcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gRGVsZXRlIHRoZSBtYXBwaW5nIGZyb20gaWQgdG8gbiBmb3Igbi5vd25lckRvY3VtZW50CiAgICAgICAgICAgICAgICBkZWxJZDogY29uc3RhbnQoZnVuY3Rpb24gZGVsSWQoaWQsIG4pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gdGhpcy5ieUlkW2lkXTsKICAgICAgICAgICAgICAgICAgICBhc3NlcnQodmFsKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQXJyYXkodmFsKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gQS5pbmRleE9mKHZhbCwgbik7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwbGljZSh2YWwsIGlkeCwgMSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb252ZXJ0IGJhY2sgdG8gYSBzaW5nbGUgbm9kZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ieUlkW2lkXSA9IHZhbFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmJ5SWRbaWRdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIF9kb2N1bWVudEJhc2VVUkw6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBUaGlzIGlzIG5vdCBpbXBsZW1lbnRlZCBjb3JyZWN0bHkgeWV0CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FkZHJlc3M7CgogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBkb2N1bWVudCBiYXNlIFVSTCBvZiBhIERvY3VtZW50IG9iamVjdCBpcyB0aGUKICAgICAgICAgICAgICAgICAgICAvLyBhYnNvbHV0ZSBVUkwgb2J0YWluZWQgYnkgcnVubmluZyB0aGVzZSBzdWJzdGVwczoKCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIExldCBmYWxsYmFjayBiYXNlIHVybCBiZSB0aGUgZG9jdW1lbnQncyBhZGRyZXNzLgoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgSWYgZmFsbGJhY2sgYmFzZSB1cmwgaXMgYWJvdXQ6YmxhbmssIGFuZCB0aGUKICAgICAgICAgICAgICAgICAgICAvLyAgICAgRG9jdW1lbnQncyBicm93c2luZyBjb250ZXh0IGhhcyBhIGNyZWF0b3IgYnJvd3NpbmcKICAgICAgICAgICAgICAgICAgICAvLyAgICAgY29udGV4dCwgdGhlbiBsZXQgZmFsbGJhY2sgYmFzZSB1cmwgYmUgdGhlIGRvY3VtZW50CiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGJhc2UgVVJMIG9mIHRoZSBjcmVhdG9yIERvY3VtZW50IGluc3RlYWQuCgogICAgICAgICAgICAgICAgICAgIC8vICAgICBJZiB0aGUgRG9jdW1lbnQgaXMgYW4gaWZyYW1lIHNyY2RvYyBkb2N1bWVudCwgdGhlbgogICAgICAgICAgICAgICAgICAgIC8vICAgICBsZXQgZmFsbGJhY2sgYmFzZSB1cmwgYmUgdGhlIGRvY3VtZW50IGJhc2UgVVJMIG9mCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoZSBEb2N1bWVudCdzIGJyb3dzaW5nIGNvbnRleHQncyBicm93c2luZyBjb250ZXh0CiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGNvbnRhaW5lcidzIERvY3VtZW50IGluc3RlYWQuCgogICAgICAgICAgICAgICAgICAgIC8vICAgICBJZiB0aGVyZSBpcyBubyBiYXNlIGVsZW1lbnQgdGhhdCBoYXMgYW4gaHJlZgogICAgICAgICAgICAgICAgICAgIC8vICAgICBhdHRyaWJ1dGUsIHRoZW4gdGhlIGRvY3VtZW50IGJhc2UgVVJMIGlzIGZhbGxiYWNrCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGJhc2UgdXJsOyBhYm9ydCB0aGVzZSBzdGVwcy4gT3RoZXJ3aXNlLCBsZXQgdXJsIGJlCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoZSB2YWx1ZSBvZiB0aGUgaHJlZiBhdHRyaWJ1dGUgb2YgdGhlIGZpcnN0IHN1Y2gKICAgICAgICAgICAgICAgICAgICAvLyAgICAgZWxlbWVudC4KCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIFJlc29sdmUgdXJsIHJlbGF0aXZlIHRvIGZhbGxiYWNrIGJhc2UgdXJsICh0aHVzLAogICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGUgYmFzZSBocmVmIGF0dHJpYnV0ZSBpc24ndCBhZmZlY3RlZCBieSB4bWw6YmFzZQogICAgICAgICAgICAgICAgICAgIC8vICAgICBhdHRyaWJ1dGVzKS4KCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIFRoZSBkb2N1bWVudCBiYXNlIFVSTCBpcyB0aGUgcmVzdWx0IG9mIHRoZSBwcmV2aW91cwogICAgICAgICAgICAgICAgICAgIC8vICAgICBzdGVwIGlmIGl0IHdhcyBzdWNjZXNzZnVsOyBvdGhlcndpc2UgaXQgaXMgZmFsbGJhY2sKICAgICAgICAgICAgICAgICAgICAvLyAgICAgYmFzZSB1cmwuCgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgZXZlbnRIYW5kbGVyVHlwZXMgPSBbImFib3J0IiwgImNhbnBsYXkiLCAiY2FucGxheXRocm91Z2giLCAiY2hhbmdlIiwgImNsaWNrIiwgImNvbnRleHRtZW51IiwgImN1ZWNoYW5nZSIsICJkYmxjbGljayIsICJkcmFnIiwgImRyYWdlbmQiLCAiZHJhZ2VudGVyIiwgImRyYWdsZWF2ZSIsICJkcmFnb3ZlciIsICJkcmFnc3RhcnQiLCAiZHJvcCIsICJkdXJhdGlvbmNoYW5nZSIsICJlbXB0aWVkIiwgImVuZGVkIiwgImlucHV0IiwgImludmFsaWQiLCAia2V5ZG93biIsICJrZXlwcmVzcyIsICJrZXl1cCIsICJsb2FkZWRkYXRhIiwgImxvYWRlZG1ldGFkYXRhIiwgImxvYWRzdGFydCIsICJtb3VzZWRvd24iLCAibW91c2Vtb3ZlIiwgIm1vdXNlb3V0IiwgIm1vdXNlb3ZlciIsICJtb3VzZXVwIiwgIm1vdXNld2hlZWwiLCAicGF1c2UiLCAicGxheSIsICJwbGF5aW5nIiwgInByb2dyZXNzIiwgInJhdGVjaGFuZ2UiLCAicmVhZHlzdGF0ZWNoYW5nZSIsICJyZXNldCIsICJzZWVrZWQiLCAic2Vla2luZyIsICJzZWxlY3QiLCAic2hvdyIsICJzdGFsbGVkIiwgInN1Ym1pdCIsICJzdXNwZW5kIiwgInRpbWV1cGRhdGUiLCAidm9sdW1lY2hhbmdlIiwgIndhaXRpbmciLCAiYmx1ciIsICJlcnJvciIsICJmb2N1cyIsICJsb2FkIiwgInNjcm9sbCJdOwoKICAgICAgICAgICAgLy8gQWRkIGV2ZW50IGhhbmRsZXIgaWRsIGF0dHJpYnV0ZSBnZXR0ZXJzIGFuZCBzZXR0ZXJzIHRvIERvY3VtZW50CiAgICAgICAgICAgIGV2ZW50SGFuZGxlclR5cGVzLmZvckVhY2goZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICAgICAgICAgIC8vIERlZmluZSB0aGUgZXZlbnQgaGFuZGxlciByZWdpc3RyYXRpb24gSURMIGF0dHJpYnV0ZSBmb3IgdGhpcyB0eXBlCiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoRG9jdW1lbnQucHJvdG90eXBlLCAib24iICsgdHlwZSwgewogICAgICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0RXZlbnRIYW5kbGVyKHR5cGUpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRFdmVudEhhbmRsZXIodHlwZSwgdik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZnVuY3Rpb24gcm9vdChuKSB7CiAgICAgICAgICAgICAgICBuLl9uaWQgPSBuLm93bmVyRG9jdW1lbnQuX25leHRuaWQrKzsKICAgICAgICAgICAgICAgIG4ub3duZXJEb2N1bWVudC5fbm9kZXNbbi5fbmlkXSA9IG47CiAgICAgICAgICAgICAgICAvLyBNYW5hZ2UgaWQgdG8gZWxlbWVudCBtYXBwaW5nCiAgICAgICAgICAgICAgICBpZiAobi5ub2RlVHlwZSA9PT0gRUxFTUVOVF9OT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gbi5nZXRBdHRyaWJ1dGUoImlkIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlkKSBuLm93bmVyRG9jdW1lbnQuYWRkSWQoaWQsIG4pOwoKICAgICAgICAgICAgICAgICAgICAvLyBTY3JpcHQgZWxlbWVudHMgbmVlZCB0byBrbm93IHdoZW4gdGhleSdyZSBpbnNlcnRlZAogICAgICAgICAgICAgICAgICAgIC8vIGludG8gdGhlIGRvY3VtZW50CiAgICAgICAgICAgICAgICAgICAgaWYgKG4uX3Jvb3Rob29rKSBuLl9yb290aG9vaygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiB1cHJvb3QobikgewogICAgICAgICAgICAgICAgLy8gTWFuYWdlIGlkIHRvIGVsZW1lbnQgbWFwcGluZwogICAgICAgICAgICAgICAgaWYgKG4ubm9kZVR5cGUgPT09IEVMRU1FTlRfTk9ERSkgewogICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IG4uZ2V0QXR0cmlidXRlKCJpZCIpOwogICAgICAgICAgICAgICAgICAgIGlmIChpZCkgbi5vd25lckRvY3VtZW50LmRlbElkKGlkLCBuKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRlbGV0ZSBuLm93bmVyRG9jdW1lbnQuX25vZGVzW24uX25pZF07CiAgICAgICAgICAgICAgICBkZWxldGUgbi5fbmlkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiByZWN1cnNpdmVseVJvb3Qobm9kZSkgewogICAgICAgICAgICAgICAgcm9vdChub2RlKTsKICAgICAgICAgICAgICAgIC8vIFhYWDoKICAgICAgICAgICAgICAgIC8vIGFjY2Vzc2luZyBjaGlsZE5vZGVzIG9uIGEgbGVhZiBub2RlIGNyZWF0ZXMgYSBuZXcgYXJyYXkgdGhlCiAgICAgICAgICAgICAgICAvLyBmaXJzdCB0aW1lLCBzbyBiZSBjYXJlZnVsIHRvIHdyaXRlIHRoaXMgbG9vcCBzbyB0aGF0IGl0CiAgICAgICAgICAgICAgICAvLyBkb2Vzbid0IGRvIHRoYXQuIG5vZGUgaXMgcG9seW1vcnBoaWMsIHNvIG1heWJlIHRoaXMgaXMgaGFyZCB0bwogICAgICAgICAgICAgICAgLy8gb3B0aW1pemU/ICBUcnkgc3dpdGNoaW5nIG9uIG5vZGVUeXBlPwogICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIga2lkcyA9IG5vZGUuY2hpbGROb2RlczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDAsIG4gPSBraWRzLmxlbmd0aDsgIGkgPCBuOyBpKyspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjdXJzaXZlbHlSb290KGtpZHNbaV0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IEVMRU1FTlRfTk9ERSkgewogICAgICAgICAgICAgICAgICAgIHZhciBraWRzID0gbm9kZS5jaGlsZE5vZGVzOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0ga2lkcy5sZW5ndGg7IGkgPCBuOyBpKyspIHJlY3Vyc2l2ZWx5Um9vdChraWRzW2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gcmVjdXJzaXZlbHlVcHJvb3Qobm9kZSkgewogICAgICAgICAgICAgICAgdXByb290KG5vZGUpOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpIDwgbjsgaSsrKSByZWN1cnNpdmVseVVwcm9vdChub2RlLmNoaWxkTm9kZXNbaV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiByZWN1cnNpdmVseVNldE93bmVyKG5vZGUsIG93bmVyKSB7CiAgICAgICAgICAgICAgICBub2RlLm93bmVyRG9jdW1lbnQgPSBvd25lcjsKICAgICAgICAgICAgICAgIGRlbGV0ZSBub2RlLl9sYXN0TW9kVGltZTsgLy8gbW9kIHRpbWVzIGFyZSBkb2N1bWVudC1iYXNlZAogICAgICAgICAgICAgICAgdmFyIGtpZHMgPSBub2RlLmNoaWxkTm9kZXM7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IGtpZHMubGVuZ3RoOyBpIDwgbjsgaSsrKSByZWN1cnNpdmVseVNldE93bmVyKGtpZHNbaV0sIG93bmVyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVGhlc2UgZnVuY3Rpb25zIHJldHVybiBwcmVkaWNhdGVzIGZvciBmaWx0ZXJpbmcgZWxlbWVudHMuCiAgICAgICAgICAgIC8vIFRoZXkncmUgdXNlZCBieSB0aGUgRG9jdW1lbnQgYW5kIEVsZW1lbnQgY2xhc3NlcyBmb3IgbWV0aG9kcyBsaWtlCiAgICAgICAgICAgIC8vIGdldEVsZW1lbnRzQnlUYWdOYW1lIGFuZCBnZXRFbGVtZW50c0J5Q2xhc3NOYW1lCgogICAgICAgICAgICBmdW5jdGlvbiBsb2NhbE5hbWVFbGVtZW50RmlsdGVyKGxuYW1lKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5sb2NhbE5hbWUgPT09IGxuYW1lOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gaHRtbExvY2FsTmFtZUVsZW1lbnRGaWx0ZXIobG5hbWUpIHsKICAgICAgICAgICAgICAgIHZhciBsY2xuYW1lID0gdG9Mb3dlckNhc2UobG5hbWUpOwogICAgICAgICAgICAgICAgaWYgKGxjbG5hbWUgPT09IGxuYW1lKSByZXR1cm4gbG9jYWxOYW1lRWxlbWVudEZpbHRlcihsbmFtZSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUuaXNIVE1MID8gZS5sb2NhbE5hbWUgPT09IGxjbG5hbWUgOiBlLmxvY2FsTmFtZSA9PT0gbG5hbWU7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBuYW1lc3BhY2VFbGVtZW50RmlsdGVyKG5zKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5uYW1lc3BhY2VVUkkgPT09IG5zOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gbmFtZXNwYWNlTG9jYWxOYW1lRWxlbWVudEZpbHRlcihucywgbG5hbWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBlLm5hbWVzcGFjZVVSSSA9PT0gbnMgJiYgZS5sb2NhbE5hbWUgPT09IGxuYW1lOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gWFhYCiAgICAgICAgICAgIC8vIE9wdGltaXplIHRoaXMgd2hlbiBJIGltcGxlbWVudCBjbGFzc0xpc3QuCiAgICAgICAgICAgIGZ1bmN0aW9uIGNsYXNzTmFtZXNFbGVtZW50RmlsdGVyKG5hbWVzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2xhc3NBdHRyID0gZS5nZXRBdHRyaWJ1dGUoImNsYXNzIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjbGFzc0F0dHIpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB2YXIgY2xhc3NlcyA9IGNsYXNzQXR0ci50cmltKCkuc3BsaXQoL1xzKy8pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBldmVyeShuYW1lcywgZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEEuaW5kZXhPZihjbGFzc2VzLCBuKSAhPT0gLTE7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBlbGVtZW50TmFtZUZpbHRlcihuYW1lKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5nZXRBdHRyaWJ1dGUoIm5hbWUiKSA9PT0gbmFtZTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBEb2N1bWVudDsKICAgICAgICB9KTsKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICAqICBzcmMvaW1wbC9Eb2N1bWVudEZyYWdtZW50LmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9Eb2N1bWVudEZyYWdtZW50LmpzIgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiRG9jdW1lbnRGcmFnbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gRG9jdW1lbnRGcmFnbWVudChkb2MpIHsKICAgICAgICAgICAgICAgIHRoaXMubm9kZVR5cGUgPSBET0NVTUVOVF9GUkFHTUVOVF9OT0RFOwogICAgICAgICAgICAgICAgdGhpcy5vd25lckRvY3VtZW50ID0gZG9jOwogICAgICAgICAgICAgICAgdGhpcy5jaGlsZE5vZGVzID0gW107CiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkTm9kZXMuX2lkbE5hbWUgPSAiTm9kZUxpc3QiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBEb2N1bWVudEZyYWdtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuTm9kZS5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiRG9jdW1lbnRGcmFnbWVudCIpLAogICAgICAgICAgICAgICAgLy8gICAgICAgIG5vZGVUeXBlOiBjb25zdGFudChET0NVTUVOVF9GUkFHTUVOVF9OT0RFKSwKICAgICAgICAgICAgICAgIG5vZGVOYW1lOiBjb25zdGFudCgiI2RvY3VtZW50LWZyYWdtZW50IiksCiAgICAgICAgICAgICAgICBub2RlVmFsdWU6IGF0dHJpYnV0ZShmbnVsbCwgZm5vb3ApLAogICAgICAgICAgICAgICAgLy8gQ29weSB0aGUgdGV4dCBjb250ZW50IGdldHRlci9zZXR0ZXIgZnJvbSBFbGVtZW50CiAgICAgICAgICAgICAgICB0ZXh0Q29udGVudDogTy5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoaW1wbC5FbGVtZW50LnByb3RvdHlwZSwgInRleHRDb250ZW50IiksCgogICAgICAgICAgICAgICAgLy8gVXRpbGl0eSBtZXRob2RzCiAgICAgICAgICAgICAgICBjbG9uZTogY29uc3RhbnQoZnVuY3Rpb24gY2xvbmUoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudEZyYWdtZW50KHRoaXMub3duZXJEb2N1bWVudCk7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGlzRXF1YWw6IGNvbnN0YW50KGZ1bmN0aW9uIGlzRXF1YWwobikgewogICAgICAgICAgICAgICAgICAgIC8vIEFueSB0d28gZG9jdW1lbnQgZnJhZ21lbnRzIGFyZSBzaGFsbG93bHkgZXF1YWwuCiAgICAgICAgICAgICAgICAgICAgLy8gTm9kZS5pc0VxdWFsTm9kZSgpIHdpbGwgdGVzdCB0aGVpciBjaGlsZHJlbiBmb3IgZXF1YWxpdHkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBEb2N1bWVudEZyYWdtZW50OwogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL0RvY3VtZW50VHlwZS5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL2ltcGwvRG9jdW1lbnRUeXBlLmpzIgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiRG9jdW1lbnRUeXBlIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBEb2N1bWVudFR5cGUobmFtZSwgcHVibGljSWQsIHN5c3RlbUlkKSB7CiAgICAgICAgICAgICAgICAvLyBVbmxpa2Ugb3RoZXIgbm9kZXMsIGRvY3R5cGUgbm9kZXMgYWx3YXlzIHN0YXJ0IG9mZiB1bm93bmVkCiAgICAgICAgICAgICAgICAvLyB1bnRpbCBpbnNlcnRlZAogICAgICAgICAgICAgICAgdGhpcy5ub2RlVHlwZSA9IERPQ1VNRU5UX1RZUEVfTk9ERTsKICAgICAgICAgICAgICAgIHRoaXMub3duZXJEb2N1bWVudCA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICAgICAgICAgICAgdGhpcy5wdWJsaWNJZCA9IHB1YmxpY0lkIHx8ICIiOwogICAgICAgICAgICAgICAgdGhpcy5zeXN0ZW1JZCA9IHN5c3RlbUlkIHx8ICIiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBEb2N1bWVudFR5cGUucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5MZWFmLnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJEb2N1bWVudFR5cGUiKSwKICAgICAgICAgICAgICAgIC8vICAgICAgICBub2RlVHlwZTogY29uc3RhbnQoRE9DVU1FTlRfVFlQRV9OT0RFKSwKICAgICAgICAgICAgICAgIG5vZGVOYW1lOiBhdHRyaWJ1dGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5hbWU7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIG5vZGVWYWx1ZTogYXR0cmlidXRlKGZudWxsLCBmbm9vcCksCgogICAgICAgICAgICAgICAgLy8gVXRpbGl0eSBtZXRob2RzCiAgICAgICAgICAgICAgICBjbG9uZTogY29uc3RhbnQoZnVuY3Rpb24gY2xvbmUoKSB7CiAgICAgICAgICAgICAgICAgICAgRGF0YUNsb25lRXJyb3IoKTsKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgaXNFcXVhbDogY29uc3RhbnQoZnVuY3Rpb24gaXNFcXVhbChuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmFtZSA9PT0gbi5uYW1lICYmIHRoaXMucHVibGljSWQgPT09IG4ucHVibGljSWQgJiYgdGhpcy5zeXN0ZW1JZCA9PT0gbi5zeXN0ZW1JZDsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIERvY3VtZW50VHlwZTsKICAgICAgICB9KTsKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICAqICBzcmMvaW1wbC9ET01JbXBsZW1lbnRhdGlvbi5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL2ltcGwvRE9NSW1wbGVtZW50YXRpb24uanMiCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJET01JbXBsZW1lbnRhdGlvbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy8gRWFjaCBkb2N1bWVudCBtdXN0IGhhdmUgaXRzIG93biBpbnN0YW5jZSBvZiB0aGUgZG9taW1wbGVtZW50YXRpb24gb2JqZWN0CiAgICAgICAgICAgIC8vIEV2ZW4gdGhvdWdoIHRoZXNlIG9iamVjdHMgaGF2ZSBubyBzdGF0ZQogICAgICAgICAgICBmdW5jdGlvbiBET01JbXBsZW1lbnRhdGlvbigpIHt9OwoKICAgICAgICAgICAgLy8gRmVhdHVyZS92ZXJzaW9uIHBhaXJzIHRoYXQgRE9NSW1wbGVtZW50YXRpb24uaGFzRmVhdHVyZSgpIHJldHVybnMKICAgICAgICAgICAgLy8gdHJ1ZSBmb3IuICBJdCByZXR1cm5zIGZhbHNlIGZvciBhbnl0aGluZyBlbHNlLgogICAgICAgICAgICB2YXIgc3VwcG9ydGVkRmVhdHVyZXMgPSB7CiAgICAgICAgICAgICAgICAieG1sIjogeyAiIjogdHJ1ZSwgIjEuMCI6IHRydWUsICIyLjAiOiB0cnVlIH0sIC8vIERPTSBDb3JlCiAgICAgICAgICAgICAgICAiY29yZSI6IHsgIiI6IHRydWUsICIyLjAiOiB0cnVlIH0sIC8vIERPTSBDb3JlCiAgICAgICAgICAgICAgICAiaHRtbCI6IHsgIiI6IHRydWUsICIxLjAiOiB0cnVlLCAiMi4wIjogdHJ1ZSB9LCAvLyBIVE1MCiAgICAgICAgICAgICAgICAieGh0bWwiOiB7ICIiOiB0cnVlLCAiMS4wIjogdHJ1ZSwgIjIuMCI6IHRydWUgfSB9OwoKICAgICAgICAgICAgRE9NSW1wbGVtZW50YXRpb24ucHJvdG90eXBlID0gewogICAgICAgICAgICAgICAgX2lkbE5hbWU6ICJET01JbXBsZW1lbnRhdGlvbiIsCiAgICAgICAgICAgICAgICBoYXNGZWF0dXJlOiBmdW5jdGlvbiBoYXNGZWF0dXJlKGZlYXR1cmUsIHZlcnNpb24pIHsKICAgICAgICAgICAgICAgICAgICAvLyBXYXJuaW5nIHRleHQgZGlyZWN0bHkgbW9kaWZpZWQgc2xpZ2h0bHkgZnJvbSB0aGUgRE9NIENvcmUgc3BlYzoKICAgICAgICAgICAgICAgICAgICB3YXJuKCJBdXRob3JzIGFyZSBzdHJvbmdseSBkaXNjb3VyYWdlZCBmcm9tIHVzaW5nICIgKyAiRE9NSW1wbGVtZW50YXRpb24uaGFzRmVhdHVyZSgpLCBhcyBpdCBpcyBub3RvcmlvdXNseSAiICsgInVucmVsaWFibGUgYW5kIGltcHJlY2lzZS4gIiArICJVc2UgZXhwbGljaXQgZmVhdHVyZSB0ZXN0aW5nIGluc3RlYWQuIik7CgogICAgICAgICAgICAgICAgICAgIHZhciBmID0gc3VwcG9ydGVkRmVhdHVyZXNbZmVhdHVyZS50b0xvd2VyQ2FzZSgpXTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYgJiYgZlt2ZXJzaW9uXSB8fCBmYWxzZTsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgY3JlYXRlRG9jdW1lbnRUeXBlOiBmdW5jdGlvbiBjcmVhdGVEb2N1bWVudFR5cGUocXVhbGlmaWVkTmFtZSwgcHVibGljSWQsIHN5c3RlbUlkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF4bWwuaXNWYWxpZE5hbWUocXVhbGlmaWVkTmFtZSkpIEludmFsaWRDaGFyYWN0ZXJFcnJvcigpOwogICAgICAgICAgICAgICAgICAgIGlmICgheG1sLmlzVmFsaWRRTmFtZShxdWFsaWZpZWROYW1lKSkgTmFtZXNwYWNlRXJyb3IoKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBpbXBsLkRvY3VtZW50VHlwZShxdWFsaWZpZWROYW1lLCBwdWJsaWNJZCwgc3lzdGVtSWQpOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBjcmVhdGVEb2N1bWVudDogZnVuY3Rpb24gY3JlYXRlRG9jdW1lbnQobmFtZXNwYWNlLCBxdWFsaWZpZWROYW1lLCBkb2N0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgICAgICAvLyBOb3RlIHRoYXQgdGhlIGN1cnJlbnQgRE9NQ29yZSBzcGVjIG1ha2VzIGl0IGltcG9zc2libGUgdG8KICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYW4gSFRNTCBkb2N1bWVudCB3aXRoIHRoaXMgZnVuY3Rpb24sIGV2ZW4gaWYgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gbmFtZXNwYWNlIGFuZCBkb2N0eXBlIGFyZSBwcm9wZXJ0bHkgc2V0LiAgU2VlIHRoaXMgdGhyZWFkOgogICAgICAgICAgICAgICAgICAgIC8vIGh0dHA6Ly9saXN0cy53My5vcmcvQXJjaGl2ZXMvUHVibGljL3d3dy1kb20vMjAxMUFwckp1bi8wMTMyLmh0bWwKICAgICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICAgIHZhciBhZGRyZXNzID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudGx5RXhlY3V0aW5nU2NyaXB0KSBhZGRyZXNzID0gY3VycmVudGx5RXhlY3V0aW5nU2NyaXB0Lm93bmVyRG9jdW1lbnQuX2FkZHJlc3M7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBuZXcgaW1wbC5Eb2N1bWVudChmYWxzZSwgYWRkcmVzcyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGU7CgogICAgICAgICAgICAgICAgICAgIGlmIChxdWFsaWZpZWROYW1lKSBlID0gZC5jcmVhdGVFbGVtZW50TlMobmFtZXNwYWNlLCBxdWFsaWZpZWROYW1lKTtlbHNlIGUgPSBudWxsOwoKICAgICAgICAgICAgICAgICAgICBpZiAoZG9jdHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZG9jdHlwZS5vd25lckRvY3VtZW50KSBXcm9uZ0RvY3VtZW50RXJyb3IoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZC5hcHBlbmRDaGlsZChkb2N0eXBlKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChlKSBkLmFwcGVuZENoaWxkKGUpOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZDsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgY3JlYXRlSFRNTERvY3VtZW50OiBmdW5jdGlvbiBjcmVhdGVIVE1MRG9jdW1lbnQodGl0bGVUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFkZHJlc3MgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50bHlFeGVjdXRpbmdTY3JpcHQpIGFkZHJlc3MgPSBjdXJyZW50bHlFeGVjdXRpbmdTY3JpcHQub3duZXJEb2N1bWVudC5fYWRkcmVzczsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBpbXBsLkRvY3VtZW50KHRydWUsIGFkZHJlc3MpOwogICAgICAgICAgICAgICAgICAgIGQuYXBwZW5kQ2hpbGQobmV3IGltcGwuRG9jdW1lbnRUeXBlKCJodG1sIikpOwogICAgICAgICAgICAgICAgICAgIHZhciBodG1sID0gZC5jcmVhdGVFbGVtZW50KCJodG1sIik7CiAgICAgICAgICAgICAgICAgICAgZC5hcHBlbmRDaGlsZChodG1sKTsKICAgICAgICAgICAgICAgICAgICB2YXIgaGVhZCA9IGQuY3JlYXRlRWxlbWVudCgiaGVhZCIpOwogICAgICAgICAgICAgICAgICAgIGh0bWwuYXBwZW5kQ2hpbGQoaGVhZCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gZC5jcmVhdGVFbGVtZW50KCJ0aXRsZSIpOwogICAgICAgICAgICAgICAgICAgIGhlYWQuYXBwZW5kQ2hpbGQodGl0bGUpOwogICAgICAgICAgICAgICAgICAgIHRpdGxlLmFwcGVuZENoaWxkKGQuY3JlYXRlVGV4dE5vZGUodGl0bGVUZXh0KSk7CiAgICAgICAgICAgICAgICAgICAgaHRtbC5hcHBlbmRDaGlsZChkLmNyZWF0ZUVsZW1lbnQoImJvZHkiKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIG1velNldE91dHB1dE11dGF0aW9uSGFuZGxlcjogZnVuY3Rpb24gKGRvYywgaGFuZGxlcikgewogICAgICAgICAgICAgICAgICAgIGRvYy5tdXRhdGlvbkhhbmRsZXIgPSBoYW5kbGVyOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBtb3pHZXRJbnB1dE11dGF0aW9uSGFuZGxlcjogZnVuY3Rpb24gKGRvYykgewogICAgICAgICAgICAgICAgICAgIG55aSgpOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBtb3pIVE1MUGFyc2VyOiBIVE1MUGFyc2VyCiAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXR1cm4gRE9NSW1wbGVtZW50YXRpb247CiAgICAgICAgfSk7CgogICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgKiAgc3JjL2ltcGwvRmlsdGVyZWRFbGVtZW50TGlzdC5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL2ltcGwvRmlsdGVyZWRFbGVtZW50TGlzdC5qcyIKICAgICAgICAvLwogICAgICAgIC8vIFRoaXMgZmlsZSBkZWZpbmVzIG5vZGUgbGlzdCBpbXBsZW1lbnRhdGlvbiB0aGF0IGxhemlseSB0cmF2ZXJzZXMKICAgICAgICAvLyB0aGUgZG9jdW1lbnQgdHJlZSAob3IgYSBzdWJ0cmVlIHJvb3RlZCBhdCBhbnkgZWxlbWVudCkgYW5kIGluY2x1ZGVzCiAgICAgICAgLy8gb25seSB0aG9zZSBlbGVtZW50cyBmb3Igd2hpY2ggYSBzcGVjaWZpZWQgZmlsdGVyIGZ1bmN0aW9uIHJldHVybnMgdHJ1ZS4KICAgICAgICAvLyBJdCBpcyB1c2VkIHRvIGltcGxlbWVudCB0aGUKICAgICAgICAvLyB7RG9jdW1lbnQsRWxlbWVudH0uZ2V0RWxlbWVudHNCeXtUYWdOYW1lLENsYXNzTmFtZX17LE5TfSBtZXRob2RzLgogICAgICAgIC8vCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJGaWx0ZXJlZEVsZW1lbnRMaXN0IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBGaWx0ZXJlZEVsZW1lbnRMaXN0KHJvb3QsIGZpbHRlcikgewogICAgICAgICAgICAgICAgdGhpcy5yb290ID0gcm9vdDsKICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyID0gZmlsdGVyOwogICAgICAgICAgICAgICAgdGhpcy5sYXN0TW9kVGltZSA9IHJvb3QubGFzdE1vZFRpbWU7CiAgICAgICAgICAgICAgICB0aGlzLmRvbmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuY2FjaGUgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgRmlsdGVyZWRFbGVtZW50TGlzdC5wcm90b3R5cGUgPSB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogIk5vZGVMaXN0IiwKCiAgICAgICAgICAgICAgICBnZXQgbGVuZ3RoKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tjYWNoZSgpOwogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5kb25lKSB0aGlzLnRyYXZlcnNlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUubGVuZ3RoOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBpdGVtOiBmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tjYWNoZSgpOwogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5kb25lICYmIG4gPj0gdGhpcy5jYWNoZS5sZW5ndGgpIHRoaXMudHJhdmVyc2Uobik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGVbbl07CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIGNoZWNrY2FjaGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5sYXN0TW9kVGltZSAhPT0gdGhpcy5yb290Lmxhc3RNb2RUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN1YnRyZWUgaGFzIGNoYW5nZWQsIHNvIGludmFsaWRhdGUgY2FjaGUKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWNoZS5sZW5ndGggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRvbmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0TW9kVGltZSA9IHRoaXMucm9vdC5sYXN0TW9kVGltZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8vIElmIG4gaXMgc3BlY2lmaWVkLCB0aGVuIHRyYXZlcnNlIHRoZSB0cmVlIHVudGlsIHdlJ3ZlIGZvdW5kIHRoZSBudGgKICAgICAgICAgICAgICAgIC8vIGl0ZW0gKG9yIHVudGlsIHdlJ3ZlIGZvdW5kIGFsbCBpdGVtcykuICBJZiBuIGlzIG5vdCBzcGVjaWZpZWQsCiAgICAgICAgICAgICAgICAvLyB0cmF2ZXJzZSB1bnRpbCB3ZSd2ZSBmb3VuZCBhbGwgaXRlbXMuCiAgICAgICAgICAgICAgICB0cmF2ZXJzZTogZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgICAgICAvLyBpbmNyZW1lbnQgbiBzbyB3ZSBjYW4gY29tcGFyZSB0byBsZW5ndGgsIGFuZCBzbyBpdCBpcyBuZXZlciBmYWxzeQogICAgICAgICAgICAgICAgICAgIGlmIChuICE9PSB1bmRlZmluZWQpIG4rKzsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGVsdDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoZWx0ID0gdGhpcy5uZXh0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0aGlzLmNhY2hlLCBlbHQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobiAmJiB0aGlzLmNhY2hlLmxlbmd0aCA9PT0gbikgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gbm8gbmV4dCBlbGVtZW50LCBzbyB3ZSd2ZSBmb3VuZCBldmVyeXRoaW5nCiAgICAgICAgICAgICAgICAgICAgdGhpcy5kb25lID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBuZXh0IGVsZW1lbnQgdW5kZXIgcm9vdCB0aGF0IG1hdGNoZXMgZmlsdGVyCiAgICAgICAgICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5jYWNoZS5sZW5ndGggPT0gMCA/IC8vIFN0YXJ0IGF0IHRoZSByb290IG9yIGF0CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb290IC8vIHRoZSBsYXN0IGVsZW1lbnQgd2UgZm91bmQKICAgICAgICAgICAgICAgICAgICA6IHRoaXMuY2FjaGVbdGhpcy5jYWNoZS5sZW5ndGggLSAxXTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGVsdDsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnQubm9kZVR5cGUgPT09IERPQ1VNRU5UX05PREUpIGVsdCA9IHN0YXJ0LmRvY3VtZW50RWxlbWVudDtlbHNlIGVsdCA9IHN0YXJ0Lm5leHRFbGVtZW50KHRoaXMucm9vdCk7CgogICAgICAgICAgICAgICAgICAgIHdoaWxlIChlbHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmlsdGVyKGVsdCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGVsdCA9IGVsdC5uZXh0RWxlbWVudCh0aGlzLnJvb3QpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiBGaWx0ZXJlZEVsZW1lbnRMaXN0OwogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL0V2ZW50LmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9FdmVudC5qcyIKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkV2ZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBFdmVudCh0eXBlLCBkaWN0aW9uYXJ5KSB7CiAgICAgICAgICAgICAgICAvLyBJbml0aWFsaXplIGJhc2ljIGV2ZW50IHByb3BlcnRpZXMKICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICIiOwogICAgICAgICAgICAgICAgdGhpcy50YXJnZXQgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VGFyZ2V0ID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRQaGFzZSA9IEFUX1RBUkdFVDsKICAgICAgICAgICAgICAgIHRoaXMuYnViYmxlcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5jYW5jZWxhYmxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLmlzVHJ1c3RlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0UHJldmVudGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLnRpbWVTdGFtcCA9IERhdGUubm93KCk7CgogICAgICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBpbnRlcm5hbCBmbGFncwogICAgICAgICAgICAgICAgLy8gWFhYOiBXb3VsZCBpdCBiZSBiZXR0ZXIgdG8gaW5oZXJpdCB0aGVzZSBkZWZhdWx0cyBmcm9tIHRoZSBwcm90b3R5cGU/CiAgICAgICAgICAgICAgICB0aGlzLl9wcm9wYWdhdGlvblN0b3BwZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuX2ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5fZGlzcGF0Y2hpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAvLyBOb3cgaW5pdGlhbGl6ZSBiYXNlZCBvbiB0aGUgY29uc3RydWN0b3IgYXJndW1lbnRzIChpZiBhbnkpCiAgICAgICAgICAgICAgICBpZiAodHlwZSkgdGhpcy50eXBlID0gdHlwZTsKICAgICAgICAgICAgICAgIGlmIChkaWN0aW9uYXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBkaWN0aW9uYXJ5KSB0aGlzW3BdID0gZGljdGlvbmFyeVtwXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgRXZlbnQucHJvdG90eXBlID0gTy5jcmVhdGUoT2JqZWN0LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJFdmVudCIpLAogICAgICAgICAgICAgICAgc3RvcFByb3BhZ2F0aW9uOiBjb25zdGFudChmdW5jdGlvbiBzdG9wUHJvcGFnYXRpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGFnYXRpb25TdG9wcGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjogY29uc3RhbnQoZnVuY3Rpb24gc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BhZ2F0aW9uU3RvcHBlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0OiBjb25zdGFudChmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdCgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jYW5jZWxhYmxlKSB0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgaW5pdEV2ZW50OiBjb25zdGFudChmdW5jdGlvbiBpbml0RXZlbnQodHlwZSwgYnViYmxlcywgY2FuY2VsYWJsZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fZGlzcGF0Y2hpbmcpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGFnYXRpb25TdG9wcGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0UHJldmVudGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1RydXN0ZWQgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXJnZXQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5idWJibGVzID0gYnViYmxlczsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbGFibGUgPSBjYW5jZWxhYmxlOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEV2ZW50OwogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL0N1c3RvbUV2ZW50LmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9DdXN0b21FdmVudC5qcyIKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkN1c3RvbUV2ZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBDdXN0b21FdmVudCh0eXBlLCBkaWN0aW9uYXJ5KSB7CiAgICAgICAgICAgICAgICAvLyBKdXN0IHVzZSB0aGUgc3VwZXJjbGFzcyBjb25zdHJ1Y3RvciB0byBpbml0aWFsaXplCiAgICAgICAgICAgICAgICBpbXBsLkV2ZW50LmNhbGwodGhpcywgdHlwZSwgZGljdGlvbmFyeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQ3VzdG9tRXZlbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5FdmVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiQ3VzdG9tRXZlbnQiKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIEN1c3RvbUV2ZW50OwogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL1VJRXZlbnQuanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy9pbXBsL1VJRXZlbnQuanMiCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJVSUV2ZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBVSUV2ZW50KCkgewogICAgICAgICAgICAgICAgLy8gSnVzdCB1c2UgdGhlIHN1cGVyY2xhc3MgY29uc3RydWN0b3IgdG8gaW5pdGlhbGl6ZQogICAgICAgICAgICAgICAgaW1wbC5FdmVudC5jYWxsKHRoaXMpOwoKICAgICAgICAgICAgICAgIHRoaXMudmlldyA9IG51bGw7IC8vIEZGIHVzZXMgdGhlIGN1cnJlbnQgd2luZG93CiAgICAgICAgICAgICAgICB0aGlzLmRldGFpbCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgVUlFdmVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkV2ZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJVSUV2ZW50IiksCiAgICAgICAgICAgICAgICBpbml0VUlFdmVudDogY29uc3RhbnQoZnVuY3Rpb24gKHR5cGUsIGJ1YmJsZXMsIGNhbmNlbGFibGUsIHZpZXcsIGRldGFpbCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdEV2ZW50KHR5cGUsIGJ1YmJsZXMsIGNhbmNlbGFibGUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudmlldyA9IHZpZXc7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXRhaWwgPSBkZXRhaWw7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIFVJRXZlbnQ7CiAgICAgICAgfSk7CgogICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgKiAgc3JjL2ltcGwvTW91c2VFdmVudC5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL2ltcGwvTW91c2VFdmVudC5qcyIKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIk1vdXNlRXZlbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIE1vdXNlRXZlbnQoKSB7CiAgICAgICAgICAgICAgICAvLyBKdXN0IHVzZSB0aGUgc3VwZXJjbGFzcyBjb25zdHJ1Y3RvciB0byBpbml0aWFsaXplCiAgICAgICAgICAgICAgICBpbXBsLlVJRXZlbnQuY2FsbCh0aGlzKTsKCiAgICAgICAgICAgICAgICB0aGlzLnNjcmVlblggPSB0aGlzLnNjcmVlblkgPSB0aGlzLmNsaWVudFggPSB0aGlzLmNsaWVudFkgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5jdHJsS2V5ID0gdGhpcy5hbHRLZXkgPSB0aGlzLnNoaWZ0S2V5ID0gdGhpcy5tZXRhS2V5ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbiA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbnMgPSAxOwogICAgICAgICAgICAgICAgdGhpcy5yZWxhdGVkVGFyZ2V0ID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBNb3VzZUV2ZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuVUlFdmVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiTW91c2VFdmVudCIpLAogICAgICAgICAgICAgICAgaW5pdE1vdXNlRXZlbnQ6IGNvbnN0YW50KGZ1bmN0aW9uICh0eXBlLCBidWJibGVzLCBjYW5jZWxhYmxlLCB2aWV3LCBkZXRhaWwsIHNjcmVlblgsIHNjcmVlblksIGNsaWVudFgsIGNsaWVudFksIGN0cmxLZXksIGFsdEtleSwgc2hpZnRLZXksIG1ldGFLZXksIGJ1dHRvbiwgcmVsYXRlZFRhcmdldCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdEV2ZW50KHR5cGUsIGJ1YmJsZXMsIGNhbmNlbGFibGUsIHZpZXcsIGRldGFpbCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JlZW5YID0gc2NyZWVuWDsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcmVlblkgPSBzY3JlZW5ZOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50WCA9IGNsaWVudFg7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGllbnRZID0gY2xpZW50WTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmN0cmxLZXkgPSBjdHJsS2V5OwogICAgICAgICAgICAgICAgICAgIHRoaXMuYWx0S2V5ID0gYWx0S2V5OwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hpZnRLZXkgPSBzaGlmdEtleTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1ldGFLZXkgPSBtZXRhS2V5OwogICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9uID0gYnV0dG9uOwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYnV0dG9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9ucyA9IDE7YnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9ucyA9IDQ7YnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9ucyA9IDI7YnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbnMgPSAwO2JyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbGF0ZWRUYXJnZXQgPSByZWxhdGVkVGFyZ2V0OwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgZ2V0TW9kaWZpZXJTdGF0ZTogY29uc3RhbnQoZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoa2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIkFsdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hbHRLZXk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIkNvbnRyb2wiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3RybEtleTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiU2hpZnQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2hpZnRLZXk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIk1ldGEiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWV0YUtleTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBNb3VzZUV2ZW50OwogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL0hUTUxFbGVtZW50LmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9IVE1MRWxlbWVudC5qcyIKICAgICAgICB2YXIgdGFnTmFtZVRvSW50ZXJmYWNlTmFtZSA9IHsKICAgICAgICAgICAgImEiOiAiSFRNTEFuY2hvckVsZW1lbnQiLAogICAgICAgICAgICAiYWJiciI6ICJIVE1MRWxlbWVudCIsCiAgICAgICAgICAgICJhZGRyZXNzIjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgImFyZWEiOiAiSFRNTEFyZWFFbGVtZW50IiwKICAgICAgICAgICAgImFydGljbGUiOiAiSFRNTEVsZW1lbnQiLAogICAgICAgICAgICAiYXNpZGUiOiAiSFRNTEVsZW1lbnQiLAogICAgICAgICAgICAiYXVkaW8iOiAiSFRNTEF1ZGlvRWxlbWVudCIsCiAgICAgICAgICAgICJiIjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgImJhc2UiOiAiSFRNTEJhc2VFbGVtZW50IiwKICAgICAgICAgICAgImJkaSI6ICJIVE1MRWxlbWVudCIsCiAgICAgICAgICAgICJiZG8iOiAiSFRNTEVsZW1lbnQiLAogICAgICAgICAgICAiYmxvY2txdW90ZSI6ICJIVE1MUXVvdGVFbGVtZW50IiwKICAgICAgICAgICAgImJvZHkiOiAiSFRNTEJvZHlFbGVtZW50IiwKICAgICAgICAgICAgImJyIjogIkhUTUxCUkVsZW1lbnQiLAogICAgICAgICAgICAiYnV0dG9uIjogIkhUTUxCdXR0b25FbGVtZW50IiwKICAgICAgICAgICAgImNhbnZhcyI6ICJIVE1MQ2FudmFzRWxlbWVudCIsCiAgICAgICAgICAgICJjYXB0aW9uIjogIkhUTUxUYWJsZUNhcHRpb25FbGVtZW50IiwKICAgICAgICAgICAgImNpdGUiOiAiSFRNTEVsZW1lbnQiLAogICAgICAgICAgICAiY29kZSI6ICJIVE1MRWxlbWVudCIsCiAgICAgICAgICAgICJjb2wiOiAiSFRNTFRhYmxlQ29sRWxlbWVudCIsCiAgICAgICAgICAgICJjb2xncm91cCI6ICJIVE1MVGFibGVDb2xFbGVtZW50IiwKICAgICAgICAgICAgImNvbW1hbmQiOiAiSFRNTENvbW1hbmRFbGVtZW50IiwKICAgICAgICAgICAgImRhdGFsaXN0IjogIkhUTUxEYXRhTGlzdEVsZW1lbnQiLAogICAgICAgICAgICAiZGQiOiAiSFRNTEVsZW1lbnQiLAogICAgICAgICAgICAiZGVsIjogIkhUTUxNb2RFbGVtZW50IiwKICAgICAgICAgICAgImRldGFpbHMiOiAiSFRNTERldGFpbHNFbGVtZW50IiwKICAgICAgICAgICAgImRmbiI6ICJIVE1MRWxlbWVudCIsCiAgICAgICAgICAgICJkaXYiOiAiSFRNTERpdkVsZW1lbnQiLAogICAgICAgICAgICAiZGwiOiAiSFRNTERMaXN0RWxlbWVudCIsCiAgICAgICAgICAgICJkdCI6ICJIVE1MRWxlbWVudCIsCiAgICAgICAgICAgICJlbSI6ICJIVE1MRWxlbWVudCIsCiAgICAgICAgICAgICJlbWJlZCI6ICJIVE1MRW1iZWRFbGVtZW50IiwKICAgICAgICAgICAgImZpZWxkc2V0IjogIkhUTUxGaWVsZFNldEVsZW1lbnQiLAogICAgICAgICAgICAiZmlnY2FwdGlvbiI6ICJIVE1MRWxlbWVudCIsCiAgICAgICAgICAgICJmaWd1cmUiOiAiSFRNTEVsZW1lbnQiLAogICAgICAgICAgICAiZm9vdGVyIjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgImZvcm0iOiAiSFRNTEZvcm1FbGVtZW50IiwKICAgICAgICAgICAgImZyYW1lIjogIkhUTUxGcmFtZUVsZW1lbnQiLAogICAgICAgICAgICAiZnJhbWVzZXQiOiAiSFRNTEZyYW1lU2V0RWxlbWVudCIsCiAgICAgICAgICAgICJoMSI6ICJIVE1MSGVhZGluZ0VsZW1lbnQiLAogICAgICAgICAgICAiaDIiOiAiSFRNTEhlYWRpbmdFbGVtZW50IiwKICAgICAgICAgICAgImgzIjogIkhUTUxIZWFkaW5nRWxlbWVudCIsCiAgICAgICAgICAgICJoNCI6ICJIVE1MSGVhZGluZ0VsZW1lbnQiLAogICAgICAgICAgICAiaDUiOiAiSFRNTEhlYWRpbmdFbGVtZW50IiwKICAgICAgICAgICAgImg2IjogIkhUTUxIZWFkaW5nRWxlbWVudCIsCiAgICAgICAgICAgICJoZWFkIjogIkhUTUxIZWFkRWxlbWVudCIsCiAgICAgICAgICAgICJoZWFkZXIiOiAiSFRNTEVsZW1lbnQiLAogICAgICAgICAgICAiaGdyb3VwIjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgImhyIjogIkhUTUxIUkVsZW1lbnQiLAogICAgICAgICAgICAiaHRtbCI6ICJIVE1MSHRtbEVsZW1lbnQiLAogICAgICAgICAgICAiaSI6ICJIVE1MRWxlbWVudCIsCiAgICAgICAgICAgICJpZnJhbWUiOiAiSFRNTElGcmFtZUVsZW1lbnQiLAogICAgICAgICAgICAiaW1nIjogIkhUTUxJbWFnZUVsZW1lbnQiLAogICAgICAgICAgICAiaW5wdXQiOiAiSFRNTElucHV0RWxlbWVudCIsCiAgICAgICAgICAgICJpbnMiOiAiSFRNTE1vZEVsZW1lbnQiLAogICAgICAgICAgICAia2JkIjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgImtleWdlbiI6ICJIVE1MS2V5Z2VuRWxlbWVudCIsCiAgICAgICAgICAgICJsYWJlbCI6ICJIVE1MTGFiZWxFbGVtZW50IiwKICAgICAgICAgICAgImxlZ2VuZCI6ICJIVE1MTGVnZW5kRWxlbWVudCIsCiAgICAgICAgICAgICJsaSI6ICJIVE1MTElFbGVtZW50IiwKICAgICAgICAgICAgImxpbmsiOiAiSFRNTExpbmtFbGVtZW50IiwKICAgICAgICAgICAgIm1hcCI6ICJIVE1MTWFwRWxlbWVudCIsCiAgICAgICAgICAgICJtYXJrIjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgIm1lbnUiOiAiSFRNTE1lbnVFbGVtZW50IiwKICAgICAgICAgICAgIm1ldGEiOiAiSFRNTE1ldGFFbGVtZW50IiwKICAgICAgICAgICAgIm1ldGVyIjogIkhUTUxNZXRlckVsZW1lbnQiLAogICAgICAgICAgICAibmF2IjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgIm5vc2NyaXB0IjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgIm9iamVjdCI6ICJIVE1MT2JqZWN0RWxlbWVudCIsCiAgICAgICAgICAgICJvbCI6ICJIVE1MT0xpc3RFbGVtZW50IiwKICAgICAgICAgICAgIm9wdGdyb3VwIjogIkhUTUxPcHRHcm91cEVsZW1lbnQiLAogICAgICAgICAgICAib3B0aW9uIjogIkhUTUxPcHRpb25FbGVtZW50IiwKICAgICAgICAgICAgIm91dHB1dCI6ICJIVE1MT3V0cHV0RWxlbWVudCIsCiAgICAgICAgICAgICJwIjogIkhUTUxQYXJhZ3JhcGhFbGVtZW50IiwKICAgICAgICAgICAgInBhcmFtIjogIkhUTUxQYXJhbUVsZW1lbnQiLAogICAgICAgICAgICAicHJlIjogIkhUTUxQcmVFbGVtZW50IiwKICAgICAgICAgICAgInByb2dyZXNzIjogIkhUTUxQcm9ncmVzc0VsZW1lbnQiLAogICAgICAgICAgICAicSI6ICJIVE1MUXVvdGVFbGVtZW50IiwKICAgICAgICAgICAgInJwIjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgInJ0IjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgInJ1YnkiOiAiSFRNTEVsZW1lbnQiLAogICAgICAgICAgICAicyI6ICJIVE1MRWxlbWVudCIsCiAgICAgICAgICAgICJzYW1wIjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgInNjcmlwdCI6ICJIVE1MU2NyaXB0RWxlbWVudCIsCiAgICAgICAgICAgICJzZWN0aW9uIjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgInNlbGVjdCI6ICJIVE1MU2VsZWN0RWxlbWVudCIsCiAgICAgICAgICAgICJzbWFsbCI6ICJIVE1MRWxlbWVudCIsCiAgICAgICAgICAgICJzb3VyY2UiOiAiSFRNTFNvdXJjZUVsZW1lbnQiLAogICAgICAgICAgICAic3BhbiI6ICJIVE1MU3BhbkVsZW1lbnQiLAogICAgICAgICAgICAic3Ryb25nIjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgInN0eWxlIjogIkhUTUxTdHlsZUVsZW1lbnQiLAogICAgICAgICAgICAic3ViIjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgInN1bW1hcnkiOiAiSFRNTEVsZW1lbnQiLAogICAgICAgICAgICAic3VwIjogIkhUTUxFbGVtZW50IiwKICAgICAgICAgICAgInRhYmxlIjogIkhUTUxUYWJsZUVsZW1lbnQiLAogICAgICAgICAgICAidGJvZHkiOiAiSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQiLAogICAgICAgICAgICAidGQiOiAiSFRNTFRhYmxlRGF0YUNlbGxFbGVtZW50IiwKICAgICAgICAgICAgInRleHRhcmVhIjogIkhUTUxUZXh0QXJlYUVsZW1lbnQiLAogICAgICAgICAgICAidGZvb3QiOiAiSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQiLAogICAgICAgICAgICAidGgiOiAiSFRNTFRhYmxlSGVhZGVyQ2VsbEVsZW1lbnQiLAogICAgICAgICAgICAidGhlYWQiOiAiSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQiLAogICAgICAgICAgICAidGltZSI6ICJIVE1MVGltZUVsZW1lbnQiLAogICAgICAgICAgICAidGl0bGUiOiAiSFRNTFRpdGxlRWxlbWVudCIsCiAgICAgICAgICAgICJ0ciI6ICJIVE1MVGFibGVSb3dFbGVtZW50IiwKICAgICAgICAgICAgInRyYWNrIjogIkhUTUxUcmFja0VsZW1lbnQiLAogICAgICAgICAgICAidSI6ICJIVE1MRWxlbWVudCIsCiAgICAgICAgICAgICJ1bCI6ICJIVE1MVUxpc3RFbGVtZW50IiwKICAgICAgICAgICAgInZhciI6ICJIVE1MRWxlbWVudCIsCiAgICAgICAgICAgICJ2aWRlbyI6ICJIVE1MVmlkZW9FbGVtZW50IiwKICAgICAgICAgICAgIndiciI6ICJIVE1MRWxlbWVudCIKICAgICAgICB9OwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgSFRNTF9OQU1FU1BBQ0UsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTEVsZW1lbnQiKSwKICAgICAgICAgICAgICAgIGlubmVySFRNTDogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJpYWxpemUoKTsKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh2KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnNlciA9IHRoaXMub3duZXJEb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5tb3pIVE1MUGFyc2VyKHRoaXMub3duZXJEb2N1bWVudC5fYWRkcmVzcywgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLnBhcnNlKHYsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIHZhciB0bXBkb2MgPSBwYXJzZXIuZG9jdW1lbnQoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgcm9vdCA9IHRtcGRvYy5maXJzdENoaWxkOwoKICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgYW55IGV4aXN0aW5nIGNoaWxkcmVuIG9mIHRoaXMgbm9kZQogICAgICAgICAgICAgICAgICAgIHdoaWxlICh0aGlzLmhhc0NoaWxkTm9kZXMoKSkgdGhpcy5yZW1vdmVDaGlsZCh0aGlzLmZpcnN0Q2hpbGQpOwoKICAgICAgICAgICAgICAgICAgICAvLyBOb3cgY29weSBuZXdseSBwYXJzZWQgY2hpbGRyZW4gZnJvbSB0aGUgcm9vdCB0byB0aGlzIG5vZGUKICAgICAgICAgICAgICAgICAgICB3aGlsZSAocm9vdC5oYXNDaGlsZE5vZGVzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRDaGlsZChyb290LmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgc3R5bGU6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9zdHlsZSkgdGhpcy5fc3R5bGUgPSBuZXcgaW1wbC5DU1NTdHlsZURlY2xhcmF0aW9uKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdHlsZTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIGNsaWNrOiBjb25zdGFudChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NsaWNrX2luX3Byb2dyZXNzKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2xpY2tfaW5fcHJvZ3Jlc3MgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wcmVfY2xpY2tfYWN0aXZhdGlvbl9zdGVwcykgdGhpcy5fcHJlX2NsaWNrX2FjdGl2YXRpb25fc3RlcHMoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBldmVudCA9IHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVFdmVudCgiTW91c2VFdmVudCIpOwogICAgICAgICAgICAgICAgICAgICAgICBldmVudC5pbml0TW91c2VFdmVudCgiY2xpY2siLCB0cnVlLCB0cnVlLCB0aGlzLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcsIDEsIDAsIDAsIDAsIDAsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZXNlIDQgc2hvdWxkIGJlIGluaXRpYWxpemVkIHdpdGgKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGFjdHVhbGx5IGN1cnJlbnQga2V5Ym9hcmQgc3RhdGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gc29tZWhvdy4uLgogICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMCwgbnVsbCk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBEaXNwYXRjaCB0aGlzIGFzIGFuIHVudHJ1c3RlZCBldmVudCBzaW5jZSBpdCBpcyBzeW50aGV0aWMKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wb3N0X2NsaWNrX2FjdGl2YXRpb25fc3RlcHMpIHRoaXMuX3Bvc3RfY2xpY2tfYWN0aXZhdGlvbl9zdGVwcyhldmVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fY2FuY2VsbGVkX2FjdGl2YXRpb25fc3RlcHMpIHRoaXMuX2NhbmNlbGxlZF9hY3RpdmF0aW9uX3N0ZXBzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jbGlja19pbl9wcm9ncmVzcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEVsZW1lbnQsICJ0aXRsZSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MRWxlbWVudCwgImxhbmciKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RFbnVtZXJhdGVkQXR0cmlidXRlKEhUTUxFbGVtZW50LCAiZGlyIiwgbnVsbCwgewogICAgICAgICAgICAgICAgbHRyOiAibHRyIiwKICAgICAgICAgICAgICAgIHJ0bDogInJ0bCIsCiAgICAgICAgICAgICAgICBhdXRvOiAiYXV0byIKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MRWxlbWVudCwgImFjY2Vzc2tleSIsICJhY2Nlc3NLZXkiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RCb29sZWFuQXR0cmlidXRlKEhUTUxFbGVtZW50LCAiaGlkZGVuIik7CgogICAgICAgICAgICAvLyBYWFg6IHRoZSBkZWZhdWx0IHZhbHVlIGZvciB0YWJJbmRleCBzaG91bGQgYmUgMCBpZiB0aGUgZWxlbWVudCBpcwogICAgICAgICAgICAvLyBmb2N1c2FibGUgYW5kIC0xIGlmIGl0IGlzIG5vdC4gIEJ1dCB0aGUgZnVsbCBkZWZpbml0aW9uIG9mIGZvY3VzYWJsZQogICAgICAgICAgICAvLyBpcyBhY3R1YWxseSBoYXJkIHRvIGNvbXB1dGUsIHNvIGZvciBub3csIEknbGwgZm9sbG93IEZpcmVmb3ggYW5kCiAgICAgICAgICAgIC8vIGp1c3QgYmFzZSB0aGUgZGVmYXVsdCB2YWx1ZSBvbiB0aGUgdHlwZSBvZiB0aGUgZWxlbWVudC4KICAgICAgICAgICAgdmFyIGZvY3VzYWJsZUVsZW1lbnRzID0gewogICAgICAgICAgICAgICAgIkEiOiB0cnVlLCAiTElOSyI6IHRydWUsICJCVVRUT04iOiB0cnVlLCAiSU5QVVQiOiB0cnVlLAogICAgICAgICAgICAgICAgIlNFTEVDVCI6IHRydWUsICJURVhUQVJFQSI6IHRydWUsICJDT01NQU5EIjogdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEludGVnZXJBdHRyaWJ1dGUoSFRNTEVsZW1lbnQsICJ0YWJpbmRleCIsCiAgICAgICAgICAgIC8vIGNvbXB1dGUgYSBkZWZhdWx0IHRhYkluZGV4IHZhbHVlCiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRhZ05hbWUgaW4gZm9jdXNhYmxlRWxlbWVudHMgfHwgdGhpcy5jb250ZW50RWRpdGFibGUpIHJldHVybiAwO2Vsc2UgcmV0dXJuIC0xOwogICAgICAgICAgICB9LCAidGFiSW5kZXgiKTsKCiAgICAgICAgICAgIC8vIFhYWDogcmVmbGVjdCBjb250ZXh0bWVudSBhcyBjb250ZXh0TWVudSwgd2l0aCBlbGVtZW50IHR5cGUKCgogICAgICAgICAgICAvLyBzdHlsZTogdGhlIHNwZWMgZG9lc24ndCBjYWxsIHRoaXMgYSByZWZsZWN0ZWQgYXR0cmlidXRlLgogICAgICAgICAgICAvLyAgIG1heSB3YW50IHRvIGhhbmRsZSBpdCBtYW51YWxseS4KCiAgICAgICAgICAgIC8vIGNvbnRlbnRFZGl0YWJsZTogZW51bWVyYXRlZCwgbm90IGNsZWFyIGlmIGl0IGlzIGFjdHVhbGx5CiAgICAgICAgICAgIC8vIHJlZmxlY3RlZCBvciByZXF1aXJlcyBjdXN0b20gZ2V0dGVyL3NldHRlci4gTm90IGxpc3RlZCBhcwogICAgICAgICAgICAvLyAibGltaXRlZCB0byBrbm93biB2YWx1ZXMiLiAgUmFpc2VzIHN5bnRheF9lcnIgb24gYmFkIHNldHRpbmcsCiAgICAgICAgICAgIC8vIHNvIEkgdGhpbmsgdGhpcyBpcyBjdXN0b20uCgogICAgICAgICAgICAvLyBjb250ZXh0bWVudTogY29udGVudCBpcyBlbGVtZW50IGlkLCBpZGwgdHlwZSBpcyBhbiBlbGVtZW50CiAgICAgICAgICAgIC8vIGRyYWdnYWJsZTogYm9vbGVhbiwgYnV0IG5vdCBhIHJlZmxlY3RlZCBhdHRyaWJ1dGUKICAgICAgICAgICAgLy8gZHJvcHpvbmU6IHJlZmxlY3RlZCBTZXR0YWJsZVRva2VuTGlzdCwgZXhwZXJpbWVudGFsLCBzbyBkb24ndAogICAgICAgICAgICAvLyAgIGltcGxlbWVudCBpdCByaWdodCBhd2F5LgoKICAgICAgICAgICAgLy8gZGF0YS0qIGF0dHJpYnV0ZXM6IG5lZWQgc3BlY2lhbCBoYW5kbGluZyBpbiBzZXRBdHRyaWJ1dGU/CiAgICAgICAgICAgIC8vIE9yIG1heWJlIHRoYXQgaXNuJ3QgbmVjZXNzYXJ5LiBDYW4gSSBqdXN0IHNjYW4gdGhlIGF0dHJpYnV0ZSBsaXN0CiAgICAgICAgICAgIC8vIHdoZW4gYnVpbGRpbmcgdGhlIGRhdGFzZXQ/ICBMaXZlbmVzcyBhbmQgY2FjaGluZyBpc3N1ZXM/CgogICAgICAgICAgICAvLyBtaWNyb2RhdGEgYXR0cmlidXRlczogbWFueSBhcmUgc2ltcGxlIHJlZmxlY3RlZCBhdHRyaWJ1dGVzLCBidXQKICAgICAgICAgICAgLy8gSSdtIG5vdCBnb2luZyB0byBpbXBsZW1lbnQgdGhpcyBub3cuCgoKICAgICAgICAgICAgdmFyIGV2ZW50SGFuZGxlclR5cGVzID0gWyJhYm9ydCIsICJjYW5wbGF5IiwgImNhbnBsYXl0aHJvdWdoIiwgImNoYW5nZSIsICJjbGljayIsICJjb250ZXh0bWVudSIsICJjdWVjaGFuZ2UiLCAiZGJsY2xpY2siLCAiZHJhZyIsICJkcmFnZW5kIiwgImRyYWdlbnRlciIsICJkcmFnbGVhdmUiLCAiZHJhZ292ZXIiLCAiZHJhZ3N0YXJ0IiwgImRyb3AiLCAiZHVyYXRpb25jaGFuZ2UiLCAiZW1wdGllZCIsICJlbmRlZCIsICJpbnB1dCIsICJpbnZhbGlkIiwgImtleWRvd24iLCAia2V5cHJlc3MiLCAia2V5dXAiLCAibG9hZGVkZGF0YSIsICJsb2FkZWRtZXRhZGF0YSIsICJsb2Fkc3RhcnQiLCAibW91c2Vkb3duIiwgIm1vdXNlbW92ZSIsICJtb3VzZW91dCIsICJtb3VzZW92ZXIiLCAibW91c2V1cCIsICJtb3VzZXdoZWVsIiwgInBhdXNlIiwgInBsYXkiLCAicGxheWluZyIsICJwcm9ncmVzcyIsICJyYXRlY2hhbmdlIiwgInJlYWR5c3RhdGVjaGFuZ2UiLCAicmVzZXQiLCAic2Vla2VkIiwgInNlZWtpbmciLCAic2VsZWN0IiwgInNob3ciLCAic3RhbGxlZCIsICJzdWJtaXQiLCAic3VzcGVuZCIsICJ0aW1ldXBkYXRlIiwgInZvbHVtZWNoYW5nZSIsICJ3YWl0aW5nIiwKCiAgICAgICAgICAgIC8vIFRoZXNlIGxhc3QgNSBldmVudCB0eXBlcyB3aWxsIGJlIG92ZXJyaWRlbiBieSBIVE1MQm9keUVsZW1lbnQKICAgICAgICAgICAgImJsdXIiLCAiZXJyb3IiLCAiZm9jdXMiLCAibG9hZCIsICJzY3JvbGwiXTsKCiAgICAgICAgICAgIGV2ZW50SGFuZGxlclR5cGVzLmZvckVhY2goZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICAgICAgICAgIC8vIERlZmluZSB0aGUgZXZlbnQgaGFuZGxlciByZWdpc3RyYXRpb24gSURMIGF0dHJpYnV0ZSBmb3IgdGhpcyB0eXBlCiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSFRNTEVsZW1lbnQucHJvdG90eXBlLCAib24iICsgdHlwZSwgewogICAgICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0RXZlbnRIYW5kbGVyKHR5cGUpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRFdmVudEhhbmRsZXIodHlwZSwgdik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gRXZlbnRIYW5kbGVyQ2hhbmdlSGFuZGxlcihlbHQsIG5hbWUsIG9sZHZhbCwgbmV3dmFsKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGRvYyA9IGVsdC5vd25lckRvY3VtZW50ID8gd3JhcChlbHQub3duZXJEb2N1bWVudCkgOiB7fTsKICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybSA9IGVsdC5mb3JtID8gd3JhcChlbHQuZm9ybSkgOiB7fTsKICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IHdyYXAoZWx0KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gRXZlbnRIYW5kbGVyQnVpbGRlciB1c2VzIHdpdGgsIHNvIGl0IGlzIGluIHNyYy9sb29zZS5qcwogICAgICAgICAgICAgICAgICAgIGVsdFtuYW1lXSA9IG5ldyBFdmVudEhhbmRsZXJCdWlsZGVyKG5ld3ZhbCwgZG9jLCBmb3JtLCBlbGVtZW50KS5idWlsZCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIERlZmluZSBzcGVjaWFsIGJlaGF2aW9yIGZvciB0aGUgY29udGVudCBhdHRyaWJ1dGUgYXMgd2VsbAogICAgICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZ2lzdGVyQXR0cmlidXRlQ2hhbmdlSGFuZGxlcihIVE1MRWxlbWVudCwgIm9uIiArIHR5cGUsIEV2ZW50SGFuZGxlckNoYW5nZUhhbmRsZXIpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MQW5jaG9yRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTEFuY2hvckVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MQW5jaG9yRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MQW5jaG9yRWxlbWVudCIpLAoKICAgICAgICAgICAgICAgIF9wb3N0X2NsaWNrX2FjdGl2YXRpb25fc3RlcHM6IGNvbnN0YW50KGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaHJlZikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBGb2xsb3cgdGhlIGxpbmsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiB0aGlzIGlzIGp1c3QgYSBxdWljayBoYWNrCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWDogdGhlIEhUTUwgc3BlYyBwcm9iYWJseSByZXF1aXJlcyBtb3JlIHRoYW4gdGhpcwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcubG9jYXRpb24gPSB0aGlzLmhyZWY7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBYWFggaW1wbC5FbGVtZW50LnJlZmxlY3RVUkxBdHRyaWJ1dGUoSFRNTEFuY2hvckVsZW1lbnQsICJocmVmIik7CiAgICAgICAgICAgIC8vIFhYWCBpbXBsLkVsZW1lbnQucmVmbGVjdFVSTEF0dHJpYnV0ZShIVE1MQW5jaG9yRWxlbWVudCwgInBpbmciKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEFuY2hvckVsZW1lbnQsICJkb3dubG9hZCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MQW5jaG9yRWxlbWVudCwgInRhcmdldCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MQW5jaG9yRWxlbWVudCwgInJlbCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MQW5jaG9yRWxlbWVudCwgIm1lZGlhIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxBbmNob3JFbGVtZW50LCAiaHJlZmxhbmciKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEFuY2hvckVsZW1lbnQsICJ0eXBlIik7CiAgICAgICAgICAgIC8vIFhYWDogYWxzbyByZWZsZWN0IHJlbExpc3QKCiAgICAgICAgICAgIHJldHVybiBIVE1MQW5jaG9yRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MQXJlYUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxBcmVhRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxBcmVhRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MQXJlYUVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFhYWCBpbXBsLkVsZW1lbnQucmVmbGVjdFVSTEF0dHJpYnV0ZShIVE1MQXJlYUVsZW1lbnQsICJocmVmIik7CiAgICAgICAgICAgIC8vIFhYWCBpbXBsLkVsZW1lbnQucmVmbGVjdFVSTEF0dHJpYnV0ZShIVE1MQXJlYUVsZW1lbnQsICJwaW5nIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxBcmVhRWxlbWVudCwgImFsdCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MQXJlYUVsZW1lbnQsICJ0YXJnZXQiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEFyZWFFbGVtZW50LCAiZG93bmxvYWQiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEFyZWFFbGVtZW50LCAicmVsIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxBcmVhRWxlbWVudCwgIm1lZGlhIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxBcmVhRWxlbWVudCwgImhyZWZsYW5nIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxBcmVhRWxlbWVudCwgInR5cGUiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEFyZWFFbGVtZW50LCAic2hhcGUiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEFyZWFFbGVtZW50LCAiY29vcmRzIik7CiAgICAgICAgICAgIC8vIFhYWDogYWxzbyByZWZsZWN0IHJlbExpc3QKCiAgICAgICAgICAgIHJldHVybiBIVE1MQXJlYUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTEJSRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTEJSRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxCUkVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTEJSRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxCUkVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTEJhc2VFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MQmFzZUVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MQmFzZUVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTEJhc2VFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MQmFzZUVsZW1lbnQsICJ0YXJnZXQiKTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MQmFzZUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTEJvZHlFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MQm9keUVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MQm9keUVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTEJvZHlFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBDZXJ0YWluIGV2ZW50IGhhbmRsZXIgYXR0cmlidXRlcyBvbiBhIDxib2R5PiB0YWcgYWN0dWFsbHkgc2V0CiAgICAgICAgICAgIC8vIGhhbmRsZXJzIGZvciB0aGUgd2luZG93IHJhdGhlciB0aGFuIGp1c3QgdGhhdCBlbGVtZW50LiAgRGVmaW5lCiAgICAgICAgICAgIC8vIGdldHRlcnMgYW5kIHNldHRlcnMgZm9yIHRob3NlIGhlcmUuICBOb3RlIHRoYXQgc29tZSBvZiB0aGVzZSBvdmVycmlkZQogICAgICAgICAgICAvLyBwcm9wZXJ0aWVzIG9uIEhUTUxFbGVtZW50LnByb3RvdHlwZS4KICAgICAgICAgICAgLy8gWFhYOiBJZiBJIGFkZCBzdXBwb3J0IGZvciA8ZnJhbWVzZXQ+LCB0aGVzZSBoYXZlIHRvIGdvIHRoZXJlLCB0b28KICAgICAgICAgICAgLy8gWFhYCiAgICAgICAgICAgIC8vIFdoZW4gdGhlIFdpbmRvdyBvYmplY3QgaXMgaW1wbGVtZW50ZWQsIHRoZXNlIGF0dHJpYnV0ZSB3aWxsIGhhdmUKICAgICAgICAgICAgLy8gdG8gd29yayB3aXRoIHRoZSBzYW1lLW5hbWVkIGF0dHJpYnV0ZXMgb24gdGhlIFdpbmRvdy4KCiAgICAgICAgICAgIHZhciBldmVudEhhbmRsZXJUeXBlcyA9IFsiYWZ0ZXJwcmludCIsICJiZWZvcmVwcmludCIsICJiZWZvcmV1bmxvYWQiLCAiYmx1ciIsICJlcnJvciIsICJmb2N1cyIsICJoYXNoY2hhbmdlIiwgImxvYWQiLCAibWVzc2FnZSIsICJvZmZsaW5lIiwgIm9ubGluZSIsICJwYWdlaGlkZSIsICJwYWdlc2hvdyIsICJwb3BzdGF0ZSIsICJyZXNpemUiLCAic2Nyb2xsIiwgInN0b3JhZ2UiLCAidW5sb2FkIl07CgogICAgICAgICAgICBldmVudEhhbmRsZXJUeXBlcy5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgICAgICAgICAvLyBEZWZpbmUgdGhlIGV2ZW50IGhhbmRsZXIgcmVnaXN0cmF0aW9uIElETCBhdHRyaWJ1dGUgZm9yIHRoaXMgdHlwZQogICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEhUTUxCb2R5RWxlbWVudC5wcm90b3R5cGUsICJvbiIgKyB0eXBlLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWDogcmVhZCB0aGVzZSBmcm9tIHRoZSBXaW5kb3cgb2JqZWN0IGluc3RlYWQ/CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRFdmVudEhhbmRsZXIodHlwZSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWDogd3JpdGUgdG8gdGhlIFdpbmRvdyBvYmplY3QgaW5zdGVhZD8KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0RXZlbnRIYW5kbGVyKHR5cGUsIHYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIEV2ZW50SGFuZGxlckNoYW5nZUhhbmRsZXIoZWx0LCBuYW1lLCBvbGR2YWwsIG5ld3ZhbCkgewogICAgICAgICAgICAgICAgICAgIHZhciBkb2MgPSBlbHQub3duZXJEb2N1bWVudCA/IHdyYXAoZWx0Lm93bmVyRG9jdW1lbnQpIDoge307CiAgICAgICAgICAgICAgICAgICAgdmFyIGZvcm0gPSBlbHQuZm9ybSA/IHdyYXAoZWx0LmZvcm0pIDoge307CiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB3cmFwKGVsdCk7CgogICAgICAgICAgICAgICAgICAgIC8vIEV2ZW50SGFuZGxlckJ1aWxkZXIgdXNlcyB3aXRoLCBzbyBpdCBpcyBpbiBzcmMvbG9vc2UuanMKICAgICAgICAgICAgICAgICAgICBlbHRbbmFtZV0gPSBuZXcgRXZlbnRIYW5kbGVyQnVpbGRlcihuZXd2YWwsIGRvYywgZm9ybSwgZWxlbWVudCkuYnVpbGQoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBEZWZpbmUgc3BlY2lhbCBiZWhhdmlvciBmb3IgdGhlIGNvbnRlbnQgYXR0cmlidXRlIGFzIHdlbGwKICAgICAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWdpc3RlckF0dHJpYnV0ZUNoYW5nZUhhbmRsZXIoSFRNTEJvZHlFbGVtZW50LCAib24iICsgdHlwZSwgRXZlbnRIYW5kbGVyQ2hhbmdlSGFuZGxlcik7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxCb2R5RWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MQnV0dG9uRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTEJ1dHRvbkVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MQnV0dG9uRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MQnV0dG9uRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEJ1dHRvbkVsZW1lbnQsICJuYW1lIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0Qm9vbGVhbkF0dHJpYnV0ZShIVE1MQnV0dG9uRWxlbWVudCwgImRpc2FibGVkIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0Qm9vbGVhbkF0dHJpYnV0ZShIVE1MQnV0dG9uRWxlbWVudCwgImF1dG9mb2N1cyIpOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEJ1dHRvbkVsZW1lbnQsICJ2YWx1ZSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEVudW1lcmF0ZWRBdHRyaWJ1dGUoSFRNTEJ1dHRvbkVsZW1lbnQsICJ0eXBlIiwgbnVsbCwgewogICAgICAgICAgICAgICAgc3VibWl0OiAic3VibWl0IiwKICAgICAgICAgICAgICAgIHJlc2V0OiAicmVzZXQiLAogICAgICAgICAgICAgICAgYnV0dG9uOiAiYnV0dG9uIgogICAgICAgICAgICB9LCAic3VibWl0Iik7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MQnV0dG9uRWxlbWVudCwgImZvcm10YXJnZXQiLCAiZm9ybVRhcmdldCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTEJ1dHRvbkVsZW1lbnQsICJmb3Jtbm92YWxpZGF0ZSIsICJmb3JtTm9WYWxpZGF0ZSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEVudW1lcmF0ZWRBdHRyaWJ1dGUoSFRNTEJ1dHRvbkVsZW1lbnQsICJmb3JtbWV0aG9kIiwgImZvcm1NZXRob2QiLCB7CiAgICAgICAgICAgICAgICBnZXQ6ICJnZXQiLAogICAgICAgICAgICAgICAgcG9zdDogInBvc3QiCiAgICAgICAgICAgIH0sICJnZXQiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RFbnVtZXJhdGVkQXR0cmlidXRlKEhUTUxCdXR0b25FbGVtZW50LCAiZm9ybWVuY3R5cGUiLCAiZm9ybUVuY3R5cGUiLCB7CiAgICAgICAgICAgICAgICAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsCiAgICAgICAgICAgICAgICAibXVsdGlwYXJ0L2Zvcm0tZGF0YSI6ICJtdWx0aXBhcnQvZm9ybS1kYXRhIiwKICAgICAgICAgICAgICAgICJ0ZXh0L3BsYWluIjogInRleHQvcGxhaW4iCiAgICAgICAgICAgIH0sICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MQnV0dG9uRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MQ29tbWFuZEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxDb21tYW5kRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxDb21tYW5kRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MQ29tbWFuZEVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0RW51bWVyYXRlZEF0dHJpYnV0ZShIVE1MQ29tbWFuZEVsZW1lbnQsICJ0eXBlIiwgbnVsbCwgewogICAgICAgICAgICAgICAgY29tbWFuZDogImNvbW1hbmQiLAogICAgICAgICAgICAgICAgY2hlY2tib3g6ICJjaGVja2JveCIsCiAgICAgICAgICAgICAgICByYWRpbzogInJhZGlvIgogICAgICAgICAgICB9LCAiY29tbWFuZCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MQ29tbWFuZEVsZW1lbnQsICJsYWJlbCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTENvbW1hbmRFbGVtZW50LCAiZGlzYWJsZWQiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RCb29sZWFuQXR0cmlidXRlKEhUTUxDb21tYW5kRWxlbWVudCwgImNoZWNrZWQiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTENvbW1hbmRFbGVtZW50LCAicmFkaW9ncm91cCIpOwogICAgICAgICAgICAvLyBYWFg6IGFsc28gcmVmbGVjdCBVUkwgYXR0cmlidXRlIGljb24KCiAgICAgICAgICAgIHJldHVybiBIVE1MQ29tbWFuZEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTERMaXN0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTERMaXN0RWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxETGlzdEVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTERMaXN0RWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxETGlzdEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTERhdGFMaXN0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTERhdGFMaXN0RWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxEYXRhTGlzdEVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTERhdGFMaXN0RWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxEYXRhTGlzdEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTERldGFpbHNFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MRGV0YWlsc0VsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MRGV0YWlsc0VsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTERldGFpbHNFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTERldGFpbHNFbGVtZW50LCAib3BlbiIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxEZXRhaWxzRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MRGl2RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTERpdkVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MRGl2RWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MRGl2RWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxEaXZFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxFbWJlZEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxFbWJlZEVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MRW1iZWRFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxFbWJlZEVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFhYWCBpbXBsLkVsZW1lbnQucmVmbGVjdFVSTEF0dHJpYnV0ZShIVE1MRW1iZWRFbGVtZW50LCAic3JjIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxFbWJlZEVsZW1lbnQsICJ0eXBlIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxFbWJlZEVsZW1lbnQsICJ3aWR0aCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MRW1iZWRFbGVtZW50LCAiaGVpZ2h0Iik7CgogICAgICAgICAgICByZXR1cm4gSFRNTEVtYmVkRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MRmllbGRTZXRFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MRmllbGRTZXRFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTEZpZWxkU2V0RWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MRmllbGRTZXRFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTEZpZWxkU2V0RWxlbWVudCwgImRpc2FibGVkIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxGaWVsZFNldEVsZW1lbnQsICJuYW1lIik7CgogICAgICAgICAgICByZXR1cm4gSFRNTEZpZWxkU2V0RWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MRm9ybUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxGb3JtRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxGb3JtRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MRm9ybUVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0RW51bWVyYXRlZEF0dHJpYnV0ZShIVE1MRm9ybUVsZW1lbnQsICJhdXRvY29tcGxldGUiLCBudWxsLCB7CiAgICAgICAgICAgICAgICBvbjogIm9uIiwKICAgICAgICAgICAgICAgIG9mZjogIm9mZiIKICAgICAgICAgICAgfSwgIm9uIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxGb3JtRWxlbWVudCwgIm5hbWUiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEZvcm1FbGVtZW50LCAiYWNjZXB0LWNoYXJzZXQiLCAiYWNjZXB0Q2hhcnNldCIpOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEZvcm1FbGVtZW50LCAidGFyZ2V0Iik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0Qm9vbGVhbkF0dHJpYnV0ZShIVE1MRm9ybUVsZW1lbnQsICJub3ZhbGlkYXRlIiwgIm5vVmFsaWRhdGUiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RFbnVtZXJhdGVkQXR0cmlidXRlKEhUTUxGb3JtRWxlbWVudCwgIm1ldGhvZCIsIG51bGwsIHsKICAgICAgICAgICAgICAgIGdldDogImdldCIsCiAgICAgICAgICAgICAgICBwb3N0OiAicG9zdCIKICAgICAgICAgICAgfSwgImdldCIpOwoKICAgICAgICAgICAgLy8gQm90aCBlbmN0eXBlIGFuZCBlbmNvZGluZyByZWZsZWN0IHRoZSBlbmN0eXBlIGNvbnRlbnQgYXR0cmlidXRlCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0RW51bWVyYXRlZEF0dHJpYnV0ZShIVE1MRm9ybUVsZW1lbnQsICJlbmN0eXBlIiwgbnVsbCwgewogICAgICAgICAgICAgICAgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLAogICAgICAgICAgICAgICAgIm11bHRpcGFydC9mb3JtLWRhdGEiOiAibXVsdGlwYXJ0L2Zvcm0tZGF0YSIsCiAgICAgICAgICAgICAgICAidGV4dC9wbGFpbiI6ICJ0ZXh0L3BsYWluIgogICAgICAgICAgICB9LCAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0RW51bWVyYXRlZEF0dHJpYnV0ZShIVE1MRm9ybUVsZW1lbnQsICJlbmN0eXBlIiwgImVuY29kaW5nIiwgewogICAgICAgICAgICAgICAgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLAogICAgICAgICAgICAgICAgIm11bHRpcGFydC9mb3JtLWRhdGEiOiAibXVsdGlwYXJ0L2Zvcm0tZGF0YSIsCiAgICAgICAgICAgICAgICAidGV4dC9wbGFpbiI6ICJ0ZXh0L3BsYWluIgogICAgICAgICAgICB9LCAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIik7CgogICAgICAgICAgICByZXR1cm4gSFRNTEZvcm1FbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxIUkVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxIUkVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MSFJFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxIUkVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MSFJFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxIZWFkRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTEhlYWRFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTEhlYWRFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxIZWFkRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxIZWFkRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MSGVhZGluZ0VsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxIZWFkaW5nRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxIZWFkaW5nRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MSGVhZGluZ0VsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MSGVhZGluZ0VsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTEh0bWxFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MSHRtbEVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MSHRtbEVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTEh0bWxFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gSFRNTEh0bWxFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxJRnJhbWVFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MSUZyYW1lRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxJRnJhbWVFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxJRnJhbWVFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBYWFggaW1wbC5yZWZsZWN0VVJMQXR0cmlidXRlKEhUTUxJRnJhbWVFbGVtZW50LCAic3JjIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxJRnJhbWVFbGVtZW50LCAic3JjZG9jIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxJRnJhbWVFbGVtZW50LCAibmFtZSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MSUZyYW1lRWxlbWVudCwgIndpZHRoIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxJRnJhbWVFbGVtZW50LCAiaGVpZ2h0Iik7CiAgICAgICAgICAgIC8vIFhYWDogc2FuZGJveCBpcyBhIHJlZmxlY3RlZCBzZXR0YWJsZSB0b2tlbiBsaXN0CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0Qm9vbGVhbkF0dHJpYnV0ZShIVE1MSUZyYW1lRWxlbWVudCwgInNlYW1sZXNzIik7CgogICAgICAgICAgICByZXR1cm4gSFRNTElGcmFtZUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTEltYWdlRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTEltYWdlRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxJbWFnZUVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTEltYWdlRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gWFhYIGltcGwuRWxlbWVudC5yZWZsZWN0VVJMQXR0cmlidXRlKEhUTUxJbWFnZUVsZW1lbnQsICJzcmMiKTsKICAgICAgICAgICAgLy8gWFhYOiBJIGRvbid0IGtub3cgd2hldGhlciB0byByZWZsZWN0IGNyb3Nzb3JpZ2luIGFzIGEgc3RyaW5nIG9yCiAgICAgICAgICAgIC8vIGFzIGFuIGVudW1lcmF0ZWQgYXR0cmlidXRlLiBTaW5jZSBpdCBpcyBub3QgImxpbWl0ZWQgdG8gb25seQogICAgICAgICAgICAvLyBrbm93biB2YWx1ZXMiLCBJIHRoaW5rIGl0IGlzIGp1c3QgYSBzdHJpbmcKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEltYWdlRWxlbWVudCwgImFsdCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MSW1hZ2VFbGVtZW50LCAiY3Jvc3NvcmlnaW4iLCAiY3Jvc3NPcmlnaW4iKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTEltYWdlRWxlbWVudCwgInVzZW1hcCIsICJ1c2VNYXAiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RCb29sZWFuQXR0cmlidXRlKEhUTUxJbWFnZUVsZW1lbnQsICJpc21hcCIsICJpc01hcCIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxJbWFnZUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTElucHV0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTElucHV0RWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxJbnB1dEVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTElucHV0RWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTElucHV0RWxlbWVudCwgIm5hbWUiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RCb29sZWFuQXR0cmlidXRlKEhUTUxJbnB1dEVsZW1lbnQsICJkaXNhYmxlZCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTElucHV0RWxlbWVudCwgImF1dG9mb2N1cyIpOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTElucHV0RWxlbWVudCwgImFjY2VwdCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MSW5wdXRFbGVtZW50LCAiYWx0Iik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxJbnB1dEVsZW1lbnQsICJtYXgiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTElucHV0RWxlbWVudCwgIm1pbiIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MSW5wdXRFbGVtZW50LCAicGF0dGVybiIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MSW5wdXRFbGVtZW50LCAicGxhY2Vob2xkZXIiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTElucHV0RWxlbWVudCwgInN0ZXAiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTElucHV0RWxlbWVudCwgImRpcm5hbWUiLCAiZGlyTmFtZSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MSW5wdXRFbGVtZW50LCAidmFsdWUiLCAiZGVmYXVsdFZhbHVlIik7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTElucHV0RWxlbWVudCwgIm11bHRpcGxlIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0Qm9vbGVhbkF0dHJpYnV0ZShIVE1MSW5wdXRFbGVtZW50LCAicmVxdWlyZWQiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RCb29sZWFuQXR0cmlidXRlKEhUTUxJbnB1dEVsZW1lbnQsICJyZWFkb25seSIsICJyZWFkT25seSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTElucHV0RWxlbWVudCwgImNoZWNrZWQiLCAiZGVmYXVsdENoZWNrZWQiKTsKCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0SW50ZWdlckF0dHJpYnV0ZShIVE1MSW5wdXRFbGVtZW50LCAic2l6ZSIsIDIwLCBudWxsLCAxLCBudWxsLCAxKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RJbnRlZ2VyQXR0cmlidXRlKEhUTUxJbnB1dEVsZW1lbnQsICJtYXhsZW5ndGgiLCAtMSwgIm1heExlbmd0aCIsIDAsIG51bGwsIDApOwoKICAgICAgICAgICAgLy8gaW1wbC5FbGVtZW50LnJlZmxlY3RVUkxBdHRyaWJ1dGUoSFRNTElucHV0RWxlbWVudCwgInNyYyIpOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RFbnVtZXJhdGVkQXR0cmlidXRlKEhUTUxJbnB1dEVsZW1lbnQsICJhdXRvY29tcGxldGUiLCBudWxsLCB7CiAgICAgICAgICAgICAgICBvbjogIm9uIiwKICAgICAgICAgICAgICAgIG9mZjogIm9mZiIKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEVudW1lcmF0ZWRBdHRyaWJ1dGUoSFRNTElucHV0RWxlbWVudCwgInR5cGUiLCBudWxsLCB7CiAgICAgICAgICAgICAgICBoaWRkZW46ICJoaWRkZW4iLAogICAgICAgICAgICAgICAgdGV4dDogInRleHQiLAogICAgICAgICAgICAgICAgc2VhcmNoOiAic2VhcmNoIiwKICAgICAgICAgICAgICAgIHRlbDogInRlbCIsCiAgICAgICAgICAgICAgICB1cmw6ICJ1cmwiLAogICAgICAgICAgICAgICAgZW1haWw6ICJlbWFpbCIsCiAgICAgICAgICAgICAgICBwYXNzd29yZDogInBhc3N3b3JkIiwKICAgICAgICAgICAgICAgIGRhdGV0aW1lOiAiZGF0ZXRpbWUiLAogICAgICAgICAgICAgICAgZGF0ZTogImRhdGUiLAogICAgICAgICAgICAgICAgbW9udGg6ICJtb250aCIsCiAgICAgICAgICAgICAgICB3ZWVrOiAid2VlayIsCiAgICAgICAgICAgICAgICB0aW1lOiAidGltZSIsCiAgICAgICAgICAgICAgICAiZGF0ZXRpbWUtbG9jYWwiOiAiZGF0ZXRpbWUtbG9jYWwiLAogICAgICAgICAgICAgICAgbnVtYmVyOiAibnVtYmVyIiwKICAgICAgICAgICAgICAgIHJhbmdlOiAicmFuZ2UiLAogICAgICAgICAgICAgICAgY29sb3I6ICJjb2xvciIsCiAgICAgICAgICAgICAgICBjaGVja2JveDogImNoZWNrYm94IiwKICAgICAgICAgICAgICAgIHJhZGlvOiAicmFkaW8iLAogICAgICAgICAgICAgICAgZmlsZTogImZpbGUiLAogICAgICAgICAgICAgICAgc3VibWl0OiAic3VibWl0IiwKICAgICAgICAgICAgICAgIGltYWdlOiAiaW1hZ2UiLAogICAgICAgICAgICAgICAgcmVzZXQ6ICJyZXNldCIsCiAgICAgICAgICAgICAgICBidXR0b246ICJidXR0b24iCiAgICAgICAgICAgIH0sICJ0ZXh0Iik7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MSW5wdXRFbGVtZW50LCAiZm9ybXRhcmdldCIsICJmb3JtVGFyZ2V0Iik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0Qm9vbGVhbkF0dHJpYnV0ZShIVE1MSW5wdXRFbGVtZW50LCAiZm9ybW5vdmFsaWRhdGUiLCAiZm9ybU5vVmFsaWRhdGUiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RFbnVtZXJhdGVkQXR0cmlidXRlKEhUTUxJbnB1dEVsZW1lbnQsICJmb3JtbWV0aG9kIiwgImZvcm1NZXRob2QiLCB7CiAgICAgICAgICAgICAgICBnZXQ6ICJnZXQiLAogICAgICAgICAgICAgICAgcG9zdDogInBvc3QiCiAgICAgICAgICAgIH0sICJnZXQiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RFbnVtZXJhdGVkQXR0cmlidXRlKEhUTUxJbnB1dEVsZW1lbnQsICJmb3JtZW5jdHlwZSIsICJmb3JtRW5jdHlwZSIsIHsKICAgICAgICAgICAgICAgICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIiwKICAgICAgICAgICAgICAgICJtdWx0aXBhcnQvZm9ybS1kYXRhIjogIm11bHRpcGFydC9mb3JtLWRhdGEiLAogICAgICAgICAgICAgICAgInRleHQvcGxhaW4iOiAidGV4dC9wbGFpbiIKICAgICAgICAgICAgfSwgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxJbnB1dEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTEtleWdlbkVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxLZXlnZW5FbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTEtleWdlbkVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTEtleWdlbkVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxLZXlnZW5FbGVtZW50LCAibmFtZSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTEtleWdlbkVsZW1lbnQsICJkaXNhYmxlZCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTEtleWdlbkVsZW1lbnQsICJhdXRvZm9jdXMiKTsKCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxLZXlnZW5FbGVtZW50LCAiY2hhbGxlbmdlIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0RW51bWVyYXRlZEF0dHJpYnV0ZShIVE1MS2V5Z2VuRWxlbWVudCwgImtleXR5cGUiLCBudWxsLCB7IHJzYTogInJzYSIgfSwgInJzYSIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxLZXlnZW5FbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxMSUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxMSUVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MTElFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxMSUVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0SW50ZWdlckF0dHJpYnV0ZShIVE1MTElFbGVtZW50LCAidmFsdWUiLCAwKTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MTElFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxMYWJlbEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxMYWJlbEVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MTGFiZWxFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxMYWJlbEVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxMYWJlbEVsZW1lbnQsICJmb3IiLCAiaHRtbEZvciIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxMYWJlbEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTExlZ2VuZEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxMZWdlbmRFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTExlZ2VuZEVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTExlZ2VuZEVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MTGVnZW5kRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MTGlua0VsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxMaW5rRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxMaW5rRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MTGlua0VsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFhYWDogc3RpbGwgaGF2ZSB0byByZWZsZWN0IFVSTCBhdHRyaWJ1dGUgaHJlZgogICAgICAgICAgICAvLyBhbmQgRE9NU2V0dGFibGVUb2tlbkxpc3Qgc2l6ZXMgYWxzbyBET01Ub2tlbkxpc3QgcmVsTGlzdAogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MTGlua0VsZW1lbnQsICJyZWwiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTExpbmtFbGVtZW50LCAibWVkaWEiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTExpbmtFbGVtZW50LCAiaHJlZmxhbmciKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTExpbmtFbGVtZW50LCAidHlwZSIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxMaW5rRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MTWFwRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTE1hcEVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MTWFwRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MTWFwRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTE1hcEVsZW1lbnQsICJuYW1lIik7CgogICAgICAgICAgICByZXR1cm4gSFRNTE1hcEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTE1lbnVFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MTWVudUVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MTWVudUVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTE1lbnVFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MTWVudUVsZW1lbnQsICJ0eXBlIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxNZW51RWxlbWVudCwgImxhYmVsIik7CgogICAgICAgICAgICByZXR1cm4gSFRNTE1lbnVFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxNZXRhRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTE1ldGFFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTE1ldGFFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxNZXRhRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTE1ldGFFbGVtZW50LCAibmFtZSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MTWV0YUVsZW1lbnQsICJjb250ZW50Iik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxNZXRhRWxlbWVudCwgImh0dHAtZXF1aXYiLCAiaHR0cEVxdWl2Iik7CgogICAgICAgICAgICByZXR1cm4gSFRNTE1ldGFFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxNZXRlckVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxNZXRlckVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MTWV0ZXJFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxNZXRlckVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MTWV0ZXJFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxNb2RFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MTW9kRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxNb2RFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxNb2RFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MTW9kRWxlbWVudCwgImNpdGUiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTE1vZEVsZW1lbnQsICJkYXRldGltZSIsICJkYXRlVGltZSIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxNb2RFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxPTGlzdEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxPTGlzdEVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MT0xpc3RFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxPTGlzdEVsZW1lbnQiKSwKCiAgICAgICAgICAgICAgICAvLyBVdGlsaXR5IGZ1bmN0aW9uIChzZWUgdGhlIHN0YXJ0IGF0dHJpYnV0ZSBkZWZhdWx0IHZhbHVlKS4gUmV0dXJucwogICAgICAgICAgICAgICAgLy8gdGhlIG51bWJlciBvZiA8bGk+IGNoaWxkcmVuIG9mIHRoaXMgZWxlbWVudAogICAgICAgICAgICAgICAgX251bWl0ZW1zOiBhdHRyaWJ1dGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IDA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGlsZE5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG4ubm9kZVR5cGUgPT09IEVMRU1FTlRfTk9ERSAmJiBuLnRhZ05hbWUgPT09ICJMSSIpIGl0ZW1zKys7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1zOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MT0xpc3RFbGVtZW50LCAidHlwZSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTE9MaXN0RWxlbWVudCwgInJldmVyc2VkIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0SW50ZWdlckF0dHJpYnV0ZShIVE1MT0xpc3RFbGVtZW50LCAic3RhcnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCB2YWx1ZSBvZiB0aGUKICAgICAgICAgICAgICAgIC8vIHN0YXJ0IGF0dHJpYnV0ZSBpcyAxIHVubGVzcwogICAgICAgICAgICAgICAgLy8gdGhlIGxpc3QgaXMgcmV2ZXJzZWQuIFRoZW4gaXQKICAgICAgICAgICAgICAgIC8vIGlzIHRoZSAjIG9mIGxpIGNoaWxkcmVuCiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXZlcnNlZCkgcmV0dXJuIHRoaXMuX251bWl0ZW1zO2Vsc2UgcmV0dXJuIDE7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxPTGlzdEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTE9iamVjdEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxPYmplY3RFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTE9iamVjdEVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTE9iamVjdEVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIGltcGwuRWxlbWVudC5yZWZsZWN0VVJMQXR0cmlidXRlKEhUTUxPYmplY3RFbGVtZW50LCAiZGF0YSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MT2JqZWN0RWxlbWVudCwgInR5cGUiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTE9iamVjdEVsZW1lbnQsICJuYW1lIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxPYmplY3RFbGVtZW50LCAidXNlbWFwIiwgInVzZU1hcCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTE9iamVjdEVsZW1lbnQsICJ0eXBlbXVzdG1hdGNoIiwgInR5cGVNdXN0TWF0Y2giKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTE9iamVjdEVsZW1lbnQsICJ3aWR0aCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MT2JqZWN0RWxlbWVudCwgImhlaWdodCIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxPYmplY3RFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxPcHRHcm91cEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxPcHRHcm91cEVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MT3B0R3JvdXBFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxPcHRHcm91cEVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0Qm9vbGVhbkF0dHJpYnV0ZShIVE1MT3B0R3JvdXBFbGVtZW50LCAiZGlzYWJsZWQiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTE9wdEdyb3VwRWxlbWVudCwgImxhYmVsIik7CgogICAgICAgICAgICByZXR1cm4gSFRNTE9wdEdyb3VwRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MT3B0aW9uRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTE9wdGlvbkVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MT3B0aW9uRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MT3B0aW9uRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RCb29sZWFuQXR0cmlidXRlKEhUTUxPcHRpb25FbGVtZW50LCAiZGlzYWJsZWQiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RCb29sZWFuQXR0cmlidXRlKEhUTUxPcHRpb25FbGVtZW50LCAic2VsZWN0ZWQiLCAiZGVmYXVsdFNlbGVjdGVkIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxPcHRpb25FbGVtZW50LCAibGFiZWwiKTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MT3B0aW9uRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MT3V0cHV0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTE91dHB1dEVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MT3V0cHV0RWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MT3V0cHV0RWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gWFhYIFJlZmxlY3QgZm9yL2h0bWxGb3IgYXMgYSBzZXR0YWJsZSB0b2tlbiBsaXN0CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxPdXRwdXRFbGVtZW50LCAibmFtZSIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxPdXRwdXRFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxQYXJhZ3JhcGhFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MUGFyYWdyYXBoRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxQYXJhZ3JhcGhFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxQYXJhZ3JhcGhFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gSFRNTFBhcmFncmFwaEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTFBhcmFtRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTFBhcmFtRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxQYXJhbUVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTFBhcmFtRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxQYXJhbUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTFByZUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxQcmVFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTFByZUVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTFByZUVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MUHJlRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MUHJvZ3Jlc3NFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MUHJvZ3Jlc3NFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTFByb2dyZXNzRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MUHJvZ3Jlc3NFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFBvc2l0aXZlRmxvYXRBdHRyaWJ1dGUoSFRNTFByb2dyZXNzRWxlbWVudCwgIm1heCIsIDEuMCk7CgogICAgICAgICAgICByZXR1cm4gSFRNTFByb2dyZXNzRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MUXVvdGVFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MUXVvdGVFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTFF1b3RlRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MUXVvdGVFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MUXVvdGVFbGVtZW50LCAiY2l0ZSIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxRdW90ZUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIC8vIEhUTUxTY3JpcHRFbGVtZW50IHVzZWQgdG8gYmUgaGVyZSwgYnV0IG5vdyBoYXMgaXRzIG93biBmaWxlLgoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxTZWxlY3RFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MU2VsZWN0RWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxTZWxlY3RFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxTZWxlY3RFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MU2VsZWN0RWxlbWVudCwgIm5hbWUiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RCb29sZWFuQXR0cmlidXRlKEhUTUxTZWxlY3RFbGVtZW50LCAiZGlzYWJsZWQiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RCb29sZWFuQXR0cmlidXRlKEhUTUxTZWxlY3RFbGVtZW50LCAiYXV0b2ZvY3VzIik7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTFNlbGVjdEVsZW1lbnQsICJtdWx0aXBsZSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTFNlbGVjdEVsZW1lbnQsICJyZXF1aXJlZCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEludGVnZXJBdHRyaWJ1dGUoSFRNTFNlbGVjdEVsZW1lbnQsICJzaXplIiwgMCk7CgogICAgICAgICAgICByZXR1cm4gSFRNTFNlbGVjdEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTFNvdXJjZUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxTb3VyY2VFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTFNvdXJjZUVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTFNvdXJjZUVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIGltcGwuRWxlbWVudC5yZWZsZWN0VVJMQXR0cmlidXRlKEhUTUxTb3VyY2VFbGVtZW50LCAic3JjIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxTb3VyY2VFbGVtZW50LCAidHlwZSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MU291cmNlRWxlbWVudCwgIm1lZGlhIik7CgogICAgICAgICAgICByZXR1cm4gSFRNTFNvdXJjZUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTFNwYW5FbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MU3BhbkVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MU3BhbkVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTFNwYW5FbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gSFRNTFNwYW5FbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxTdHlsZUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxTdHlsZUVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MU3R5bGVFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxTdHlsZUVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxTdHlsZUVsZW1lbnQsICJtZWRpYSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MU3R5bGVFbGVtZW50LCAidHlwZSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTFN0eWxlRWxlbWVudCwgInNjb3BlZCIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxTdHlsZUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTFRhYmxlQ2FwdGlvbkVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxUYWJsZUNhcHRpb25FbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTFRhYmxlQ2FwdGlvbkVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTFRhYmxlQ2FwdGlvbkVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MVGFibGVDYXB0aW9uRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MVGFibGVDZWxsRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTFRhYmxlQ2VsbEVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MVGFibGVDZWxsRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MVGFibGVDZWxsRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RJbnRlZ2VyQXR0cmlidXRlKEhUTUxUYWJsZUNlbGxFbGVtZW50LCAiY29sc3BhbiIsIDEsICJjb2xTcGFuIiwgMSwgbnVsbCwgMSk7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0SW50ZWdlckF0dHJpYnV0ZShIVE1MVGFibGVDZWxsRWxlbWVudCwgInJvd3NwYW4iLCAxLCAicm93U3BhbiIpOwogICAgICAgICAgICAvL1hYWCBBbHNvIHJlZmxlY3Qgc2V0dGFibGUgdG9rZW4gbGlzdCBoZWFkZXJzCgoKICAgICAgICAgICAgcmV0dXJuIEhUTUxUYWJsZUNlbGxFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxUYWJsZUNvbEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxUYWJsZUNvbEVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MVGFibGVDb2xFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxUYWJsZUNvbEVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0SW50ZWdlckF0dHJpYnV0ZShIVE1MVGFibGVDb2xFbGVtZW50LCAic3BhbiIsIDEsIG51bGwsIDEsIG51bGwsIDEpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxUYWJsZUNvbEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTFRhYmxlRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTFRhYmxlRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxUYWJsZUVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTFRhYmxlRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTFRhYmxlRWxlbWVudCwgImJvcmRlciIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxUYWJsZUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTFRhYmxlUm93RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTFRhYmxlUm93RWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxUYWJsZVJvd0VsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTFRhYmxlUm93RWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxUYWJsZVJvd0VsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxUYWJsZVNlY3Rpb25FbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MVGFibGVTZWN0aW9uRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MVGV4dEFyZWFFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MVGV4dEFyZWFFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTFRleHRBcmVhRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MVGV4dEFyZWFFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MVGV4dEFyZWFFbGVtZW50LCAibmFtZSIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTFRleHRBcmVhRWxlbWVudCwgImRpc2FibGVkIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0Qm9vbGVhbkF0dHJpYnV0ZShIVE1MVGV4dEFyZWFFbGVtZW50LCAiYXV0b2ZvY3VzIik7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MVGV4dEFyZWFFbGVtZW50LCAicGxhY2Vob2xkZXIiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTFRleHRBcmVhRWxlbWVudCwgIndyYXAiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTFRleHRBcmVhRWxlbWVudCwgImRpcm5hbWUiLCAiZGlyTmFtZSIpOwoKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RCb29sZWFuQXR0cmlidXRlKEhUTUxUZXh0QXJlYUVsZW1lbnQsICJyZXF1aXJlZCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTFRleHRBcmVhRWxlbWVudCwgInJlYWRvbmx5IiwgInJlYWRPbmx5Iik7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEludGVnZXJBdHRyaWJ1dGUoSFRNTFRleHRBcmVhRWxlbWVudCwgInJvd3MiLCAyLCBudWxsLCAxLCBudWxsLCAxKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RJbnRlZ2VyQXR0cmlidXRlKEhUTUxUZXh0QXJlYUVsZW1lbnQsICJjb2xzIiwgMjAsIG51bGwsIDEsIG51bGwsIDEpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEludGVnZXJBdHRyaWJ1dGUoSFRNTFRleHRBcmVhRWxlbWVudCwgIm1heGxlbmd0aCIsIC0xLCAibWF4TGVuZ3RoIiwgMCwgbnVsbCwgMCk7CgogICAgICAgICAgICByZXR1cm4gSFRNTFRleHRBcmVhRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MVGltZUVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxUaW1lRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxUaW1lRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MVGltZUVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxUaW1lRWxlbWVudCwgImRhdGV0aW1lIiwgImRhdGVUaW1lIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0Qm9vbGVhbkF0dHJpYnV0ZShIVE1MVGltZUVsZW1lbnQsICJwdWJkYXRlIiwgInB1YkRhdGUiKTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MVGltZUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTFRpdGxlRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTFRpdGxlRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxUaXRsZUVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTFRpdGxlRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxUaXRsZUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTFRyYWNrRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTFRyYWNrRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxUcmFja0VsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTFRyYWNrRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gaW1wbC5FbGVtZW50LnJlZmxlY3RVUkxBdHRyaWJ1dGUoSFRNTFRyYWNrRWxlbWVudCwgInNyYyIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MVHJhY2tFbGVtZW50LCAic3JjbGFuZyIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdFN0cmluZ0F0dHJpYnV0ZShIVE1MVHJhY2tFbGVtZW50LCAibGFiZWwiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RCb29sZWFuQXR0cmlidXRlKEhUTUxUcmFja0VsZW1lbnQsICJkZWZhdWx0Iik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0RW51bWVyYXRlZEF0dHJpYnV0ZShIVE1MVHJhY2tFbGVtZW50LCAia2luZCIsIG51bGwsIHsKICAgICAgICAgICAgICAgIHN1YnRpdGxlczogInN1YnRpdGxlcyIsCiAgICAgICAgICAgICAgICBjYXB0aW9uczogImNhcHRpb25zIiwKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uczogImRlc2NyaXB0aW9ucyIsCiAgICAgICAgICAgICAgICBjaGFwdGVyczogImNoYXB0ZXJzIiwKICAgICAgICAgICAgICAgIG1ldGFkYXRhOiAibWV0YWRhdGEiCiAgICAgICAgICAgIH0sICJzdWJ0aXRsZXMiKTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MVHJhY2tFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxVTGlzdEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxVTGlzdEVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MVUxpc3RFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxVTGlzdEVsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MVUxpc3RFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxVbmtub3duRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTFVua25vd25FbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTFVua25vd25FbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxVbmtub3duRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxVbmtub3duRWxlbWVudDsKICAgICAgICB9KTsKCiAgICAgICAgZGVmaW5lTGF6eVByb3BlcnR5KGltcGwsICJIVE1MTWVkaWFFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MTWVkaWFFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MTWVkaWFFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBpbXBsLkVsZW1lbnQucmVmbGVjdFVSTEF0dHJpYnV0ZShIVE1MTWVkaWFFbGVtZW50LCAic3JjIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxNZWRpYUVsZW1lbnQsICJjcm9zc29yaWdpbiIsICJjcm9zc09yaWdpbiIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEVudW1lcmF0ZWRBdHRyaWJ1dGUoSFRNTE1lZGlhRWxlbWVudCwgInByZWxvYWQiLCBudWxsLCB7CiAgICAgICAgICAgICAgICBub25lOiAibm9uZSIsCiAgICAgICAgICAgICAgICBtZXRhZGF0YTogIm1ldGFkYXRhIiwKICAgICAgICAgICAgICAgIGF1dG86ICJhdXRvIiwKICAgICAgICAgICAgICAgICIiOiAiYXV0byIKICAgICAgICAgICAgfSwgIm1ldGFkYXRhIiAvLyB1c2VyLWFnZW50IGRlZmluZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0Qm9vbGVhbkF0dHJpYnV0ZShIVE1MTWVkaWFFbGVtZW50LCAibG9vcCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTE1lZGlhRWxlbWVudCwgImF1dG9wbGF5Iik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxNZWRpYUVsZW1lbnQsICJtZWRpYWdyb3VwIiwgIm1lZGlhR3JvdXAiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RCb29sZWFuQXR0cmlidXRlKEhUTUxNZWRpYUVsZW1lbnQsICJjb250cm9scyIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTE1lZGlhRWxlbWVudCwgIm11dGVkIiwgImRlZmF1bHRNdXRlZCIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxNZWRpYUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTEF1ZGlvRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTEF1ZGlvRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxNZWRpYUVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSFRNTEF1ZGlvRWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxBdWRpb0VsZW1lbnQiKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBIVE1MQXVkaW9FbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxWaWRlb0VsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxWaWRlb0VsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MTWVkaWFFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxWaWRlb0VsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MVmlkZW9FbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBpbXBsLkVsZW1lbnQucmVmbGVjdFVSTEF0dHJpYnV0ZShIVE1MVmlkZW9FbGVtZW50LCJwb3N0ZXIiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RJbnRlZ2VyQXR0cmlidXRlKEhUTUxWaWRlb0VsZW1lbnQsICJ3aWR0aCIsIDAsIG51bGwsIDApOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEludGVnZXJBdHRyaWJ1dGUoSFRNTFZpZGVvRWxlbWVudCwgImhlaWdodCIsIDAsIG51bGwsIDApOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxWaWRlb0VsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTFRhYmxlRGF0YUNlbGxFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MVGFibGVEYXRhQ2VsbEVsZW1lbnQoZG9jLCBsb2NhbE5hbWUsIHByZWZpeCkgewogICAgICAgICAgICAgICAgaW1wbC5IVE1MVGFibGVDZWxsRWxlbWVudC5jYWxsKHRoaXMsIGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBIVE1MVGFibGVEYXRhQ2VsbEVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MVGFibGVDZWxsRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTFRhYmxlRGF0YUNlbGxFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gSFRNTFRhYmxlRGF0YUNlbGxFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICBkZWZpbmVMYXp5UHJvcGVydHkoaW1wbCwgIkhUTUxUYWJsZUhlYWRlckNlbGxFbGVtZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBIVE1MVGFibGVIZWFkZXJDZWxsRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxUYWJsZUNlbGxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxUYWJsZUhlYWRlckNlbGxFbGVtZW50LnByb3RvdHlwZSA9IE8uY3JlYXRlKGltcGwuSFRNTFRhYmxlQ2VsbEVsZW1lbnQucHJvdG90eXBlLCB7CiAgICAgICAgICAgICAgICBfaWRsTmFtZTogY29uc3RhbnQoIkhUTUxUYWJsZUhlYWRlckNlbGxFbGVtZW50IikKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEVudW1lcmF0ZWRBdHRyaWJ1dGUoSFRNTFRhYmxlSGVhZGVyQ2VsbEVsZW1lbnQsICJzY29wZSIsIG51bGwsIHsKICAgICAgICAgICAgICAgIHJvdzogInJvdyIsCiAgICAgICAgICAgICAgICBjb2w6ICJjb2wiLAogICAgICAgICAgICAgICAgcm93Z3JvdXA6ICJyb3dncm91cCIsCiAgICAgICAgICAgICAgICBjb2xncm91cDogImNvbGdyb3VwIgogICAgICAgICAgICB9LCAiIik7CgogICAgICAgICAgICByZXR1cm4gSFRNTFRhYmxlSGVhZGVyQ2VsbEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTEZyYW1lU2V0RWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTEZyYW1lU2V0RWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxGcmFtZVNldEVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTEZyYW1lU2V0RWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxGcmFtZVNldEVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTEZyYW1lRWxlbWVudCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gSFRNTEZyYW1lRWxlbWVudChkb2MsIGxvY2FsTmFtZSwgcHJlZml4KSB7CiAgICAgICAgICAgICAgICBpbXBsLkhUTUxFbGVtZW50LmNhbGwodGhpcywgZG9jLCBsb2NhbE5hbWUsIHByZWZpeCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhUTUxGcmFtZUVsZW1lbnQucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiSFRNTEZyYW1lRWxlbWVudCIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxGcmFtZUVsZW1lbnQ7CiAgICAgICAgfSk7CgogICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgKiAgc3JjL2ltcGwvSFRNTFNjcmlwdEVsZW1lbnQuanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy9pbXBsL0hUTUxTY3JpcHRFbGVtZW50LmpzIgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiSFRNTFNjcmlwdEVsZW1lbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBKYXZhU2NyaXB0TWltZVR5cGVzID0gewogICAgICAgICAgICAgICAgImFwcGxpY2F0aW9uL2VjbWFzY3JpcHQiOiB0cnVlLAogICAgICAgICAgICAgICAgImFwcGxpY2F0aW9uL2phdmFzY3JpcHQiOiB0cnVlLAogICAgICAgICAgICAgICAgImFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCI6IHRydWUsCiAgICAgICAgICAgICAgICAiYXBwbGljYXRpb24veC1qYXZhc2NyaXB0IjogdHJ1ZSwKICAgICAgICAgICAgICAgICJ0ZXh0L2VjbWFzY3JpcHQiOiB0cnVlLAogICAgICAgICAgICAgICAgInRleHQvamF2YXNjcmlwdCI6IHRydWUsCiAgICAgICAgICAgICAgICAidGV4dC9qYXZhc2NyaXB0MS4wIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJ0ZXh0L2phdmFzY3JpcHQxLjEiOiB0cnVlLAogICAgICAgICAgICAgICAgInRleHQvamF2YXNjcmlwdDEuMiI6IHRydWUsCiAgICAgICAgICAgICAgICAidGV4dC9qYXZhc2NyaXB0MS4zIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJ0ZXh0L2phdmFzY3JpcHQxLjQiOiB0cnVlLAogICAgICAgICAgICAgICAgInRleHQvamF2YXNjcmlwdDEuNSI6IHRydWUsCiAgICAgICAgICAgICAgICAidGV4dC9qc2NyaXB0IjogdHJ1ZSwKICAgICAgICAgICAgICAgICJ0ZXh0L2xpdmVzY3JpcHQiOiB0cnVlLAogICAgICAgICAgICAgICAgInRleHQveC1lY21hc2NyaXB0IjogdHJ1ZSwKICAgICAgICAgICAgICAgICJ0ZXh0L3gtamF2YXNjcmlwdCI6IHRydWUKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGZ1bmN0aW9uIEhUTUxTY3JpcHRFbGVtZW50KGRvYywgbG9jYWxOYW1lLCBwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGltcGwuSFRNTEVsZW1lbnQuY2FsbCh0aGlzLCBkb2MsIGxvY2FsTmFtZSwgcHJlZml4KTsKICAgICAgICAgICAgICAgIC8vIEludGVybmFsIHNjcmlwdCBmbGFncywgdXNlZCBieSB0aGUgcGFyc2VyIGFuZCBlbHNld2hlcmUKICAgICAgICAgICAgICAgIHRoaXMuX2FscmVhZHlfc3RhcnRlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5fcGFyc2VyX2luc2VydGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLl9yZWFkeV90b19leGVjdXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLl9mb3JjZV9hc3luYyA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLl9oYWRfYXN5bmNfY29udGVudF9hdHRyaWJ1dGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0b3JEb2N1bWVudCA9IGRvYzsgLy8gaW4gY2FzZSBvd25lckRvY3VtZW50IGNoYW5nZXMgbGF0ZXIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2NyaXB0IGVsZW1lbnRzIHRoYXQgYXJlIG5vdCBwYXJzZXIgaW5zZXJ0ZWQgbXVzdCBjYWxsIF9wcmVwYXJlKCkgd2hlbjoKICAgICAgICAgICAgLy8gMSkgYSBzY3JpcHQgaXMgaW5zZXJ0ZWQgaW50byB0aGUgZG9jdW1lbnQuICAoc2VlIF9yb290aG9vayBiZWxvdykKICAgICAgICAgICAgLy8gMikgdGhlIHNjcmlwdCdzIGNoaWxkcmVuIGNoYW5nZQogICAgICAgICAgICAvLyAgIFhYWDogbmVlZCB0byBtYWtlIHRoaXMgb25lIGhhcHBlbgogICAgICAgICAgICAvLyAgIEkgY291bGQgdXNlIGEgcHJveHkgYXJyYXkgZm9yIGNoaWxkTm9kZXMgYW5kIGhhbmRsZSB0aGF0IGhlcmUKICAgICAgICAgICAgLy8gICBUaGF0IG1pZ2h0IGJlIG1vcmUgZWZmaWNpZW50IHRoYW4gYWRkaW5nIGhvb2tzIGluIE5vZGUuCiAgICAgICAgICAgIC8vICAgQWxzbywgSSBzZW50IGVtYWlsIHRvIHdoYXR3ZyBtYWlsaW5nIGxpc3QgYWJvdXQgdGhpcy4KICAgICAgICAgICAgLy8gICBGaXJlZm94IGFjdHVhbGx5IHRyaWdnZXJzIGEgc2NyaXB0IGlmIGEgdGV4dCBub2RlIGNoaWxkCiAgICAgICAgICAgIC8vICAgY2hhbmdlcyBmcm9tIHRoZSBlbXB0eSBzdHJpbmcgdG8gbm9uLWVtcHR5LCBhbmQgdGhhdCB3b3VsZAogICAgICAgICAgICAvLyAgIGJlIGhhcmQgdG8gaGF2ZSBhIGhvb2sgZm9yLiBPciwgSSBjb3VsZCB1c2UgdGhlIG1vZHRpbWUgdGhpbmcKICAgICAgICAgICAgLy8gICB0byBsb29rIGZvciBhbnkgY2hhbmdlcyBvbiBhbnkgZGVzY2VuZGFudCBhbmQgdGhlbiBjaGVjayB0aGUKICAgICAgICAgICAgLy8gICB0ZXh0IHByb3BlcnR5LiBUaGUgdHJhbnNpdGlvbiBmcm9tICIiIHRvIG5vbi1lbXB0eSB0ZXh0IHdvdWxkCiAgICAgICAgICAgIC8vICAgYmUgYSBfcHJlcGFyZSgpIHRyaWdnZXIuICBCdXQgSSdtIGhvcGluZyB0aGF0IHRoZSBzcGVjIHdpbGwgY2hhbmdlCiAgICAgICAgICAgIC8vICAgc28gdGhhdCBhbnkgY2hpbGQgaW5zZXJ0aW9uIChpbmNsdWRpbmcgYW4gZW1wdHkgdGV4dCBub2RlKSBcCiAgICAgICAgICAgIC8vICAgaXMgZW5vdWdoLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyAzKSB3aGVuIHRoZSBhIHNyYyBhdHRyaWJ1dGUgaXMgZGVmaW5lZAogICAgICAgICAgICAvLyAgIChTZWUgX25ld2F0dHJob29rIGJlbG93KTsKICAgICAgICAgICAgLy8KCgogICAgICAgICAgICBIVE1MU2NyaXB0RWxlbWVudC5wcm90b3R5cGUgPSBPLmNyZWF0ZShpbXBsLkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJIVE1MU2NyaXB0RWxlbWVudCIpLAoKICAgICAgICAgICAgICAgIC8vIFNjcmlwdCBlbGVtZW50cyBuZWVkIHRvIGtub3cgd2hlbiB0aGV5J3JlIGluc2VydGVkIGludG8gdGhlCiAgICAgICAgICAgICAgICAvLyBkb2N1bWVudCwgc28gdGhleSBkZWZpbmUgdGhpcyBob29rIG1ldGhvZAogICAgICAgICAgICAgICAgX3Jvb3Rob29rOiBjb25zdGFudChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9wYXJzZXJfaW5zZXJ0ZWQpIHRoaXMuX3ByZXBhcmUoKTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIFRoZSBTY3JpcHQgZWxlbWVudCBuZWVkcyB0byBrbm93IHdoZW4gaXRzIHNyYyBhbmQgYXN5bmMgYXR0cnMgYXJlIHNldAogICAgICAgICAgICAgICAgX25ld2F0dHJob29rOiBjb25zdGFudChmdW5jdGlvbiAobmFtZSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXN5bmMnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZm9yY2VfYXN5bmMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzcmMnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9wYXJzZXJfaW5zZXJ0ZWQgJiYgdGhpcy5yb290ZWQpIHRoaXMuX3ByZXBhcmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIFRoZSBTY3JpcHQgZWxlbWVudCBuZWVkcyB0byBrbm93IHdoZW4gYSBjaGlsZCBpcyBhZGRlZAogICAgICAgICAgICAgICAgLy8gVGhpcyBob29rIGlzIG9ubHkgZm9yIGRpcmVjdCBjaGlsZHJlbjogaXQgZG9lcyBub3QgYnViYmxlIHVwCiAgICAgICAgICAgICAgICBfYWRkY2hpbGRob29rOiBjb25zdGFudChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBYWFggd2hhdCBpZiBtdWx0aXBsZSBjaGlsZHJlbiBhcmUgYWRkZWQgYXQgb25jZQogICAgICAgICAgICAgICAgICAgIC8vIHZpYSBhIERvY3VtZW50RnJhZ21lbnQsIGRvIHdlIHJ1biBhbGwgb2YgdGhlbSBvciBvbmx5IHRoZSBmaXJzdD8KICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3BhcnNlcl9pbnNlcnRlZCAmJiB0aGlzLnJvb3RlZCkgdGhpcy5fcHJlcGFyZSgpOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gRmluYWxseSwgaXQgbmVlZHMgdG8ga25vdyB3aGVuIGEgVGV4dCBjaGlsZCBoYXMgY2hhbmdlZAogICAgICAgICAgICAgICAgLy8gVGhpcyBob29rIG9ubHkgZ2V0cyB0cmlnZ2VyZWQgZm9yIGRpcmVjdCBjaGlsZHJlbiwgbm90IGFsbAogICAgICAgICAgICAgICAgLy8gZGVzY2VuZGFudHMKICAgICAgICAgICAgICAgIF90ZXh0Y2hhbmdlaG9vazogY29uc3RhbnQoZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9wYXJzZXJfaW5zZXJ0ZWQgJiYgdGhpcy5yb290ZWQpIHRoaXMuX3ByZXBhcmUoKTsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIC8vIFRoZSBhc3luYyBpZGwgYXR0ciBkb2Vzbid0IHF1aXRlIHJlZmxlY3QgdGhlIGFzeW5jIGNvbnRlbnQgYXR0cgogICAgICAgICAgICAgICAgYXN5bmM6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZvcmNlX2FzeW5jKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRBdHRyaWJ1dGUoImFzeW5jIik7CiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9mb3JjZV9hc3luYyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRhdHRyKCJhc3luYyIsICIiKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUF0dHJpYnV0ZSgiYXN5bmMiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICB0ZXh0OiBhdHRyaWJ1dGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBzID0gIiI7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSB0aGlzLmNoaWxkTm9kZXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IHRoaXMuY2hpbGROb2Rlc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSBURVhUX05PREUpIHMgKz0gY2hpbGQuX2RhdGE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDaGlsZHJlbigpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh0aGlzLm93bmVyRG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodmFsdWUpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBUaGUgSFRNTCAiUHJlcGFyZSBhIFNjcmlwdCIgYWxnb3JpdGhtCiAgICAgICAgICAgICAgICBfcHJlcGFyZTogY29uc3RhbnQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBzY3JpcHQgZWxlbWVudCBpcyBtYXJrZWQgYXMgaGF2aW5nICJhbHJlYWR5IHN0YXJ0ZWQiLAogICAgICAgICAgICAgICAgICAgIC8vIHRoZW4gdGhlIHVzZXIgYWdlbnQgbXVzdCBhYm9ydCB0aGVzZSBzdGVwcyBhdCB0aGlzIHBvaW50LiBUaGUKICAgICAgICAgICAgICAgICAgICAvLyBzY3JpcHQgaXMgbm90IGV4ZWN1dGVkLgogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hbHJlYWR5X3N0YXJ0ZWQpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGVsZW1lbnQgaGFzIGl0cyAicGFyc2VyLWluc2VydGVkIiBmbGFnIHNldCwgdGhlbiBzZXQKICAgICAgICAgICAgICAgICAgICAvLyB3YXMtcGFyc2VyLWluc2VydGVkIHRvIHRydWUgYW5kIHVuc2V0IHRoZSBlbGVtZW50J3MKICAgICAgICAgICAgICAgICAgICAvLyAicGFyc2VyLWluc2VydGVkIiBmbGFnLiBPdGhlcndpc2UsIHNldCB3YXMtcGFyc2VyLWluc2VydGVkIHRvCiAgICAgICAgICAgICAgICAgICAgLy8gZmFsc2UuCiAgICAgICAgICAgICAgICAgICAgdmFyIHdhc19wYXJzZXJfaW5zZXJ0ZWQgPSB0aGlzLl9wYXJzZXJfaW5zZXJ0ZWQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFyc2VyX2luc2VydGVkID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgIC8vIElmIHdhcy1wYXJzZXItaW5zZXJ0ZWQgaXMgdHJ1ZSBhbmQgdGhlIGVsZW1lbnQgZG9lcyBub3QgaGF2ZSBhbgogICAgICAgICAgICAgICAgICAgIC8vIGFzeW5jIGF0dHJpYnV0ZSwgdGhlbiBzZXQgdGhlIGVsZW1lbnQncyAiZm9yY2UtYXN5bmMiIGZsYWcgdG8KICAgICAgICAgICAgICAgICAgICAvLyB0cnVlLgogICAgICAgICAgICAgICAgICAgIGlmICh3YXNfcGFyc2VyX2luc2VydGVkICYmICF0aGlzLmhhc0F0dHJpYnV0ZSgiYXN5bmMiKSkgdGhpcy5fZm9yY2VfYXN5bmMgPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgZWxlbWVudCBoYXMgbm8gc3JjIGF0dHJpYnV0ZSwgYW5kIGl0cyBjaGlsZCBub2RlcywgaWYKICAgICAgICAgICAgICAgICAgICAvLyBhbnksIGNvbnNpc3Qgb25seSBvZiBjb21tZW50IG5vZGVzIGFuZCBlbXB0eSB0ZXh0IG5vZGVzLCB0aGVuCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHVzZXIgYWdlbnQgbXVzdCBhYm9ydCB0aGVzZSBzdGVwcyBhdCB0aGlzIHBvaW50LiBUaGUgc2NyaXB0CiAgICAgICAgICAgICAgICAgICAgLy8gaXMgbm90IGV4ZWN1dGVkLgogICAgICAgICAgICAgICAgICAgIHZhciBzcmNBdHRyaWJ1dGUgPSB0aGlzLnNyYzsKICAgICAgICAgICAgICAgICAgICBpZiAoIXNyY0F0dHJpYnV0ZSAmJiAhdGhpcy5oYXNBdHRyaWJ1dGUoInNyYyIpICYmIHRoaXMudGV4dCA9PT0gIiIpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGVsZW1lbnQgaXMgbm90IGluIGEgRG9jdW1lbnQsIHRoZW4gdGhlIHVzZXIgYWdlbnQgbXVzdAogICAgICAgICAgICAgICAgICAgIC8vIGFib3J0IHRoZXNlIHN0ZXBzIGF0IHRoaXMgcG9pbnQuIFRoZSBzY3JpcHQgaXMgbm90IGV4ZWN1dGVkLgogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5yb290ZWQpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgZWl0aGVyOgogICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGUgc2NyaXB0IGVsZW1lbnQgaGFzIGEgdHlwZSBhdHRyaWJ1dGUgYW5kIGl0cyB2YWx1ZSBpcyB0aGUKICAgICAgICAgICAgICAgICAgICAvLyAgICAgZW1wdHkgc3RyaW5nLCBvciB0aGUgc2NyaXB0IGVsZW1lbnQgaGFzIG5vIHR5cGUgYXR0cmlidXRlCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGJ1dCBpdCBoYXMgYSBsYW5ndWFnZSBhdHRyaWJ1dGUgYW5kIHRoYXQgYXR0cmlidXRlJ3MgdmFsdWUKICAgICAgICAgICAgICAgICAgICAvLyAgICAgaXMgdGhlIGVtcHR5IHN0cmluZywgb3IgdGhlIHNjcmlwdCBlbGVtZW50IGhhcyBuZWl0aGVyIGEKICAgICAgICAgICAgICAgICAgICAvLyAgICAgdHlwZSBhdHRyaWJ1dGUgbm9yIGEgbGFuZ3VhZ2UgYXR0cmlidXRlLCB0aGVuCiAgICAgICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgICAgICAvLyAuLi5sZXQgdGhlIHNjcmlwdCBibG9jaydzIHR5cGUgZm9yIHRoaXMgc2NyaXB0IGVsZW1lbnQgYmUKICAgICAgICAgICAgICAgICAgICAvLyAidGV4dC9qYXZhc2NyaXB0Ii4KICAgICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgaWYgdGhlIHNjcmlwdCBlbGVtZW50IGhhcyBhIHR5cGUgYXR0cmlidXRlLCBsZXQgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gc2NyaXB0IGJsb2NrJ3MgdHlwZSBmb3IgdGhpcyBzY3JpcHQgZWxlbWVudCBiZSB0aGUgdmFsdWUgb2YgdGhhdAogICAgICAgICAgICAgICAgICAgIC8vIGF0dHJpYnV0ZSB3aXRoIGFueSBsZWFkaW5nIG9yIHRyYWlsaW5nIHNlcXVlbmNlcyBvZiBzcGFjZQogICAgICAgICAgICAgICAgICAgIC8vIGNoYXJhY3RlcnMgcmVtb3ZlZC4KICAgICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgdGhlIGVsZW1lbnQgaGFzIGEgbm9uLWVtcHR5IGxhbmd1YWdlIGF0dHJpYnV0ZTsgbGV0CiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHNjcmlwdCBibG9jaydzIHR5cGUgZm9yIHRoaXMgc2NyaXB0IGVsZW1lbnQgYmUgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gY29uY2F0ZW5hdGlvbiBvZiB0aGUgc3RyaW5nICJ0ZXh0LyIgZm9sbG93ZWQgYnkgdGhlIHZhbHVlIG9mIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIGxhbmd1YWdlIGF0dHJpYnV0ZS4KICAgICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBsYW5ndWFnZSBhdHRyaWJ1dGUgaXMgbmV2ZXIgY29uZm9ybWluZywgYW5kIGlzIGFsd2F5cwogICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZWQgaWYgdGhlcmUgaXMgYSB0eXBlIGF0dHJpYnV0ZSBwcmVzZW50LgogICAgICAgICAgICAgICAgICAgIHZhciBoYXN0eXBlID0gdGhpcy5oYXNBdHRyaWJ1dGUoInR5cGUiKSB8fCAhIXRoaXMudHlwZTsKICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZWF0dHIgPSBoYXN0eXBlID8gdGhpcy5nZXRBdHRyaWJ1dGUoInR5cGUiKSB8fCB0aGlzLnR5cGUgOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgdmFyIGhhc2xhbmcgPSB0aGlzLmhhc0F0dHJpYnV0ZSgibGFuZ3VhZ2UiKSB8fCAhIXRoaXMubGFuZ3VhZ2U7CiAgICAgICAgICAgICAgICAgICAgdmFyIGxhbmdhdHRyID0gaGFzbGFuZyA/IHRoaXMuZ2V0QXR0cmlidXRlKCJsYW5ndWFnZSIpIHx8IHRoaXMubGFuZ3VhZ2UgOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgdmFyIHNjcmlwdHR5cGU7CgogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlYXR0ciA9PT0gIiIgfHwgIWhhc3R5cGUgJiYgbGFuZ2F0dHIgPT09ICIiIHx8ICFoYXN0eXBlICYmICFoYXNsYW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdHR5cGUgPSAidGV4dC9qYXZhc2NyaXB0IjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc3R5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FuJ3QgdXNlIHRyaW0oKSBoZXJlLCBiZWNhdXNlIGl0IGhhcyBhIGRpZmZlcmVudAogICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWZpbml0aW9uIG9mIHdoaXRlc3BhY2UgdGhhbiBodG1sIGRvZXMKICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0dHlwZSA9IGh0bWxUcmltKHR5cGVhdHRyKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHR0eXBlID0gInRleHQvIiArIGxhbmdhdHRyOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHVzZXIgYWdlbnQgZG9lcyBub3Qgc3VwcG9ydCB0aGUgc2NyaXB0aW5nIGxhbmd1YWdlIGdpdmVuCiAgICAgICAgICAgICAgICAgICAgLy8gYnkgdGhlIHNjcmlwdCBibG9jaydzIHR5cGUgZm9yIHRoaXMgc2NyaXB0IGVsZW1lbnQsIHRoZW4gdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gdXNlciBhZ2VudCBtdXN0IGFib3J0IHRoZXNlIHN0ZXBzIGF0IHRoaXMgcG9pbnQuIFRoZSBzY3JpcHQgaXMKICAgICAgICAgICAgICAgICAgICAvLyBub3QgZXhlY3V0ZWQuCiAgICAgICAgICAgICAgICAgICAgaWYgKCFKYXZhU2NyaXB0TWltZVR5cGVzW3RvTG93ZXJDYXNlKHNjcmlwdHR5cGUpXSkgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAvLyBJZiB3YXMtcGFyc2VyLWluc2VydGVkIGlzIHRydWUsIHRoZW4gZmxhZyB0aGUgZWxlbWVudCBhcwogICAgICAgICAgICAgICAgICAgIC8vICJwYXJzZXItaW5zZXJ0ZWQiIGFnYWluLCBhbmQgc2V0IHRoZSBlbGVtZW50J3MgImZvcmNlLWFzeW5jIgogICAgICAgICAgICAgICAgICAgIC8vIGZsYWcgdG8gZmFsc2UuCiAgICAgICAgICAgICAgICAgICAgaWYgKHdhc19wYXJzZXJfaW5zZXJ0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFyc2VyX2luc2VydGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZm9yY2VfYXN5bmMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFRoZSB1c2VyIGFnZW50IG11c3Qgc2V0IHRoZSBlbGVtZW50J3MgImFscmVhZHkgc3RhcnRlZCIgZmxhZy4KICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbHJlYWR5X3N0YXJ0ZWQgPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgICAvLyBUaGUgc3RhdGUgb2YgdGhlIGVsZW1lbnQgYXQgdGhpcyBtb21lbnQgaXMgbGF0ZXIgdXNlZCB0bwogICAgICAgICAgICAgICAgICAgIC8vIGRldGVybWluZSB0aGUgc2NyaXB0IHNvdXJjZS4KICAgICAgICAgICAgICAgICAgICB0aGlzLl9zY3JpcHRfdGV4dCA9IHRoaXMudGV4dDsgLy8gV2UnbGwgdXNlIHRoaXMgaW4gX2V4ZWN1dGUKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGVsZW1lbnQgaXMgZmxhZ2dlZCBhcyAicGFyc2VyLWluc2VydGVkIiwgYnV0IHRoZQogICAgICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQncyBEb2N1bWVudCBpcyBub3QgdGhlIERvY3VtZW50IG9mIHRoZSBwYXJzZXIgdGhhdAogICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZWQgdGhlIGVsZW1lbnQsIHRoZW4gYWJvcnQgdGhlc2Ugc3RlcHMuCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BhcnNlcl9pbnNlcnRlZCAmJiB0aGlzLm93bmVyRG9jdW1lbnQgIT09IHRoaXMuX2NyZWF0b3JEb2N1bWVudCkgcmV0dXJuOyAvLyBTY3JpcHQgd2FzIG1vdmVkIHRvIGEgbmV3IGRvY3VtZW50CgogICAgICAgICAgICAgICAgICAgIC8vIElmIHNjcmlwdGluZyBpcyBkaXNhYmxlZCBmb3IgdGhlIHNjcmlwdCBlbGVtZW50LCB0aGVuIHRoZSB1c2VyCiAgICAgICAgICAgICAgICAgICAgLy8gYWdlbnQgbXVzdCBhYm9ydCB0aGVzZSBzdGVwcyBhdCB0aGlzIHBvaW50LiBUaGUgc2NyaXB0IGlzIG5vdAogICAgICAgICAgICAgICAgICAgIC8vIGV4ZWN1dGVkLgogICAgICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGRlZmluaXRpb24gb2Ygc2NyaXB0aW5nIGlzIGRpc2FibGVkIG1lYW5zIHRoYXQsIGFtb25nc3QKICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcnMsIHRoZSBmb2xsb3dpbmcgc2NyaXB0cyB3aWxsIG5vdCBleGVjdXRlOiBzY3JpcHRzIGluCiAgICAgICAgICAgICAgICAgICAgLy8gWE1MSHR0cFJlcXVlc3QncyByZXNwb25zZVhNTCBkb2N1bWVudHMsIHNjcmlwdHMgaW4KICAgICAgICAgICAgICAgICAgICAvLyBET01QYXJzZXItY3JlYXRlZCBkb2N1bWVudHMsIHNjcmlwdHMgaW4gZG9jdW1lbnRzIGNyZWF0ZWQgYnkKICAgICAgICAgICAgICAgICAgICAvLyBYU0xUUHJvY2Vzc29yJ3MgdHJhbnNmb3JtVG9Eb2N1bWVudCBmZWF0dXJlLCBhbmQgc2NyaXB0cyB0aGF0CiAgICAgICAgICAgICAgICAgICAgLy8gYXJlIGZpcnN0IGluc2VydGVkIGJ5IGEgc2NyaXB0IGludG8gYSBEb2N1bWVudCB0aGF0IHdhcyBjcmVhdGVkCiAgICAgICAgICAgICAgICAgICAgLy8gdXNpbmcgdGhlIGNyZWF0ZURvY3VtZW50KCkgQVBJLiBbWEhSXSBbRE9NUEFSU0lOR10gW0RPTUNPUkVdCiAgICAgICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgICAgICAvLyBYWFg6IGRvY3VtZW50cyB3aXRoIGEgYnJvd3NpbmcgY29udGV4dCBoYXZlIHNjcmlwdGluZyBvbgogICAgICAgICAgICAgICAgICAgIC8vIChleGNlcHQgaWZyYW1lcyB3aXRoIHRoZSBzYW5kYm94IGF0dHIpLiBTdGFuZGFsb25lIGRvY3MgZG8gbm90LgogICAgICAgICAgICAgICAgICAgIC8vIEl0cyBub3QgY2xlYXIgdG8gbWUgd2hlbiBJIHNob3VsZCBzZXQgdGhpcyBmbGFnLiAgZG9tLmpzIGlzCiAgICAgICAgICAgICAgICAgICAgLy8gaW4gYSB3ZWlyZCBzaXR1YXRpb24gc2luY2Ugd2UgZG9uJ3QgcmVhbGx5IGhhdmUgYSB3aW5kb3cgeWV0LAogICAgICAgICAgICAgICAgICAgIC8vIGJ1dCB3ZSBkbyB3YW50IHRvIHJ1biBzY3JpcHRzLiAgRm9yIG5vdywgSSB0aGluayBJJ2xsIGhhdmUKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgcGFyc2VyIHNldCB0aGlzLCBhbmQgYWxzbyBzZXQgaXQgb24gdGhlIGluaXRpYWwKICAgICAgICAgICAgICAgICAgICAvLyBnbG9iYWwgZG9jdW1lbnQuCiAgICAgICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3duZXJEb2N1bWVudC5fc2NyaXB0aW5nX2VuYWJsZWQpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHNjcmlwdCBlbGVtZW50IGhhcyBhbiBldmVudCBhdHRyaWJ1dGUgYW5kIGEgZm9yCiAgICAgICAgICAgICAgICAgICAgLy8gYXR0cmlidXRlLCB0aGVuIHJ1biB0aGVzZSBzdWJzdGVwczoKICAgICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICAgIC8vICAgICBMZXQgZm9yIGJlIHRoZSB2YWx1ZSBvZiB0aGUgZm9yIGF0dHJpYnV0ZS4KICAgICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICAgIC8vICAgICBMZXQgZXZlbnQgYmUgdGhlIHZhbHVlIG9mIHRoZSBldmVudCBhdHRyaWJ1dGUuCiAgICAgICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgICAgICAvLyAgICAgU3RyaXAgbGVhZGluZyBhbmQgdHJhaWxpbmcgd2hpdGVzcGFjZSBmcm9tIGV2ZW50IGFuZCBmb3IuCiAgICAgICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgICAgICAvLyAgICAgSWYgZm9yIGlzIG5vdCBhbiBBU0NJSSBjYXNlLWluc2Vuc2l0aXZlIG1hdGNoIGZvciB0aGUgc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICJ3aW5kb3ciLCB0aGVuIHRoZSB1c2VyIGFnZW50IG11c3QgYWJvcnQgdGhlc2Ugc3RlcHMgYXQgdGhpcwogICAgICAgICAgICAgICAgICAgIC8vICAgICBwb2ludC4gVGhlIHNjcmlwdCBpcyBub3QgZXhlY3V0ZWQuCiAgICAgICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgICAgICAvLyAgICAgSWYgZXZlbnQgaXMgbm90IGFuIEFTQ0lJIGNhc2UtaW5zZW5zaXRpdmUgbWF0Y2ggZm9yIGVpdGhlcgogICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGUgc3RyaW5nICJvbmxvYWQiIG9yIHRoZSBzdHJpbmcgIm9ubG9hZCgpIiwgdGhlbiB0aGUgdXNlcgogICAgICAgICAgICAgICAgICAgIC8vICAgICBhZ2VudCBtdXN0IGFib3J0IHRoZXNlIHN0ZXBzIGF0IHRoaXMgcG9pbnQuIFRoZSBzY3JpcHQgaXMKICAgICAgICAgICAgICAgICAgICAvLyAgICAgbm90IGV4ZWN1dGVkLgoKICAgICAgICAgICAgICAgICAgICB2YXIgZm9yYXR0ciA9IHRoaXMuZ2V0QXR0cmlidXRlKCJmb3IiKSB8fCB0aGlzLmZvciB8fCAiIjsKICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRhdHRyID0gdGhpcy5nZXRBdHRyaWJ1dGUoImV2ZW50IikgfHwgdGhpcy5ldmVudCB8fCAiIjsKICAgICAgICAgICAgICAgICAgICBpZiAoZm9yYXR0ciB8fCBldmVudGF0dHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yYXR0ciA9IHRvTG93ZXJDYXNlKGh0bWxUcmltKGZvcmF0dHIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRhdHRyID0gdG9Mb3dlckNhc2UoaHRtbFRyaW0oZXZlbnRhdHRyKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3JhdHRyICE9PSAid2luZG93IiB8fCBldmVudCAhPT0gIm9ubG9hZCIgJiYgZXZlbnQgIT09ICJvbmxvYWQoKSIpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBzY3JpcHQgZWxlbWVudCBoYXMgYSBjaGFyc2V0IGF0dHJpYnV0ZSwgdGhlbiBsZXQgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gc2NyaXB0IGJsb2NrJ3MgY2hhcmFjdGVyIGVuY29kaW5nIGZvciB0aGlzIHNjcmlwdCBlbGVtZW50IGJlIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIGVuY29kaW5nIGdpdmVuIGJ5IHRoZSBjaGFyc2V0IGF0dHJpYnV0ZS4KICAgICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgbGV0IHRoZSBzY3JpcHQgYmxvY2sncyBmYWxsYmFjayBjaGFyYWN0ZXIgZW5jb2RpbmcKICAgICAgICAgICAgICAgICAgICAvLyBmb3IgdGhpcyBzY3JpcHQgZWxlbWVudCBiZSB0aGUgc2FtZSBhcyB0aGUgZW5jb2Rpbmcgb2YgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gZG9jdW1lbnQgaXRzZWxmLgogICAgICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBvbmUgb2YgdGhlc2UgdHdvIHBpZWNlcyBvZiBzdGF0ZSBpcyBzZXQuCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKCJjaGFyc2V0IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBpZ25vcmluZyBjaGFyc2V0IGlzc3VlcyBmb3Igbm93CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHt9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWDogaWdub3JpbmcgY2hhcnNldCBpc3N1ZXMgZm9yIG5vdwoKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBlbGVtZW50IGhhcyBhIHNyYyBhdHRyaWJ1dGUgd2hvc2UgdmFsdWUgaXMgbm90IHRoZSBlbXB0eQogICAgICAgICAgICAgICAgICAgICAgICAvLyBzdHJpbmcsIHRoZW4gdGhlIHZhbHVlIG9mIHRoYXQgYXR0cmlidXRlIG11c3QgYmUgcmVzb2x2ZWQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVsYXRpdmUgdG8gdGhlIGVsZW1lbnQsIGFuZCBpZiB0aGF0IGlzIHN1Y2Nlc3NmdWwsIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBzcGVjaWZpZWQgcmVzb3VyY2UgbXVzdCB0aGVuIGJlIGZldGNoZWQsIGZyb20gdGhlIG9yaWdpbiBvZiB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCdzIERvY3VtZW50LgogICAgICAgICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgc3JjIGF0dHJpYnV0ZSdzIHZhbHVlIGlzIHRoZSBlbXB0eSBzdHJpbmcgb3IgaWYgaXQgY291bGQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm90IGJlIHJlc29sdmVkLCB0aGVuIHRoZSB1c2VyIGFnZW50IG11c3QgcXVldWUgYSB0YXNrIHRvIGZpcmUgYQogICAgICAgICAgICAgICAgICAgICAgICAvLyBzaW1wbGUgZXZlbnQgbmFtZWQgZXJyb3IgYXQgdGhlIGVsZW1lbnQsIGFuZCBhYm9ydCB0aGVzZSBzdGVwcy4KICAgICAgICAgICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGhpc3RvcmljYWwgcmVhc29ucywgaWYgdGhlIFVSTCBpcyBhIGphdmFzY3JpcHQ6IFVSTCwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgdXNlciBhZ2VudCBtdXN0IG5vdCwgZGVzcGl0ZSB0aGUgcmVxdWlyZW1lbnRzIGluIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWZpbml0aW9uIG9mIHRoZSBmZXRjaGluZyBhbGdvcml0aG0sIGFjdHVhbGx5IGV4ZWN1dGUgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNjcmlwdCBpbiB0aGUgVVJMOyBpbnN0ZWFkIHRoZSB1c2VyIGFnZW50IG11c3QgYWN0IGFzIGlmIGl0IGhhZAogICAgICAgICAgICAgICAgICAgICAgICAvLyByZWNlaXZlZCBhbiBlbXB0eSBIVFRQIDQwMCByZXNwb25zZS4KICAgICAgICAgICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMsIHVzZXIgYWdlbnRzIG1heSBzdGFydCBmZXRjaGluZyB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2NyaXB0IGFzIHNvb24gYXMgdGhlIGF0dHJpYnV0ZSBpcyBzZXQsIGluc3RlYWQsIGluIHRoZSBob3BlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoYXQgdGhlIGVsZW1lbnQgd2lsbCBiZSBpbnNlcnRlZCBpbnRvIHRoZSBkb2N1bWVudC4gRWl0aGVyIHdheSwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gb25jZSB0aGUgZWxlbWVudCBpcyBpbnNlcnRlZCBpbnRvIHRoZSBkb2N1bWVudCwgdGhlIGxvYWQgbXVzdAogICAgICAgICAgICAgICAgICAgICAgICAvLyBoYXZlIHN0YXJ0ZWQuIElmIHRoZSBVQSBwZXJmb3JtcyBzdWNoIHByZWZldGNoaW5nLCBidXQgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQgaXMgbmV2ZXIgaW5zZXJ0ZWQgaW4gdGhlIGRvY3VtZW50LCBvciB0aGUgc3JjIGF0dHJpYnV0ZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBpcyBkeW5hbWljYWxseSBjaGFuZ2VkLCB0aGVuIHRoZSB1c2VyIGFnZW50IHdpbGwgbm90IGV4ZWN1dGUgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNjcmlwdCwgYW5kIHRoZSBmZXRjaGluZyBwcm9jZXNzIHdpbGwgaGF2ZSBiZWVuIGVmZmVjdGl2ZWx5CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdhc3RlZC4KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoInNyYyIpIHx8IHNyY0F0dHJpYnV0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBYWFgKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHNwZWMgZm9yIGhhbmRsaW5nIHRoaXMgaXMgcmVhbGx5LCByZWFsbHkgY29tcGxpY2F0ZWQuCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBub3csIEknbSBqdXN0IGdvaW5nIHRvIHRyeSB0byBnZXQgc29tZXRoaW5nIGJhc2ljIHdvcmtpbmcKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSB0aGlzLmdldEF0dHJpYnV0ZSgic3JjIikgfHwgc3JjQXR0cmlidXRlOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3duZXJEb2N1bWVudC5fcGFyc2VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm93bmVyRG9jdW1lbnQuX3BhcnNlci5wYXVzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiB0aGlzIGlzIGEgaGFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UncmUgcnVubmluZyBpbiBub2RlLCBhbmQgdGhlIGRvY3VtZW50IGhhcyBhbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gX2FkZHJlc3MsIHRoZW4gd2UgY2FuIHJlc29sdmUgdGhlIFVSTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3duZXJEb2N1bWVudC5fYWRkcmVzcyAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiByZXF1aXJlID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gcmVxdWlyZSgndXJsJykucmVzb2x2ZSh0aGlzLm93bmVyRG9jdW1lbnQuX2FkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXNvbHZlIHRoZSBzY3JpcHQgdXJsIGFnYWluc3QgdGhlIGRvY3VtZW50IHVybAogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG9jdW1lbnR1cmwgPSBuZXcgVVJMKHRoaXMub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5sb2NhdGlvbi5ocmVmKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gZG9jdW1lbnR1cmwucmVzb2x2ZSh1cmwpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiB0aGlzIGlzIGV4cGVyaW1lbnRhbAogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSdyZSBpbiBhIHdlYiB3b3JrZXIsIHVzZSBpbXBvcnRTY3JpcHRzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRvIGxvYWQgYW5kIGV4ZWN1dGUgdGhlIHNjcmlwdC4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWF5YmUgdGhpcyB3aWxsIGdpdmUgdXMgYmV0dGVyIGVycm9yIG1lc3NhZ2VzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnbG9iYWwuaW1wb3J0U2NyaXB0cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnRTY3JpcHRzKHVybCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IoZSArICIgIiArIGUuc3RhY2spOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm93bmVyRG9jdW1lbnQuX3BhcnNlci5yZXN1bWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2NyaXB0ID0gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZWIgd29ya2VycyBzdXBwb3J0IHRoaXMgaGFuZGxlciBidXQgbm90IHRoZSBvbGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9ucmVhZHlzdGF0ZWNoYW5nZSBoYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aHIub25sb2FkZW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDAgfHwgeGhyLnN0YXR1cyA9PT0gMCAvKiBmaWxlOi8vIHVybHMgKi8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdC5fc2NyaXB0X3RleHQgPSB4aHIucmVzcG9uc2VUZXh0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0Ll9leGVjdXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgc2NyaXB0Ll9zY3JpcHRfdGV4dDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvIHRoaXMgZXZlbiBpZiB3ZSBmYWlsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NyaXB0Lm93bmVyRG9jdW1lbnQuX3BhcnNlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHQub3duZXJEb2N1bWVudC5fcGFyc2VyLnJlc3VtZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTXkgbm9kZSB2ZXJzaW9uIG9mIFhIUiByZXNwb25kcyB0byB0aGlzIGhhbmRsZXIgYnV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBub3QgdG8gb25sb2FkZW5kIGFib3ZlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgIT09IDQpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PT0gMjAwIHx8IHhoci5zdGF0dXMgPT09IDAgLyogZmlsZTovLyB1cmxzICovKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHQuX3NjcmlwdF90ZXh0ID0geGhyLnJlc3BvbnNlVGV4dDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdC5fZXhlY3V0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHNjcmlwdC5fc2NyaXB0X3RleHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG8gdGhpcyBldmVuIGlmIHdlIGZhaWxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY3JpcHQub3duZXJEb2N1bWVudC5fcGFyc2VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdC5vd25lckRvY3VtZW50Ll9wYXJzZXIucmVzdW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aHIub3BlbigiR0VUIiwgdXJsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhoci5zZW5kKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEp1c3QgZXhlY3V0ZSBpbmxpbmVzIHNjcmlwdHMgbm93LgogICAgICAgICAgICAgICAgICAgICAgICAvLyBMYXRlciwgSSd2ZSBnb3QgdG8gZGVhbCB3aXRoIHRoZSBhbGwgdGhlIGNhc2VzIGJlbG93CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9leGVjdXRlKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBUaGVuLCB0aGUgZmlyc3Qgb2YgdGhlIGZvbGxvd2luZyBvcHRpb25zIHRoYXQgZGVzY3JpYmVzIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIHNpdHVhdGlvbiBtdXN0IGJlIGZvbGxvd2VkOgoKICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgZWxlbWVudCBoYXMgYSBzcmMgYXR0cmlidXRlLCBhbmQgdGhlIGVsZW1lbnQgaGFzIGEgZGVmZXIKICAgICAgICAgICAgICAgICAgICAvLyBhdHRyaWJ1dGUsIGFuZCB0aGUgZWxlbWVudCBoYXMgYmVlbiBmbGFnZ2VkIGFzCiAgICAgICAgICAgICAgICAgICAgLy8gInBhcnNlci1pbnNlcnRlZCIsIGFuZCB0aGUgZWxlbWVudCBkb2VzIG5vdCBoYXZlIGFuIGFzeW5jCiAgICAgICAgICAgICAgICAgICAgLy8gYXR0cmlidXRlCgogICAgICAgICAgICAgICAgICAgIC8vICAgICBUaGUgZWxlbWVudCBtdXN0IGJlIGFkZGVkIHRvIHRoZSBlbmQgb2YgdGhlIGxpc3Qgb2Ygc2NyaXB0cwogICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGF0IHdpbGwgZXhlY3V0ZSB3aGVuIHRoZSBkb2N1bWVudCBoYXMgZmluaXNoZWQgcGFyc2luZwogICAgICAgICAgICAgICAgICAgIC8vICAgICBhc3NvY2lhdGVkIHdpdGggdGhlIERvY3VtZW50IG9mIHRoZSBwYXJzZXIgdGhhdCBjcmVhdGVkIHRoZQogICAgICAgICAgICAgICAgICAgIC8vICAgICBlbGVtZW50LgoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgVGhlIHRhc2sgdGhhdCB0aGUgbmV0d29ya2luZyB0YXNrIHNvdXJjZSBwbGFjZXMgb24gdGhlIHRhc2sKICAgICAgICAgICAgICAgICAgICAvLyBxdWV1ZSBvbmNlIHRoZSBmZXRjaGluZyBhbGdvcml0aG0gaGFzIGNvbXBsZXRlZCBtdXN0IHNldCB0aGUKICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50J3MgInJlYWR5IHRvIGJlIHBhcnNlci1leGVjdXRlZCIgZmxhZy4gVGhlIHBhcnNlciB3aWxsCiAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIGV4ZWN1dGluZyB0aGUgc2NyaXB0LiAgSWYgdGhlIGVsZW1lbnQgaGFzIGEgc3JjCiAgICAgICAgICAgICAgICAgICAgLy8gYXR0cmlidXRlLCBhbmQgdGhlIGVsZW1lbnQgaGFzIGJlZW4gZmxhZ2dlZCBhcwogICAgICAgICAgICAgICAgICAgIC8vICJwYXJzZXItaW5zZXJ0ZWQiLCBhbmQgdGhlIGVsZW1lbnQgZG9lcyBub3QgaGF2ZSBhbiBhc3luYwogICAgICAgICAgICAgICAgICAgIC8vIGF0dHJpYnV0ZQoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgVGhlIGVsZW1lbnQgaXMgdGhlIHBlbmRpbmcgcGFyc2luZy1ibG9ja2luZyBzY3JpcHQgb2YgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIERvY3VtZW50IG9mIHRoZSBwYXJzZXIgdGhhdCBjcmVhdGVkIHRoZSBlbGVtZW50LiAoVGhlcmUgY2FuCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIG9ubHkgYmUgb25lIHN1Y2ggc2NyaXB0IHBlciBEb2N1bWVudCBhdCBhIHRpbWUuKQoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgVGhlIHRhc2sgdGhhdCB0aGUgbmV0d29ya2luZyB0YXNrIHNvdXJjZSBwbGFjZXMgb24gdGhlIHRhc2sKICAgICAgICAgICAgICAgICAgICAvLyBxdWV1ZSBvbmNlIHRoZSBmZXRjaGluZyBhbGdvcml0aG0gaGFzIGNvbXBsZXRlZCBtdXN0IHNldCB0aGUKICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50J3MgInJlYWR5IHRvIGJlIHBhcnNlci1leGVjdXRlZCIgZmxhZy4gVGhlIHBhcnNlciB3aWxsCiAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIGV4ZWN1dGluZyB0aGUgc2NyaXB0LiAgSWYgdGhlIGVsZW1lbnQgZG9lcyBub3QgaGF2ZSBhIHNyYwogICAgICAgICAgICAgICAgICAgIC8vIGF0dHJpYnV0ZSwgYW5kIHRoZSBlbGVtZW50IGhhcyBiZWVuIGZsYWdnZWQgYXMKICAgICAgICAgICAgICAgICAgICAvLyAicGFyc2VyLWluc2VydGVkIiwgYW5kIHRoZSBEb2N1bWVudCBvZiB0aGUgSFRNTCBwYXJzZXIgb3IgWE1MCiAgICAgICAgICAgICAgICAgICAgLy8gcGFyc2VyIHRoYXQgY3JlYXRlZCB0aGUgc2NyaXB0IGVsZW1lbnQgaGFzIGEgc3R5bGUgc2hlZXQgdGhhdCBpcwogICAgICAgICAgICAgICAgICAgIC8vIGJsb2NraW5nIHNjcmlwdHMKCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIFRoZSBlbGVtZW50IGlzIHRoZSBwZW5kaW5nIHBhcnNpbmctYmxvY2tpbmcgc2NyaXB0IG9mIHRoZQogICAgICAgICAgICAgICAgICAgIC8vICAgICBEb2N1bWVudCBvZiB0aGUgcGFyc2VyIHRoYXQgY3JlYXRlZCB0aGUgZWxlbWVudC4gKFRoZXJlIGNhbgogICAgICAgICAgICAgICAgICAgIC8vICAgICBvbmx5IGJlIG9uZSBzdWNoIHNjcmlwdCBwZXIgRG9jdW1lbnQgYXQgYSB0aW1lLikKCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIFNldCB0aGUgZWxlbWVudCdzICJyZWFkeSB0byBiZSBwYXJzZXItZXhlY3V0ZWQiIGZsYWcuIFRoZQogICAgICAgICAgICAgICAgICAgIC8vIHBhcnNlciB3aWxsIGhhbmRsZSBleGVjdXRpbmcgdGhlIHNjcmlwdC4gIElmIHRoZSBlbGVtZW50IGhhcyBhCiAgICAgICAgICAgICAgICAgICAgLy8gc3JjIGF0dHJpYnV0ZSwgZG9lcyBub3QgaGF2ZSBhbiBhc3luYyBhdHRyaWJ1dGUsIGFuZCBkb2VzIG5vdAogICAgICAgICAgICAgICAgICAgIC8vIGhhdmUgdGhlICJmb3JjZS1hc3luYyIgZmxhZyBzZXQKCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIFRoZSBlbGVtZW50IG11c3QgYmUgYWRkZWQgdG8gdGhlIGVuZCBvZiB0aGUgbGlzdCBvZiBzY3JpcHRzCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoYXQgd2lsbCBleGVjdXRlIGluIG9yZGVyIGFzIHNvb24gYXMgcG9zc2libGUgYXNzb2NpYXRlZAogICAgICAgICAgICAgICAgICAgIC8vICAgICB3aXRoIHRoZSBEb2N1bWVudCBvZiB0aGUgc2NyaXB0IGVsZW1lbnQgYXQgdGhlIHRpbWUgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHByZXBhcmUgYSBzY3JpcHQgYWxnb3JpdGhtIHN0YXJ0ZWQuCgogICAgICAgICAgICAgICAgICAgIC8vICAgICBUaGUgdGFzayB0aGF0IHRoZSBuZXR3b3JraW5nIHRhc2sgc291cmNlIHBsYWNlcyBvbiB0aGUgdGFzawogICAgICAgICAgICAgICAgICAgIC8vICAgICBxdWV1ZSBvbmNlIHRoZSBmZXRjaGluZyBhbGdvcml0aG0gaGFzIGNvbXBsZXRlZCBtdXN0IHJ1biB0aGUKICAgICAgICAgICAgICAgICAgICAvLyAgICAgZm9sbG93aW5nIHN0ZXBzOgoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIElmIHRoZSBlbGVtZW50IGlzIG5vdCBub3cgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGxpc3QKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIG9mIHNjcmlwdHMgdGhhdCB3aWxsIGV4ZWN1dGUgaW4gb3JkZXIgYXMgc29vbiBhcwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgcG9zc2libGUgdG8gd2hpY2ggaXQgd2FzIGFkZGVkIGFib3ZlLCB0aGVuIG1hcmsgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICBlbGVtZW50IGFzIHJlYWR5IGJ1dCBhYm9ydCB0aGVzZSBzdGVwcyB3aXRob3V0IGV4ZWN1dGluZwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgdGhlIHNjcmlwdCB5ZXQuCgogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgRXhlY3V0aW9uOiBFeGVjdXRlIHRoZSBzY3JpcHQgYmxvY2sgY29ycmVzcG9uZGluZyB0byB0aGUKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIGZpcnN0IHNjcmlwdCBlbGVtZW50IGluIHRoaXMgbGlzdCBvZiBzY3JpcHRzIHRoYXQgd2lsbAogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgZXhlY3V0ZSBpbiBvcmRlciBhcyBzb29uIGFzIHBvc3NpYmxlLgoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIFJlbW92ZSB0aGUgZmlyc3QgZWxlbWVudCBmcm9tIHRoaXMgbGlzdCBvZiBzY3JpcHRzIHRoYXQKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIHdpbGwgZXhlY3V0ZSBpbiBvcmRlciBhcyBzb29uIGFzIHBvc3NpYmxlLgoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgIElmIHRoaXMgbGlzdCBvZiBzY3JpcHRzIHRoYXQgd2lsbCBleGVjdXRlIGluIG9yZGVyIGFzCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICBzb29uIGFzIHBvc3NpYmxlIGlzIHN0aWxsIG5vdCBlbXB0eSBhbmQgdGhlIGZpcnN0IGVudHJ5CiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICBoYXMgYWxyZWFkeSBiZWVuIG1hcmtlZCBhcyByZWFkeSwgdGhlbiBqdW1wIGJhY2sgdG8gdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICBzdGVwIGxhYmVsZWQgZXhlY3V0aW9uLgoKICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgZWxlbWVudCBoYXMgYSBzcmMgYXR0cmlidXRlCgogICAgICAgICAgICAgICAgICAgIC8vICAgICBUaGUgZWxlbWVudCBtdXN0IGJlIGFkZGVkIHRvIHRoZSBzZXQgb2Ygc2NyaXB0cyB0aGF0IHdpbGwKICAgICAgICAgICAgICAgICAgICAvLyAgICAgZXhlY3V0ZSBhcyBzb29uIGFzIHBvc3NpYmxlIG9mIHRoZSBEb2N1bWVudCBvZiB0aGUgc2NyaXB0CiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGVsZW1lbnQgYXQgdGhlIHRpbWUgdGhlIHByZXBhcmUgYSBzY3JpcHQgYWxnb3JpdGhtIHN0YXJ0ZWQuCgogICAgICAgICAgICAgICAgICAgIC8vICAgICBUaGUgdGFzayB0aGF0IHRoZSBuZXR3b3JraW5nIHRhc2sgc291cmNlIHBsYWNlcyBvbgogICAgICAgICAgICAgICAgICAgIC8vICAgICB0aGUgdGFzayBxdWV1ZSBvbmNlIHRoZSBmZXRjaGluZyBhbGdvcml0aG0gaGFzCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGNvbXBsZXRlZCBtdXN0IGV4ZWN1dGUgdGhlIHNjcmlwdCBibG9jayBhbmQgdGhlbgogICAgICAgICAgICAgICAgICAgIC8vICAgICByZW1vdmUgdGhlIGVsZW1lbnQgZnJvbSB0aGUgc2V0IG9mIHNjcmlwdHMgdGhhdAogICAgICAgICAgICAgICAgICAgIC8vICAgICB3aWxsIGV4ZWN1dGUgYXMgc29vbiBhcyBwb3NzaWJsZS4KICAgICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSBUaGUgdXNlciBhZ2VudCBtdXN0IGltbWVkaWF0ZWx5IGV4ZWN1dGUgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gc2NyaXB0IGJsb2NrLCBldmVuIGlmIG90aGVyIHNjcmlwdHMgYXJlIGFscmVhZHkKICAgICAgICAgICAgICAgICAgICAvLyBleGVjdXRpbmcuCiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICBfZXhlY3V0ZTogY29uc3RhbnQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIC8vIFdlIHRlc3QgdGhpcyBpbiBfcHJlcGFyZSgpLCBidXQgdGhlIHNwZWMgc2F5cyB3ZQogICAgICAgICAgICAgICAgICAgIC8vIGhhdmUgdG8gY2hlY2sgYWdhaW4gaGVyZS4KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGFyc2VyX2luc2VydGVkICYmIHRoaXMub3duZXJEb2N1bWVudCAhPT0gdGhpcy5fY3JlYXRvckRvY3VtZW50KSByZXR1cm47CgogICAgICAgICAgICAgICAgICAgIC8vIFhYWAogICAgICAgICAgICAgICAgICAgIC8vIEZvciBub3csIHdlJ3JlIGp1c3QgZG9pbmcgaW5saW5lIHNjcmlwdHMsIHNvIEknbSBza2lwcGluZwogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzdGVwcyBhYm91dCBpZiB0aGUgbG9hZCB3YXMgbm90IHN1Y2Nlc3NmdWwuCiAgICAgICAgICAgICAgICAgICAgdmFyIGNvZGUgPSB0aGlzLl9zY3JpcHRfdGV4dDsKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHNjcmlwdCBpcyBmcm9tIGFuIGV4dGVybmFsIGZpbGUsIHRoZW4gaW5jcmVtZW50IHRoZQogICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZS1kZXN0cnVjdGl2ZS13cml0ZXMgY291bnRlciBvZiB0aGUgc2NyaXB0IGVsZW1lbnQncwogICAgICAgICAgICAgICAgICAgIC8vIERvY3VtZW50LiBMZXQgbmV1dHJhbGl6ZWQgZG9jIGJlIHRoYXQgRG9jdW1lbnQuCiAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBpZ25vcmluZyB0aGlzIGZvciBpbmxpbmUgc2NyaXB0cyBmb3Igbm93LgoKICAgICAgICAgICAgICAgICAgICAvLyBYWFgKICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSBpcyBhY3R1YWxseSBtb3JlIHRvIGV4ZWN1dGluZyBhIHNjcmlwdCB0aGFuIHRoaXMuCiAgICAgICAgICAgICAgICAgICAgLy8gU2VlIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvbXVsdGlwYWdlL3dlYmFwcGFwaXMuaHRtbCNjcmVhdGUtYS1zY3JpcHQKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBYWFggRm9yIG5vdywgd2UncmUganVzdCBhc3N1bWluZyB0aGF0IHRoZXJlIGlzIG5ldmVyIG1vcmUgdGhhbgogICAgICAgICAgICAgICAgICAgICAgICAvLyBvbmUgZG9jdW1lbnQgYXQgYSB0aW1lLCBhbmQgYWxsIHNjcmlwdHMgZ2V0IGV4ZWN1dGVkIGFnYWluc3QgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNhbWUgZ2xvYmFsIG9iamVjdC4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgdmFyIG9sZGRvYyA9IGdsb2JhbC5kb2N1bWVudDsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgZ2xvYmFsLmRvY3VtZW50ID0gd3JhcCh0aGlzLm93bmVyRG9jdW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICBldmFsU2NyaXB0KGNvZGUpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICBnbG9iYWwuZG9jdW1lbnQgPSBvbGRkb2M7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBYWFggZmlyZSBhbiBvbmVycm9yIGV2ZW50IGJlZm9yZSByZXBvcnRpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IoZSArICIgIiArIGUuc3RhY2spOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gRGVjcmVtZW50IHRoZSBpZ25vcmUtZGVzdHJ1Y3RpdmUtd3JpdGVzIGNvdW50ZXIgb2YgbmV1dHJhbGl6ZWQKICAgICAgICAgICAgICAgICAgICAvLyBkb2MsIGlmIGl0IHdhcyBpbmNyZW1lbnRlZCBpbiB0aGUgZWFybGllciBzdGVwLgoKICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgc2NyaXB0IGlzIGZyb20gYW4gZXh0ZXJuYWwgZmlsZSwgZmlyZSBhIHNpbXBsZSBldmVudAogICAgICAgICAgICAgICAgICAgIC8vIG5hbWVkIGxvYWQgYXQgdGhlIHNjcmlwdCBlbGVtZW50LgoKICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIHRoZSBzY3JpcHQgaXMgaW50ZXJuYWw7IHF1ZXVlIGEgdGFzayB0byBmaXJlIGEgc2ltcGxlCiAgICAgICAgICAgICAgICAgICAgLy8gZXZlbnQgbmFtZWQgbG9hZCBhdCB0aGUgc2NyaXB0IGVsZW1lbnQuCiAgICAgICAgICAgICAgICAgICAgdmFyIG9ubG9hZCA9IHRoaXMuZ2V0QXR0cmlidXRlKCJvbmxvYWQiKSB8fCB0aGlzLm9ubG9hZDsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKG9ubG9hZCkgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb25sb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBYWFggaW1wbC5FbGVtZW50LnJlZmxlY3RVUkxBdHRyaWJ1dGUoSFRNTFNjcmlwdEVsZW1lbnQsICJzcmMiKTsKICAgICAgICAgICAgaW1wbC5FbGVtZW50LnJlZmxlY3RTdHJpbmdBdHRyaWJ1dGUoSFRNTFNjcmlwdEVsZW1lbnQsICJ0eXBlIik7CiAgICAgICAgICAgIGltcGwuRWxlbWVudC5yZWZsZWN0U3RyaW5nQXR0cmlidXRlKEhUTUxTY3JpcHRFbGVtZW50LCAiY2hhcnNldCIpOwogICAgICAgICAgICBpbXBsLkVsZW1lbnQucmVmbGVjdEJvb2xlYW5BdHRyaWJ1dGUoSFRNTFNjcmlwdEVsZW1lbnQsICJkZWZlciIpOwoKICAgICAgICAgICAgcmV0dXJuIEhUTUxTY3JpcHRFbGVtZW50OwogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL0hUTUxQYXJzZXIuanMKICAgICAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgICAgICAvL0BsaW5lIDEgInNyYy9pbXBsL0hUTUxQYXJzZXIuanMiCiAgICAgICAgLyoKICAgICAgICAgKiBUaGlzIGZpbGUgY29udGFpbnMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIEhUTUwgcGFyc2luZyBhbGdvcml0aG0uCiAgICAgICAgICogVGhlIGFsZ29yaXRobSBhbmQgdGhlIGltcGxlbWVudGF0aW9uIGFyZSBjb21wbGV4IGJlY2F1c2UgSFRNTAogICAgICAgICAqIGV4cGxpY2l0bHkgZGVmaW5lcyBob3cgdGhlIHBhcnNlciBzaG91bGQgYmVoYXZlIGZvciBhbGwgcG9zc2libGUKICAgICAgICAgKiB2YWxpZCBhbmQgaW52YWxpZCBpbnB1dHMuCiAgICAgICAgICoKICAgICAgICAgKiBVc2FnZToKICAgICAgICAgKgogICAgICAgICAqIFRoZSBmaWxlIGRlZmluZXMgYSBzaW5nbGUgSFRNTFBhcnNlcigpIGZ1bmN0aW9uLCB3aGljaCBkb20uanMgZXhwb3NlcwogICAgICAgICAqIHB1YmxpY2x5IGFzIGRvY3VtZW50LmltcGxlbWVudGF0aW9uLm1vekhUTUxQYXJzZXIoKS4gVGhpcyBpcyBhCiAgICAgICAgICogZmFjdG9yeSBmdW5jdGlvbiwgbm90IGEgY29uc3RydWN0b3IuCiAgICAgICAgICoKICAgICAgICAgKiBXaGVuIHlvdSBjYWxsIGRvY3VtZW50LmltcGxlbWVudGF0aW9uLm1vekhUTUxQYXJzZXIoKSwgaXQgcmV0dXJucwogICAgICAgICAqIGFuIG9iamVjdCB0aGF0IGhhcyBwYXJzZSgpIGFuZCBkb2N1bWVudCgpIG1ldGhvZHMuIFRvIHBhcnNlIEhUTUwgdGV4dCwKICAgICAgICAgKiBwYXNzIHRoZSB0ZXh0IChpbiBvbmUgb3IgbW9yZSBjaHVua3MpIHRvIHRoZSBwYXJzZSgpIG1ldGhvZC4gIFdoZW4KICAgICAgICAgKiB5b3UndmUgcGFzc2VkIGFsbCB0aGUgdGV4dCAob24gdGhlIGxhc3QgY2h1bmssIG9yIGFmdGVyd2FyZCkgcGFzcwogICAgICAgICAqIHRydWUgYXMgdGhlIHNlY29uZCBhcmd1bWVudCB0byBwYXJzZSgpIHRvIHRlbGwgdGhlIHBhcnNlciB0aGF0IHRoZXJlCiAgICAgICAgICogaXMgbm8gbW9yZSBjb21pbmcuIENhbGwgZG9jdW1lbnQoKSB0byBnZXQgdGhlIGRvY3VtZW50IG9iamVjdCB0aGF0CiAgICAgICAgICogdGhlIHBhcnNlciBpcyBwYXJzaW5nIGludG8uICBZb3UgY2FuIGNhbGwgdGhpcyBhdCBhbnkgdGltZSwgYmVmb3JlCiAgICAgICAgICogb3IgYWZ0ZXIgY2FsbGluZyBwYXJzZSgpLgogICAgICAgICAqCiAgICAgICAgICogVGhlIGZpcnN0IGFyZ3VtZW50IHRvIG1vekhUTUxQYXJzZXIgaXMgdGhlIGFic29sdXRlIFVSTCBvZiB0aGUgZG9jdW1lbnQuCiAgICAgICAgICoKICAgICAgICAgKiBUaGUgc2Vjb25kIGFyZ3VtZW50IGlzIG9wdGlvbmFsIGFuZCBpcyBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuICBQYXNzIGFuCiAgICAgICAgICogZWxlbWVudCBhcyB0aGUgZnJhZ21lbnRDb250ZXh0IHRvIGRvIGlubmVySFRNTCBwYXJzaW5nIGZvciB0aGUKICAgICAgICAgKiBlbGVtZW50LiAgVG8gZG8gaW5uZXJIVE1MIHBhcnNpbmcgb24gYSBkb2N1bWVudCwgcGFzcyBudWxsLiBPdGhlcndpc2UsCiAgICAgICAgICogb21pdCB0aGUgMm5kIGFyZ3VtZW50LiBTZWUgSFRNTEVsZW1lbnQuaW5uZXJIVE1MIGZvciBhbiBleGFtcGxlLiAgTm90ZQogICAgICAgICAqIHRoYXQgaWYgeW91IHBhc3MgYSBjb250ZXh0IGVsZW1lbnQsIHRoZSBlbmQoKSBtZXRob2Qgd2lsbCByZXR1cm4gYW4KICAgICAgICAgKiB1bndyYXBwZWQgZG9jdW1lbnQgaW5zdGVhZCBvZiBhIHdyYXBwZWQgb25lLgogICAgICAgICAqCiAgICAgICAgICogSW1wbGVtZW50YXRpb24gZGV0YWlsczoKICAgICAgICAgKgogICAgICAgICAqIFRoaXMgaXMgYSBsb25nIGZpbGUgb2YgYWxtb3N0IDcwMDAgbGluZXMuIEl0IGlzIHN0cnVjdHVyZWQgYXMgb25lCiAgICAgICAgICogYmlnIGZ1bmN0aW9uIG5lc3RlZCB3aXRoaW4gYW5vdGhlciBiaWcgZnVuY3Rpb24uICBUaGUgb3V0ZXIKICAgICAgICAgKiBmdW5jdGlvbiBkZWZpbmVzIGEgYnVuY2ggb2YgY29uc3RhbnQgZGF0YSwgdXRpbGl0eSBmdW5jdGlvbnMKICAgICAgICAgKiB0aGF0IHVzZSB0aGF0IGRhdGEsIGFuZCBhIGNvdXBsZSBvZiBjbGFzc2VzIHVzZWQgYnkgdGhlIHBhcnNlci4KICAgICAgICAgKiBUaGUgb3V0ZXIgZnVuY3Rpb24gYWxzbyBkZWZpbmVzIGFuZCByZXR1cm5zIHRoZQogICAgICAgICAqIGlubmVyIGZ1bmN0aW9uLiBUaGlzIGlubmVyIGZ1bmN0aW9uIGlzIHRoZSBIVE1MUGFyc2VyIGZhY3RvcnkKICAgICAgICAgKiBmdW5jdGlvbiB0aGF0IGltcGxlbWVudHMgdGhlIHBhcnNlciBhbmQgaG9sZHMgYWxsIHRoZSBwYXJzZXIgc3RhdGUKICAgICAgICAgKiBhcyBsb2NhbCB2YXJpYWJsZXMuICBUaGUgSFRNTFBhcnNlciBmdW5jdGlvbiBpcyBxdWl0ZSBiaWcgYmVjYXVzZQogICAgICAgICAqIGl0IGRlZmluZXMgbWFueSBuZXN0ZWQgZnVuY3Rpb25zIHRoYXQgdXNlIHRob3NlIGxvY2FsIHZhcmlhYmxlcy4KICAgICAgICAgKgogICAgICAgICAqIFRoZXJlIGFyZSB0aHJlZSB0aWdodGx5IGNvdXBsZWQgcGFyc2VyIHN0YWdlczogYSBzY2FubmVyLCBhCiAgICAgICAgICogdG9rZW5pemVyIGFuZCBhIHRyZWUgYnVpbGRlci4gSW4gYSAocG9zc2libHkgbWlzZ3VpZGVkKSBhdHRlbXB0IGF0CiAgICAgICAgICogZWZmaWNpZW5jeSwgdGhlIHN0YWdlcyBhcmUgbm90IGltcGxlbWVudGVkIGFzIHNlcGFyYXRlIGNsYXNzZXM6CiAgICAgICAgICogZXZlcnl0aGluZyBzaGFyZXMgc3RhdGUgYW5kIGlzIChtb3N0bHkpIGltcGxlbWVudGVkIGluIGltcGVyYXRpdmUKICAgICAgICAgKiAocmF0aGVyIHRoYW4gT08pIHN0eWxlLgogICAgICAgICAqCiAgICAgICAgICogVGhlIHN0YWdlcyBvZiB0aGUgcGFyc2VyIHdvcmsgbGlrZSB0aGlzOiBXaGVuIHRoZSBjbGllbnQgY29kZSBjYWxscwogICAgICAgICAqIHRoZSBwYXJzZXIncyBwYXJzZSgpIG1ldGhvZCwgdGhlIHNwZWNpZmllZCBzdHJpbmcgaXMgcGFzc2VkIHRvCiAgICAgICAgICogc2NhbkNoYXJzKCkuIFRoZSBzY2FubmVyIGxvb3BzIHRocm91Z2ggdGhhdCBzdHJpbmcgYW5kIHBhc3NlcyBjaGFyYWN0ZXJzCiAgICAgICAgICogKHNvbWV0aW1lcyBvbmUgYXQgYSB0aW1lLCBzb21ldGltZXMgaW4gY2h1bmtzKSB0byB0aGUgdG9rZW5pemVyIHN0YWdlLgogICAgICAgICAqIFRoZSB0b2tlbml6ZXIgZ3JvdXBzIHRoZSBjaGFyYWN0ZXJzIGludG8gdG9rZW5zOiB0YWdzLCBlbmR0YWdzLCBydW5zCiAgICAgICAgICogb2YgdGV4dCwgY29tbWVudHMsIGRvY3R5cGUgZGVjbGFyYXRpb25zLCBhbmQgdGhlIGVuZC1vZi1maWxlIChFT0YpCiAgICAgICAgICogdG9rZW4uICBUaGVzZSB0b2tlbnMgYXJlIHRoZW4gcGFzc2VkIHRvIHRoZSB0cmVlIGJ1aWxkaW5nIHN0YWdlIHZpYQogICAgICAgICAqIHRoZSBpbnNlcnRUb2tlbigpIGZ1bmN0aW9uLiAgVGhlIHRyZWUgYnVpbGRpbmcgc3RhZ2UgYnVpbGRzIHVwIHRoZQogICAgICAgICAqIGRvY3VtZW50IHRyZWUuCiAgICAgICAgICoKICAgICAgICAgKiBUaGUgdG9rZW5pemVyIHN0YWdlIGlzIGEgZmluaXRlIHN0YXRlIG1hY2hpbmUuICBFYWNoIHN0YXRlIGlzCiAgICAgICAgICogaW1wbGVtZW50ZWQgYXMgYSBmdW5jdGlvbiB3aXRoIGEgbmFtZSB0aGF0IGVuZHMgaW4gIl9zdGF0ZSIuICBUaGUKICAgICAgICAgKiBpbml0aWFsIHN0YXRlIGlzIGRhdGFfc3RhdGUoKS4gVGhlIGN1cnJlbnQgdG9rZW5pemVyIHN0YXRlIGlzIHN0b3JlZAogICAgICAgICAqIGluIHRoZSB2YXJpYWJsZSAndG9rZW5pemVyJy4gIE1vc3Qgc3RhdGUgZnVuY3Rpb25zIGV4cGVjdCBhIHNpbmdsZQogICAgICAgICAqIGludGVnZXIgYXJndW1lbnQgd2hpY2ggcmVwcmVzZW50cyBhIHNpbmdsZSBVVEYtMTYgY29kZXBvaW50LiAgU29tZQogICAgICAgICAqIHN0YXRlcyB3YW50IG1vcmUgY2hhcmFjdGVycyBhbmQgc2V0IGEgbG9va2FoZWFkIHByb3BlcnR5IG9uCiAgICAgICAgICogdGhlbXNlbHZlcy4gIFRoZSBzY2FuQ2hhcnMoKSBmdW5jdGlvbiBpbiB0aGUgc2Nhbm5lciBjaGVja3MgZm9yIHRoaXMKICAgICAgICAgKiBsb29rYWhlYWQgcHJvcGVydHkuICBJZiBpdCBkb2Vzbid0IGV4aXN0LCB0aGVuIHNjYW5DaGFycygpIGp1c3QgcGFzc2VzCiAgICAgICAgICogdGhlIG5leHQgaW5wdXQgY2hhcmFjdGVyIHRvIHRoZSBjdXJyZW50IHRva2VuaXplciBzdGF0ZSBmdW5jdGlvbi4KICAgICAgICAgKiBPdGhlcndpc2UsIHNjYW5DaGFycygpIGxvb2tzIGFoZWFkIChhIGdpdmVuICMgb2YgY2hhcmFjdGVycywgb3IgZm9yIGEKICAgICAgICAgKiBtYXRjaGluZyBzdHJpbmcsIG9yIGZvciBhIG1hdGNoaW5nIHJlZ2V4cCkgYW5kIHBhc3NlcyBhIHN0cmluZyBvZgogICAgICAgICAqIGNoYXJhY3RlcnMgdG8gdGhlIGN1cnJlbnQgdG9rZW5pemVyIHN0YXRlIGZ1bmN0aW9uLgogICAgICAgICAqCiAgICAgICAgICogQXMgYSBzaG9ydGN1dCwgY2VydGFpbiBzdGF0ZXMgb2YgdGhlIHRva2VuaXplciB1c2UgcmVndWxhciBleHByZXNzaW9ucwogICAgICAgICAqIHRvIGxvb2sgYWhlYWQgaW4gdGhlIHNjYW5uZXIncyBpbnB1dCBidWZmZXIgZm9yIHJ1bnMgb2YgdGV4dCwgc2ltcGxlCiAgICAgICAgICogdGFncyBhbmQgYXR0cmlidXRlcy4gIEZvciB3ZWxsLWZvcm1lZCBpbnB1dCwgdGhlc2Ugc2hvcnRjdXRzIHNraXAgYQogICAgICAgICAqIGxvdCBvZiBzdGF0ZSB0cmFuc2l0aW9ucyBhbmQgc3BlZWQgdGhpbmdzIHVwIGEgYml0LgogICAgICAgICAqCiAgICAgICAgICogV2hlbiBhIHRva2VuaXplciBzdGF0ZSBmdW5jdGlvbiBoYXMgY29uc3VtZWQgYSBjb21wbGV0ZSB0b2tlbiwgaXQKICAgICAgICAgKiBlbWl0cyB0aGF0IHRva2VuLCBieSBjYWxsaW5nIGluc2VydFRva2VuKCksIG9yIGJ5IGNhbGxpbmcgYSB1dGlsaXR5CiAgICAgICAgICogZnVuY3Rpb24gdGhhdCBpdHNlbGYgY2FsbHMgaW5zZXJ0VG9rZW4oKS4gIFRoZXNlIHRva2VucyBhcmUgcGFzc2VkIHRvCiAgICAgICAgICogdGhlIHRyZWUgYnVpbGRpbmcgc3RhZ2UsIHdoaWNoIGlzIGFsc28gYSBzdGF0ZSBtYWNoaW5lLiAgTGlrZSB0aGUKICAgICAgICAgKiB0b2tlbml6ZXIsIHRoZSB0cmVlIGJ1aWxkaW5nIHN0YXRlcyBhcmUgaW1wbGVtZW50ZWQgYXMgZnVuY3Rpb25zLCBhbmQKICAgICAgICAgKiB0aGVzZSBmdW5jdGlvbnMgaGF2ZSBuYW1lcyB0aGF0IGVuZCB3aXRoIF9tb2RlIChiZWNhdXNlIHRoZSBIVE1MIHNwZWMKICAgICAgICAgKiByZWZlcnMgdG8gdGhlbSBhcyBpbnNlcnRpb24gbW9kZXMpLiBUaGUgY3VycmVudCBpbnNlcnRpb24gbW9kZSBpcyBoZWxkCiAgICAgICAgICogYnkgdGhlICdwYXJzZXInIHZhcmlhYmxlLiAgRWFjaCBpbnNlcnRpb24gbW9kZSBmdW5jdGlvbiB0YWtlcyB1cCB0byA0CiAgICAgICAgICogYXJndW1lbnRzLiAgVGhlIGZpcnN0IGlzIGEgdG9rZW4gdHlwZSwgcmVwcmVzZW50ZWQgYnkgdGhlIGNvbnN0YW50cwogICAgICAgICAqIFRBRywgRU5EVEFHLCBURVhULCBDT01NRU5ULCBET0NUWVBFIGFuZCBFT0YuICBUaGUgc2Vjb25kIGFyZ3VtZW50IGlzCiAgICAgICAgICogdGhlIHZhbHVlIG9mIHRoZSB0b2tlbjogdGhlIHRleHQgb3IgY29tbWVudCBkYXRhLCBvciB0YWduYW1lIG9yCiAgICAgICAgICogZG9jdHlwZS4gIEZvciB0YWdzLCB0aGUgM3JkIGFyZ3VtZW50IGlzIGFuIGFycmF5IG9mIGF0dHJpYnV0ZXMuICBGb3IKICAgICAgICAgKiBET0NUWVBFUyBpdCBpcyB0aGUgb3B0aW9uYWwgcHVibGljIGlkLiAgRm9yIHRhZ3MsIHRoZSA0dGggYXJndW1lbnQgaXMKICAgICAgICAgKiB0cnVlIGlmIHRoZSB0YWcgaXMgc2VsZi1jbG9zaW5nLiBGb3IgZG9jdHlwZXMsIHRoZSA0dGggYXJndW1lbnQgaXMgdGhlCiAgICAgICAgICogb3B0aW9uYWwgc3lzdGVtIGlkLgogICAgICAgICAqCiAgICAgICAgICogU2VhcmNoIGZvciAiKioqIiB0byBmaW5kIHRoZSBtYWpvciBzdWItZGl2aXNpb25zIGluIHRoZSBjb2RlLgogICAgICAgICAqLwogICAgICAgIHZhciBIVE1MUGFyc2VyID0gZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgLyoqKgogICAgICAgICAgICAgKiBEYXRhIHByb2xvZy4gIExvdHMgb2YgY29uc3RhbnRzIGRlY2xhcmVkIGhlcmUsIGluY2x1ZGluZyBzb21lCiAgICAgICAgICAgICAqIHZlcnkgbGFyZ2Ugb2JqZWN0cy4gIFRoZXkncmUgdXNlZCB0aHJvdWdob3V0IHRoZSBjb2RlIHRoYXQgZm9sbG93cwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgLy8gVG9rZW4gdHlwZXMgZm9yIHRoZSB0cmVlIGJ1aWxkZXIuCiAgICAgICAgICAgIHZhciBFT0YgPSAtMTsKICAgICAgICAgICAgdmFyIFRFWFQgPSAxOwogICAgICAgICAgICB2YXIgVEFHID0gMjsKICAgICAgICAgICAgdmFyIEVORFRBRyA9IDM7CiAgICAgICAgICAgIHZhciBDT01NRU5UID0gNDsKICAgICAgICAgICAgdmFyIERPQ1RZUEUgPSA1OwoKICAgICAgICAgICAgLy8gQSByZS11c2FibGUgZW1wdHkgYXJyYXkKICAgICAgICAgICAgdmFyIE5PQVRUUlMgPSBPYmplY3QuZnJlZXplKFtdKTsKCiAgICAgICAgICAgIC8vIFRoZXNlIERURCBwdWJsaWMgaWRzIHB1dCB0aGUgYnJvd3NlciBpbiBxdWlya3MgbW9kZQogICAgICAgICAgICB2YXIgcXVpcmt5UHVibGljSWRzID0gL15IVE1MJHxeLVwvXC9XM09cL1wvRFREIFczIEhUTUwgU3RyaWN0IDNcLjBcL1wvRU5cL1wvJHxeLVwvVzNDXC9EVEQgSFRNTCA0XC4wIFRyYW5zaXRpb25hbFwvRU4kfF5cK1wvXC9TaWxtYXJpbFwvXC9kdGQgaHRtbCBQcm8gdjByMTEgMTk5NzAxMDFcL1wvfF4tXC9cL0FkdmFTb2Z0IEx0ZFwvXC9EVEQgSFRNTCAzXC4wIGFzV2VkaXQgXCsgZXh0ZW5zaW9uc1wvXC98Xi1cL1wvQVNcL1wvRFREIEhUTUwgM1wuMCBhc1dlZGl0IFwrIGV4dGVuc2lvbnNcL1wvfF4tXC9cL0lFVEZcL1wvRFREIEhUTUwgMlwuMCBMZXZlbCAxXC9cL3xeLVwvXC9JRVRGXC9cL0RURCBIVE1MIDJcLjAgTGV2ZWwgMlwvXC98Xi1cL1wvSUVURlwvXC9EVEQgSFRNTCAyXC4wIFN0cmljdCBMZXZlbCAxXC9cL3xeLVwvXC9JRVRGXC9cL0RURCBIVE1MIDJcLjAgU3RyaWN0IExldmVsIDJcL1wvfF4tXC9cL0lFVEZcL1wvRFREIEhUTUwgMlwuMCBTdHJpY3RcL1wvfF4tXC9cL0lFVEZcL1wvRFREIEhUTUwgMlwuMFwvXC98Xi1cL1wvSUVURlwvXC9EVEQgSFRNTCAyXC4xRVwvXC98Xi1cL1wvSUVURlwvXC9EVEQgSFRNTCAzXC4wXC9cL3xeLVwvXC9JRVRGXC9cL0RURCBIVE1MIDNcLjIgRmluYWxcL1wvfF4tXC9cL0lFVEZcL1wvRFREIEhUTUwgM1wuMlwvXC98Xi1cL1wvSUVURlwvXC9EVEQgSFRNTCAzXC9cL3xeLVwvXC9JRVRGXC9cL0RURCBIVE1MIExldmVsIDBcL1wvfF4tXC9cL0lFVEZcL1wvRFREIEhUTUwgTGV2ZWwgMVwvXC98Xi1cL1wvSUVURlwvXC9EVEQgSFRNTCBMZXZlbCAyXC9cL3xeLVwvXC9JRVRGXC9cL0RURCBIVE1MIExldmVsIDNcL1wvfF4tXC9cL0lFVEZcL1wvRFREIEhUTUwgU3RyaWN0IExldmVsIDBcL1wvfF4tXC9cL0lFVEZcL1wvRFREIEhUTUwgU3RyaWN0IExldmVsIDFcL1wvfF4tXC9cL0lFVEZcL1wvRFREIEhUTUwgU3RyaWN0IExldmVsIDJcL1wvfF4tXC9cL0lFVEZcL1wvRFREIEhUTUwgU3RyaWN0IExldmVsIDNcL1wvfF4tXC9cL0lFVEZcL1wvRFREIEhUTUwgU3RyaWN0XC9cL3xeLVwvXC9JRVRGXC9cL0RURCBIVE1MXC9cL3xeLVwvXC9NZXRyaXVzXC9cL0RURCBNZXRyaXVzIFByZXNlbnRhdGlvbmFsXC9cL3xeLVwvXC9NaWNyb3NvZnRcL1wvRFREIEludGVybmV0IEV4cGxvcmVyIDJcLjAgSFRNTCBTdHJpY3RcL1wvfF4tXC9cL01pY3Jvc29mdFwvXC9EVEQgSW50ZXJuZXQgRXhwbG9yZXIgMlwuMCBIVE1MXC9cL3xeLVwvXC9NaWNyb3NvZnRcL1wvRFREIEludGVybmV0IEV4cGxvcmVyIDJcLjAgVGFibGVzXC9cL3xeLVwvXC9NaWNyb3NvZnRcL1wvRFREIEludGVybmV0IEV4cGxvcmVyIDNcLjAgSFRNTCBTdHJpY3RcL1wvfF4tXC9cL01pY3Jvc29mdFwvXC9EVEQgSW50ZXJuZXQgRXhwbG9yZXIgM1wuMCBIVE1MXC9cL3xeLVwvXC9NaWNyb3NvZnRcL1wvRFREIEludGVybmV0IEV4cGxvcmVyIDNcLjAgVGFibGVzXC9cL3xeLVwvXC9OZXRzY2FwZSBDb21tXC4gQ29ycFwuXC9cL0RURCBIVE1MXC9cL3xeLVwvXC9OZXRzY2FwZSBDb21tXC4gQ29ycFwuXC9cL0RURCBTdHJpY3QgSFRNTFwvXC98Xi1cL1wvTydSZWlsbHkgYW5kIEFzc29jaWF0ZXNcL1wvRFREIEhUTUwgMlwuMFwvXC98Xi1cL1wvTydSZWlsbHkgYW5kIEFzc29jaWF0ZXNcL1wvRFREIEhUTUwgRXh0ZW5kZWQgMVwuMFwvXC98Xi1cL1wvTydSZWlsbHkgYW5kIEFzc29jaWF0ZXNcL1wvRFREIEhUTUwgRXh0ZW5kZWQgUmVsYXhlZCAxXC4wXC9cL3xeLVwvXC9Tb2Z0UXVhZCBTb2Z0d2FyZVwvXC9EVEQgSG9UTWV0YUwgUFJPIDZcLjA6OjE5OTkwNjAxOjpleHRlbnNpb25zIHRvIEhUTUwgNFwuMFwvXC98Xi1cL1wvU29mdFF1YWRcL1wvRFREIEhvVE1ldGFMIFBSTyA0XC4wOjoxOTk3MTAxMDo6ZXh0ZW5zaW9ucyB0byBIVE1MIDRcLjBcL1wvfF4tXC9cL1NweWdsYXNzXC9cL0RURCBIVE1MIDJcLjAgRXh0ZW5kZWRcL1wvfF4tXC9cL1NRXC9cL0RURCBIVE1MIDJcLjAgSG9UTWV0YUwgXCsgZXh0ZW5zaW9uc1wvXC98Xi1cL1wvU3VuIE1pY3Jvc3lzdGVtcyBDb3JwXC5cL1wvRFREIEhvdEphdmEgSFRNTFwvXC98Xi1cL1wvU3VuIE1pY3Jvc3lzdGVtcyBDb3JwXC5cL1wvRFREIEhvdEphdmEgU3RyaWN0IEhUTUxcL1wvfF4tXC9cL1czQ1wvXC9EVEQgSFRNTCAzIDE5OTUtMDMtMjRcL1wvfF4tXC9cL1czQ1wvXC9EVEQgSFRNTCAzXC4yIERyYWZ0XC9cL3xeLVwvXC9XM0NcL1wvRFREIEhUTUwgM1wuMiBGaW5hbFwvXC98Xi1cL1wvVzNDXC9cL0RURCBIVE1MIDNcLjJcL1wvfF4tXC9cL1czQ1wvXC9EVEQgSFRNTCAzXC4yUyBEcmFmdFwvXC98Xi1cL1wvVzNDXC9cL0RURCBIVE1MIDRcLjAgRnJhbWVzZXRcL1wvfF4tXC9cL1czQ1wvXC9EVEQgSFRNTCA0XC4wIFRyYW5zaXRpb25hbFwvXC98Xi1cL1wvVzNDXC9cL0RURCBIVE1MIEV4cGVyaW1lbnRhbCAxOTk2MDcxMlwvXC98Xi1cL1wvVzNDXC9cL0RURCBIVE1MIEV4cGVyaW1lbnRhbCA5NzA0MjFcL1wvfF4tXC9cL1czQ1wvXC9EVEQgVzMgSFRNTFwvXC98Xi1cL1wvVzNPXC9cL0RURCBXMyBIVE1MIDNcLjBcL1wvfF4tXC9cL1dlYlRlY2hzXC9cL0RURCBNb3ppbGxhIEhUTUwgMlwuMFwvXC98Xi1cL1wvV2ViVGVjaHNcL1wvRFREIE1vemlsbGEgSFRNTFwvXC8vaTsKCiAgICAgICAgICAgIHZhciBxdWlya3lTeXN0ZW1JZCA9ICJodHRwOi8vd3d3LmlibS5jb20vZGF0YS9kdGQvdjExL2libXhodG1sMS10cmFuc2l0aW9uYWwuZHRkIjsKCiAgICAgICAgICAgIHZhciBjb25kaXRpb25hbGx5UXVpcmt5UHVibGljSWRzID0gL14tXC9cL1czQ1wvXC9EVEQgSFRNTCA0XC4wMSBGcmFtZXNldFwvXC98Xi1cL1wvVzNDXC9cL0RURCBIVE1MIDRcLjAxIFRyYW5zaXRpb25hbFwvXC8vaTsKCiAgICAgICAgICAgIC8vIFRoZXNlIERURCBwdWJsaWMgaWRzIHB1dCB0aGUgYnJvd3NlciBpbiBsaW1pdGVkIHF1aXJrcyBtb2RlCiAgICAgICAgICAgIHZhciBsaW1pdGVkUXVpcmt5UHVibGljSWRzID0gL14tXC9cL1czQ1wvXC9EVEQgWEhUTUwgMVwuMCBGcmFtZXNldFwvXC98Xi1cL1wvVzNDXC9cL0RURCBYSFRNTCAxXC4wIFRyYW5zaXRpb25hbFwvXC8vaTsKCiAgICAgICAgICAgIC8vIEVsZW1lbnQgc2V0cyBiZWxvdy4gIFNlZSB0aGUgaXNBKCkgZnVuY3Rpb24gZm9yIGEgd2F5IHRvIHRlc3QKICAgICAgICAgICAgLy8gd2hldGhlciBhbiBlbGVtZW50IGlzIGEgbWVtYmVyIG9mIGEgc2V0CiAgICAgICAgICAgIHZhciBzcGVjaWFsU2V0ID0ge307CiAgICAgICAgICAgIHNwZWNpYWxTZXRbSFRNTF9OQU1FU1BBQ0VdID0gewogICAgICAgICAgICAgICAgImFkZHJlc3MiOiB0cnVlLCAiYXBwbGV0IjogdHJ1ZSwgImFyZWEiOiB0cnVlLCAiYXJ0aWNsZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiYXNpZGUiOiB0cnVlLCAiYmFzZSI6IHRydWUsICJiYXNlZm9udCI6IHRydWUsICJiZ3NvdW5kIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJibG9ja3F1b3RlIjogdHJ1ZSwgImJvZHkiOiB0cnVlLCAiYnIiOiB0cnVlLCAiYnV0dG9uIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJjYXB0aW9uIjogdHJ1ZSwgImNlbnRlciI6IHRydWUsICJjb2wiOiB0cnVlLCAiY29sZ3JvdXAiOiB0cnVlLAogICAgICAgICAgICAgICAgImNvbW1hbmQiOiB0cnVlLCAiZGQiOiB0cnVlLCAiZGV0YWlscyI6IHRydWUsICJkaXIiOiB0cnVlLAogICAgICAgICAgICAgICAgImRpdiI6IHRydWUsICJkbCI6IHRydWUsICJkdCI6IHRydWUsICJlbWJlZCI6IHRydWUsCiAgICAgICAgICAgICAgICAiZmllbGRzZXQiOiB0cnVlLCAiZmlnY2FwdGlvbiI6IHRydWUsICJmaWd1cmUiOiB0cnVlLCAiZm9vdGVyIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJmb3JtIjogdHJ1ZSwgImZyYW1lIjogdHJ1ZSwgImZyYW1lc2V0IjogdHJ1ZSwgImgxIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJoMiI6IHRydWUsICJoMyI6IHRydWUsICJoNCI6IHRydWUsICJoNSI6IHRydWUsCiAgICAgICAgICAgICAgICAiaDYiOiB0cnVlLCAiaGVhZCI6IHRydWUsICJoZWFkZXIiOiB0cnVlLCAiaGdyb3VwIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJociI6IHRydWUsICJodG1sIjogdHJ1ZSwgImlmcmFtZSI6IHRydWUsICJpbWciOiB0cnVlLAogICAgICAgICAgICAgICAgImlucHV0IjogdHJ1ZSwgImlzaW5kZXgiOiB0cnVlLCAibGkiOiB0cnVlLCAibGluayI6IHRydWUsCiAgICAgICAgICAgICAgICAibGlzdGluZyI6IHRydWUsICJtYXJxdWVlIjogdHJ1ZSwgIm1lbnUiOiB0cnVlLCAibWV0YSI6IHRydWUsCiAgICAgICAgICAgICAgICAibmF2IjogdHJ1ZSwgIm5vZW1iZWQiOiB0cnVlLCAibm9mcmFtZXMiOiB0cnVlLCAibm9zY3JpcHQiOiB0cnVlLAogICAgICAgICAgICAgICAgIm9iamVjdCI6IHRydWUsICJvbCI6IHRydWUsICJwIjogdHJ1ZSwgInBhcmFtIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJwbGFpbnRleHQiOiB0cnVlLCAicHJlIjogdHJ1ZSwgInNjcmlwdCI6IHRydWUsICJzZWN0aW9uIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJzZWxlY3QiOiB0cnVlLCAic3R5bGUiOiB0cnVlLCAic3VtbWFyeSI6IHRydWUsICJ0YWJsZSI6IHRydWUsCiAgICAgICAgICAgICAgICAidGJvZHkiOiB0cnVlLCAidGQiOiB0cnVlLCAidGV4dGFyZWEiOiB0cnVlLCAidGZvb3QiOiB0cnVlLAogICAgICAgICAgICAgICAgInRoIjogdHJ1ZSwgInRoZWFkIjogdHJ1ZSwgInRpdGxlIjogdHJ1ZSwgInRyIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJ1bCI6IHRydWUsICJ3YnIiOiB0cnVlLCAieG1wIjogdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgICBzcGVjaWFsU2V0W1NWR19OQU1FU1BBQ0VdID0gewogICAgICAgICAgICAgICAgImZvcmVpZ25PYmplY3QiOiB0cnVlLCAiZGVzYyI6IHRydWUsICJ0aXRsZSI6IHRydWUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgc3BlY2lhbFNldFtNQVRITUxfTkFNRVNQQUNFXSA9IHsKICAgICAgICAgICAgICAgICJtaSI6IHRydWUsICJtbyI6IHRydWUsICJtbiI6IHRydWUsICJtcyI6IHRydWUsCiAgICAgICAgICAgICAgICAibXRleHQiOiB0cnVlLCAiYW5ub3RhdGlvbi14bWwiOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIE9iamVjdC5mcmVlemUoc3BlY2lhbFNldCk7CgogICAgICAgICAgICAvLyBUaGUgc2V0IG9mIGFkZHJlc3MsIGRpdiwgYW5kIHAgSFRNTCB0YWdzCiAgICAgICAgICAgIHZhciBhZGRyZXNzZGl2cFNldCA9IHt9OwogICAgICAgICAgICBhZGRyZXNzZGl2cFNldFtIVE1MX05BTUVTUEFDRV0gPSB7CiAgICAgICAgICAgICAgICAiYWRkcmVzcyI6IHRydWUsICJkaXYiOiB0cnVlLCAicCI6IHRydWUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgT2JqZWN0LmZyZWV6ZShhZGRyZXNzZGl2cFNldCk7CgogICAgICAgICAgICB2YXIgZGRkdFNldCA9IHt9OwogICAgICAgICAgICBkZGR0U2V0W0hUTUxfTkFNRVNQQUNFXSA9IHsKICAgICAgICAgICAgICAgICJkZCI6IHRydWUsICJkdCI6IHRydWUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgT2JqZWN0LmZyZWV6ZShkZGR0U2V0KTsKCiAgICAgICAgICAgIHZhciB0YWJsZXNlY3Rpb25yb3dTZXQgPSB7fTsKICAgICAgICAgICAgdGFibGVzZWN0aW9ucm93U2V0W0hUTUxfTkFNRVNQQUNFXSA9IHsKICAgICAgICAgICAgICAgICJ0YWJsZSI6IHRydWUsICJ0aGVhZCI6IHRydWUsICJ0Ym9keSI6IHRydWUsICJ0Zm9vdCI6IHRydWUsICJ0ciI6IHRydWUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgT2JqZWN0LmZyZWV6ZSh0YWJsZXNlY3Rpb25yb3dTZXQpOwoKICAgICAgICAgICAgdmFyIGltcGxpZWRFbmRUYWdzU2V0ID0ge307CiAgICAgICAgICAgIGltcGxpZWRFbmRUYWdzU2V0W0hUTUxfTkFNRVNQQUNFXSA9IHsKICAgICAgICAgICAgICAgICJkZCI6IHRydWUsICJkdCI6IHRydWUsICJsaSI6IHRydWUsICJvcHRpb24iOiB0cnVlLAogICAgICAgICAgICAgICAgIm9wdGdyb3VwIjogdHJ1ZSwgInAiOiB0cnVlLCAicnAiOiB0cnVlLCAicnQiOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIE9iamVjdC5mcmVlemUoaW1wbGllZEVuZFRhZ3NTZXQpOwoKICAgICAgICAgICAgdmFyIGluU2NvcGVTZXQgPSB7fTsKICAgICAgICAgICAgaW5TY29wZVNldFtIVE1MX05BTUVTUEFDRV0gPSB7CiAgICAgICAgICAgICAgICAiYXBwbGV0IjogdHJ1ZSwgImNhcHRpb24iOiB0cnVlLCAiaHRtbCI6IHRydWUsICJ0YWJsZSI6IHRydWUsCiAgICAgICAgICAgICAgICAidGQiOiB0cnVlLCAidGgiOiB0cnVlLCAibWFycXVlZSI6IHRydWUsICJvYmplY3QiOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGluU2NvcGVTZXRbTUFUSE1MX05BTUVTUEFDRV0gPSB7CiAgICAgICAgICAgICAgICAibWkiOiB0cnVlLCAibW8iOiB0cnVlLCAibW4iOiB0cnVlLCAibXMiOiB0cnVlLAogICAgICAgICAgICAgICAgIm10ZXh0IjogdHJ1ZSwgImFubm90YXRpb24teG1sIjogdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgICBpblNjb3BlU2V0W1NWR19OQU1FU1BBQ0VdID0gewogICAgICAgICAgICAgICAgImZvcmVpZ25PYmplY3QiOiB0cnVlLCAiZGVzYyI6IHRydWUsICJ0aXRsZSI6IHRydWUKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBpbkxpc3RJdGVtU2NvcGVTZXQgPSBPYmplY3QuY3JlYXRlKGluU2NvcGVTZXQpOwogICAgICAgICAgICBpbkxpc3RJdGVtU2NvcGVTZXRbSFRNTF9OQU1FU1BBQ0VdID0gT2JqZWN0LmNyZWF0ZShpblNjb3BlU2V0W0hUTUxfTkFNRVNQQUNFXSk7CiAgICAgICAgICAgIGluTGlzdEl0ZW1TY29wZVNldFtIVE1MX05BTUVTUEFDRV0ub2wgPSB0cnVlOwogICAgICAgICAgICBpbkxpc3RJdGVtU2NvcGVTZXRbSFRNTF9OQU1FU1BBQ0VdLnVsID0gdHJ1ZTsKCiAgICAgICAgICAgIHZhciBpbkJ1dHRvblNjb3BlU2V0ID0gT2JqZWN0LmNyZWF0ZShpblNjb3BlU2V0KTsKICAgICAgICAgICAgaW5CdXR0b25TY29wZVNldFtIVE1MX05BTUVTUEFDRV0gPSBPYmplY3QuY3JlYXRlKGluU2NvcGVTZXRbSFRNTF9OQU1FU1BBQ0VdKTsKICAgICAgICAgICAgaW5CdXR0b25TY29wZVNldFtIVE1MX05BTUVTUEFDRV0uYnV0dG9uID0gdHJ1ZTsKCiAgICAgICAgICAgIE9iamVjdC5mcmVlemUoaW5TY29wZVNldCk7CiAgICAgICAgICAgIE9iamVjdC5mcmVlemUoaW5MaXN0SXRlbVNjb3BlU2V0KTsKICAgICAgICAgICAgT2JqZWN0LmZyZWV6ZShpbkJ1dHRvblNjb3BlU2V0KTsKCiAgICAgICAgICAgIHZhciBpblRhYmxlU2NvcGVTZXQgPSB7fTsKICAgICAgICAgICAgaW5UYWJsZVNjb3BlU2V0W0hUTUxfTkFNRVNQQUNFXSA9IHsKICAgICAgICAgICAgICAgICJodG1sIjogdHJ1ZSwgInRhYmxlIjogdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgICBPYmplY3QuZnJlZXplKGluVGFibGVTY29wZVNldCk7CgogICAgICAgICAgICAvLyBUaGUgc2V0IG9mIGVsZW1lbnRzIGZvciBzZWxlY3Qgc2NvcGUgaXMgdGhlIGV2ZXJ5dGhpbmcgKmV4Y2VwdCogdGhlc2UKICAgICAgICAgICAgdmFyIGludmVydGVkU2VsZWN0U2NvcGVTZXQgPSB7fTsKICAgICAgICAgICAgaW52ZXJ0ZWRTZWxlY3RTY29wZVNldFtIVE1MX05BTUVTUEFDRV0gPSB7CiAgICAgICAgICAgICAgICAib3B0Z3JvdXAiOiB0cnVlLCAib3B0aW9uIjogdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgICBPYmplY3QuZnJlZXplKGludmVydGVkU2VsZWN0U2NvcGVTZXQpOwoKICAgICAgICAgICAgdmFyIG1hdGhtbFRleHRJbnRlZ3JhdGlvblBvaW50U2V0ID0ge307CiAgICAgICAgICAgIG1hdGhtbFRleHRJbnRlZ3JhdGlvblBvaW50U2V0W01BVEhNTF9OQU1FU1BBQ0VdID0gewogICAgICAgICAgICAgICAgbWk6IHRydWUsCiAgICAgICAgICAgICAgICBtbzogdHJ1ZSwKICAgICAgICAgICAgICAgIG1uOiB0cnVlLAogICAgICAgICAgICAgICAgbXM6IHRydWUsCiAgICAgICAgICAgICAgICBtdGV4dDogdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgICBPYmplY3QuZnJlZXplKG1hdGhtbFRleHRJbnRlZ3JhdGlvblBvaW50U2V0KTsKCiAgICAgICAgICAgIHZhciBodG1sSW50ZWdyYXRpb25Qb2ludFNldCA9IHt9OwogICAgICAgICAgICBodG1sSW50ZWdyYXRpb25Qb2ludFNldFtTVkdfTkFNRVNQQUNFXSA9IHsKICAgICAgICAgICAgICAgIGZvcmVpZ25PYmplY3Q6IHRydWUsCiAgICAgICAgICAgICAgICBkZXNjOiB0cnVlLAogICAgICAgICAgICAgICAgdGl0bGU6IHRydWUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgT2JqZWN0LmZyZWV6ZShodG1sSW50ZWdyYXRpb25Qb2ludFNldCk7CgogICAgICAgICAgICB2YXIgZm9yZWlnbkF0dHJpYnV0ZXMgPSBPYmplY3QuZnJlZXplKHsKICAgICAgICAgICAgICAgICJ4bGluazphY3R1YXRlIjogWExJTktfTkFNRVNQQUNFLCAieGxpbms6YXJjcm9sZSI6IFhMSU5LX05BTUVTUEFDRSwKICAgICAgICAgICAgICAgICJ4bGluazpocmVmIjogWExJTktfTkFNRVNQQUNFLCAieGxpbms6cm9sZSI6IFhMSU5LX05BTUVTUEFDRSwKICAgICAgICAgICAgICAgICJ4bGluazpzaG93IjogWExJTktfTkFNRVNQQUNFLCAieGxpbms6dGl0bGUiOiBYTElOS19OQU1FU1BBQ0UsCiAgICAgICAgICAgICAgICAieGxpbms6dHlwZSI6IFhMSU5LX05BTUVTUEFDRSwgInhtbDpiYXNlIjogWE1MX05BTUVTUEFDRSwKICAgICAgICAgICAgICAgICJ4bWw6bGFuZyI6IFhNTF9OQU1FU1BBQ0UsICJ4bWw6c3BhY2UiOiBYTUxfTkFNRVNQQUNFLAogICAgICAgICAgICAgICAgInhtbG5zIjogWE1MTlNfTkFNRVNQQUNFLCAieG1sbnM6eGxpbmsiOiBYTUxOU19OQU1FU1BBQ0UKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBMb3dlcmNhc2UgdG8gbWl4ZWQgY2FzZSBtYXBwaW5nIGZvciBTVkcgYXR0cmlidXRlcyBhbmQgdGFnbmFtZXMKICAgICAgICAgICAgdmFyIHN2Z0F0dHJBZGp1c3RtZW50cyA9IE9iamVjdC5mcmVlemUoewogICAgICAgICAgICAgICAgYXR0cmlidXRlbmFtZTogImF0dHJpYnV0ZU5hbWUiLCBhdHRyaWJ1dGV0eXBlOiAiYXR0cmlidXRlVHlwZSIsCiAgICAgICAgICAgICAgICBiYXNlZnJlcXVlbmN5OiAiYmFzZUZyZXF1ZW5jeSIsIGJhc2Vwcm9maWxlOiAiYmFzZVByb2ZpbGUiLAogICAgICAgICAgICAgICAgY2FsY21vZGU6ICJjYWxjTW9kZSIsIGNsaXBwYXRodW5pdHM6ICJjbGlwUGF0aFVuaXRzIiwKICAgICAgICAgICAgICAgIGNvbnRlbnRzY3JpcHR0eXBlOiAiY29udGVudFNjcmlwdFR5cGUiLAogICAgICAgICAgICAgICAgY29udGVudHN0eWxldHlwZTogImNvbnRlbnRTdHlsZVR5cGUiLAogICAgICAgICAgICAgICAgZGlmZnVzZWNvbnN0YW50OiAiZGlmZnVzZUNvbnN0YW50IiwKICAgICAgICAgICAgICAgIGVkZ2Vtb2RlOiAiZWRnZU1vZGUiLAogICAgICAgICAgICAgICAgZXh0ZXJuYWxyZXNvdXJjZXNyZXF1aXJlZDogImV4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQiLAogICAgICAgICAgICAgICAgZmlsdGVycmVzOiAiZmlsdGVyUmVzIiwgZmlsdGVydW5pdHM6ICJmaWx0ZXJVbml0cyIsCiAgICAgICAgICAgICAgICBnbHlwaHJlZjogImdseXBoUmVmIiwgZ3JhZGllbnR0cmFuc2Zvcm06ICJncmFkaWVudFRyYW5zZm9ybSIsCiAgICAgICAgICAgICAgICBncmFkaWVudHVuaXRzOiAiZ3JhZGllbnRVbml0cyIsIGtlcm5lbG1hdHJpeDogImtlcm5lbE1hdHJpeCIsCiAgICAgICAgICAgICAgICBrZXJuZWx1bml0bGVuZ3RoOiAia2VybmVsVW5pdExlbmd0aCIsIGtleXBvaW50czogImtleVBvaW50cyIsCiAgICAgICAgICAgICAgICBrZXlzcGxpbmVzOiAia2V5U3BsaW5lcyIsIGtleXRpbWVzOiAia2V5VGltZXMiLAogICAgICAgICAgICAgICAgbGVuZ3RoYWRqdXN0OiAibGVuZ3RoQWRqdXN0IiwgbGltaXRpbmdjb25lYW5nbGU6ICJsaW1pdGluZ0NvbmVBbmdsZSIsCiAgICAgICAgICAgICAgICBtYXJrZXJoZWlnaHQ6ICJtYXJrZXJIZWlnaHQiLCBtYXJrZXJ1bml0czogIm1hcmtlclVuaXRzIiwKICAgICAgICAgICAgICAgIG1hcmtlcndpZHRoOiAibWFya2VyV2lkdGgiLCBtYXNrY29udGVudHVuaXRzOiAibWFza0NvbnRlbnRVbml0cyIsCiAgICAgICAgICAgICAgICBtYXNrdW5pdHM6ICJtYXNrVW5pdHMiLCBudW1vY3RhdmVzOiAibnVtT2N0YXZlcyIsCiAgICAgICAgICAgICAgICBwYXRobGVuZ3RoOiAicGF0aExlbmd0aCIsIHBhdHRlcm5jb250ZW50dW5pdHM6ICJwYXR0ZXJuQ29udGVudFVuaXRzIiwKICAgICAgICAgICAgICAgIHBhdHRlcm50cmFuc2Zvcm06ICJwYXR0ZXJuVHJhbnNmb3JtIiwgcGF0dGVybnVuaXRzOiAicGF0dGVyblVuaXRzIiwKICAgICAgICAgICAgICAgIHBvaW50c2F0eDogInBvaW50c0F0WCIsIHBvaW50c2F0eTogInBvaW50c0F0WSIsCiAgICAgICAgICAgICAgICBwb2ludHNhdHo6ICJwb2ludHNBdFoiLCBwcmVzZXJ2ZWFscGhhOiAicHJlc2VydmVBbHBoYSIsCiAgICAgICAgICAgICAgICBwcmVzZXJ2ZWFzcGVjdHJhdGlvOiAicHJlc2VydmVBc3BlY3RSYXRpbyIsCiAgICAgICAgICAgICAgICBwcmltaXRpdmV1bml0czogInByaW1pdGl2ZVVuaXRzIiwgcmVmeDogInJlZlgiLAogICAgICAgICAgICAgICAgcmVmeTogInJlZlkiLCByZXBlYXRjb3VudDogInJlcGVhdENvdW50IiwKICAgICAgICAgICAgICAgIHJlcGVhdGR1cjogInJlcGVhdER1ciIsIHJlcXVpcmVkZXh0ZW5zaW9uczogInJlcXVpcmVkRXh0ZW5zaW9ucyIsCiAgICAgICAgICAgICAgICByZXF1aXJlZGZlYXR1cmVzOiAicmVxdWlyZWRGZWF0dXJlcyIsCiAgICAgICAgICAgICAgICBzcGVjdWxhcmNvbnN0YW50OiAic3BlY3VsYXJDb25zdGFudCIsCiAgICAgICAgICAgICAgICBzcGVjdWxhcmV4cG9uZW50OiAic3BlY3VsYXJFeHBvbmVudCIsIHNwcmVhZG1ldGhvZDogInNwcmVhZE1ldGhvZCIsCiAgICAgICAgICAgICAgICBzdGFydG9mZnNldDogInN0YXJ0T2Zmc2V0Iiwgc3RkZGV2aWF0aW9uOiAic3RkRGV2aWF0aW9uIiwKICAgICAgICAgICAgICAgIHN0aXRjaHRpbGVzOiAic3RpdGNoVGlsZXMiLCBzdXJmYWNlc2NhbGU6ICJzdXJmYWNlU2NhbGUiLAogICAgICAgICAgICAgICAgc3lzdGVtbGFuZ3VhZ2U6ICJzeXN0ZW1MYW5ndWFnZSIsIHRhYmxldmFsdWVzOiAidGFibGVWYWx1ZXMiLAogICAgICAgICAgICAgICAgdGFyZ2V0eDogInRhcmdldFgiLCB0YXJnZXR5OiAidGFyZ2V0WSIsCiAgICAgICAgICAgICAgICB0ZXh0bGVuZ3RoOiAidGV4dExlbmd0aCIsIHZpZXdib3g6ICJ2aWV3Qm94IiwKICAgICAgICAgICAgICAgIHZpZXd0YXJnZXQ6ICJ2aWV3VGFyZ2V0IiwgeGNoYW5uZWxzZWxlY3RvcjogInhDaGFubmVsU2VsZWN0b3IiLAogICAgICAgICAgICAgICAgeWNoYW5uZWxzZWxlY3RvcjogInlDaGFubmVsU2VsZWN0b3IiLCB6b29tYW5kcGFuOiAiem9vbUFuZFBhbiIKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgc3ZnVGFnTmFtZUFkanVzdG1lbnRzID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgICAgICAgICBhbHRnbHlwaDogImFsdEdseXBoIiwgYWx0Z2x5cGhkZWY6ICJhbHRHbHlwaERlZiIsCiAgICAgICAgICAgICAgICBhbHRnbHlwaGl0ZW06ICJhbHRHbHlwaEl0ZW0iLCBhbmltYXRlY29sb3I6ICJhbmltYXRlQ29sb3IiLAogICAgICAgICAgICAgICAgYW5pbWF0ZW1vdGlvbjogImFuaW1hdGVNb3Rpb24iLCBhbmltYXRldHJhbnNmb3JtOiAiYW5pbWF0ZVRyYW5zZm9ybSIsCiAgICAgICAgICAgICAgICBjbGlwcGF0aDogImNsaXBQYXRoIiwgZmVibGVuZDogImZlQmxlbmQiLAogICAgICAgICAgICAgICAgZmVjb2xvcm1hdHJpeDogImZlQ29sb3JNYXRyaXgiLAogICAgICAgICAgICAgICAgZmVjb21wb25lbnR0cmFuc2ZlcjogImZlQ29tcG9uZW50VHJhbnNmZXIiLCBmZWNvbXBvc2l0ZTogImZlQ29tcG9zaXRlIiwKICAgICAgICAgICAgICAgIGZlY29udm9sdmVtYXRyaXg6ICJmZUNvbnZvbHZlTWF0cml4IiwKICAgICAgICAgICAgICAgIGZlZGlmZnVzZWxpZ2h0aW5nOiAiZmVEaWZmdXNlTGlnaHRpbmciLAogICAgICAgICAgICAgICAgZmVkaXNwbGFjZW1lbnRtYXA6ICJmZURpc3BsYWNlbWVudE1hcCIsCiAgICAgICAgICAgICAgICBmZWRpc3RhbnRsaWdodDogImZlRGlzdGFudExpZ2h0IiwgZmVmbG9vZDogImZlRmxvb2QiLAogICAgICAgICAgICAgICAgZmVmdW5jYTogImZlRnVuY0EiLCBmZWZ1bmNiOiAiZmVGdW5jQiIsCiAgICAgICAgICAgICAgICBmZWZ1bmNnOiAiZmVGdW5jRyIsIGZlZnVuY3I6ICJmZUZ1bmNSIiwKICAgICAgICAgICAgICAgIGZlZ2F1c3NpYW5ibHVyOiAiZmVHYXVzc2lhbkJsdXIiLCBmZWltYWdlOiAiZmVJbWFnZSIsCiAgICAgICAgICAgICAgICBmZW1lcmdlOiAiZmVNZXJnZSIsIGZlbWVyZ2Vub2RlOiAiZmVNZXJnZU5vZGUiLAogICAgICAgICAgICAgICAgZmVtb3JwaG9sb2d5OiAiZmVNb3JwaG9sb2d5IiwgZmVvZmZzZXQ6ICJmZU9mZnNldCIsCiAgICAgICAgICAgICAgICBmZXBvaW50bGlnaHQ6ICJmZVBvaW50TGlnaHQiLCBmZXNwZWN1bGFybGlnaHRpbmc6ICJmZVNwZWN1bGFyTGlnaHRpbmciLAogICAgICAgICAgICAgICAgZmVzcG90bGlnaHQ6ICJmZVNwb3RMaWdodCIsIGZldGlsZTogImZlVGlsZSIsCiAgICAgICAgICAgICAgICBmZXR1cmJ1bGVuY2U6ICJmZVR1cmJ1bGVuY2UiLCBmb3JlaWdub2JqZWN0OiAiZm9yZWlnbk9iamVjdCIsCiAgICAgICAgICAgICAgICBnbHlwaHJlZjogImdseXBoUmVmIiwgbGluZWFyZ3JhZGllbnQ6ICJsaW5lYXJHcmFkaWVudCIsCiAgICAgICAgICAgICAgICByYWRpYWxncmFkaWVudDogInJhZGlhbEdyYWRpZW50IiwgdGV4dHBhdGg6ICJ0ZXh0UGF0aCIKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBEYXRhIGZvciBwYXJzaW5nIG51bWVyaWMgYW5kIG5hbWVkIGNoYXJhY3RlciByZWZlcmVuY2VzCiAgICAgICAgICAgIC8vIFRoZXNlIG5leHQgMyBvYmplY3RzIGFyZSBkaXJlY3QgdHJhbnNsYXRpb25zIG9mIHRhYmxlcwogICAgICAgICAgICAvLyBpbiB0aGUgSFRNTCBzcGVjIGludG8gSmF2YVNjcmlwdCBvYmplY3QgZm9ybWF0CiAgICAgICAgICAgIHZhciBudW1lcmljQ2hhclJlZlJlcGxhY2VtZW50cyA9IE9iamVjdC5mcmVlemUoewogICAgICAgICAgICAgICAgMHgwMDogMHhGRkZELCAweDgwOiAweDIwQUMsIDB4ODI6IDB4MjAxQSwgMHg4MzogMHgwMTkyLCAweDg0OiAweDIwMUUsCiAgICAgICAgICAgICAgICAweDg1OiAweDIwMjYsIDB4ODY6IDB4MjAyMCwgMHg4NzogMHgyMDIxLCAweDg4OiAweDAyQzYsIDB4ODk6IDB4MjAzMCwKICAgICAgICAgICAgICAgIDB4OEE6IDB4MDE2MCwgMHg4QjogMHgyMDM5LCAweDhDOiAweDAxNTIsIDB4OEU6IDB4MDE3RCwgMHg5MTogMHgyMDE4LAogICAgICAgICAgICAgICAgMHg5MjogMHgyMDE5LCAweDkzOiAweDIwMUMsIDB4OTQ6IDB4MjAxRCwgMHg5NTogMHgyMDIyLCAweDk2OiAweDIwMTMsCiAgICAgICAgICAgICAgICAweDk3OiAweDIwMTQsIDB4OTg6IDB4MDJEQywgMHg5OTogMHgyMTIyLCAweDlBOiAweDAxNjEsIDB4OUI6IDB4MjAzQSwKICAgICAgICAgICAgICAgIDB4OUM6IDB4MDE1MywgMHg5RTogMHgwMTdFLCAweDlGOiAweDAxNzgKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBUaGVzZSBuYW1lZCBjaGFyYWN0ZXIgcmVmZXJlbmNlcyB3b3JrIGV2ZW4gd2l0aG91dCB0aGUgc2VtaWNvbG9uCiAgICAgICAgICAgIHZhciBuYW1lZENoYXJSZWZzTm9TZW1pID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgICAgICAgICAiQUVsaWciOiAweEM2LCAiQU1QIjogMHgyNiwgIkFhY3V0ZSI6IDB4QzEsICJBY2lyYyI6IDB4QzIsCiAgICAgICAgICAgICAgICAiQWdyYXZlIjogMHhDMCwgIkFyaW5nIjogMHhDNSwgIkF0aWxkZSI6IDB4QzMsICJBdW1sIjogMHhDNCwKICAgICAgICAgICAgICAgICJDT1BZIjogMHhBOSwgIkNjZWRpbCI6IDB4QzcsICJFVEgiOiAweEQwLCAiRWFjdXRlIjogMHhDOSwKICAgICAgICAgICAgICAgICJFY2lyYyI6IDB4Q0EsICJFZ3JhdmUiOiAweEM4LCAiRXVtbCI6IDB4Q0IsICJHVCI6IDB4M0UsCiAgICAgICAgICAgICAgICAiSWFjdXRlIjogMHhDRCwgIkljaXJjIjogMHhDRSwgIklncmF2ZSI6IDB4Q0MsICJJdW1sIjogMHhDRiwKICAgICAgICAgICAgICAgICJMVCI6IDB4M0MsICJOdGlsZGUiOiAweEQxLCAiT2FjdXRlIjogMHhEMywgIk9jaXJjIjogMHhENCwKICAgICAgICAgICAgICAgICJPZ3JhdmUiOiAweEQyLCAiT3NsYXNoIjogMHhEOCwgIk90aWxkZSI6IDB4RDUsICJPdW1sIjogMHhENiwKICAgICAgICAgICAgICAgICJRVU9UIjogMHgyMiwgIlJFRyI6IDB4QUUsICJUSE9STiI6IDB4REUsICJVYWN1dGUiOiAweERBLAogICAgICAgICAgICAgICAgIlVjaXJjIjogMHhEQiwgIlVncmF2ZSI6IDB4RDksICJVdW1sIjogMHhEQywgIllhY3V0ZSI6IDB4REQsCiAgICAgICAgICAgICAgICAiYWFjdXRlIjogMHhFMSwgImFjaXJjIjogMHhFMiwgImFjdXRlIjogMHhCNCwgImFlbGlnIjogMHhFNiwKICAgICAgICAgICAgICAgICJhZ3JhdmUiOiAweEUwLCAiYW1wIjogMHgyNiwgImFyaW5nIjogMHhFNSwgImF0aWxkZSI6IDB4RTMsCiAgICAgICAgICAgICAgICAiYXVtbCI6IDB4RTQsICJicnZiYXIiOiAweEE2LCAiY2NlZGlsIjogMHhFNywgImNlZGlsIjogMHhCOCwKICAgICAgICAgICAgICAgICJjZW50IjogMHhBMiwgImNvcHkiOiAweEE5LCAiY3VycmVuIjogMHhBNCwgImRlZyI6IDB4QjAsCiAgICAgICAgICAgICAgICAiZGl2aWRlIjogMHhGNywgImVhY3V0ZSI6IDB4RTksICJlY2lyYyI6IDB4RUEsICJlZ3JhdmUiOiAweEU4LAogICAgICAgICAgICAgICAgImV0aCI6IDB4RjAsICJldW1sIjogMHhFQiwgImZyYWMxMiI6IDB4QkQsICJmcmFjMTQiOiAweEJDLAogICAgICAgICAgICAgICAgImZyYWMzNCI6IDB4QkUsICJndCI6IDB4M0UsICJpYWN1dGUiOiAweEVELCAiaWNpcmMiOiAweEVFLAogICAgICAgICAgICAgICAgImlleGNsIjogMHhBMSwgImlncmF2ZSI6IDB4RUMsICJpcXVlc3QiOiAweEJGLCAiaXVtbCI6IDB4RUYsCiAgICAgICAgICAgICAgICAibGFxdW8iOiAweEFCLCAibHQiOiAweDNDLCAibWFjciI6IDB4QUYsICJtaWNybyI6IDB4QjUsCiAgICAgICAgICAgICAgICAibWlkZG90IjogMHhCNywgIm5ic3AiOiAweEEwLCAibm90IjogMHhBQywgIm50aWxkZSI6IDB4RjEsCiAgICAgICAgICAgICAgICAib2FjdXRlIjogMHhGMywgIm9jaXJjIjogMHhGNCwgIm9ncmF2ZSI6IDB4RjIsICJvcmRmIjogMHhBQSwKICAgICAgICAgICAgICAgICJvcmRtIjogMHhCQSwgIm9zbGFzaCI6IDB4RjgsICJvdGlsZGUiOiAweEY1LCAib3VtbCI6IDB4RjYsCiAgICAgICAgICAgICAgICAicGFyYSI6IDB4QjYsICJwbHVzbW4iOiAweEIxLCAicG91bmQiOiAweEEzLCAicXVvdCI6IDB4MjIsCiAgICAgICAgICAgICAgICAicmFxdW8iOiAweEJCLCAicmVnIjogMHhBRSwgInNlY3QiOiAweEE3LCAic2h5IjogMHhBRCwKICAgICAgICAgICAgICAgICJzdXAxIjogMHhCOSwgInN1cDIiOiAweEIyLCAic3VwMyI6IDB4QjMsICJzemxpZyI6IDB4REYsCiAgICAgICAgICAgICAgICAidGhvcm4iOiAweEZFLCAidGltZXMiOiAweEQ3LCAidWFjdXRlIjogMHhGQSwgInVjaXJjIjogMHhGQiwKICAgICAgICAgICAgICAgICJ1Z3JhdmUiOiAweEY5LCAidW1sIjogMHhBOCwgInV1bWwiOiAweEZDLCAieWFjdXRlIjogMHhGRCwKICAgICAgICAgICAgICAgICJ5ZW4iOiAweEE1LCAieXVtbCI6IDB4RkYKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgbmFtZWRDaGFyUmVmcyA9IE9iamVjdC5mcmVlemUoewogICAgICAgICAgICAgICAgIkFFbGlnOyI6IDB4YzYsICJBTVA7IjogMHgyNiwKICAgICAgICAgICAgICAgICJBYWN1dGU7IjogMHhjMSwgIkFicmV2ZTsiOiAweDEwMiwKICAgICAgICAgICAgICAgICJBY2lyYzsiOiAweGMyLCAiQWN5OyI6IDB4NDEwLAogICAgICAgICAgICAgICAgIkFmcjsiOiBbMHhkODM1LCAweGRkMDRdLCAiQWdyYXZlOyI6IDB4YzAsCiAgICAgICAgICAgICAgICAiQWxwaGE7IjogMHgzOTEsICJBbWFjcjsiOiAweDEwMCwKICAgICAgICAgICAgICAgICJBbmQ7IjogMHgyYTUzLCAiQW9nb247IjogMHgxMDQsCiAgICAgICAgICAgICAgICAiQW9wZjsiOiBbMHhkODM1LCAweGRkMzhdLCAiQXBwbHlGdW5jdGlvbjsiOiAweDIwNjEsCiAgICAgICAgICAgICAgICAiQXJpbmc7IjogMHhjNSwgIkFzY3I7IjogWzB4ZDgzNSwgMHhkYzljXSwKICAgICAgICAgICAgICAgICJBc3NpZ247IjogMHgyMjU0LCAiQXRpbGRlOyI6IDB4YzMsCiAgICAgICAgICAgICAgICAiQXVtbDsiOiAweGM0LCAiQmFja3NsYXNoOyI6IDB4MjIxNiwKICAgICAgICAgICAgICAgICJCYXJ2OyI6IDB4MmFlNywgIkJhcndlZDsiOiAweDIzMDYsCiAgICAgICAgICAgICAgICAiQmN5OyI6IDB4NDExLCAiQmVjYXVzZTsiOiAweDIyMzUsCiAgICAgICAgICAgICAgICAiQmVybm91bGxpczsiOiAweDIxMmMsICJCZXRhOyI6IDB4MzkyLAogICAgICAgICAgICAgICAgIkJmcjsiOiBbMHhkODM1LCAweGRkMDVdLCAiQm9wZjsiOiBbMHhkODM1LCAweGRkMzldLAogICAgICAgICAgICAgICAgIkJyZXZlOyI6IDB4MmQ4LCAiQnNjcjsiOiAweDIxMmMsCiAgICAgICAgICAgICAgICAiQnVtcGVxOyI6IDB4MjI0ZSwgIkNIY3k7IjogMHg0MjcsCiAgICAgICAgICAgICAgICAiQ09QWTsiOiAweGE5LCAiQ2FjdXRlOyI6IDB4MTA2LAogICAgICAgICAgICAgICAgIkNhcDsiOiAweDIyZDIsICJDYXBpdGFsRGlmZmVyZW50aWFsRDsiOiAweDIxNDUsCiAgICAgICAgICAgICAgICAiQ2F5bGV5czsiOiAweDIxMmQsICJDY2Fyb247IjogMHgxMGMsCiAgICAgICAgICAgICAgICAiQ2NlZGlsOyI6IDB4YzcsICJDY2lyYzsiOiAweDEwOCwKICAgICAgICAgICAgICAgICJDY29uaW50OyI6IDB4MjIzMCwgIkNkb3Q7IjogMHgxMGEsCiAgICAgICAgICAgICAgICAiQ2VkaWxsYTsiOiAweGI4LCAiQ2VudGVyRG90OyI6IDB4YjcsCiAgICAgICAgICAgICAgICAiQ2ZyOyI6IDB4MjEyZCwgIkNoaTsiOiAweDNhNywKICAgICAgICAgICAgICAgICJDaXJjbGVEb3Q7IjogMHgyMjk5LCAiQ2lyY2xlTWludXM7IjogMHgyMjk2LAogICAgICAgICAgICAgICAgIkNpcmNsZVBsdXM7IjogMHgyMjk1LCAiQ2lyY2xlVGltZXM7IjogMHgyMjk3LAogICAgICAgICAgICAgICAgIkNsb2Nrd2lzZUNvbnRvdXJJbnRlZ3JhbDsiOiAweDIyMzIsICJDbG9zZUN1cmx5RG91YmxlUXVvdGU7IjogMHgyMDFkLAogICAgICAgICAgICAgICAgIkNsb3NlQ3VybHlRdW90ZTsiOiAweDIwMTksICJDb2xvbjsiOiAweDIyMzcsCiAgICAgICAgICAgICAgICAiQ29sb25lOyI6IDB4MmE3NCwgIkNvbmdydWVudDsiOiAweDIyNjEsCiAgICAgICAgICAgICAgICAiQ29uaW50OyI6IDB4MjIyZiwgIkNvbnRvdXJJbnRlZ3JhbDsiOiAweDIyMmUsCiAgICAgICAgICAgICAgICAiQ29wZjsiOiAweDIxMDIsICJDb3Byb2R1Y3Q7IjogMHgyMjEwLAogICAgICAgICAgICAgICAgIkNvdW50ZXJDbG9ja3dpc2VDb250b3VySW50ZWdyYWw7IjogMHgyMjMzLCAiQ3Jvc3M7IjogMHgyYTJmLAogICAgICAgICAgICAgICAgIkNzY3I7IjogWzB4ZDgzNSwgMHhkYzllXSwgIkN1cDsiOiAweDIyZDMsCiAgICAgICAgICAgICAgICAiQ3VwQ2FwOyI6IDB4MjI0ZCwgIkREOyI6IDB4MjE0NSwKICAgICAgICAgICAgICAgICJERG90cmFoZDsiOiAweDI5MTEsICJESmN5OyI6IDB4NDAyLAogICAgICAgICAgICAgICAgIkRTY3k7IjogMHg0MDUsICJEWmN5OyI6IDB4NDBmLAogICAgICAgICAgICAgICAgIkRhZ2dlcjsiOiAweDIwMjEsICJEYXJyOyI6IDB4MjFhMSwKICAgICAgICAgICAgICAgICJEYXNodjsiOiAweDJhZTQsICJEY2Fyb247IjogMHgxMGUsCiAgICAgICAgICAgICAgICAiRGN5OyI6IDB4NDE0LCAiRGVsOyI6IDB4MjIwNywKICAgICAgICAgICAgICAgICJEZWx0YTsiOiAweDM5NCwgIkRmcjsiOiBbMHhkODM1LCAweGRkMDddLAogICAgICAgICAgICAgICAgIkRpYWNyaXRpY2FsQWN1dGU7IjogMHhiNCwgIkRpYWNyaXRpY2FsRG90OyI6IDB4MmQ5LAogICAgICAgICAgICAgICAgIkRpYWNyaXRpY2FsRG91YmxlQWN1dGU7IjogMHgyZGQsICJEaWFjcml0aWNhbEdyYXZlOyI6IDB4NjAsCiAgICAgICAgICAgICAgICAiRGlhY3JpdGljYWxUaWxkZTsiOiAweDJkYywgIkRpYW1vbmQ7IjogMHgyMmM0LAogICAgICAgICAgICAgICAgIkRpZmZlcmVudGlhbEQ7IjogMHgyMTQ2LCAiRG9wZjsiOiBbMHhkODM1LCAweGRkM2JdLAogICAgICAgICAgICAgICAgIkRvdDsiOiAweGE4LCAiRG90RG90OyI6IDB4MjBkYywKICAgICAgICAgICAgICAgICJEb3RFcXVhbDsiOiAweDIyNTAsICJEb3VibGVDb250b3VySW50ZWdyYWw7IjogMHgyMjJmLAogICAgICAgICAgICAgICAgIkRvdWJsZURvdDsiOiAweGE4LCAiRG91YmxlRG93bkFycm93OyI6IDB4MjFkMywKICAgICAgICAgICAgICAgICJEb3VibGVMZWZ0QXJyb3c7IjogMHgyMWQwLCAiRG91YmxlTGVmdFJpZ2h0QXJyb3c7IjogMHgyMWQ0LAogICAgICAgICAgICAgICAgIkRvdWJsZUxlZnRUZWU7IjogMHgyYWU0LCAiRG91YmxlTG9uZ0xlZnRBcnJvdzsiOiAweDI3ZjgsCiAgICAgICAgICAgICAgICAiRG91YmxlTG9uZ0xlZnRSaWdodEFycm93OyI6IDB4MjdmYSwgIkRvdWJsZUxvbmdSaWdodEFycm93OyI6IDB4MjdmOSwKICAgICAgICAgICAgICAgICJEb3VibGVSaWdodEFycm93OyI6IDB4MjFkMiwgIkRvdWJsZVJpZ2h0VGVlOyI6IDB4MjJhOCwKICAgICAgICAgICAgICAgICJEb3VibGVVcEFycm93OyI6IDB4MjFkMSwgIkRvdWJsZVVwRG93bkFycm93OyI6IDB4MjFkNSwKICAgICAgICAgICAgICAgICJEb3VibGVWZXJ0aWNhbEJhcjsiOiAweDIyMjUsICJEb3duQXJyb3c7IjogMHgyMTkzLAogICAgICAgICAgICAgICAgIkRvd25BcnJvd0JhcjsiOiAweDI5MTMsICJEb3duQXJyb3dVcEFycm93OyI6IDB4MjFmNSwKICAgICAgICAgICAgICAgICJEb3duQnJldmU7IjogMHgzMTEsICJEb3duTGVmdFJpZ2h0VmVjdG9yOyI6IDB4Mjk1MCwKICAgICAgICAgICAgICAgICJEb3duTGVmdFRlZVZlY3RvcjsiOiAweDI5NWUsICJEb3duTGVmdFZlY3RvcjsiOiAweDIxYmQsCiAgICAgICAgICAgICAgICAiRG93bkxlZnRWZWN0b3JCYXI7IjogMHgyOTU2LCAiRG93blJpZ2h0VGVlVmVjdG9yOyI6IDB4Mjk1ZiwKICAgICAgICAgICAgICAgICJEb3duUmlnaHRWZWN0b3I7IjogMHgyMWMxLCAiRG93blJpZ2h0VmVjdG9yQmFyOyI6IDB4Mjk1NywKICAgICAgICAgICAgICAgICJEb3duVGVlOyI6IDB4MjJhNCwgIkRvd25UZWVBcnJvdzsiOiAweDIxYTcsCiAgICAgICAgICAgICAgICAiRG93bmFycm93OyI6IDB4MjFkMywgIkRzY3I7IjogWzB4ZDgzNSwgMHhkYzlmXSwKICAgICAgICAgICAgICAgICJEc3Ryb2s7IjogMHgxMTAsICJFTkc7IjogMHgxNGEsCiAgICAgICAgICAgICAgICAiRVRIOyI6IDB4ZDAsICJFYWN1dGU7IjogMHhjOSwKICAgICAgICAgICAgICAgICJFY2Fyb247IjogMHgxMWEsICJFY2lyYzsiOiAweGNhLAogICAgICAgICAgICAgICAgIkVjeTsiOiAweDQyZCwgIkVkb3Q7IjogMHgxMTYsCiAgICAgICAgICAgICAgICAiRWZyOyI6IFsweGQ4MzUsIDB4ZGQwOF0sICJFZ3JhdmU7IjogMHhjOCwKICAgICAgICAgICAgICAgICJFbGVtZW50OyI6IDB4MjIwOCwgIkVtYWNyOyI6IDB4MTEyLAogICAgICAgICAgICAgICAgIkVtcHR5U21hbGxTcXVhcmU7IjogMHgyNWZiLCAiRW1wdHlWZXJ5U21hbGxTcXVhcmU7IjogMHgyNWFiLAogICAgICAgICAgICAgICAgIkVvZ29uOyI6IDB4MTE4LCAiRW9wZjsiOiBbMHhkODM1LCAweGRkM2NdLAogICAgICAgICAgICAgICAgIkVwc2lsb247IjogMHgzOTUsICJFcXVhbDsiOiAweDJhNzUsCiAgICAgICAgICAgICAgICAiRXF1YWxUaWxkZTsiOiAweDIyNDIsICJFcXVpbGlicml1bTsiOiAweDIxY2MsCiAgICAgICAgICAgICAgICAiRXNjcjsiOiAweDIxMzAsICJFc2ltOyI6IDB4MmE3MywKICAgICAgICAgICAgICAgICJFdGE7IjogMHgzOTcsICJFdW1sOyI6IDB4Y2IsCiAgICAgICAgICAgICAgICAiRXhpc3RzOyI6IDB4MjIwMywgIkV4cG9uZW50aWFsRTsiOiAweDIxNDcsCiAgICAgICAgICAgICAgICAiRmN5OyI6IDB4NDI0LCAiRmZyOyI6IFsweGQ4MzUsIDB4ZGQwOV0sCiAgICAgICAgICAgICAgICAiRmlsbGVkU21hbGxTcXVhcmU7IjogMHgyNWZjLCAiRmlsbGVkVmVyeVNtYWxsU3F1YXJlOyI6IDB4MjVhYSwKICAgICAgICAgICAgICAgICJGb3BmOyI6IFsweGQ4MzUsIDB4ZGQzZF0sICJGb3JBbGw7IjogMHgyMjAwLAogICAgICAgICAgICAgICAgIkZvdXJpZXJ0cmY7IjogMHgyMTMxLCAiRnNjcjsiOiAweDIxMzEsCiAgICAgICAgICAgICAgICAiR0pjeTsiOiAweDQwMywgIkdUOyI6IDB4M2UsCiAgICAgICAgICAgICAgICAiR2FtbWE7IjogMHgzOTMsICJHYW1tYWQ7IjogMHgzZGMsCiAgICAgICAgICAgICAgICAiR2JyZXZlOyI6IDB4MTFlLCAiR2NlZGlsOyI6IDB4MTIyLAogICAgICAgICAgICAgICAgIkdjaXJjOyI6IDB4MTFjLCAiR2N5OyI6IDB4NDEzLAogICAgICAgICAgICAgICAgIkdkb3Q7IjogMHgxMjAsICJHZnI7IjogWzB4ZDgzNSwgMHhkZDBhXSwKICAgICAgICAgICAgICAgICJHZzsiOiAweDIyZDksICJHb3BmOyI6IFsweGQ4MzUsIDB4ZGQzZV0sCiAgICAgICAgICAgICAgICAiR3JlYXRlckVxdWFsOyI6IDB4MjI2NSwgIkdyZWF0ZXJFcXVhbExlc3M7IjogMHgyMmRiLAogICAgICAgICAgICAgICAgIkdyZWF0ZXJGdWxsRXF1YWw7IjogMHgyMjY3LCAiR3JlYXRlckdyZWF0ZXI7IjogMHgyYWEyLAogICAgICAgICAgICAgICAgIkdyZWF0ZXJMZXNzOyI6IDB4MjI3NywgIkdyZWF0ZXJTbGFudEVxdWFsOyI6IDB4MmE3ZSwKICAgICAgICAgICAgICAgICJHcmVhdGVyVGlsZGU7IjogMHgyMjczLCAiR3NjcjsiOiBbMHhkODM1LCAweGRjYTJdLAogICAgICAgICAgICAgICAgIkd0OyI6IDB4MjI2YiwgIkhBUkRjeTsiOiAweDQyYSwKICAgICAgICAgICAgICAgICJIYWNlazsiOiAweDJjNywgIkhhdDsiOiAweDVlLAogICAgICAgICAgICAgICAgIkhjaXJjOyI6IDB4MTI0LCAiSGZyOyI6IDB4MjEwYywKICAgICAgICAgICAgICAgICJIaWxiZXJ0U3BhY2U7IjogMHgyMTBiLCAiSG9wZjsiOiAweDIxMGQsCiAgICAgICAgICAgICAgICAiSG9yaXpvbnRhbExpbmU7IjogMHgyNTAwLCAiSHNjcjsiOiAweDIxMGIsCiAgICAgICAgICAgICAgICAiSHN0cm9rOyI6IDB4MTI2LCAiSHVtcERvd25IdW1wOyI6IDB4MjI0ZSwKICAgICAgICAgICAgICAgICJIdW1wRXF1YWw7IjogMHgyMjRmLCAiSUVjeTsiOiAweDQxNSwKICAgICAgICAgICAgICAgICJJSmxpZzsiOiAweDEzMiwgIklPY3k7IjogMHg0MDEsCiAgICAgICAgICAgICAgICAiSWFjdXRlOyI6IDB4Y2QsICJJY2lyYzsiOiAweGNlLAogICAgICAgICAgICAgICAgIkljeTsiOiAweDQxOCwgIklkb3Q7IjogMHgxMzAsCiAgICAgICAgICAgICAgICAiSWZyOyI6IDB4MjExMSwgIklncmF2ZTsiOiAweGNjLAogICAgICAgICAgICAgICAgIkltOyI6IDB4MjExMSwgIkltYWNyOyI6IDB4MTJhLAogICAgICAgICAgICAgICAgIkltYWdpbmFyeUk7IjogMHgyMTQ4LCAiSW1wbGllczsiOiAweDIxZDIsCiAgICAgICAgICAgICAgICAiSW50OyI6IDB4MjIyYywgIkludGVncmFsOyI6IDB4MjIyYiwKICAgICAgICAgICAgICAgICJJbnRlcnNlY3Rpb247IjogMHgyMmMyLCAiSW52aXNpYmxlQ29tbWE7IjogMHgyMDYzLAogICAgICAgICAgICAgICAgIkludmlzaWJsZVRpbWVzOyI6IDB4MjA2MiwgIklvZ29uOyI6IDB4MTJlLAogICAgICAgICAgICAgICAgIklvcGY7IjogWzB4ZDgzNSwgMHhkZDQwXSwgIklvdGE7IjogMHgzOTksCiAgICAgICAgICAgICAgICAiSXNjcjsiOiAweDIxMTAsICJJdGlsZGU7IjogMHgxMjgsCiAgICAgICAgICAgICAgICAiSXVrY3k7IjogMHg0MDYsICJJdW1sOyI6IDB4Y2YsCiAgICAgICAgICAgICAgICAiSmNpcmM7IjogMHgxMzQsICJKY3k7IjogMHg0MTksCiAgICAgICAgICAgICAgICAiSmZyOyI6IFsweGQ4MzUsIDB4ZGQwZF0sICJKb3BmOyI6IFsweGQ4MzUsIDB4ZGQ0MV0sCiAgICAgICAgICAgICAgICAiSnNjcjsiOiBbMHhkODM1LCAweGRjYTVdLCAiSnNlcmN5OyI6IDB4NDA4LAogICAgICAgICAgICAgICAgIkp1a2N5OyI6IDB4NDA0LCAiS0hjeTsiOiAweDQyNSwKICAgICAgICAgICAgICAgICJLSmN5OyI6IDB4NDBjLCAiS2FwcGE7IjogMHgzOWEsCiAgICAgICAgICAgICAgICAiS2NlZGlsOyI6IDB4MTM2LCAiS2N5OyI6IDB4NDFhLAogICAgICAgICAgICAgICAgIktmcjsiOiBbMHhkODM1LCAweGRkMGVdLCAiS29wZjsiOiBbMHhkODM1LCAweGRkNDJdLAogICAgICAgICAgICAgICAgIktzY3I7IjogWzB4ZDgzNSwgMHhkY2E2XSwgIkxKY3k7IjogMHg0MDksCiAgICAgICAgICAgICAgICAiTFQ7IjogMHgzYywgIkxhY3V0ZTsiOiAweDEzOSwKICAgICAgICAgICAgICAgICJMYW1iZGE7IjogMHgzOWIsICJMYW5nOyI6IDB4MjdlYSwKICAgICAgICAgICAgICAgICJMYXBsYWNldHJmOyI6IDB4MjExMiwgIkxhcnI7IjogMHgyMTllLAogICAgICAgICAgICAgICAgIkxjYXJvbjsiOiAweDEzZCwgIkxjZWRpbDsiOiAweDEzYiwKICAgICAgICAgICAgICAgICJMY3k7IjogMHg0MWIsICJMZWZ0QW5nbGVCcmFja2V0OyI6IDB4MjdlOCwKICAgICAgICAgICAgICAgICJMZWZ0QXJyb3c7IjogMHgyMTkwLCAiTGVmdEFycm93QmFyOyI6IDB4MjFlNCwKICAgICAgICAgICAgICAgICJMZWZ0QXJyb3dSaWdodEFycm93OyI6IDB4MjFjNiwgIkxlZnRDZWlsaW5nOyI6IDB4MjMwOCwKICAgICAgICAgICAgICAgICJMZWZ0RG91YmxlQnJhY2tldDsiOiAweDI3ZTYsICJMZWZ0RG93blRlZVZlY3RvcjsiOiAweDI5NjEsCiAgICAgICAgICAgICAgICAiTGVmdERvd25WZWN0b3I7IjogMHgyMWMzLCAiTGVmdERvd25WZWN0b3JCYXI7IjogMHgyOTU5LAogICAgICAgICAgICAgICAgIkxlZnRGbG9vcjsiOiAweDIzMGEsICJMZWZ0UmlnaHRBcnJvdzsiOiAweDIxOTQsCiAgICAgICAgICAgICAgICAiTGVmdFJpZ2h0VmVjdG9yOyI6IDB4Mjk0ZSwgIkxlZnRUZWU7IjogMHgyMmEzLAogICAgICAgICAgICAgICAgIkxlZnRUZWVBcnJvdzsiOiAweDIxYTQsICJMZWZ0VGVlVmVjdG9yOyI6IDB4Mjk1YSwKICAgICAgICAgICAgICAgICJMZWZ0VHJpYW5nbGU7IjogMHgyMmIyLCAiTGVmdFRyaWFuZ2xlQmFyOyI6IDB4MjljZiwKICAgICAgICAgICAgICAgICJMZWZ0VHJpYW5nbGVFcXVhbDsiOiAweDIyYjQsICJMZWZ0VXBEb3duVmVjdG9yOyI6IDB4Mjk1MSwKICAgICAgICAgICAgICAgICJMZWZ0VXBUZWVWZWN0b3I7IjogMHgyOTYwLCAiTGVmdFVwVmVjdG9yOyI6IDB4MjFiZiwKICAgICAgICAgICAgICAgICJMZWZ0VXBWZWN0b3JCYXI7IjogMHgyOTU4LCAiTGVmdFZlY3RvcjsiOiAweDIxYmMsCiAgICAgICAgICAgICAgICAiTGVmdFZlY3RvckJhcjsiOiAweDI5NTIsICJMZWZ0YXJyb3c7IjogMHgyMWQwLAogICAgICAgICAgICAgICAgIkxlZnRyaWdodGFycm93OyI6IDB4MjFkNCwgIkxlc3NFcXVhbEdyZWF0ZXI7IjogMHgyMmRhLAogICAgICAgICAgICAgICAgIkxlc3NGdWxsRXF1YWw7IjogMHgyMjY2LCAiTGVzc0dyZWF0ZXI7IjogMHgyMjc2LAogICAgICAgICAgICAgICAgIkxlc3NMZXNzOyI6IDB4MmFhMSwgIkxlc3NTbGFudEVxdWFsOyI6IDB4MmE3ZCwKICAgICAgICAgICAgICAgICJMZXNzVGlsZGU7IjogMHgyMjcyLCAiTGZyOyI6IFsweGQ4MzUsIDB4ZGQwZl0sCiAgICAgICAgICAgICAgICAiTGw7IjogMHgyMmQ4LCAiTGxlZnRhcnJvdzsiOiAweDIxZGEsCiAgICAgICAgICAgICAgICAiTG1pZG90OyI6IDB4MTNmLCAiTG9uZ0xlZnRBcnJvdzsiOiAweDI3ZjUsCiAgICAgICAgICAgICAgICAiTG9uZ0xlZnRSaWdodEFycm93OyI6IDB4MjdmNywgIkxvbmdSaWdodEFycm93OyI6IDB4MjdmNiwKICAgICAgICAgICAgICAgICJMb25nbGVmdGFycm93OyI6IDB4MjdmOCwgIkxvbmdsZWZ0cmlnaHRhcnJvdzsiOiAweDI3ZmEsCiAgICAgICAgICAgICAgICAiTG9uZ3JpZ2h0YXJyb3c7IjogMHgyN2Y5LCAiTG9wZjsiOiBbMHhkODM1LCAweGRkNDNdLAogICAgICAgICAgICAgICAgIkxvd2VyTGVmdEFycm93OyI6IDB4MjE5OSwgIkxvd2VyUmlnaHRBcnJvdzsiOiAweDIxOTgsCiAgICAgICAgICAgICAgICAiTHNjcjsiOiAweDIxMTIsICJMc2g7IjogMHgyMWIwLAogICAgICAgICAgICAgICAgIkxzdHJvazsiOiAweDE0MSwgIkx0OyI6IDB4MjI2YSwKICAgICAgICAgICAgICAgICJNYXA7IjogMHgyOTA1LCAiTWN5OyI6IDB4NDFjLAogICAgICAgICAgICAgICAgIk1lZGl1bVNwYWNlOyI6IDB4MjA1ZiwgIk1lbGxpbnRyZjsiOiAweDIxMzMsCiAgICAgICAgICAgICAgICAiTWZyOyI6IFsweGQ4MzUsIDB4ZGQxMF0sICJNaW51c1BsdXM7IjogMHgyMjEzLAogICAgICAgICAgICAgICAgIk1vcGY7IjogWzB4ZDgzNSwgMHhkZDQ0XSwgIk1zY3I7IjogMHgyMTMzLAogICAgICAgICAgICAgICAgIk11OyI6IDB4MzljLCAiTkpjeTsiOiAweDQwYSwKICAgICAgICAgICAgICAgICJOYWN1dGU7IjogMHgxNDMsICJOY2Fyb247IjogMHgxNDcsCiAgICAgICAgICAgICAgICAiTmNlZGlsOyI6IDB4MTQ1LCAiTmN5OyI6IDB4NDFkLAogICAgICAgICAgICAgICAgIk5lZ2F0aXZlTWVkaXVtU3BhY2U7IjogMHgyMDBiLCAiTmVnYXRpdmVUaGlja1NwYWNlOyI6IDB4MjAwYiwKICAgICAgICAgICAgICAgICJOZWdhdGl2ZVRoaW5TcGFjZTsiOiAweDIwMGIsICJOZWdhdGl2ZVZlcnlUaGluU3BhY2U7IjogMHgyMDBiLAogICAgICAgICAgICAgICAgIk5lc3RlZEdyZWF0ZXJHcmVhdGVyOyI6IDB4MjI2YiwgIk5lc3RlZExlc3NMZXNzOyI6IDB4MjI2YSwKICAgICAgICAgICAgICAgICJOZXdMaW5lOyI6IDB4YSwgIk5mcjsiOiBbMHhkODM1LCAweGRkMTFdLAogICAgICAgICAgICAgICAgIk5vQnJlYWs7IjogMHgyMDYwLCAiTm9uQnJlYWtpbmdTcGFjZTsiOiAweGEwLAogICAgICAgICAgICAgICAgIk5vcGY7IjogMHgyMTE1LCAiTm90OyI6IDB4MmFlYywKICAgICAgICAgICAgICAgICJOb3RDb25ncnVlbnQ7IjogMHgyMjYyLCAiTm90Q3VwQ2FwOyI6IDB4MjI2ZCwKICAgICAgICAgICAgICAgICJOb3REb3VibGVWZXJ0aWNhbEJhcjsiOiAweDIyMjYsICJOb3RFbGVtZW50OyI6IDB4MjIwOSwKICAgICAgICAgICAgICAgICJOb3RFcXVhbDsiOiAweDIyNjAsICJOb3RFcXVhbFRpbGRlOyI6IFsweDIyNDIsIDB4MzM4XSwKICAgICAgICAgICAgICAgICJOb3RFeGlzdHM7IjogMHgyMjA0LCAiTm90R3JlYXRlcjsiOiAweDIyNmYsCiAgICAgICAgICAgICAgICAiTm90R3JlYXRlckVxdWFsOyI6IDB4MjI3MSwgIk5vdEdyZWF0ZXJGdWxsRXF1YWw7IjogWzB4MjI2NywgMHgzMzhdLAogICAgICAgICAgICAgICAgIk5vdEdyZWF0ZXJHcmVhdGVyOyI6IFsweDIyNmIsIDB4MzM4XSwgIk5vdEdyZWF0ZXJMZXNzOyI6IDB4MjI3OSwKICAgICAgICAgICAgICAgICJOb3RHcmVhdGVyU2xhbnRFcXVhbDsiOiBbMHgyYTdlLCAweDMzOF0sICJOb3RHcmVhdGVyVGlsZGU7IjogMHgyMjc1LAogICAgICAgICAgICAgICAgIk5vdEh1bXBEb3duSHVtcDsiOiBbMHgyMjRlLCAweDMzOF0sICJOb3RIdW1wRXF1YWw7IjogWzB4MjI0ZiwgMHgzMzhdLAogICAgICAgICAgICAgICAgIk5vdExlZnRUcmlhbmdsZTsiOiAweDIyZWEsICJOb3RMZWZ0VHJpYW5nbGVCYXI7IjogWzB4MjljZiwgMHgzMzhdLAogICAgICAgICAgICAgICAgIk5vdExlZnRUcmlhbmdsZUVxdWFsOyI6IDB4MjJlYywgIk5vdExlc3M7IjogMHgyMjZlLAogICAgICAgICAgICAgICAgIk5vdExlc3NFcXVhbDsiOiAweDIyNzAsICJOb3RMZXNzR3JlYXRlcjsiOiAweDIyNzgsCiAgICAgICAgICAgICAgICAiTm90TGVzc0xlc3M7IjogWzB4MjI2YSwgMHgzMzhdLCAiTm90TGVzc1NsYW50RXF1YWw7IjogWzB4MmE3ZCwgMHgzMzhdLAogICAgICAgICAgICAgICAgIk5vdExlc3NUaWxkZTsiOiAweDIyNzQsICJOb3ROZXN0ZWRHcmVhdGVyR3JlYXRlcjsiOiBbMHgyYWEyLCAweDMzOF0sCiAgICAgICAgICAgICAgICAiTm90TmVzdGVkTGVzc0xlc3M7IjogWzB4MmFhMSwgMHgzMzhdLCAiTm90UHJlY2VkZXM7IjogMHgyMjgwLAogICAgICAgICAgICAgICAgIk5vdFByZWNlZGVzRXF1YWw7IjogWzB4MmFhZiwgMHgzMzhdLCAiTm90UHJlY2VkZXNTbGFudEVxdWFsOyI6IDB4MjJlMCwKICAgICAgICAgICAgICAgICJOb3RSZXZlcnNlRWxlbWVudDsiOiAweDIyMGMsICJOb3RSaWdodFRyaWFuZ2xlOyI6IDB4MjJlYiwKICAgICAgICAgICAgICAgICJOb3RSaWdodFRyaWFuZ2xlQmFyOyI6IFsweDI5ZDAsIDB4MzM4XSwgIk5vdFJpZ2h0VHJpYW5nbGVFcXVhbDsiOiAweDIyZWQsCiAgICAgICAgICAgICAgICAiTm90U3F1YXJlU3Vic2V0OyI6IFsweDIyOGYsIDB4MzM4XSwgIk5vdFNxdWFyZVN1YnNldEVxdWFsOyI6IDB4MjJlMiwKICAgICAgICAgICAgICAgICJOb3RTcXVhcmVTdXBlcnNldDsiOiBbMHgyMjkwLCAweDMzOF0sICJOb3RTcXVhcmVTdXBlcnNldEVxdWFsOyI6IDB4MjJlMywKICAgICAgICAgICAgICAgICJOb3RTdWJzZXQ7IjogWzB4MjI4MiwgMHgyMGQyXSwgIk5vdFN1YnNldEVxdWFsOyI6IDB4MjI4OCwKICAgICAgICAgICAgICAgICJOb3RTdWNjZWVkczsiOiAweDIyODEsICJOb3RTdWNjZWVkc0VxdWFsOyI6IFsweDJhYjAsIDB4MzM4XSwKICAgICAgICAgICAgICAgICJOb3RTdWNjZWVkc1NsYW50RXF1YWw7IjogMHgyMmUxLCAiTm90U3VjY2VlZHNUaWxkZTsiOiBbMHgyMjdmLCAweDMzOF0sCiAgICAgICAgICAgICAgICAiTm90U3VwZXJzZXQ7IjogWzB4MjI4MywgMHgyMGQyXSwgIk5vdFN1cGVyc2V0RXF1YWw7IjogMHgyMjg5LAogICAgICAgICAgICAgICAgIk5vdFRpbGRlOyI6IDB4MjI0MSwgIk5vdFRpbGRlRXF1YWw7IjogMHgyMjQ0LAogICAgICAgICAgICAgICAgIk5vdFRpbGRlRnVsbEVxdWFsOyI6IDB4MjI0NywgIk5vdFRpbGRlVGlsZGU7IjogMHgyMjQ5LAogICAgICAgICAgICAgICAgIk5vdFZlcnRpY2FsQmFyOyI6IDB4MjIyNCwgIk5zY3I7IjogWzB4ZDgzNSwgMHhkY2E5XSwKICAgICAgICAgICAgICAgICJOdGlsZGU7IjogMHhkMSwgIk51OyI6IDB4MzlkLAogICAgICAgICAgICAgICAgIk9FbGlnOyI6IDB4MTUyLCAiT2FjdXRlOyI6IDB4ZDMsCiAgICAgICAgICAgICAgICAiT2NpcmM7IjogMHhkNCwgIk9jeTsiOiAweDQxZSwKICAgICAgICAgICAgICAgICJPZGJsYWM7IjogMHgxNTAsICJPZnI7IjogWzB4ZDgzNSwgMHhkZDEyXSwKICAgICAgICAgICAgICAgICJPZ3JhdmU7IjogMHhkMiwgIk9tYWNyOyI6IDB4MTRjLAogICAgICAgICAgICAgICAgIk9tZWdhOyI6IDB4M2E5LCAiT21pY3JvbjsiOiAweDM5ZiwKICAgICAgICAgICAgICAgICJPb3BmOyI6IFsweGQ4MzUsIDB4ZGQ0Nl0sICJPcGVuQ3VybHlEb3VibGVRdW90ZTsiOiAweDIwMWMsCiAgICAgICAgICAgICAgICAiT3BlbkN1cmx5UXVvdGU7IjogMHgyMDE4LCAiT3I7IjogMHgyYTU0LAogICAgICAgICAgICAgICAgIk9zY3I7IjogWzB4ZDgzNSwgMHhkY2FhXSwgIk9zbGFzaDsiOiAweGQ4LAogICAgICAgICAgICAgICAgIk90aWxkZTsiOiAweGQ1LCAiT3RpbWVzOyI6IDB4MmEzNywKICAgICAgICAgICAgICAgICJPdW1sOyI6IDB4ZDYsICJPdmVyQmFyOyI6IDB4MjAzZSwKICAgICAgICAgICAgICAgICJPdmVyQnJhY2U7IjogMHgyM2RlLCAiT3ZlckJyYWNrZXQ7IjogMHgyM2I0LAogICAgICAgICAgICAgICAgIk92ZXJQYXJlbnRoZXNpczsiOiAweDIzZGMsICJQYXJ0aWFsRDsiOiAweDIyMDIsCiAgICAgICAgICAgICAgICAiUGN5OyI6IDB4NDFmLCAiUGZyOyI6IFsweGQ4MzUsIDB4ZGQxM10sCiAgICAgICAgICAgICAgICAiUGhpOyI6IDB4M2E2LCAiUGk7IjogMHgzYTAsCiAgICAgICAgICAgICAgICAiUGx1c01pbnVzOyI6IDB4YjEsICJQb2luY2FyZXBsYW5lOyI6IDB4MjEwYywKICAgICAgICAgICAgICAgICJQb3BmOyI6IDB4MjExOSwgIlByOyI6IDB4MmFiYiwKICAgICAgICAgICAgICAgICJQcmVjZWRlczsiOiAweDIyN2EsICJQcmVjZWRlc0VxdWFsOyI6IDB4MmFhZiwKICAgICAgICAgICAgICAgICJQcmVjZWRlc1NsYW50RXF1YWw7IjogMHgyMjdjLCAiUHJlY2VkZXNUaWxkZTsiOiAweDIyN2UsCiAgICAgICAgICAgICAgICAiUHJpbWU7IjogMHgyMDMzLCAiUHJvZHVjdDsiOiAweDIyMGYsCiAgICAgICAgICAgICAgICAiUHJvcG9ydGlvbjsiOiAweDIyMzcsICJQcm9wb3J0aW9uYWw7IjogMHgyMjFkLAogICAgICAgICAgICAgICAgIlBzY3I7IjogWzB4ZDgzNSwgMHhkY2FiXSwgIlBzaTsiOiAweDNhOCwKICAgICAgICAgICAgICAgICJRVU9UOyI6IDB4MjIsICJRZnI7IjogWzB4ZDgzNSwgMHhkZDE0XSwKICAgICAgICAgICAgICAgICJRb3BmOyI6IDB4MjExYSwgIlFzY3I7IjogWzB4ZDgzNSwgMHhkY2FjXSwKICAgICAgICAgICAgICAgICJSQmFycjsiOiAweDI5MTAsICJSRUc7IjogMHhhZSwKICAgICAgICAgICAgICAgICJSYWN1dGU7IjogMHgxNTQsICJSYW5nOyI6IDB4MjdlYiwKICAgICAgICAgICAgICAgICJSYXJyOyI6IDB4MjFhMCwgIlJhcnJ0bDsiOiAweDI5MTYsCiAgICAgICAgICAgICAgICAiUmNhcm9uOyI6IDB4MTU4LCAiUmNlZGlsOyI6IDB4MTU2LAogICAgICAgICAgICAgICAgIlJjeTsiOiAweDQyMCwgIlJlOyI6IDB4MjExYywKICAgICAgICAgICAgICAgICJSZXZlcnNlRWxlbWVudDsiOiAweDIyMGIsICJSZXZlcnNlRXF1aWxpYnJpdW07IjogMHgyMWNiLAogICAgICAgICAgICAgICAgIlJldmVyc2VVcEVxdWlsaWJyaXVtOyI6IDB4Mjk2ZiwgIlJmcjsiOiAweDIxMWMsCiAgICAgICAgICAgICAgICAiUmhvOyI6IDB4M2ExLCAiUmlnaHRBbmdsZUJyYWNrZXQ7IjogMHgyN2U5LAogICAgICAgICAgICAgICAgIlJpZ2h0QXJyb3c7IjogMHgyMTkyLCAiUmlnaHRBcnJvd0JhcjsiOiAweDIxZTUsCiAgICAgICAgICAgICAgICAiUmlnaHRBcnJvd0xlZnRBcnJvdzsiOiAweDIxYzQsICJSaWdodENlaWxpbmc7IjogMHgyMzA5LAogICAgICAgICAgICAgICAgIlJpZ2h0RG91YmxlQnJhY2tldDsiOiAweDI3ZTcsICJSaWdodERvd25UZWVWZWN0b3I7IjogMHgyOTVkLAogICAgICAgICAgICAgICAgIlJpZ2h0RG93blZlY3RvcjsiOiAweDIxYzIsICJSaWdodERvd25WZWN0b3JCYXI7IjogMHgyOTU1LAogICAgICAgICAgICAgICAgIlJpZ2h0Rmxvb3I7IjogMHgyMzBiLCAiUmlnaHRUZWU7IjogMHgyMmEyLAogICAgICAgICAgICAgICAgIlJpZ2h0VGVlQXJyb3c7IjogMHgyMWE2LCAiUmlnaHRUZWVWZWN0b3I7IjogMHgyOTViLAogICAgICAgICAgICAgICAgIlJpZ2h0VHJpYW5nbGU7IjogMHgyMmIzLCAiUmlnaHRUcmlhbmdsZUJhcjsiOiAweDI5ZDAsCiAgICAgICAgICAgICAgICAiUmlnaHRUcmlhbmdsZUVxdWFsOyI6IDB4MjJiNSwgIlJpZ2h0VXBEb3duVmVjdG9yOyI6IDB4Mjk0ZiwKICAgICAgICAgICAgICAgICJSaWdodFVwVGVlVmVjdG9yOyI6IDB4Mjk1YywgIlJpZ2h0VXBWZWN0b3I7IjogMHgyMWJlLAogICAgICAgICAgICAgICAgIlJpZ2h0VXBWZWN0b3JCYXI7IjogMHgyOTU0LCAiUmlnaHRWZWN0b3I7IjogMHgyMWMwLAogICAgICAgICAgICAgICAgIlJpZ2h0VmVjdG9yQmFyOyI6IDB4Mjk1MywgIlJpZ2h0YXJyb3c7IjogMHgyMWQyLAogICAgICAgICAgICAgICAgIlJvcGY7IjogMHgyMTFkLCAiUm91bmRJbXBsaWVzOyI6IDB4Mjk3MCwKICAgICAgICAgICAgICAgICJScmlnaHRhcnJvdzsiOiAweDIxZGIsICJSc2NyOyI6IDB4MjExYiwKICAgICAgICAgICAgICAgICJSc2g7IjogMHgyMWIxLCAiUnVsZURlbGF5ZWQ7IjogMHgyOWY0LAogICAgICAgICAgICAgICAgIlNIQ0hjeTsiOiAweDQyOSwgIlNIY3k7IjogMHg0MjgsCiAgICAgICAgICAgICAgICAiU09GVGN5OyI6IDB4NDJjLCAiU2FjdXRlOyI6IDB4MTVhLAogICAgICAgICAgICAgICAgIlNjOyI6IDB4MmFiYywgIlNjYXJvbjsiOiAweDE2MCwKICAgICAgICAgICAgICAgICJTY2VkaWw7IjogMHgxNWUsICJTY2lyYzsiOiAweDE1YywKICAgICAgICAgICAgICAgICJTY3k7IjogMHg0MjEsICJTZnI7IjogWzB4ZDgzNSwgMHhkZDE2XSwKICAgICAgICAgICAgICAgICJTaG9ydERvd25BcnJvdzsiOiAweDIxOTMsICJTaG9ydExlZnRBcnJvdzsiOiAweDIxOTAsCiAgICAgICAgICAgICAgICAiU2hvcnRSaWdodEFycm93OyI6IDB4MjE5MiwgIlNob3J0VXBBcnJvdzsiOiAweDIxOTEsCiAgICAgICAgICAgICAgICAiU2lnbWE7IjogMHgzYTMsICJTbWFsbENpcmNsZTsiOiAweDIyMTgsCiAgICAgICAgICAgICAgICAiU29wZjsiOiBbMHhkODM1LCAweGRkNGFdLCAiU3FydDsiOiAweDIyMWEsCiAgICAgICAgICAgICAgICAiU3F1YXJlOyI6IDB4MjVhMSwgIlNxdWFyZUludGVyc2VjdGlvbjsiOiAweDIyOTMsCiAgICAgICAgICAgICAgICAiU3F1YXJlU3Vic2V0OyI6IDB4MjI4ZiwgIlNxdWFyZVN1YnNldEVxdWFsOyI6IDB4MjI5MSwKICAgICAgICAgICAgICAgICJTcXVhcmVTdXBlcnNldDsiOiAweDIyOTAsICJTcXVhcmVTdXBlcnNldEVxdWFsOyI6IDB4MjI5MiwKICAgICAgICAgICAgICAgICJTcXVhcmVVbmlvbjsiOiAweDIyOTQsICJTc2NyOyI6IFsweGQ4MzUsIDB4ZGNhZV0sCiAgICAgICAgICAgICAgICAiU3RhcjsiOiAweDIyYzYsICJTdWI7IjogMHgyMmQwLAogICAgICAgICAgICAgICAgIlN1YnNldDsiOiAweDIyZDAsICJTdWJzZXRFcXVhbDsiOiAweDIyODYsCiAgICAgICAgICAgICAgICAiU3VjY2VlZHM7IjogMHgyMjdiLCAiU3VjY2VlZHNFcXVhbDsiOiAweDJhYjAsCiAgICAgICAgICAgICAgICAiU3VjY2VlZHNTbGFudEVxdWFsOyI6IDB4MjI3ZCwgIlN1Y2NlZWRzVGlsZGU7IjogMHgyMjdmLAogICAgICAgICAgICAgICAgIlN1Y2hUaGF0OyI6IDB4MjIwYiwgIlN1bTsiOiAweDIyMTEsCiAgICAgICAgICAgICAgICAiU3VwOyI6IDB4MjJkMSwgIlN1cGVyc2V0OyI6IDB4MjI4MywKICAgICAgICAgICAgICAgICJTdXBlcnNldEVxdWFsOyI6IDB4MjI4NywgIlN1cHNldDsiOiAweDIyZDEsCiAgICAgICAgICAgICAgICAiVEhPUk47IjogMHhkZSwgIlRSQURFOyI6IDB4MjEyMiwKICAgICAgICAgICAgICAgICJUU0hjeTsiOiAweDQwYiwgIlRTY3k7IjogMHg0MjYsCiAgICAgICAgICAgICAgICAiVGFiOyI6IDB4OSwgIlRhdTsiOiAweDNhNCwKICAgICAgICAgICAgICAgICJUY2Fyb247IjogMHgxNjQsICJUY2VkaWw7IjogMHgxNjIsCiAgICAgICAgICAgICAgICAiVGN5OyI6IDB4NDIyLCAiVGZyOyI6IFsweGQ4MzUsIDB4ZGQxN10sCiAgICAgICAgICAgICAgICAiVGhlcmVmb3JlOyI6IDB4MjIzNCwgIlRoZXRhOyI6IDB4Mzk4LAogICAgICAgICAgICAgICAgIlRoaWNrU3BhY2U7IjogWzB4MjA1ZiwgMHgyMDBhXSwgIlRoaW5TcGFjZTsiOiAweDIwMDksCiAgICAgICAgICAgICAgICAiVGlsZGU7IjogMHgyMjNjLCAiVGlsZGVFcXVhbDsiOiAweDIyNDMsCiAgICAgICAgICAgICAgICAiVGlsZGVGdWxsRXF1YWw7IjogMHgyMjQ1LCAiVGlsZGVUaWxkZTsiOiAweDIyNDgsCiAgICAgICAgICAgICAgICAiVG9wZjsiOiBbMHhkODM1LCAweGRkNGJdLCAiVHJpcGxlRG90OyI6IDB4MjBkYiwKICAgICAgICAgICAgICAgICJUc2NyOyI6IFsweGQ4MzUsIDB4ZGNhZl0sICJUc3Ryb2s7IjogMHgxNjYsCiAgICAgICAgICAgICAgICAiVWFjdXRlOyI6IDB4ZGEsICJVYXJyOyI6IDB4MjE5ZiwKICAgICAgICAgICAgICAgICJVYXJyb2NpcjsiOiAweDI5NDksICJVYnJjeTsiOiAweDQwZSwKICAgICAgICAgICAgICAgICJVYnJldmU7IjogMHgxNmMsICJVY2lyYzsiOiAweGRiLAogICAgICAgICAgICAgICAgIlVjeTsiOiAweDQyMywgIlVkYmxhYzsiOiAweDE3MCwKICAgICAgICAgICAgICAgICJVZnI7IjogWzB4ZDgzNSwgMHhkZDE4XSwgIlVncmF2ZTsiOiAweGQ5LAogICAgICAgICAgICAgICAgIlVtYWNyOyI6IDB4MTZhLCAiVW5kZXJCYXI7IjogMHg1ZiwKICAgICAgICAgICAgICAgICJVbmRlckJyYWNlOyI6IDB4MjNkZiwgIlVuZGVyQnJhY2tldDsiOiAweDIzYjUsCiAgICAgICAgICAgICAgICAiVW5kZXJQYXJlbnRoZXNpczsiOiAweDIzZGQsICJVbmlvbjsiOiAweDIyYzMsCiAgICAgICAgICAgICAgICAiVW5pb25QbHVzOyI6IDB4MjI4ZSwgIlVvZ29uOyI6IDB4MTcyLAogICAgICAgICAgICAgICAgIlVvcGY7IjogWzB4ZDgzNSwgMHhkZDRjXSwgIlVwQXJyb3c7IjogMHgyMTkxLAogICAgICAgICAgICAgICAgIlVwQXJyb3dCYXI7IjogMHgyOTEyLCAiVXBBcnJvd0Rvd25BcnJvdzsiOiAweDIxYzUsCiAgICAgICAgICAgICAgICAiVXBEb3duQXJyb3c7IjogMHgyMTk1LCAiVXBFcXVpbGlicml1bTsiOiAweDI5NmUsCiAgICAgICAgICAgICAgICAiVXBUZWU7IjogMHgyMmE1LCAiVXBUZWVBcnJvdzsiOiAweDIxYTUsCiAgICAgICAgICAgICAgICAiVXBhcnJvdzsiOiAweDIxZDEsICJVcGRvd25hcnJvdzsiOiAweDIxZDUsCiAgICAgICAgICAgICAgICAiVXBwZXJMZWZ0QXJyb3c7IjogMHgyMTk2LCAiVXBwZXJSaWdodEFycm93OyI6IDB4MjE5NywKICAgICAgICAgICAgICAgICJVcHNpOyI6IDB4M2QyLCAiVXBzaWxvbjsiOiAweDNhNSwKICAgICAgICAgICAgICAgICJVcmluZzsiOiAweDE2ZSwgIlVzY3I7IjogWzB4ZDgzNSwgMHhkY2IwXSwKICAgICAgICAgICAgICAgICJVdGlsZGU7IjogMHgxNjgsICJVdW1sOyI6IDB4ZGMsCiAgICAgICAgICAgICAgICAiVkRhc2g7IjogMHgyMmFiLCAiVmJhcjsiOiAweDJhZWIsCiAgICAgICAgICAgICAgICAiVmN5OyI6IDB4NDEyLCAiVmRhc2g7IjogMHgyMmE5LAogICAgICAgICAgICAgICAgIlZkYXNobDsiOiAweDJhZTYsICJWZWU7IjogMHgyMmMxLAogICAgICAgICAgICAgICAgIlZlcmJhcjsiOiAweDIwMTYsICJWZXJ0OyI6IDB4MjAxNiwKICAgICAgICAgICAgICAgICJWZXJ0aWNhbEJhcjsiOiAweDIyMjMsICJWZXJ0aWNhbExpbmU7IjogMHg3YywKICAgICAgICAgICAgICAgICJWZXJ0aWNhbFNlcGFyYXRvcjsiOiAweDI3NTgsICJWZXJ0aWNhbFRpbGRlOyI6IDB4MjI0MCwKICAgICAgICAgICAgICAgICJWZXJ5VGhpblNwYWNlOyI6IDB4MjAwYSwgIlZmcjsiOiBbMHhkODM1LCAweGRkMTldLAogICAgICAgICAgICAgICAgIlZvcGY7IjogWzB4ZDgzNSwgMHhkZDRkXSwgIlZzY3I7IjogWzB4ZDgzNSwgMHhkY2IxXSwKICAgICAgICAgICAgICAgICJWdmRhc2g7IjogMHgyMmFhLCAiV2NpcmM7IjogMHgxNzQsCiAgICAgICAgICAgICAgICAiV2VkZ2U7IjogMHgyMmMwLCAiV2ZyOyI6IFsweGQ4MzUsIDB4ZGQxYV0sCiAgICAgICAgICAgICAgICAiV29wZjsiOiBbMHhkODM1LCAweGRkNGVdLCAiV3NjcjsiOiBbMHhkODM1LCAweGRjYjJdLAogICAgICAgICAgICAgICAgIlhmcjsiOiBbMHhkODM1LCAweGRkMWJdLCAiWGk7IjogMHgzOWUsCiAgICAgICAgICAgICAgICAiWG9wZjsiOiBbMHhkODM1LCAweGRkNGZdLCAiWHNjcjsiOiBbMHhkODM1LCAweGRjYjNdLAogICAgICAgICAgICAgICAgIllBY3k7IjogMHg0MmYsICJZSWN5OyI6IDB4NDA3LAogICAgICAgICAgICAgICAgIllVY3k7IjogMHg0MmUsICJZYWN1dGU7IjogMHhkZCwKICAgICAgICAgICAgICAgICJZY2lyYzsiOiAweDE3NiwgIlljeTsiOiAweDQyYiwKICAgICAgICAgICAgICAgICJZZnI7IjogWzB4ZDgzNSwgMHhkZDFjXSwgIllvcGY7IjogWzB4ZDgzNSwgMHhkZDUwXSwKICAgICAgICAgICAgICAgICJZc2NyOyI6IFsweGQ4MzUsIDB4ZGNiNF0sICJZdW1sOyI6IDB4MTc4LAogICAgICAgICAgICAgICAgIlpIY3k7IjogMHg0MTYsICJaYWN1dGU7IjogMHgxNzksCiAgICAgICAgICAgICAgICAiWmNhcm9uOyI6IDB4MTdkLCAiWmN5OyI6IDB4NDE3LAogICAgICAgICAgICAgICAgIlpkb3Q7IjogMHgxN2IsICJaZXJvV2lkdGhTcGFjZTsiOiAweDIwMGIsCiAgICAgICAgICAgICAgICAiWmV0YTsiOiAweDM5NiwgIlpmcjsiOiAweDIxMjgsCiAgICAgICAgICAgICAgICAiWm9wZjsiOiAweDIxMjQsICJac2NyOyI6IFsweGQ4MzUsIDB4ZGNiNV0sCiAgICAgICAgICAgICAgICAiYWFjdXRlOyI6IDB4ZTEsICJhYnJldmU7IjogMHgxMDMsCiAgICAgICAgICAgICAgICAiYWM7IjogMHgyMjNlLCAiYWNFOyI6IFsweDIyM2UsIDB4MzMzXSwKICAgICAgICAgICAgICAgICJhY2Q7IjogMHgyMjNmLCAiYWNpcmM7IjogMHhlMiwKICAgICAgICAgICAgICAgICJhY3V0ZTsiOiAweGI0LCAiYWN5OyI6IDB4NDMwLAogICAgICAgICAgICAgICAgImFlbGlnOyI6IDB4ZTYsICJhZjsiOiAweDIwNjEsCiAgICAgICAgICAgICAgICAiYWZyOyI6IFsweGQ4MzUsIDB4ZGQxZV0sICJhZ3JhdmU7IjogMHhlMCwKICAgICAgICAgICAgICAgICJhbGVmc3ltOyI6IDB4MjEzNSwgImFsZXBoOyI6IDB4MjEzNSwKICAgICAgICAgICAgICAgICJhbHBoYTsiOiAweDNiMSwgImFtYWNyOyI6IDB4MTAxLAogICAgICAgICAgICAgICAgImFtYWxnOyI6IDB4MmEzZiwgImFtcDsiOiAweDI2LAogICAgICAgICAgICAgICAgImFuZDsiOiAweDIyMjcsICJhbmRhbmQ7IjogMHgyYTU1LAogICAgICAgICAgICAgICAgImFuZGQ7IjogMHgyYTVjLCAiYW5kc2xvcGU7IjogMHgyYTU4LAogICAgICAgICAgICAgICAgImFuZHY7IjogMHgyYTVhLCAiYW5nOyI6IDB4MjIyMCwKICAgICAgICAgICAgICAgICJhbmdlOyI6IDB4MjlhNCwgImFuZ2xlOyI6IDB4MjIyMCwKICAgICAgICAgICAgICAgICJhbmdtc2Q7IjogMHgyMjIxLCAiYW5nbXNkYWE7IjogMHgyOWE4LAogICAgICAgICAgICAgICAgImFuZ21zZGFiOyI6IDB4MjlhOSwgImFuZ21zZGFjOyI6IDB4MjlhYSwKICAgICAgICAgICAgICAgICJhbmdtc2RhZDsiOiAweDI5YWIsICJhbmdtc2RhZTsiOiAweDI5YWMsCiAgICAgICAgICAgICAgICAiYW5nbXNkYWY7IjogMHgyOWFkLCAiYW5nbXNkYWc7IjogMHgyOWFlLAogICAgICAgICAgICAgICAgImFuZ21zZGFoOyI6IDB4MjlhZiwgImFuZ3J0OyI6IDB4MjIxZiwKICAgICAgICAgICAgICAgICJhbmdydHZiOyI6IDB4MjJiZSwgImFuZ3J0dmJkOyI6IDB4Mjk5ZCwKICAgICAgICAgICAgICAgICJhbmdzcGg7IjogMHgyMjIyLCAiYW5nc3Q7IjogMHhjNSwKICAgICAgICAgICAgICAgICJhbmd6YXJyOyI6IDB4MjM3YywgImFvZ29uOyI6IDB4MTA1LAogICAgICAgICAgICAgICAgImFvcGY7IjogWzB4ZDgzNSwgMHhkZDUyXSwgImFwOyI6IDB4MjI0OCwKICAgICAgICAgICAgICAgICJhcEU7IjogMHgyYTcwLCAiYXBhY2lyOyI6IDB4MmE2ZiwKICAgICAgICAgICAgICAgICJhcGU7IjogMHgyMjRhLCAiYXBpZDsiOiAweDIyNGIsCiAgICAgICAgICAgICAgICAiYXBvczsiOiAweDI3LCAiYXBwcm94OyI6IDB4MjI0OCwKICAgICAgICAgICAgICAgICJhcHByb3hlcTsiOiAweDIyNGEsICJhcmluZzsiOiAweGU1LAogICAgICAgICAgICAgICAgImFzY3I7IjogWzB4ZDgzNSwgMHhkY2I2XSwgImFzdDsiOiAweDJhLAogICAgICAgICAgICAgICAgImFzeW1wOyI6IDB4MjI0OCwgImFzeW1wZXE7IjogMHgyMjRkLAogICAgICAgICAgICAgICAgImF0aWxkZTsiOiAweGUzLCAiYXVtbDsiOiAweGU0LAogICAgICAgICAgICAgICAgImF3Y29uaW50OyI6IDB4MjIzMywgImF3aW50OyI6IDB4MmExMSwKICAgICAgICAgICAgICAgICJiTm90OyI6IDB4MmFlZCwgImJhY2tjb25nOyI6IDB4MjI0YywKICAgICAgICAgICAgICAgICJiYWNrZXBzaWxvbjsiOiAweDNmNiwgImJhY2twcmltZTsiOiAweDIwMzUsCiAgICAgICAgICAgICAgICAiYmFja3NpbTsiOiAweDIyM2QsICJiYWNrc2ltZXE7IjogMHgyMmNkLAogICAgICAgICAgICAgICAgImJhcnZlZTsiOiAweDIyYmQsICJiYXJ3ZWQ7IjogMHgyMzA1LAogICAgICAgICAgICAgICAgImJhcndlZGdlOyI6IDB4MjMwNSwgImJicms7IjogMHgyM2I1LAogICAgICAgICAgICAgICAgImJicmt0YnJrOyI6IDB4MjNiNiwgImJjb25nOyI6IDB4MjI0YywKICAgICAgICAgICAgICAgICJiY3k7IjogMHg0MzEsICJiZHF1bzsiOiAweDIwMWUsCiAgICAgICAgICAgICAgICAiYmVjYXVzOyI6IDB4MjIzNSwgImJlY2F1c2U7IjogMHgyMjM1LAogICAgICAgICAgICAgICAgImJlbXB0eXY7IjogMHgyOWIwLCAiYmVwc2k7IjogMHgzZjYsCiAgICAgICAgICAgICAgICAiYmVybm91OyI6IDB4MjEyYywgImJldGE7IjogMHgzYjIsCiAgICAgICAgICAgICAgICAiYmV0aDsiOiAweDIxMzYsICJiZXR3ZWVuOyI6IDB4MjI2YywKICAgICAgICAgICAgICAgICJiZnI7IjogWzB4ZDgzNSwgMHhkZDFmXSwgImJpZ2NhcDsiOiAweDIyYzIsCiAgICAgICAgICAgICAgICAiYmlnY2lyYzsiOiAweDI1ZWYsICJiaWdjdXA7IjogMHgyMmMzLAogICAgICAgICAgICAgICAgImJpZ29kb3Q7IjogMHgyYTAwLCAiYmlnb3BsdXM7IjogMHgyYTAxLAogICAgICAgICAgICAgICAgImJpZ290aW1lczsiOiAweDJhMDIsICJiaWdzcWN1cDsiOiAweDJhMDYsCiAgICAgICAgICAgICAgICAiYmlnc3RhcjsiOiAweDI2MDUsICJiaWd0cmlhbmdsZWRvd247IjogMHgyNWJkLAogICAgICAgICAgICAgICAgImJpZ3RyaWFuZ2xldXA7IjogMHgyNWIzLCAiYmlndXBsdXM7IjogMHgyYTA0LAogICAgICAgICAgICAgICAgImJpZ3ZlZTsiOiAweDIyYzEsICJiaWd3ZWRnZTsiOiAweDIyYzAsCiAgICAgICAgICAgICAgICAiYmthcm93OyI6IDB4MjkwZCwgImJsYWNrbG96ZW5nZTsiOiAweDI5ZWIsCiAgICAgICAgICAgICAgICAiYmxhY2tzcXVhcmU7IjogMHgyNWFhLCAiYmxhY2t0cmlhbmdsZTsiOiAweDI1YjQsCiAgICAgICAgICAgICAgICAiYmxhY2t0cmlhbmdsZWRvd247IjogMHgyNWJlLCAiYmxhY2t0cmlhbmdsZWxlZnQ7IjogMHgyNWMyLAogICAgICAgICAgICAgICAgImJsYWNrdHJpYW5nbGVyaWdodDsiOiAweDI1YjgsICJibGFuazsiOiAweDI0MjMsCiAgICAgICAgICAgICAgICAiYmxrMTI7IjogMHgyNTkyLCAiYmxrMTQ7IjogMHgyNTkxLAogICAgICAgICAgICAgICAgImJsazM0OyI6IDB4MjU5MywgImJsb2NrOyI6IDB4MjU4OCwKICAgICAgICAgICAgICAgICJibmU7IjogWzB4M2QsIDB4MjBlNV0sICJibmVxdWl2OyI6IFsweDIyNjEsIDB4MjBlNV0sCiAgICAgICAgICAgICAgICAiYm5vdDsiOiAweDIzMTAsICJib3BmOyI6IFsweGQ4MzUsIDB4ZGQ1M10sCiAgICAgICAgICAgICAgICAiYm90OyI6IDB4MjJhNSwgImJvdHRvbTsiOiAweDIyYTUsCiAgICAgICAgICAgICAgICAiYm93dGllOyI6IDB4MjJjOCwgImJveERMOyI6IDB4MjU1NywKICAgICAgICAgICAgICAgICJib3hEUjsiOiAweDI1NTQsICJib3hEbDsiOiAweDI1NTYsCiAgICAgICAgICAgICAgICAiYm94RHI7IjogMHgyNTUzLCAiYm94SDsiOiAweDI1NTAsCiAgICAgICAgICAgICAgICAiYm94SEQ7IjogMHgyNTY2LCAiYm94SFU7IjogMHgyNTY5LAogICAgICAgICAgICAgICAgImJveEhkOyI6IDB4MjU2NCwgImJveEh1OyI6IDB4MjU2NywKICAgICAgICAgICAgICAgICJib3hVTDsiOiAweDI1NWQsICJib3hVUjsiOiAweDI1NWEsCiAgICAgICAgICAgICAgICAiYm94VWw7IjogMHgyNTVjLCAiYm94VXI7IjogMHgyNTU5LAogICAgICAgICAgICAgICAgImJveFY7IjogMHgyNTUxLCAiYm94Vkg7IjogMHgyNTZjLAogICAgICAgICAgICAgICAgImJveFZMOyI6IDB4MjU2MywgImJveFZSOyI6IDB4MjU2MCwKICAgICAgICAgICAgICAgICJib3hWaDsiOiAweDI1NmIsICJib3hWbDsiOiAweDI1NjIsCiAgICAgICAgICAgICAgICAiYm94VnI7IjogMHgyNTVmLCAiYm94Ym94OyI6IDB4MjljOSwKICAgICAgICAgICAgICAgICJib3hkTDsiOiAweDI1NTUsICJib3hkUjsiOiAweDI1NTIsCiAgICAgICAgICAgICAgICAiYm94ZGw7IjogMHgyNTEwLCAiYm94ZHI7IjogMHgyNTBjLAogICAgICAgICAgICAgICAgImJveGg7IjogMHgyNTAwLCAiYm94aEQ7IjogMHgyNTY1LAogICAgICAgICAgICAgICAgImJveGhVOyI6IDB4MjU2OCwgImJveGhkOyI6IDB4MjUyYywKICAgICAgICAgICAgICAgICJib3hodTsiOiAweDI1MzQsICJib3htaW51czsiOiAweDIyOWYsCiAgICAgICAgICAgICAgICAiYm94cGx1czsiOiAweDIyOWUsICJib3h0aW1lczsiOiAweDIyYTAsCiAgICAgICAgICAgICAgICAiYm94dUw7IjogMHgyNTViLCAiYm94dVI7IjogMHgyNTU4LAogICAgICAgICAgICAgICAgImJveHVsOyI6IDB4MjUxOCwgImJveHVyOyI6IDB4MjUxNCwKICAgICAgICAgICAgICAgICJib3h2OyI6IDB4MjUwMiwgImJveHZIOyI6IDB4MjU2YSwKICAgICAgICAgICAgICAgICJib3h2TDsiOiAweDI1NjEsICJib3h2UjsiOiAweDI1NWUsCiAgICAgICAgICAgICAgICAiYm94dmg7IjogMHgyNTNjLCAiYm94dmw7IjogMHgyNTI0LAogICAgICAgICAgICAgICAgImJveHZyOyI6IDB4MjUxYywgImJwcmltZTsiOiAweDIwMzUsCiAgICAgICAgICAgICAgICAiYnJldmU7IjogMHgyZDgsICJicnZiYXI7IjogMHhhNiwKICAgICAgICAgICAgICAgICJic2NyOyI6IFsweGQ4MzUsIDB4ZGNiN10sICJic2VtaTsiOiAweDIwNGYsCiAgICAgICAgICAgICAgICAiYnNpbTsiOiAweDIyM2QsICJic2ltZTsiOiAweDIyY2QsCiAgICAgICAgICAgICAgICAiYnNvbDsiOiAweDVjLCAiYnNvbGI7IjogMHgyOWM1LAogICAgICAgICAgICAgICAgImJzb2xoc3ViOyI6IDB4MjdjOCwgImJ1bGw7IjogMHgyMDIyLAogICAgICAgICAgICAgICAgImJ1bGxldDsiOiAweDIwMjIsICJidW1wOyI6IDB4MjI0ZSwKICAgICAgICAgICAgICAgICJidW1wRTsiOiAweDJhYWUsICJidW1wZTsiOiAweDIyNGYsCiAgICAgICAgICAgICAgICAiYnVtcGVxOyI6IDB4MjI0ZiwgImNhY3V0ZTsiOiAweDEwNywKICAgICAgICAgICAgICAgICJjYXA7IjogMHgyMjI5LCAiY2FwYW5kOyI6IDB4MmE0NCwKICAgICAgICAgICAgICAgICJjYXBicmN1cDsiOiAweDJhNDksICJjYXBjYXA7IjogMHgyYTRiLAogICAgICAgICAgICAgICAgImNhcGN1cDsiOiAweDJhNDcsICJjYXBkb3Q7IjogMHgyYTQwLAogICAgICAgICAgICAgICAgImNhcHM7IjogWzB4MjIyOSwgMHhmZTAwXSwgImNhcmV0OyI6IDB4MjA0MSwKICAgICAgICAgICAgICAgICJjYXJvbjsiOiAweDJjNywgImNjYXBzOyI6IDB4MmE0ZCwKICAgICAgICAgICAgICAgICJjY2Fyb247IjogMHgxMGQsICJjY2VkaWw7IjogMHhlNywKICAgICAgICAgICAgICAgICJjY2lyYzsiOiAweDEwOSwgImNjdXBzOyI6IDB4MmE0YywKICAgICAgICAgICAgICAgICJjY3Vwc3NtOyI6IDB4MmE1MCwgImNkb3Q7IjogMHgxMGIsCiAgICAgICAgICAgICAgICAiY2VkaWw7IjogMHhiOCwgImNlbXB0eXY7IjogMHgyOWIyLAogICAgICAgICAgICAgICAgImNlbnQ7IjogMHhhMiwgImNlbnRlcmRvdDsiOiAweGI3LAogICAgICAgICAgICAgICAgImNmcjsiOiBbMHhkODM1LCAweGRkMjBdLCAiY2hjeTsiOiAweDQ0NywKICAgICAgICAgICAgICAgICJjaGVjazsiOiAweDI3MTMsICJjaGVja21hcms7IjogMHgyNzEzLAogICAgICAgICAgICAgICAgImNoaTsiOiAweDNjNywgImNpcjsiOiAweDI1Y2IsCiAgICAgICAgICAgICAgICAiY2lyRTsiOiAweDI5YzMsICJjaXJjOyI6IDB4MmM2LAogICAgICAgICAgICAgICAgImNpcmNlcTsiOiAweDIyNTcsICJjaXJjbGVhcnJvd2xlZnQ7IjogMHgyMWJhLAogICAgICAgICAgICAgICAgImNpcmNsZWFycm93cmlnaHQ7IjogMHgyMWJiLCAiY2lyY2xlZFI7IjogMHhhZSwKICAgICAgICAgICAgICAgICJjaXJjbGVkUzsiOiAweDI0YzgsICJjaXJjbGVkYXN0OyI6IDB4MjI5YiwKICAgICAgICAgICAgICAgICJjaXJjbGVkY2lyYzsiOiAweDIyOWEsICJjaXJjbGVkZGFzaDsiOiAweDIyOWQsCiAgICAgICAgICAgICAgICAiY2lyZTsiOiAweDIyNTcsICJjaXJmbmludDsiOiAweDJhMTAsCiAgICAgICAgICAgICAgICAiY2lybWlkOyI6IDB4MmFlZiwgImNpcnNjaXI7IjogMHgyOWMyLAogICAgICAgICAgICAgICAgImNsdWJzOyI6IDB4MjY2MywgImNsdWJzdWl0OyI6IDB4MjY2MywKICAgICAgICAgICAgICAgICJjb2xvbjsiOiAweDNhLCAiY29sb25lOyI6IDB4MjI1NCwKICAgICAgICAgICAgICAgICJjb2xvbmVxOyI6IDB4MjI1NCwgImNvbW1hOyI6IDB4MmMsCiAgICAgICAgICAgICAgICAiY29tbWF0OyI6IDB4NDAsICJjb21wOyI6IDB4MjIwMSwKICAgICAgICAgICAgICAgICJjb21wZm47IjogMHgyMjE4LCAiY29tcGxlbWVudDsiOiAweDIyMDEsCiAgICAgICAgICAgICAgICAiY29tcGxleGVzOyI6IDB4MjEwMiwgImNvbmc7IjogMHgyMjQ1LAogICAgICAgICAgICAgICAgImNvbmdkb3Q7IjogMHgyYTZkLCAiY29uaW50OyI6IDB4MjIyZSwKICAgICAgICAgICAgICAgICJjb3BmOyI6IFsweGQ4MzUsIDB4ZGQ1NF0sICJjb3Byb2Q7IjogMHgyMjEwLAogICAgICAgICAgICAgICAgImNvcHk7IjogMHhhOSwgImNvcHlzcjsiOiAweDIxMTcsCiAgICAgICAgICAgICAgICAiY3JhcnI7IjogMHgyMWI1LCAiY3Jvc3M7IjogMHgyNzE3LAogICAgICAgICAgICAgICAgImNzY3I7IjogWzB4ZDgzNSwgMHhkY2I4XSwgImNzdWI7IjogMHgyYWNmLAogICAgICAgICAgICAgICAgImNzdWJlOyI6IDB4MmFkMSwgImNzdXA7IjogMHgyYWQwLAogICAgICAgICAgICAgICAgImNzdXBlOyI6IDB4MmFkMiwgImN0ZG90OyI6IDB4MjJlZiwKICAgICAgICAgICAgICAgICJjdWRhcnJsOyI6IDB4MjkzOCwgImN1ZGFycnI7IjogMHgyOTM1LAogICAgICAgICAgICAgICAgImN1ZXByOyI6IDB4MjJkZSwgImN1ZXNjOyI6IDB4MjJkZiwKICAgICAgICAgICAgICAgICJjdWxhcnI7IjogMHgyMWI2LCAiY3VsYXJycDsiOiAweDI5M2QsCiAgICAgICAgICAgICAgICAiY3VwOyI6IDB4MjIyYSwgImN1cGJyY2FwOyI6IDB4MmE0OCwKICAgICAgICAgICAgICAgICJjdXBjYXA7IjogMHgyYTQ2LCAiY3VwY3VwOyI6IDB4MmE0YSwKICAgICAgICAgICAgICAgICJjdXBkb3Q7IjogMHgyMjhkLCAiY3Vwb3I7IjogMHgyYTQ1LAogICAgICAgICAgICAgICAgImN1cHM7IjogWzB4MjIyYSwgMHhmZTAwXSwgImN1cmFycjsiOiAweDIxYjcsCiAgICAgICAgICAgICAgICAiY3VyYXJybTsiOiAweDI5M2MsICJjdXJseWVxcHJlYzsiOiAweDIyZGUsCiAgICAgICAgICAgICAgICAiY3VybHllcXN1Y2M7IjogMHgyMmRmLCAiY3VybHl2ZWU7IjogMHgyMmNlLAogICAgICAgICAgICAgICAgImN1cmx5d2VkZ2U7IjogMHgyMmNmLCAiY3VycmVuOyI6IDB4YTQsCiAgICAgICAgICAgICAgICAiY3VydmVhcnJvd2xlZnQ7IjogMHgyMWI2LCAiY3VydmVhcnJvd3JpZ2h0OyI6IDB4MjFiNywKICAgICAgICAgICAgICAgICJjdXZlZTsiOiAweDIyY2UsICJjdXdlZDsiOiAweDIyY2YsCiAgICAgICAgICAgICAgICAiY3djb25pbnQ7IjogMHgyMjMyLCAiY3dpbnQ7IjogMHgyMjMxLAogICAgICAgICAgICAgICAgImN5bGN0eTsiOiAweDIzMmQsICJkQXJyOyI6IDB4MjFkMywKICAgICAgICAgICAgICAgICJkSGFyOyI6IDB4Mjk2NSwgImRhZ2dlcjsiOiAweDIwMjAsCiAgICAgICAgICAgICAgICAiZGFsZXRoOyI6IDB4MjEzOCwgImRhcnI7IjogMHgyMTkzLAogICAgICAgICAgICAgICAgImRhc2g7IjogMHgyMDEwLCAiZGFzaHY7IjogMHgyMmEzLAogICAgICAgICAgICAgICAgImRia2Fyb3c7IjogMHgyOTBmLCAiZGJsYWM7IjogMHgyZGQsCiAgICAgICAgICAgICAgICAiZGNhcm9uOyI6IDB4MTBmLCAiZGN5OyI6IDB4NDM0LAogICAgICAgICAgICAgICAgImRkOyI6IDB4MjE0NiwgImRkYWdnZXI7IjogMHgyMDIxLAogICAgICAgICAgICAgICAgImRkYXJyOyI6IDB4MjFjYSwgImRkb3RzZXE7IjogMHgyYTc3LAogICAgICAgICAgICAgICAgImRlZzsiOiAweGIwLCAiZGVsdGE7IjogMHgzYjQsCiAgICAgICAgICAgICAgICAiZGVtcHR5djsiOiAweDI5YjEsICJkZmlzaHQ7IjogMHgyOTdmLAogICAgICAgICAgICAgICAgImRmcjsiOiBbMHhkODM1LCAweGRkMjFdLCAiZGhhcmw7IjogMHgyMWMzLAogICAgICAgICAgICAgICAgImRoYXJyOyI6IDB4MjFjMiwgImRpYW07IjogMHgyMmM0LAogICAgICAgICAgICAgICAgImRpYW1vbmQ7IjogMHgyMmM0LCAiZGlhbW9uZHN1aXQ7IjogMHgyNjY2LAogICAgICAgICAgICAgICAgImRpYW1zOyI6IDB4MjY2NiwgImRpZTsiOiAweGE4LAogICAgICAgICAgICAgICAgImRpZ2FtbWE7IjogMHgzZGQsICJkaXNpbjsiOiAweDIyZjIsCiAgICAgICAgICAgICAgICAiZGl2OyI6IDB4ZjcsICJkaXZpZGU7IjogMHhmNywKICAgICAgICAgICAgICAgICJkaXZpZGVvbnRpbWVzOyI6IDB4MjJjNywgImRpdm9ueDsiOiAweDIyYzcsCiAgICAgICAgICAgICAgICAiZGpjeTsiOiAweDQ1MiwgImRsY29ybjsiOiAweDIzMWUsCiAgICAgICAgICAgICAgICAiZGxjcm9wOyI6IDB4MjMwZCwgImRvbGxhcjsiOiAweDI0LAogICAgICAgICAgICAgICAgImRvcGY7IjogWzB4ZDgzNSwgMHhkZDU1XSwgImRvdDsiOiAweDJkOSwKICAgICAgICAgICAgICAgICJkb3RlcTsiOiAweDIyNTAsICJkb3RlcWRvdDsiOiAweDIyNTEsCiAgICAgICAgICAgICAgICAiZG90bWludXM7IjogMHgyMjM4LCAiZG90cGx1czsiOiAweDIyMTQsCiAgICAgICAgICAgICAgICAiZG90c3F1YXJlOyI6IDB4MjJhMSwgImRvdWJsZWJhcndlZGdlOyI6IDB4MjMwNiwKICAgICAgICAgICAgICAgICJkb3duYXJyb3c7IjogMHgyMTkzLCAiZG93bmRvd25hcnJvd3M7IjogMHgyMWNhLAogICAgICAgICAgICAgICAgImRvd25oYXJwb29ubGVmdDsiOiAweDIxYzMsICJkb3duaGFycG9vbnJpZ2h0OyI6IDB4MjFjMiwKICAgICAgICAgICAgICAgICJkcmJrYXJvdzsiOiAweDI5MTAsICJkcmNvcm47IjogMHgyMzFmLAogICAgICAgICAgICAgICAgImRyY3JvcDsiOiAweDIzMGMsICJkc2NyOyI6IFsweGQ4MzUsIDB4ZGNiOV0sCiAgICAgICAgICAgICAgICAiZHNjeTsiOiAweDQ1NSwgImRzb2w7IjogMHgyOWY2LAogICAgICAgICAgICAgICAgImRzdHJvazsiOiAweDExMSwgImR0ZG90OyI6IDB4MjJmMSwKICAgICAgICAgICAgICAgICJkdHJpOyI6IDB4MjViZiwgImR0cmlmOyI6IDB4MjViZSwKICAgICAgICAgICAgICAgICJkdWFycjsiOiAweDIxZjUsICJkdWhhcjsiOiAweDI5NmYsCiAgICAgICAgICAgICAgICAiZHdhbmdsZTsiOiAweDI5YTYsICJkemN5OyI6IDB4NDVmLAogICAgICAgICAgICAgICAgImR6aWdyYXJyOyI6IDB4MjdmZiwgImVERG90OyI6IDB4MmE3NywKICAgICAgICAgICAgICAgICJlRG90OyI6IDB4MjI1MSwgImVhY3V0ZTsiOiAweGU5LAogICAgICAgICAgICAgICAgImVhc3RlcjsiOiAweDJhNmUsICJlY2Fyb247IjogMHgxMWIsCiAgICAgICAgICAgICAgICAiZWNpcjsiOiAweDIyNTYsICJlY2lyYzsiOiAweGVhLAogICAgICAgICAgICAgICAgImVjb2xvbjsiOiAweDIyNTUsICJlY3k7IjogMHg0NGQsCiAgICAgICAgICAgICAgICAiZWRvdDsiOiAweDExNywgImVlOyI6IDB4MjE0NywKICAgICAgICAgICAgICAgICJlZkRvdDsiOiAweDIyNTIsICJlZnI7IjogWzB4ZDgzNSwgMHhkZDIyXSwKICAgICAgICAgICAgICAgICJlZzsiOiAweDJhOWEsICJlZ3JhdmU7IjogMHhlOCwKICAgICAgICAgICAgICAgICJlZ3M7IjogMHgyYTk2LCAiZWdzZG90OyI6IDB4MmE5OCwKICAgICAgICAgICAgICAgICJlbDsiOiAweDJhOTksICJlbGludGVyczsiOiAweDIzZTcsCiAgICAgICAgICAgICAgICAiZWxsOyI6IDB4MjExMywgImVsczsiOiAweDJhOTUsCiAgICAgICAgICAgICAgICAiZWxzZG90OyI6IDB4MmE5NywgImVtYWNyOyI6IDB4MTEzLAogICAgICAgICAgICAgICAgImVtcHR5OyI6IDB4MjIwNSwgImVtcHR5c2V0OyI6IDB4MjIwNSwKICAgICAgICAgICAgICAgICJlbXB0eXY7IjogMHgyMjA1LCAiZW1zcDsiOiAweDIwMDMsCiAgICAgICAgICAgICAgICAiZW1zcDEzOyI6IDB4MjAwNCwgImVtc3AxNDsiOiAweDIwMDUsCiAgICAgICAgICAgICAgICAiZW5nOyI6IDB4MTRiLCAiZW5zcDsiOiAweDIwMDIsCiAgICAgICAgICAgICAgICAiZW9nb247IjogMHgxMTksICJlb3BmOyI6IFsweGQ4MzUsIDB4ZGQ1Nl0sCiAgICAgICAgICAgICAgICAiZXBhcjsiOiAweDIyZDUsICJlcGFyc2w7IjogMHgyOWUzLAogICAgICAgICAgICAgICAgImVwbHVzOyI6IDB4MmE3MSwgImVwc2k7IjogMHgzYjUsCiAgICAgICAgICAgICAgICAiZXBzaWxvbjsiOiAweDNiNSwgImVwc2l2OyI6IDB4M2Y1LAogICAgICAgICAgICAgICAgImVxY2lyYzsiOiAweDIyNTYsICJlcWNvbG9uOyI6IDB4MjI1NSwKICAgICAgICAgICAgICAgICJlcXNpbTsiOiAweDIyNDIsICJlcXNsYW50Z3RyOyI6IDB4MmE5NiwKICAgICAgICAgICAgICAgICJlcXNsYW50bGVzczsiOiAweDJhOTUsICJlcXVhbHM7IjogMHgzZCwKICAgICAgICAgICAgICAgICJlcXVlc3Q7IjogMHgyMjVmLCAiZXF1aXY7IjogMHgyMjYxLAogICAgICAgICAgICAgICAgImVxdWl2REQ7IjogMHgyYTc4LCAiZXF2cGFyc2w7IjogMHgyOWU1LAogICAgICAgICAgICAgICAgImVyRG90OyI6IDB4MjI1MywgImVyYXJyOyI6IDB4Mjk3MSwKICAgICAgICAgICAgICAgICJlc2NyOyI6IDB4MjEyZiwgImVzZG90OyI6IDB4MjI1MCwKICAgICAgICAgICAgICAgICJlc2ltOyI6IDB4MjI0MiwgImV0YTsiOiAweDNiNywKICAgICAgICAgICAgICAgICJldGg7IjogMHhmMCwgImV1bWw7IjogMHhlYiwKICAgICAgICAgICAgICAgICJldXJvOyI6IDB4MjBhYywgImV4Y2w7IjogMHgyMSwKICAgICAgICAgICAgICAgICJleGlzdDsiOiAweDIyMDMsICJleHBlY3RhdGlvbjsiOiAweDIxMzAsCiAgICAgICAgICAgICAgICAiZXhwb25lbnRpYWxlOyI6IDB4MjE0NywgImZhbGxpbmdkb3RzZXE7IjogMHgyMjUyLAogICAgICAgICAgICAgICAgImZjeTsiOiAweDQ0NCwgImZlbWFsZTsiOiAweDI2NDAsCiAgICAgICAgICAgICAgICAiZmZpbGlnOyI6IDB4ZmIwMywgImZmbGlnOyI6IDB4ZmIwMCwKICAgICAgICAgICAgICAgICJmZmxsaWc7IjogMHhmYjA0LCAiZmZyOyI6IFsweGQ4MzUsIDB4ZGQyM10sCiAgICAgICAgICAgICAgICAiZmlsaWc7IjogMHhmYjAxLCAiZmpsaWc7IjogWzB4NjYsIDB4NmFdLAogICAgICAgICAgICAgICAgImZsYXQ7IjogMHgyNjZkLCAiZmxsaWc7IjogMHhmYjAyLAogICAgICAgICAgICAgICAgImZsdG5zOyI6IDB4MjViMSwgImZub2Y7IjogMHgxOTIsCiAgICAgICAgICAgICAgICAiZm9wZjsiOiBbMHhkODM1LCAweGRkNTddLCAiZm9yYWxsOyI6IDB4MjIwMCwKICAgICAgICAgICAgICAgICJmb3JrOyI6IDB4MjJkNCwgImZvcmt2OyI6IDB4MmFkOSwKICAgICAgICAgICAgICAgICJmcGFydGludDsiOiAweDJhMGQsICJmcmFjMTI7IjogMHhiZCwKICAgICAgICAgICAgICAgICJmcmFjMTM7IjogMHgyMTUzLCAiZnJhYzE0OyI6IDB4YmMsCiAgICAgICAgICAgICAgICAiZnJhYzE1OyI6IDB4MjE1NSwgImZyYWMxNjsiOiAweDIxNTksCiAgICAgICAgICAgICAgICAiZnJhYzE4OyI6IDB4MjE1YiwgImZyYWMyMzsiOiAweDIxNTQsCiAgICAgICAgICAgICAgICAiZnJhYzI1OyI6IDB4MjE1NiwgImZyYWMzNDsiOiAweGJlLAogICAgICAgICAgICAgICAgImZyYWMzNTsiOiAweDIxNTcsICJmcmFjMzg7IjogMHgyMTVjLAogICAgICAgICAgICAgICAgImZyYWM0NTsiOiAweDIxNTgsICJmcmFjNTY7IjogMHgyMTVhLAogICAgICAgICAgICAgICAgImZyYWM1ODsiOiAweDIxNWQsICJmcmFjNzg7IjogMHgyMTVlLAogICAgICAgICAgICAgICAgImZyYXNsOyI6IDB4MjA0NCwgImZyb3duOyI6IDB4MjMyMiwKICAgICAgICAgICAgICAgICJmc2NyOyI6IFsweGQ4MzUsIDB4ZGNiYl0sICJnRTsiOiAweDIyNjcsCiAgICAgICAgICAgICAgICAiZ0VsOyI6IDB4MmE4YywgImdhY3V0ZTsiOiAweDFmNSwKICAgICAgICAgICAgICAgICJnYW1tYTsiOiAweDNiMywgImdhbW1hZDsiOiAweDNkZCwKICAgICAgICAgICAgICAgICJnYXA7IjogMHgyYTg2LCAiZ2JyZXZlOyI6IDB4MTFmLAogICAgICAgICAgICAgICAgImdjaXJjOyI6IDB4MTFkLCAiZ2N5OyI6IDB4NDMzLAogICAgICAgICAgICAgICAgImdkb3Q7IjogMHgxMjEsICJnZTsiOiAweDIyNjUsCiAgICAgICAgICAgICAgICAiZ2VsOyI6IDB4MjJkYiwgImdlcTsiOiAweDIyNjUsCiAgICAgICAgICAgICAgICAiZ2VxcTsiOiAweDIyNjcsICJnZXFzbGFudDsiOiAweDJhN2UsCiAgICAgICAgICAgICAgICAiZ2VzOyI6IDB4MmE3ZSwgImdlc2NjOyI6IDB4MmFhOSwKICAgICAgICAgICAgICAgICJnZXNkb3Q7IjogMHgyYTgwLCAiZ2VzZG90bzsiOiAweDJhODIsCiAgICAgICAgICAgICAgICAiZ2VzZG90b2w7IjogMHgyYTg0LCAiZ2VzbDsiOiBbMHgyMmRiLCAweGZlMDBdLAogICAgICAgICAgICAgICAgImdlc2xlczsiOiAweDJhOTQsICJnZnI7IjogWzB4ZDgzNSwgMHhkZDI0XSwKICAgICAgICAgICAgICAgICJnZzsiOiAweDIyNmIsICJnZ2c7IjogMHgyMmQ5LAogICAgICAgICAgICAgICAgImdpbWVsOyI6IDB4MjEzNywgImdqY3k7IjogMHg0NTMsCiAgICAgICAgICAgICAgICAiZ2w7IjogMHgyMjc3LCAiZ2xFOyI6IDB4MmE5MiwKICAgICAgICAgICAgICAgICJnbGE7IjogMHgyYWE1LCAiZ2xqOyI6IDB4MmFhNCwKICAgICAgICAgICAgICAgICJnbkU7IjogMHgyMjY5LCAiZ25hcDsiOiAweDJhOGEsCiAgICAgICAgICAgICAgICAiZ25hcHByb3g7IjogMHgyYThhLCAiZ25lOyI6IDB4MmE4OCwKICAgICAgICAgICAgICAgICJnbmVxOyI6IDB4MmE4OCwgImduZXFxOyI6IDB4MjI2OSwKICAgICAgICAgICAgICAgICJnbnNpbTsiOiAweDIyZTcsICJnb3BmOyI6IFsweGQ4MzUsIDB4ZGQ1OF0sCiAgICAgICAgICAgICAgICAiZ3JhdmU7IjogMHg2MCwgImdzY3I7IjogMHgyMTBhLAogICAgICAgICAgICAgICAgImdzaW07IjogMHgyMjczLCAiZ3NpbWU7IjogMHgyYThlLAogICAgICAgICAgICAgICAgImdzaW1sOyI6IDB4MmE5MCwgImd0OyI6IDB4M2UsCiAgICAgICAgICAgICAgICAiZ3RjYzsiOiAweDJhYTcsICJndGNpcjsiOiAweDJhN2EsCiAgICAgICAgICAgICAgICAiZ3Rkb3Q7IjogMHgyMmQ3LCAiZ3RsUGFyOyI6IDB4Mjk5NSwKICAgICAgICAgICAgICAgICJndHF1ZXN0OyI6IDB4MmE3YywgImd0cmFwcHJveDsiOiAweDJhODYsCiAgICAgICAgICAgICAgICAiZ3RyYXJyOyI6IDB4Mjk3OCwgImd0cmRvdDsiOiAweDIyZDcsCiAgICAgICAgICAgICAgICAiZ3RyZXFsZXNzOyI6IDB4MjJkYiwgImd0cmVxcWxlc3M7IjogMHgyYThjLAogICAgICAgICAgICAgICAgImd0cmxlc3M7IjogMHgyMjc3LCAiZ3Ryc2ltOyI6IDB4MjI3MywKICAgICAgICAgICAgICAgICJndmVydG5lcXE7IjogWzB4MjI2OSwgMHhmZTAwXSwgImd2bkU7IjogWzB4MjI2OSwgMHhmZTAwXSwKICAgICAgICAgICAgICAgICJoQXJyOyI6IDB4MjFkNCwgImhhaXJzcDsiOiAweDIwMGEsCiAgICAgICAgICAgICAgICAiaGFsZjsiOiAweGJkLCAiaGFtaWx0OyI6IDB4MjEwYiwKICAgICAgICAgICAgICAgICJoYXJkY3k7IjogMHg0NGEsICJoYXJyOyI6IDB4MjE5NCwKICAgICAgICAgICAgICAgICJoYXJyY2lyOyI6IDB4Mjk0OCwgImhhcnJ3OyI6IDB4MjFhZCwKICAgICAgICAgICAgICAgICJoYmFyOyI6IDB4MjEwZiwgImhjaXJjOyI6IDB4MTI1LAogICAgICAgICAgICAgICAgImhlYXJ0czsiOiAweDI2NjUsICJoZWFydHN1aXQ7IjogMHgyNjY1LAogICAgICAgICAgICAgICAgImhlbGxpcDsiOiAweDIwMjYsICJoZXJjb247IjogMHgyMmI5LAogICAgICAgICAgICAgICAgImhmcjsiOiBbMHhkODM1LCAweGRkMjVdLCAiaGtzZWFyb3c7IjogMHgyOTI1LAogICAgICAgICAgICAgICAgImhrc3dhcm93OyI6IDB4MjkyNiwgImhvYXJyOyI6IDB4MjFmZiwKICAgICAgICAgICAgICAgICJob210aHQ7IjogMHgyMjNiLCAiaG9va2xlZnRhcnJvdzsiOiAweDIxYTksCiAgICAgICAgICAgICAgICAiaG9va3JpZ2h0YXJyb3c7IjogMHgyMWFhLCAiaG9wZjsiOiBbMHhkODM1LCAweGRkNTldLAogICAgICAgICAgICAgICAgImhvcmJhcjsiOiAweDIwMTUsICJoc2NyOyI6IFsweGQ4MzUsIDB4ZGNiZF0sCiAgICAgICAgICAgICAgICAiaHNsYXNoOyI6IDB4MjEwZiwgImhzdHJvazsiOiAweDEyNywKICAgICAgICAgICAgICAgICJoeWJ1bGw7IjogMHgyMDQzLCAiaHlwaGVuOyI6IDB4MjAxMCwKICAgICAgICAgICAgICAgICJpYWN1dGU7IjogMHhlZCwgImljOyI6IDB4MjA2MywKICAgICAgICAgICAgICAgICJpY2lyYzsiOiAweGVlLCAiaWN5OyI6IDB4NDM4LAogICAgICAgICAgICAgICAgImllY3k7IjogMHg0MzUsICJpZXhjbDsiOiAweGExLAogICAgICAgICAgICAgICAgImlmZjsiOiAweDIxZDQsICJpZnI7IjogWzB4ZDgzNSwgMHhkZDI2XSwKICAgICAgICAgICAgICAgICJpZ3JhdmU7IjogMHhlYywgImlpOyI6IDB4MjE0OCwKICAgICAgICAgICAgICAgICJpaWlpbnQ7IjogMHgyYTBjLCAiaWlpbnQ7IjogMHgyMjJkLAogICAgICAgICAgICAgICAgImlpbmZpbjsiOiAweDI5ZGMsICJpaW90YTsiOiAweDIxMjksCiAgICAgICAgICAgICAgICAiaWpsaWc7IjogMHgxMzMsICJpbWFjcjsiOiAweDEyYiwKICAgICAgICAgICAgICAgICJpbWFnZTsiOiAweDIxMTEsICJpbWFnbGluZTsiOiAweDIxMTAsCiAgICAgICAgICAgICAgICAiaW1hZ3BhcnQ7IjogMHgyMTExLCAiaW1hdGg7IjogMHgxMzEsCiAgICAgICAgICAgICAgICAiaW1vZjsiOiAweDIyYjcsICJpbXBlZDsiOiAweDFiNSwKICAgICAgICAgICAgICAgICJpbjsiOiAweDIyMDgsICJpbmNhcmU7IjogMHgyMTA1LAogICAgICAgICAgICAgICAgImluZmluOyI6IDB4MjIxZSwgImluZmludGllOyI6IDB4MjlkZCwKICAgICAgICAgICAgICAgICJpbm9kb3Q7IjogMHgxMzEsICJpbnQ7IjogMHgyMjJiLAogICAgICAgICAgICAgICAgImludGNhbDsiOiAweDIyYmEsICJpbnRlZ2VyczsiOiAweDIxMjQsCiAgICAgICAgICAgICAgICAiaW50ZXJjYWw7IjogMHgyMmJhLCAiaW50bGFyaGs7IjogMHgyYTE3LAogICAgICAgICAgICAgICAgImludHByb2Q7IjogMHgyYTNjLCAiaW9jeTsiOiAweDQ1MSwKICAgICAgICAgICAgICAgICJpb2dvbjsiOiAweDEyZiwgImlvcGY7IjogWzB4ZDgzNSwgMHhkZDVhXSwKICAgICAgICAgICAgICAgICJpb3RhOyI6IDB4M2I5LCAiaXByb2Q7IjogMHgyYTNjLAogICAgICAgICAgICAgICAgImlxdWVzdDsiOiAweGJmLCAiaXNjcjsiOiBbMHhkODM1LCAweGRjYmVdLAogICAgICAgICAgICAgICAgImlzaW47IjogMHgyMjA4LCAiaXNpbkU7IjogMHgyMmY5LAogICAgICAgICAgICAgICAgImlzaW5kb3Q7IjogMHgyMmY1LCAiaXNpbnM7IjogMHgyMmY0LAogICAgICAgICAgICAgICAgImlzaW5zdjsiOiAweDIyZjMsICJpc2ludjsiOiAweDIyMDgsCiAgICAgICAgICAgICAgICAiaXQ7IjogMHgyMDYyLCAiaXRpbGRlOyI6IDB4MTI5LAogICAgICAgICAgICAgICAgIml1a2N5OyI6IDB4NDU2LCAiaXVtbDsiOiAweGVmLAogICAgICAgICAgICAgICAgImpjaXJjOyI6IDB4MTM1LCAiamN5OyI6IDB4NDM5LAogICAgICAgICAgICAgICAgImpmcjsiOiBbMHhkODM1LCAweGRkMjddLCAiam1hdGg7IjogMHgyMzcsCiAgICAgICAgICAgICAgICAiam9wZjsiOiBbMHhkODM1LCAweGRkNWJdLCAianNjcjsiOiBbMHhkODM1LCAweGRjYmZdLAogICAgICAgICAgICAgICAgImpzZXJjeTsiOiAweDQ1OCwgImp1a2N5OyI6IDB4NDU0LAogICAgICAgICAgICAgICAgImthcHBhOyI6IDB4M2JhLCAia2FwcGF2OyI6IDB4M2YwLAogICAgICAgICAgICAgICAgImtjZWRpbDsiOiAweDEzNywgImtjeTsiOiAweDQzYSwKICAgICAgICAgICAgICAgICJrZnI7IjogWzB4ZDgzNSwgMHhkZDI4XSwgImtncmVlbjsiOiAweDEzOCwKICAgICAgICAgICAgICAgICJraGN5OyI6IDB4NDQ1LCAia2pjeTsiOiAweDQ1YywKICAgICAgICAgICAgICAgICJrb3BmOyI6IFsweGQ4MzUsIDB4ZGQ1Y10sICJrc2NyOyI6IFsweGQ4MzUsIDB4ZGNjMF0sCiAgICAgICAgICAgICAgICAibEFhcnI7IjogMHgyMWRhLCAibEFycjsiOiAweDIxZDAsCiAgICAgICAgICAgICAgICAibEF0YWlsOyI6IDB4MjkxYiwgImxCYXJyOyI6IDB4MjkwZSwKICAgICAgICAgICAgICAgICJsRTsiOiAweDIyNjYsICJsRWc7IjogMHgyYThiLAogICAgICAgICAgICAgICAgImxIYXI7IjogMHgyOTYyLCAibGFjdXRlOyI6IDB4MTNhLAogICAgICAgICAgICAgICAgImxhZW1wdHl2OyI6IDB4MjliNCwgImxhZ3JhbjsiOiAweDIxMTIsCiAgICAgICAgICAgICAgICAibGFtYmRhOyI6IDB4M2JiLCAibGFuZzsiOiAweDI3ZTgsCiAgICAgICAgICAgICAgICAibGFuZ2Q7IjogMHgyOTkxLCAibGFuZ2xlOyI6IDB4MjdlOCwKICAgICAgICAgICAgICAgICJsYXA7IjogMHgyYTg1LCAibGFxdW87IjogMHhhYiwKICAgICAgICAgICAgICAgICJsYXJyOyI6IDB4MjE5MCwgImxhcnJiOyI6IDB4MjFlNCwKICAgICAgICAgICAgICAgICJsYXJyYmZzOyI6IDB4MjkxZiwgImxhcnJmczsiOiAweDI5MWQsCiAgICAgICAgICAgICAgICAibGFycmhrOyI6IDB4MjFhOSwgImxhcnJscDsiOiAweDIxYWIsCiAgICAgICAgICAgICAgICAibGFycnBsOyI6IDB4MjkzOSwgImxhcnJzaW07IjogMHgyOTczLAogICAgICAgICAgICAgICAgImxhcnJ0bDsiOiAweDIxYTIsICJsYXQ7IjogMHgyYWFiLAogICAgICAgICAgICAgICAgImxhdGFpbDsiOiAweDI5MTksICJsYXRlOyI6IDB4MmFhZCwKICAgICAgICAgICAgICAgICJsYXRlczsiOiBbMHgyYWFkLCAweGZlMDBdLCAibGJhcnI7IjogMHgyOTBjLAogICAgICAgICAgICAgICAgImxiYnJrOyI6IDB4Mjc3MiwgImxicmFjZTsiOiAweDdiLAogICAgICAgICAgICAgICAgImxicmFjazsiOiAweDViLCAibGJya2U7IjogMHgyOThiLAogICAgICAgICAgICAgICAgImxicmtzbGQ7IjogMHgyOThmLCAibGJya3NsdTsiOiAweDI5OGQsCiAgICAgICAgICAgICAgICAibGNhcm9uOyI6IDB4MTNlLCAibGNlZGlsOyI6IDB4MTNjLAogICAgICAgICAgICAgICAgImxjZWlsOyI6IDB4MjMwOCwgImxjdWI7IjogMHg3YiwKICAgICAgICAgICAgICAgICJsY3k7IjogMHg0M2IsICJsZGNhOyI6IDB4MjkzNiwKICAgICAgICAgICAgICAgICJsZHF1bzsiOiAweDIwMWMsICJsZHF1b3I7IjogMHgyMDFlLAogICAgICAgICAgICAgICAgImxkcmRoYXI7IjogMHgyOTY3LCAibGRydXNoYXI7IjogMHgyOTRiLAogICAgICAgICAgICAgICAgImxkc2g7IjogMHgyMWIyLCAibGU7IjogMHgyMjY0LAogICAgICAgICAgICAgICAgImxlZnRhcnJvdzsiOiAweDIxOTAsICJsZWZ0YXJyb3d0YWlsOyI6IDB4MjFhMiwKICAgICAgICAgICAgICAgICJsZWZ0aGFycG9vbmRvd247IjogMHgyMWJkLCAibGVmdGhhcnBvb251cDsiOiAweDIxYmMsCiAgICAgICAgICAgICAgICAibGVmdGxlZnRhcnJvd3M7IjogMHgyMWM3LCAibGVmdHJpZ2h0YXJyb3c7IjogMHgyMTk0LAogICAgICAgICAgICAgICAgImxlZnRyaWdodGFycm93czsiOiAweDIxYzYsICJsZWZ0cmlnaHRoYXJwb29uczsiOiAweDIxY2IsCiAgICAgICAgICAgICAgICAibGVmdHJpZ2h0c3F1aWdhcnJvdzsiOiAweDIxYWQsICJsZWZ0dGhyZWV0aW1lczsiOiAweDIyY2IsCiAgICAgICAgICAgICAgICAibGVnOyI6IDB4MjJkYSwgImxlcTsiOiAweDIyNjQsCiAgICAgICAgICAgICAgICAibGVxcTsiOiAweDIyNjYsICJsZXFzbGFudDsiOiAweDJhN2QsCiAgICAgICAgICAgICAgICAibGVzOyI6IDB4MmE3ZCwgImxlc2NjOyI6IDB4MmFhOCwKICAgICAgICAgICAgICAgICJsZXNkb3Q7IjogMHgyYTdmLCAibGVzZG90bzsiOiAweDJhODEsCiAgICAgICAgICAgICAgICAibGVzZG90b3I7IjogMHgyYTgzLCAibGVzZzsiOiBbMHgyMmRhLCAweGZlMDBdLAogICAgICAgICAgICAgICAgImxlc2dlczsiOiAweDJhOTMsICJsZXNzYXBwcm94OyI6IDB4MmE4NSwKICAgICAgICAgICAgICAgICJsZXNzZG90OyI6IDB4MjJkNiwgImxlc3NlcWd0cjsiOiAweDIyZGEsCiAgICAgICAgICAgICAgICAibGVzc2VxcWd0cjsiOiAweDJhOGIsICJsZXNzZ3RyOyI6IDB4MjI3NiwKICAgICAgICAgICAgICAgICJsZXNzc2ltOyI6IDB4MjI3MiwgImxmaXNodDsiOiAweDI5N2MsCiAgICAgICAgICAgICAgICAibGZsb29yOyI6IDB4MjMwYSwgImxmcjsiOiBbMHhkODM1LCAweGRkMjldLAogICAgICAgICAgICAgICAgImxnOyI6IDB4MjI3NiwgImxnRTsiOiAweDJhOTEsCiAgICAgICAgICAgICAgICAibGhhcmQ7IjogMHgyMWJkLCAibGhhcnU7IjogMHgyMWJjLAogICAgICAgICAgICAgICAgImxoYXJ1bDsiOiAweDI5NmEsICJsaGJsazsiOiAweDI1ODQsCiAgICAgICAgICAgICAgICAibGpjeTsiOiAweDQ1OSwgImxsOyI6IDB4MjI2YSwKICAgICAgICAgICAgICAgICJsbGFycjsiOiAweDIxYzcsICJsbGNvcm5lcjsiOiAweDIzMWUsCiAgICAgICAgICAgICAgICAibGxoYXJkOyI6IDB4Mjk2YiwgImxsdHJpOyI6IDB4MjVmYSwKICAgICAgICAgICAgICAgICJsbWlkb3Q7IjogMHgxNDAsICJsbW91c3Q7IjogMHgyM2IwLAogICAgICAgICAgICAgICAgImxtb3VzdGFjaGU7IjogMHgyM2IwLCAibG5FOyI6IDB4MjI2OCwKICAgICAgICAgICAgICAgICJsbmFwOyI6IDB4MmE4OSwgImxuYXBwcm94OyI6IDB4MmE4OSwKICAgICAgICAgICAgICAgICJsbmU7IjogMHgyYTg3LCAibG5lcTsiOiAweDJhODcsCiAgICAgICAgICAgICAgICAibG5lcXE7IjogMHgyMjY4LCAibG5zaW07IjogMHgyMmU2LAogICAgICAgICAgICAgICAgImxvYW5nOyI6IDB4MjdlYywgImxvYXJyOyI6IDB4MjFmZCwKICAgICAgICAgICAgICAgICJsb2JyazsiOiAweDI3ZTYsICJsb25nbGVmdGFycm93OyI6IDB4MjdmNSwKICAgICAgICAgICAgICAgICJsb25nbGVmdHJpZ2h0YXJyb3c7IjogMHgyN2Y3LCAibG9uZ21hcHN0bzsiOiAweDI3ZmMsCiAgICAgICAgICAgICAgICAibG9uZ3JpZ2h0YXJyb3c7IjogMHgyN2Y2LCAibG9vcGFycm93bGVmdDsiOiAweDIxYWIsCiAgICAgICAgICAgICAgICAibG9vcGFycm93cmlnaHQ7IjogMHgyMWFjLCAibG9wYXI7IjogMHgyOTg1LAogICAgICAgICAgICAgICAgImxvcGY7IjogWzB4ZDgzNSwgMHhkZDVkXSwgImxvcGx1czsiOiAweDJhMmQsCiAgICAgICAgICAgICAgICAibG90aW1lczsiOiAweDJhMzQsICJsb3dhc3Q7IjogMHgyMjE3LAogICAgICAgICAgICAgICAgImxvd2JhcjsiOiAweDVmLCAibG96OyI6IDB4MjVjYSwKICAgICAgICAgICAgICAgICJsb3plbmdlOyI6IDB4MjVjYSwgImxvemY7IjogMHgyOWViLAogICAgICAgICAgICAgICAgImxwYXI7IjogMHgyOCwgImxwYXJsdDsiOiAweDI5OTMsCiAgICAgICAgICAgICAgICAibHJhcnI7IjogMHgyMWM2LCAibHJjb3JuZXI7IjogMHgyMzFmLAogICAgICAgICAgICAgICAgImxyaGFyOyI6IDB4MjFjYiwgImxyaGFyZDsiOiAweDI5NmQsCiAgICAgICAgICAgICAgICAibHJtOyI6IDB4MjAwZSwgImxydHJpOyI6IDB4MjJiZiwKICAgICAgICAgICAgICAgICJsc2FxdW87IjogMHgyMDM5LCAibHNjcjsiOiBbMHhkODM1LCAweGRjYzFdLAogICAgICAgICAgICAgICAgImxzaDsiOiAweDIxYjAsICJsc2ltOyI6IDB4MjI3MiwKICAgICAgICAgICAgICAgICJsc2ltZTsiOiAweDJhOGQsICJsc2ltZzsiOiAweDJhOGYsCiAgICAgICAgICAgICAgICAibHNxYjsiOiAweDViLCAibHNxdW87IjogMHgyMDE4LAogICAgICAgICAgICAgICAgImxzcXVvcjsiOiAweDIwMWEsICJsc3Ryb2s7IjogMHgxNDIsCiAgICAgICAgICAgICAgICAibHQ7IjogMHgzYywgImx0Y2M7IjogMHgyYWE2LAogICAgICAgICAgICAgICAgImx0Y2lyOyI6IDB4MmE3OSwgImx0ZG90OyI6IDB4MjJkNiwKICAgICAgICAgICAgICAgICJsdGhyZWU7IjogMHgyMmNiLCAibHRpbWVzOyI6IDB4MjJjOSwKICAgICAgICAgICAgICAgICJsdGxhcnI7IjogMHgyOTc2LCAibHRxdWVzdDsiOiAweDJhN2IsCiAgICAgICAgICAgICAgICAibHRyUGFyOyI6IDB4Mjk5NiwgImx0cmk7IjogMHgyNWMzLAogICAgICAgICAgICAgICAgImx0cmllOyI6IDB4MjJiNCwgImx0cmlmOyI6IDB4MjVjMiwKICAgICAgICAgICAgICAgICJsdXJkc2hhcjsiOiAweDI5NGEsICJsdXJ1aGFyOyI6IDB4Mjk2NiwKICAgICAgICAgICAgICAgICJsdmVydG5lcXE7IjogWzB4MjI2OCwgMHhmZTAwXSwgImx2bkU7IjogWzB4MjI2OCwgMHhmZTAwXSwKICAgICAgICAgICAgICAgICJtRERvdDsiOiAweDIyM2EsICJtYWNyOyI6IDB4YWYsCiAgICAgICAgICAgICAgICAibWFsZTsiOiAweDI2NDIsICJtYWx0OyI6IDB4MjcyMCwKICAgICAgICAgICAgICAgICJtYWx0ZXNlOyI6IDB4MjcyMCwgIm1hcDsiOiAweDIxYTYsCiAgICAgICAgICAgICAgICAibWFwc3RvOyI6IDB4MjFhNiwgIm1hcHN0b2Rvd247IjogMHgyMWE3LAogICAgICAgICAgICAgICAgIm1hcHN0b2xlZnQ7IjogMHgyMWE0LCAibWFwc3RvdXA7IjogMHgyMWE1LAogICAgICAgICAgICAgICAgIm1hcmtlcjsiOiAweDI1YWUsICJtY29tbWE7IjogMHgyYTI5LAogICAgICAgICAgICAgICAgIm1jeTsiOiAweDQzYywgIm1kYXNoOyI6IDB4MjAxNCwKICAgICAgICAgICAgICAgICJtZWFzdXJlZGFuZ2xlOyI6IDB4MjIyMSwgIm1mcjsiOiBbMHhkODM1LCAweGRkMmFdLAogICAgICAgICAgICAgICAgIm1obzsiOiAweDIxMjcsICJtaWNybzsiOiAweGI1LAogICAgICAgICAgICAgICAgIm1pZDsiOiAweDIyMjMsICJtaWRhc3Q7IjogMHgyYSwKICAgICAgICAgICAgICAgICJtaWRjaXI7IjogMHgyYWYwLCAibWlkZG90OyI6IDB4YjcsCiAgICAgICAgICAgICAgICAibWludXM7IjogMHgyMjEyLCAibWludXNiOyI6IDB4MjI5ZiwKICAgICAgICAgICAgICAgICJtaW51c2Q7IjogMHgyMjM4LCAibWludXNkdTsiOiAweDJhMmEsCiAgICAgICAgICAgICAgICAibWxjcDsiOiAweDJhZGIsICJtbGRyOyI6IDB4MjAyNiwKICAgICAgICAgICAgICAgICJtbnBsdXM7IjogMHgyMjEzLCAibW9kZWxzOyI6IDB4MjJhNywKICAgICAgICAgICAgICAgICJtb3BmOyI6IFsweGQ4MzUsIDB4ZGQ1ZV0sICJtcDsiOiAweDIyMTMsCiAgICAgICAgICAgICAgICAibXNjcjsiOiBbMHhkODM1LCAweGRjYzJdLCAibXN0cG9zOyI6IDB4MjIzZSwKICAgICAgICAgICAgICAgICJtdTsiOiAweDNiYywgIm11bHRpbWFwOyI6IDB4MjJiOCwKICAgICAgICAgICAgICAgICJtdW1hcDsiOiAweDIyYjgsICJuR2c7IjogWzB4MjJkOSwgMHgzMzhdLAogICAgICAgICAgICAgICAgIm5HdDsiOiBbMHgyMjZiLCAweDIwZDJdLCAibkd0djsiOiBbMHgyMjZiLCAweDMzOF0sCiAgICAgICAgICAgICAgICAibkxlZnRhcnJvdzsiOiAweDIxY2QsICJuTGVmdHJpZ2h0YXJyb3c7IjogMHgyMWNlLAogICAgICAgICAgICAgICAgIm5MbDsiOiBbMHgyMmQ4LCAweDMzOF0sICJuTHQ7IjogWzB4MjI2YSwgMHgyMGQyXSwKICAgICAgICAgICAgICAgICJuTHR2OyI6IFsweDIyNmEsIDB4MzM4XSwgIm5SaWdodGFycm93OyI6IDB4MjFjZiwKICAgICAgICAgICAgICAgICJuVkRhc2g7IjogMHgyMmFmLCAiblZkYXNoOyI6IDB4MjJhZSwKICAgICAgICAgICAgICAgICJuYWJsYTsiOiAweDIyMDcsICJuYWN1dGU7IjogMHgxNDQsCiAgICAgICAgICAgICAgICAibmFuZzsiOiBbMHgyMjIwLCAweDIwZDJdLCAibmFwOyI6IDB4MjI0OSwKICAgICAgICAgICAgICAgICJuYXBFOyI6IFsweDJhNzAsIDB4MzM4XSwgIm5hcGlkOyI6IFsweDIyNGIsIDB4MzM4XSwKICAgICAgICAgICAgICAgICJuYXBvczsiOiAweDE0OSwgIm5hcHByb3g7IjogMHgyMjQ5LAogICAgICAgICAgICAgICAgIm5hdHVyOyI6IDB4MjY2ZSwgIm5hdHVyYWw7IjogMHgyNjZlLAogICAgICAgICAgICAgICAgIm5hdHVyYWxzOyI6IDB4MjExNSwgIm5ic3A7IjogMHhhMCwKICAgICAgICAgICAgICAgICJuYnVtcDsiOiBbMHgyMjRlLCAweDMzOF0sICJuYnVtcGU7IjogWzB4MjI0ZiwgMHgzMzhdLAogICAgICAgICAgICAgICAgIm5jYXA7IjogMHgyYTQzLCAibmNhcm9uOyI6IDB4MTQ4LAogICAgICAgICAgICAgICAgIm5jZWRpbDsiOiAweDE0NiwgIm5jb25nOyI6IDB4MjI0NywKICAgICAgICAgICAgICAgICJuY29uZ2RvdDsiOiBbMHgyYTZkLCAweDMzOF0sICJuY3VwOyI6IDB4MmE0MiwKICAgICAgICAgICAgICAgICJuY3k7IjogMHg0M2QsICJuZGFzaDsiOiAweDIwMTMsCiAgICAgICAgICAgICAgICAibmU7IjogMHgyMjYwLCAibmVBcnI7IjogMHgyMWQ3LAogICAgICAgICAgICAgICAgIm5lYXJoazsiOiAweDI5MjQsICJuZWFycjsiOiAweDIxOTcsCiAgICAgICAgICAgICAgICAibmVhcnJvdzsiOiAweDIxOTcsICJuZWRvdDsiOiBbMHgyMjUwLCAweDMzOF0sCiAgICAgICAgICAgICAgICAibmVxdWl2OyI6IDB4MjI2MiwgIm5lc2VhcjsiOiAweDI5MjgsCiAgICAgICAgICAgICAgICAibmVzaW07IjogWzB4MjI0MiwgMHgzMzhdLCAibmV4aXN0OyI6IDB4MjIwNCwKICAgICAgICAgICAgICAgICJuZXhpc3RzOyI6IDB4MjIwNCwgIm5mcjsiOiBbMHhkODM1LCAweGRkMmJdLAogICAgICAgICAgICAgICAgIm5nRTsiOiBbMHgyMjY3LCAweDMzOF0sICJuZ2U7IjogMHgyMjcxLAogICAgICAgICAgICAgICAgIm5nZXE7IjogMHgyMjcxLCAibmdlcXE7IjogWzB4MjI2NywgMHgzMzhdLAogICAgICAgICAgICAgICAgIm5nZXFzbGFudDsiOiBbMHgyYTdlLCAweDMzOF0sICJuZ2VzOyI6IFsweDJhN2UsIDB4MzM4XSwKICAgICAgICAgICAgICAgICJuZ3NpbTsiOiAweDIyNzUsICJuZ3Q7IjogMHgyMjZmLAogICAgICAgICAgICAgICAgIm5ndHI7IjogMHgyMjZmLCAibmhBcnI7IjogMHgyMWNlLAogICAgICAgICAgICAgICAgIm5oYXJyOyI6IDB4MjFhZSwgIm5ocGFyOyI6IDB4MmFmMiwKICAgICAgICAgICAgICAgICJuaTsiOiAweDIyMGIsICJuaXM7IjogMHgyMmZjLAogICAgICAgICAgICAgICAgIm5pc2Q7IjogMHgyMmZhLCAibml2OyI6IDB4MjIwYiwKICAgICAgICAgICAgICAgICJuamN5OyI6IDB4NDVhLCAibmxBcnI7IjogMHgyMWNkLAogICAgICAgICAgICAgICAgIm5sRTsiOiBbMHgyMjY2LCAweDMzOF0sICJubGFycjsiOiAweDIxOWEsCiAgICAgICAgICAgICAgICAibmxkcjsiOiAweDIwMjUsICJubGU7IjogMHgyMjcwLAogICAgICAgICAgICAgICAgIm5sZWZ0YXJyb3c7IjogMHgyMTlhLCAibmxlZnRyaWdodGFycm93OyI6IDB4MjFhZSwKICAgICAgICAgICAgICAgICJubGVxOyI6IDB4MjI3MCwgIm5sZXFxOyI6IFsweDIyNjYsIDB4MzM4XSwKICAgICAgICAgICAgICAgICJubGVxc2xhbnQ7IjogWzB4MmE3ZCwgMHgzMzhdLCAibmxlczsiOiBbMHgyYTdkLCAweDMzOF0sCiAgICAgICAgICAgICAgICAibmxlc3M7IjogMHgyMjZlLCAibmxzaW07IjogMHgyMjc0LAogICAgICAgICAgICAgICAgIm5sdDsiOiAweDIyNmUsICJubHRyaTsiOiAweDIyZWEsCiAgICAgICAgICAgICAgICAibmx0cmllOyI6IDB4MjJlYywgIm5taWQ7IjogMHgyMjI0LAogICAgICAgICAgICAgICAgIm5vcGY7IjogWzB4ZDgzNSwgMHhkZDVmXSwgIm5vdDsiOiAweGFjLAogICAgICAgICAgICAgICAgIm5vdGluOyI6IDB4MjIwOSwgIm5vdGluRTsiOiBbMHgyMmY5LCAweDMzOF0sCiAgICAgICAgICAgICAgICAibm90aW5kb3Q7IjogWzB4MjJmNSwgMHgzMzhdLCAibm90aW52YTsiOiAweDIyMDksCiAgICAgICAgICAgICAgICAibm90aW52YjsiOiAweDIyZjcsICJub3RpbnZjOyI6IDB4MjJmNiwKICAgICAgICAgICAgICAgICJub3RuaTsiOiAweDIyMGMsICJub3RuaXZhOyI6IDB4MjIwYywKICAgICAgICAgICAgICAgICJub3RuaXZiOyI6IDB4MjJmZSwgIm5vdG5pdmM7IjogMHgyMmZkLAogICAgICAgICAgICAgICAgIm5wYXI7IjogMHgyMjI2LCAibnBhcmFsbGVsOyI6IDB4MjIyNiwKICAgICAgICAgICAgICAgICJucGFyc2w7IjogWzB4MmFmZCwgMHgyMGU1XSwgIm5wYXJ0OyI6IFsweDIyMDIsIDB4MzM4XSwKICAgICAgICAgICAgICAgICJucG9saW50OyI6IDB4MmExNCwgIm5wcjsiOiAweDIyODAsCiAgICAgICAgICAgICAgICAibnByY3VlOyI6IDB4MjJlMCwgIm5wcmU7IjogWzB4MmFhZiwgMHgzMzhdLAogICAgICAgICAgICAgICAgIm5wcmVjOyI6IDB4MjI4MCwgIm5wcmVjZXE7IjogWzB4MmFhZiwgMHgzMzhdLAogICAgICAgICAgICAgICAgIm5yQXJyOyI6IDB4MjFjZiwgIm5yYXJyOyI6IDB4MjE5YiwKICAgICAgICAgICAgICAgICJucmFycmM7IjogWzB4MjkzMywgMHgzMzhdLCAibnJhcnJ3OyI6IFsweDIxOWQsIDB4MzM4XSwKICAgICAgICAgICAgICAgICJucmlnaHRhcnJvdzsiOiAweDIxOWIsICJucnRyaTsiOiAweDIyZWIsCiAgICAgICAgICAgICAgICAibnJ0cmllOyI6IDB4MjJlZCwgIm5zYzsiOiAweDIyODEsCiAgICAgICAgICAgICAgICAibnNjY3VlOyI6IDB4MjJlMSwgIm5zY2U7IjogWzB4MmFiMCwgMHgzMzhdLAogICAgICAgICAgICAgICAgIm5zY3I7IjogWzB4ZDgzNSwgMHhkY2MzXSwgIm5zaG9ydG1pZDsiOiAweDIyMjQsCiAgICAgICAgICAgICAgICAibnNob3J0cGFyYWxsZWw7IjogMHgyMjI2LCAibnNpbTsiOiAweDIyNDEsCiAgICAgICAgICAgICAgICAibnNpbWU7IjogMHgyMjQ0LCAibnNpbWVxOyI6IDB4MjI0NCwKICAgICAgICAgICAgICAgICJuc21pZDsiOiAweDIyMjQsICJuc3BhcjsiOiAweDIyMjYsCiAgICAgICAgICAgICAgICAibnNxc3ViZTsiOiAweDIyZTIsICJuc3FzdXBlOyI6IDB4MjJlMywKICAgICAgICAgICAgICAgICJuc3ViOyI6IDB4MjI4NCwgIm5zdWJFOyI6IFsweDJhYzUsIDB4MzM4XSwKICAgICAgICAgICAgICAgICJuc3ViZTsiOiAweDIyODgsICJuc3Vic2V0OyI6IFsweDIyODIsIDB4MjBkMl0sCiAgICAgICAgICAgICAgICAibnN1YnNldGVxOyI6IDB4MjI4OCwgIm5zdWJzZXRlcXE7IjogWzB4MmFjNSwgMHgzMzhdLAogICAgICAgICAgICAgICAgIm5zdWNjOyI6IDB4MjI4MSwgIm5zdWNjZXE7IjogWzB4MmFiMCwgMHgzMzhdLAogICAgICAgICAgICAgICAgIm5zdXA7IjogMHgyMjg1LCAibnN1cEU7IjogWzB4MmFjNiwgMHgzMzhdLAogICAgICAgICAgICAgICAgIm5zdXBlOyI6IDB4MjI4OSwgIm5zdXBzZXQ7IjogWzB4MjI4MywgMHgyMGQyXSwKICAgICAgICAgICAgICAgICJuc3Vwc2V0ZXE7IjogMHgyMjg5LCAibnN1cHNldGVxcTsiOiBbMHgyYWM2LCAweDMzOF0sCiAgICAgICAgICAgICAgICAibnRnbDsiOiAweDIyNzksICJudGlsZGU7IjogMHhmMSwKICAgICAgICAgICAgICAgICJudGxnOyI6IDB4MjI3OCwgIm50cmlhbmdsZWxlZnQ7IjogMHgyMmVhLAogICAgICAgICAgICAgICAgIm50cmlhbmdsZWxlZnRlcTsiOiAweDIyZWMsICJudHJpYW5nbGVyaWdodDsiOiAweDIyZWIsCiAgICAgICAgICAgICAgICAibnRyaWFuZ2xlcmlnaHRlcTsiOiAweDIyZWQsICJudTsiOiAweDNiZCwKICAgICAgICAgICAgICAgICJudW07IjogMHgyMywgIm51bWVybzsiOiAweDIxMTYsCiAgICAgICAgICAgICAgICAibnVtc3A7IjogMHgyMDA3LCAibnZEYXNoOyI6IDB4MjJhZCwKICAgICAgICAgICAgICAgICJudkhhcnI7IjogMHgyOTA0LCAibnZhcDsiOiBbMHgyMjRkLCAweDIwZDJdLAogICAgICAgICAgICAgICAgIm52ZGFzaDsiOiAweDIyYWMsICJudmdlOyI6IFsweDIyNjUsIDB4MjBkMl0sCiAgICAgICAgICAgICAgICAibnZndDsiOiBbMHgzZSwgMHgyMGQyXSwgIm52aW5maW47IjogMHgyOWRlLAogICAgICAgICAgICAgICAgIm52bEFycjsiOiAweDI5MDIsICJudmxlOyI6IFsweDIyNjQsIDB4MjBkMl0sCiAgICAgICAgICAgICAgICAibnZsdDsiOiBbMHgzYywgMHgyMGQyXSwgIm52bHRyaWU7IjogWzB4MjJiNCwgMHgyMGQyXSwKICAgICAgICAgICAgICAgICJudnJBcnI7IjogMHgyOTAzLCAibnZydHJpZTsiOiBbMHgyMmI1LCAweDIwZDJdLAogICAgICAgICAgICAgICAgIm52c2ltOyI6IFsweDIyM2MsIDB4MjBkMl0sICJud0FycjsiOiAweDIxZDYsCiAgICAgICAgICAgICAgICAibndhcmhrOyI6IDB4MjkyMywgIm53YXJyOyI6IDB4MjE5NiwKICAgICAgICAgICAgICAgICJud2Fycm93OyI6IDB4MjE5NiwgIm53bmVhcjsiOiAweDI5MjcsCiAgICAgICAgICAgICAgICAib1M7IjogMHgyNGM4LCAib2FjdXRlOyI6IDB4ZjMsCiAgICAgICAgICAgICAgICAib2FzdDsiOiAweDIyOWIsICJvY2lyOyI6IDB4MjI5YSwKICAgICAgICAgICAgICAgICJvY2lyYzsiOiAweGY0LCAib2N5OyI6IDB4NDNlLAogICAgICAgICAgICAgICAgIm9kYXNoOyI6IDB4MjI5ZCwgIm9kYmxhYzsiOiAweDE1MSwKICAgICAgICAgICAgICAgICJvZGl2OyI6IDB4MmEzOCwgIm9kb3Q7IjogMHgyMjk5LAogICAgICAgICAgICAgICAgIm9kc29sZDsiOiAweDI5YmMsICJvZWxpZzsiOiAweDE1MywKICAgICAgICAgICAgICAgICJvZmNpcjsiOiAweDI5YmYsICJvZnI7IjogWzB4ZDgzNSwgMHhkZDJjXSwKICAgICAgICAgICAgICAgICJvZ29uOyI6IDB4MmRiLCAib2dyYXZlOyI6IDB4ZjIsCiAgICAgICAgICAgICAgICAib2d0OyI6IDB4MjljMSwgIm9oYmFyOyI6IDB4MjliNSwKICAgICAgICAgICAgICAgICJvaG07IjogMHgzYTksICJvaW50OyI6IDB4MjIyZSwKICAgICAgICAgICAgICAgICJvbGFycjsiOiAweDIxYmEsICJvbGNpcjsiOiAweDI5YmUsCiAgICAgICAgICAgICAgICAib2xjcm9zczsiOiAweDI5YmIsICJvbGluZTsiOiAweDIwM2UsCiAgICAgICAgICAgICAgICAib2x0OyI6IDB4MjljMCwgIm9tYWNyOyI6IDB4MTRkLAogICAgICAgICAgICAgICAgIm9tZWdhOyI6IDB4M2M5LCAib21pY3JvbjsiOiAweDNiZiwKICAgICAgICAgICAgICAgICJvbWlkOyI6IDB4MjliNiwgIm9taW51czsiOiAweDIyOTYsCiAgICAgICAgICAgICAgICAib29wZjsiOiBbMHhkODM1LCAweGRkNjBdLCAib3BhcjsiOiAweDI5YjcsCiAgICAgICAgICAgICAgICAib3BlcnA7IjogMHgyOWI5LCAib3BsdXM7IjogMHgyMjk1LAogICAgICAgICAgICAgICAgIm9yOyI6IDB4MjIyOCwgIm9yYXJyOyI6IDB4MjFiYiwKICAgICAgICAgICAgICAgICJvcmQ7IjogMHgyYTVkLCAib3JkZXI7IjogMHgyMTM0LAogICAgICAgICAgICAgICAgIm9yZGVyb2Y7IjogMHgyMTM0LCAib3JkZjsiOiAweGFhLAogICAgICAgICAgICAgICAgIm9yZG07IjogMHhiYSwgIm9yaWdvZjsiOiAweDIyYjYsCiAgICAgICAgICAgICAgICAib3JvcjsiOiAweDJhNTYsICJvcnNsb3BlOyI6IDB4MmE1NywKICAgICAgICAgICAgICAgICJvcnY7IjogMHgyYTViLCAib3NjcjsiOiAweDIxMzQsCiAgICAgICAgICAgICAgICAib3NsYXNoOyI6IDB4ZjgsICJvc29sOyI6IDB4MjI5OCwKICAgICAgICAgICAgICAgICJvdGlsZGU7IjogMHhmNSwgIm90aW1lczsiOiAweDIyOTcsCiAgICAgICAgICAgICAgICAib3RpbWVzYXM7IjogMHgyYTM2LCAib3VtbDsiOiAweGY2LAogICAgICAgICAgICAgICAgIm92YmFyOyI6IDB4MjMzZCwgInBhcjsiOiAweDIyMjUsCiAgICAgICAgICAgICAgICAicGFyYTsiOiAweGI2LCAicGFyYWxsZWw7IjogMHgyMjI1LAogICAgICAgICAgICAgICAgInBhcnNpbTsiOiAweDJhZjMsICJwYXJzbDsiOiAweDJhZmQsCiAgICAgICAgICAgICAgICAicGFydDsiOiAweDIyMDIsICJwY3k7IjogMHg0M2YsCiAgICAgICAgICAgICAgICAicGVyY250OyI6IDB4MjUsICJwZXJpb2Q7IjogMHgyZSwKICAgICAgICAgICAgICAgICJwZXJtaWw7IjogMHgyMDMwLCAicGVycDsiOiAweDIyYTUsCiAgICAgICAgICAgICAgICAicGVydGVuazsiOiAweDIwMzEsICJwZnI7IjogWzB4ZDgzNSwgMHhkZDJkXSwKICAgICAgICAgICAgICAgICJwaGk7IjogMHgzYzYsICJwaGl2OyI6IDB4M2Q1LAogICAgICAgICAgICAgICAgInBobW1hdDsiOiAweDIxMzMsICJwaG9uZTsiOiAweDI2MGUsCiAgICAgICAgICAgICAgICAicGk7IjogMHgzYzAsICJwaXRjaGZvcms7IjogMHgyMmQ0LAogICAgICAgICAgICAgICAgInBpdjsiOiAweDNkNiwgInBsYW5jazsiOiAweDIxMGYsCiAgICAgICAgICAgICAgICAicGxhbmNraDsiOiAweDIxMGUsICJwbGFua3Y7IjogMHgyMTBmLAogICAgICAgICAgICAgICAgInBsdXM7IjogMHgyYiwgInBsdXNhY2lyOyI6IDB4MmEyMywKICAgICAgICAgICAgICAgICJwbHVzYjsiOiAweDIyOWUsICJwbHVzY2lyOyI6IDB4MmEyMiwKICAgICAgICAgICAgICAgICJwbHVzZG87IjogMHgyMjE0LCAicGx1c2R1OyI6IDB4MmEyNSwKICAgICAgICAgICAgICAgICJwbHVzZTsiOiAweDJhNzIsICJwbHVzbW47IjogMHhiMSwKICAgICAgICAgICAgICAgICJwbHVzc2ltOyI6IDB4MmEyNiwgInBsdXN0d287IjogMHgyYTI3LAogICAgICAgICAgICAgICAgInBtOyI6IDB4YjEsICJwb2ludGludDsiOiAweDJhMTUsCiAgICAgICAgICAgICAgICAicG9wZjsiOiBbMHhkODM1LCAweGRkNjFdLCAicG91bmQ7IjogMHhhMywKICAgICAgICAgICAgICAgICJwcjsiOiAweDIyN2EsICJwckU7IjogMHgyYWIzLAogICAgICAgICAgICAgICAgInByYXA7IjogMHgyYWI3LCAicHJjdWU7IjogMHgyMjdjLAogICAgICAgICAgICAgICAgInByZTsiOiAweDJhYWYsICJwcmVjOyI6IDB4MjI3YSwKICAgICAgICAgICAgICAgICJwcmVjYXBwcm94OyI6IDB4MmFiNywgInByZWNjdXJseWVxOyI6IDB4MjI3YywKICAgICAgICAgICAgICAgICJwcmVjZXE7IjogMHgyYWFmLCAicHJlY25hcHByb3g7IjogMHgyYWI5LAogICAgICAgICAgICAgICAgInByZWNuZXFxOyI6IDB4MmFiNSwgInByZWNuc2ltOyI6IDB4MjJlOCwKICAgICAgICAgICAgICAgICJwcmVjc2ltOyI6IDB4MjI3ZSwgInByaW1lOyI6IDB4MjAzMiwKICAgICAgICAgICAgICAgICJwcmltZXM7IjogMHgyMTE5LCAicHJuRTsiOiAweDJhYjUsCiAgICAgICAgICAgICAgICAicHJuYXA7IjogMHgyYWI5LCAicHJuc2ltOyI6IDB4MjJlOCwKICAgICAgICAgICAgICAgICJwcm9kOyI6IDB4MjIwZiwgInByb2ZhbGFyOyI6IDB4MjMyZSwKICAgICAgICAgICAgICAgICJwcm9mbGluZTsiOiAweDIzMTIsICJwcm9mc3VyZjsiOiAweDIzMTMsCiAgICAgICAgICAgICAgICAicHJvcDsiOiAweDIyMWQsICJwcm9wdG87IjogMHgyMjFkLAogICAgICAgICAgICAgICAgInByc2ltOyI6IDB4MjI3ZSwgInBydXJlbDsiOiAweDIyYjAsCiAgICAgICAgICAgICAgICAicHNjcjsiOiBbMHhkODM1LCAweGRjYzVdLCAicHNpOyI6IDB4M2M4LAogICAgICAgICAgICAgICAgInB1bmNzcDsiOiAweDIwMDgsICJxZnI7IjogWzB4ZDgzNSwgMHhkZDJlXSwKICAgICAgICAgICAgICAgICJxaW50OyI6IDB4MmEwYywgInFvcGY7IjogWzB4ZDgzNSwgMHhkZDYyXSwKICAgICAgICAgICAgICAgICJxcHJpbWU7IjogMHgyMDU3LCAicXNjcjsiOiBbMHhkODM1LCAweGRjYzZdLAogICAgICAgICAgICAgICAgInF1YXRlcm5pb25zOyI6IDB4MjEwZCwgInF1YXRpbnQ7IjogMHgyYTE2LAogICAgICAgICAgICAgICAgInF1ZXN0OyI6IDB4M2YsICJxdWVzdGVxOyI6IDB4MjI1ZiwKICAgICAgICAgICAgICAgICJxdW90OyI6IDB4MjIsICJyQWFycjsiOiAweDIxZGIsCiAgICAgICAgICAgICAgICAickFycjsiOiAweDIxZDIsICJyQXRhaWw7IjogMHgyOTFjLAogICAgICAgICAgICAgICAgInJCYXJyOyI6IDB4MjkwZiwgInJIYXI7IjogMHgyOTY0LAogICAgICAgICAgICAgICAgInJhY2U7IjogWzB4MjIzZCwgMHgzMzFdLCAicmFjdXRlOyI6IDB4MTU1LAogICAgICAgICAgICAgICAgInJhZGljOyI6IDB4MjIxYSwgInJhZW1wdHl2OyI6IDB4MjliMywKICAgICAgICAgICAgICAgICJyYW5nOyI6IDB4MjdlOSwgInJhbmdkOyI6IDB4Mjk5MiwKICAgICAgICAgICAgICAgICJyYW5nZTsiOiAweDI5YTUsICJyYW5nbGU7IjogMHgyN2U5LAogICAgICAgICAgICAgICAgInJhcXVvOyI6IDB4YmIsICJyYXJyOyI6IDB4MjE5MiwKICAgICAgICAgICAgICAgICJyYXJyYXA7IjogMHgyOTc1LCAicmFycmI7IjogMHgyMWU1LAogICAgICAgICAgICAgICAgInJhcnJiZnM7IjogMHgyOTIwLCAicmFycmM7IjogMHgyOTMzLAogICAgICAgICAgICAgICAgInJhcnJmczsiOiAweDI5MWUsICJyYXJyaGs7IjogMHgyMWFhLAogICAgICAgICAgICAgICAgInJhcnJscDsiOiAweDIxYWMsICJyYXJycGw7IjogMHgyOTQ1LAogICAgICAgICAgICAgICAgInJhcnJzaW07IjogMHgyOTc0LCAicmFycnRsOyI6IDB4MjFhMywKICAgICAgICAgICAgICAgICJyYXJydzsiOiAweDIxOWQsICJyYXRhaWw7IjogMHgyOTFhLAogICAgICAgICAgICAgICAgInJhdGlvOyI6IDB4MjIzNiwgInJhdGlvbmFsczsiOiAweDIxMWEsCiAgICAgICAgICAgICAgICAicmJhcnI7IjogMHgyOTBkLCAicmJicms7IjogMHgyNzczLAogICAgICAgICAgICAgICAgInJicmFjZTsiOiAweDdkLCAicmJyYWNrOyI6IDB4NWQsCiAgICAgICAgICAgICAgICAicmJya2U7IjogMHgyOThjLCAicmJya3NsZDsiOiAweDI5OGUsCiAgICAgICAgICAgICAgICAicmJya3NsdTsiOiAweDI5OTAsICJyY2Fyb247IjogMHgxNTksCiAgICAgICAgICAgICAgICAicmNlZGlsOyI6IDB4MTU3LCAicmNlaWw7IjogMHgyMzA5LAogICAgICAgICAgICAgICAgInJjdWI7IjogMHg3ZCwgInJjeTsiOiAweDQ0MCwKICAgICAgICAgICAgICAgICJyZGNhOyI6IDB4MjkzNywgInJkbGRoYXI7IjogMHgyOTY5LAogICAgICAgICAgICAgICAgInJkcXVvOyI6IDB4MjAxZCwgInJkcXVvcjsiOiAweDIwMWQsCiAgICAgICAgICAgICAgICAicmRzaDsiOiAweDIxYjMsICJyZWFsOyI6IDB4MjExYywKICAgICAgICAgICAgICAgICJyZWFsaW5lOyI6IDB4MjExYiwgInJlYWxwYXJ0OyI6IDB4MjExYywKICAgICAgICAgICAgICAgICJyZWFsczsiOiAweDIxMWQsICJyZWN0OyI6IDB4MjVhZCwKICAgICAgICAgICAgICAgICJyZWc7IjogMHhhZSwgInJmaXNodDsiOiAweDI5N2QsCiAgICAgICAgICAgICAgICAicmZsb29yOyI6IDB4MjMwYiwgInJmcjsiOiBbMHhkODM1LCAweGRkMmZdLAogICAgICAgICAgICAgICAgInJoYXJkOyI6IDB4MjFjMSwgInJoYXJ1OyI6IDB4MjFjMCwKICAgICAgICAgICAgICAgICJyaGFydWw7IjogMHgyOTZjLCAicmhvOyI6IDB4M2MxLAogICAgICAgICAgICAgICAgInJob3Y7IjogMHgzZjEsICJyaWdodGFycm93OyI6IDB4MjE5MiwKICAgICAgICAgICAgICAgICJyaWdodGFycm93dGFpbDsiOiAweDIxYTMsICJyaWdodGhhcnBvb25kb3duOyI6IDB4MjFjMSwKICAgICAgICAgICAgICAgICJyaWdodGhhcnBvb251cDsiOiAweDIxYzAsICJyaWdodGxlZnRhcnJvd3M7IjogMHgyMWM0LAogICAgICAgICAgICAgICAgInJpZ2h0bGVmdGhhcnBvb25zOyI6IDB4MjFjYywgInJpZ2h0cmlnaHRhcnJvd3M7IjogMHgyMWM5LAogICAgICAgICAgICAgICAgInJpZ2h0c3F1aWdhcnJvdzsiOiAweDIxOWQsICJyaWdodHRocmVldGltZXM7IjogMHgyMmNjLAogICAgICAgICAgICAgICAgInJpbmc7IjogMHgyZGEsICJyaXNpbmdkb3RzZXE7IjogMHgyMjUzLAogICAgICAgICAgICAgICAgInJsYXJyOyI6IDB4MjFjNCwgInJsaGFyOyI6IDB4MjFjYywKICAgICAgICAgICAgICAgICJybG07IjogMHgyMDBmLCAicm1vdXN0OyI6IDB4MjNiMSwKICAgICAgICAgICAgICAgICJybW91c3RhY2hlOyI6IDB4MjNiMSwgInJubWlkOyI6IDB4MmFlZSwKICAgICAgICAgICAgICAgICJyb2FuZzsiOiAweDI3ZWQsICJyb2FycjsiOiAweDIxZmUsCiAgICAgICAgICAgICAgICAicm9icms7IjogMHgyN2U3LCAicm9wYXI7IjogMHgyOTg2LAogICAgICAgICAgICAgICAgInJvcGY7IjogWzB4ZDgzNSwgMHhkZDYzXSwgInJvcGx1czsiOiAweDJhMmUsCiAgICAgICAgICAgICAgICAicm90aW1lczsiOiAweDJhMzUsICJycGFyOyI6IDB4MjksCiAgICAgICAgICAgICAgICAicnBhcmd0OyI6IDB4Mjk5NCwgInJwcG9saW50OyI6IDB4MmExMiwKICAgICAgICAgICAgICAgICJycmFycjsiOiAweDIxYzksICJyc2FxdW87IjogMHgyMDNhLAogICAgICAgICAgICAgICAgInJzY3I7IjogWzB4ZDgzNSwgMHhkY2M3XSwgInJzaDsiOiAweDIxYjEsCiAgICAgICAgICAgICAgICAicnNxYjsiOiAweDVkLCAicnNxdW87IjogMHgyMDE5LAogICAgICAgICAgICAgICAgInJzcXVvcjsiOiAweDIwMTksICJydGhyZWU7IjogMHgyMmNjLAogICAgICAgICAgICAgICAgInJ0aW1lczsiOiAweDIyY2EsICJydHJpOyI6IDB4MjViOSwKICAgICAgICAgICAgICAgICJydHJpZTsiOiAweDIyYjUsICJydHJpZjsiOiAweDI1YjgsCiAgICAgICAgICAgICAgICAicnRyaWx0cmk7IjogMHgyOWNlLCAicnVsdWhhcjsiOiAweDI5NjgsCiAgICAgICAgICAgICAgICAicng7IjogMHgyMTFlLCAic2FjdXRlOyI6IDB4MTViLAogICAgICAgICAgICAgICAgInNicXVvOyI6IDB4MjAxYSwgInNjOyI6IDB4MjI3YiwKICAgICAgICAgICAgICAgICJzY0U7IjogMHgyYWI0LCAic2NhcDsiOiAweDJhYjgsCiAgICAgICAgICAgICAgICAic2Nhcm9uOyI6IDB4MTYxLCAic2NjdWU7IjogMHgyMjdkLAogICAgICAgICAgICAgICAgInNjZTsiOiAweDJhYjAsICJzY2VkaWw7IjogMHgxNWYsCiAgICAgICAgICAgICAgICAic2NpcmM7IjogMHgxNWQsICJzY25FOyI6IDB4MmFiNiwKICAgICAgICAgICAgICAgICJzY25hcDsiOiAweDJhYmEsICJzY25zaW07IjogMHgyMmU5LAogICAgICAgICAgICAgICAgInNjcG9saW50OyI6IDB4MmExMywgInNjc2ltOyI6IDB4MjI3ZiwKICAgICAgICAgICAgICAgICJzY3k7IjogMHg0NDEsICJzZG90OyI6IDB4MjJjNSwKICAgICAgICAgICAgICAgICJzZG90YjsiOiAweDIyYTEsICJzZG90ZTsiOiAweDJhNjYsCiAgICAgICAgICAgICAgICAic2VBcnI7IjogMHgyMWQ4LCAic2VhcmhrOyI6IDB4MjkyNSwKICAgICAgICAgICAgICAgICJzZWFycjsiOiAweDIxOTgsICJzZWFycm93OyI6IDB4MjE5OCwKICAgICAgICAgICAgICAgICJzZWN0OyI6IDB4YTcsICJzZW1pOyI6IDB4M2IsCiAgICAgICAgICAgICAgICAic2Vzd2FyOyI6IDB4MjkyOSwgInNldG1pbnVzOyI6IDB4MjIxNiwKICAgICAgICAgICAgICAgICJzZXRtbjsiOiAweDIyMTYsICJzZXh0OyI6IDB4MjczNiwKICAgICAgICAgICAgICAgICJzZnI7IjogWzB4ZDgzNSwgMHhkZDMwXSwgInNmcm93bjsiOiAweDIzMjIsCiAgICAgICAgICAgICAgICAic2hhcnA7IjogMHgyNjZmLCAic2hjaGN5OyI6IDB4NDQ5LAogICAgICAgICAgICAgICAgInNoY3k7IjogMHg0NDgsICJzaG9ydG1pZDsiOiAweDIyMjMsCiAgICAgICAgICAgICAgICAic2hvcnRwYXJhbGxlbDsiOiAweDIyMjUsICJzaHk7IjogMHhhZCwKICAgICAgICAgICAgICAgICJzaWdtYTsiOiAweDNjMywgInNpZ21hZjsiOiAweDNjMiwKICAgICAgICAgICAgICAgICJzaWdtYXY7IjogMHgzYzIsICJzaW07IjogMHgyMjNjLAogICAgICAgICAgICAgICAgInNpbWRvdDsiOiAweDJhNmEsICJzaW1lOyI6IDB4MjI0MywKICAgICAgICAgICAgICAgICJzaW1lcTsiOiAweDIyNDMsICJzaW1nOyI6IDB4MmE5ZSwKICAgICAgICAgICAgICAgICJzaW1nRTsiOiAweDJhYTAsICJzaW1sOyI6IDB4MmE5ZCwKICAgICAgICAgICAgICAgICJzaW1sRTsiOiAweDJhOWYsICJzaW1uZTsiOiAweDIyNDYsCiAgICAgICAgICAgICAgICAic2ltcGx1czsiOiAweDJhMjQsICJzaW1yYXJyOyI6IDB4Mjk3MiwKICAgICAgICAgICAgICAgICJzbGFycjsiOiAweDIxOTAsICJzbWFsbHNldG1pbnVzOyI6IDB4MjIxNiwKICAgICAgICAgICAgICAgICJzbWFzaHA7IjogMHgyYTMzLCAic21lcGFyc2w7IjogMHgyOWU0LAogICAgICAgICAgICAgICAgInNtaWQ7IjogMHgyMjIzLCAic21pbGU7IjogMHgyMzIzLAogICAgICAgICAgICAgICAgInNtdDsiOiAweDJhYWEsICJzbXRlOyI6IDB4MmFhYywKICAgICAgICAgICAgICAgICJzbXRlczsiOiBbMHgyYWFjLCAweGZlMDBdLCAic29mdGN5OyI6IDB4NDRjLAogICAgICAgICAgICAgICAgInNvbDsiOiAweDJmLCAic29sYjsiOiAweDI5YzQsCiAgICAgICAgICAgICAgICAic29sYmFyOyI6IDB4MjMzZiwgInNvcGY7IjogWzB4ZDgzNSwgMHhkZDY0XSwKICAgICAgICAgICAgICAgICJzcGFkZXM7IjogMHgyNjYwLCAic3BhZGVzdWl0OyI6IDB4MjY2MCwKICAgICAgICAgICAgICAgICJzcGFyOyI6IDB4MjIyNSwgInNxY2FwOyI6IDB4MjI5MywKICAgICAgICAgICAgICAgICJzcWNhcHM7IjogWzB4MjI5MywgMHhmZTAwXSwgInNxY3VwOyI6IDB4MjI5NCwKICAgICAgICAgICAgICAgICJzcWN1cHM7IjogWzB4MjI5NCwgMHhmZTAwXSwgInNxc3ViOyI6IDB4MjI4ZiwKICAgICAgICAgICAgICAgICJzcXN1YmU7IjogMHgyMjkxLCAic3FzdWJzZXQ7IjogMHgyMjhmLAogICAgICAgICAgICAgICAgInNxc3Vic2V0ZXE7IjogMHgyMjkxLCAic3FzdXA7IjogMHgyMjkwLAogICAgICAgICAgICAgICAgInNxc3VwZTsiOiAweDIyOTIsICJzcXN1cHNldDsiOiAweDIyOTAsCiAgICAgICAgICAgICAgICAic3FzdXBzZXRlcTsiOiAweDIyOTIsICJzcXU7IjogMHgyNWExLAogICAgICAgICAgICAgICAgInNxdWFyZTsiOiAweDI1YTEsICJzcXVhcmY7IjogMHgyNWFhLAogICAgICAgICAgICAgICAgInNxdWY7IjogMHgyNWFhLCAic3JhcnI7IjogMHgyMTkyLAogICAgICAgICAgICAgICAgInNzY3I7IjogWzB4ZDgzNSwgMHhkY2M4XSwgInNzZXRtbjsiOiAweDIyMTYsCiAgICAgICAgICAgICAgICAic3NtaWxlOyI6IDB4MjMyMywgInNzdGFyZjsiOiAweDIyYzYsCiAgICAgICAgICAgICAgICAic3RhcjsiOiAweDI2MDYsICJzdGFyZjsiOiAweDI2MDUsCiAgICAgICAgICAgICAgICAic3RyYWlnaHRlcHNpbG9uOyI6IDB4M2Y1LCAic3RyYWlnaHRwaGk7IjogMHgzZDUsCiAgICAgICAgICAgICAgICAic3RybnM7IjogMHhhZiwgInN1YjsiOiAweDIyODIsCiAgICAgICAgICAgICAgICAic3ViRTsiOiAweDJhYzUsICJzdWJkb3Q7IjogMHgyYWJkLAogICAgICAgICAgICAgICAgInN1YmU7IjogMHgyMjg2LCAic3ViZWRvdDsiOiAweDJhYzMsCiAgICAgICAgICAgICAgICAic3VibXVsdDsiOiAweDJhYzEsICJzdWJuRTsiOiAweDJhY2IsCiAgICAgICAgICAgICAgICAic3VibmU7IjogMHgyMjhhLCAic3VicGx1czsiOiAweDJhYmYsCiAgICAgICAgICAgICAgICAic3VicmFycjsiOiAweDI5NzksICJzdWJzZXQ7IjogMHgyMjgyLAogICAgICAgICAgICAgICAgInN1YnNldGVxOyI6IDB4MjI4NiwgInN1YnNldGVxcTsiOiAweDJhYzUsCiAgICAgICAgICAgICAgICAic3Vic2V0bmVxOyI6IDB4MjI4YSwgInN1YnNldG5lcXE7IjogMHgyYWNiLAogICAgICAgICAgICAgICAgInN1YnNpbTsiOiAweDJhYzcsICJzdWJzdWI7IjogMHgyYWQ1LAogICAgICAgICAgICAgICAgInN1YnN1cDsiOiAweDJhZDMsICJzdWNjOyI6IDB4MjI3YiwKICAgICAgICAgICAgICAgICJzdWNjYXBwcm94OyI6IDB4MmFiOCwgInN1Y2NjdXJseWVxOyI6IDB4MjI3ZCwKICAgICAgICAgICAgICAgICJzdWNjZXE7IjogMHgyYWIwLCAic3VjY25hcHByb3g7IjogMHgyYWJhLAogICAgICAgICAgICAgICAgInN1Y2NuZXFxOyI6IDB4MmFiNiwgInN1Y2Nuc2ltOyI6IDB4MjJlOSwKICAgICAgICAgICAgICAgICJzdWNjc2ltOyI6IDB4MjI3ZiwgInN1bTsiOiAweDIyMTEsCiAgICAgICAgICAgICAgICAic3VuZzsiOiAweDI2NmEsICJzdXA7IjogMHgyMjgzLAogICAgICAgICAgICAgICAgInN1cDE7IjogMHhiOSwgInN1cDI7IjogMHhiMiwKICAgICAgICAgICAgICAgICJzdXAzOyI6IDB4YjMsICJzdXBFOyI6IDB4MmFjNiwKICAgICAgICAgICAgICAgICJzdXBkb3Q7IjogMHgyYWJlLCAic3VwZHN1YjsiOiAweDJhZDgsCiAgICAgICAgICAgICAgICAic3VwZTsiOiAweDIyODcsICJzdXBlZG90OyI6IDB4MmFjNCwKICAgICAgICAgICAgICAgICJzdXBoc29sOyI6IDB4MjdjOSwgInN1cGhzdWI7IjogMHgyYWQ3LAogICAgICAgICAgICAgICAgInN1cGxhcnI7IjogMHgyOTdiLCAic3VwbXVsdDsiOiAweDJhYzIsCiAgICAgICAgICAgICAgICAic3VwbkU7IjogMHgyYWNjLCAic3VwbmU7IjogMHgyMjhiLAogICAgICAgICAgICAgICAgInN1cHBsdXM7IjogMHgyYWMwLCAic3Vwc2V0OyI6IDB4MjI4MywKICAgICAgICAgICAgICAgICJzdXBzZXRlcTsiOiAweDIyODcsICJzdXBzZXRlcXE7IjogMHgyYWM2LAogICAgICAgICAgICAgICAgInN1cHNldG5lcTsiOiAweDIyOGIsICJzdXBzZXRuZXFxOyI6IDB4MmFjYywKICAgICAgICAgICAgICAgICJzdXBzaW07IjogMHgyYWM4LCAic3Vwc3ViOyI6IDB4MmFkNCwKICAgICAgICAgICAgICAgICJzdXBzdXA7IjogMHgyYWQ2LCAic3dBcnI7IjogMHgyMWQ5LAogICAgICAgICAgICAgICAgInN3YXJoazsiOiAweDI5MjYsICJzd2FycjsiOiAweDIxOTksCiAgICAgICAgICAgICAgICAic3dhcnJvdzsiOiAweDIxOTksICJzd253YXI7IjogMHgyOTJhLAogICAgICAgICAgICAgICAgInN6bGlnOyI6IDB4ZGYsICJ0YXJnZXQ7IjogMHgyMzE2LAogICAgICAgICAgICAgICAgInRhdTsiOiAweDNjNCwgInRicms7IjogMHgyM2I0LAogICAgICAgICAgICAgICAgInRjYXJvbjsiOiAweDE2NSwgInRjZWRpbDsiOiAweDE2MywKICAgICAgICAgICAgICAgICJ0Y3k7IjogMHg0NDIsICJ0ZG90OyI6IDB4MjBkYiwKICAgICAgICAgICAgICAgICJ0ZWxyZWM7IjogMHgyMzE1LCAidGZyOyI6IFsweGQ4MzUsIDB4ZGQzMV0sCiAgICAgICAgICAgICAgICAidGhlcmU0OyI6IDB4MjIzNCwgInRoZXJlZm9yZTsiOiAweDIyMzQsCiAgICAgICAgICAgICAgICAidGhldGE7IjogMHgzYjgsICJ0aGV0YXN5bTsiOiAweDNkMSwKICAgICAgICAgICAgICAgICJ0aGV0YXY7IjogMHgzZDEsICJ0aGlja2FwcHJveDsiOiAweDIyNDgsCiAgICAgICAgICAgICAgICAidGhpY2tzaW07IjogMHgyMjNjLCAidGhpbnNwOyI6IDB4MjAwOSwKICAgICAgICAgICAgICAgICJ0aGthcDsiOiAweDIyNDgsICJ0aGtzaW07IjogMHgyMjNjLAogICAgICAgICAgICAgICAgInRob3JuOyI6IDB4ZmUsICJ0aWxkZTsiOiAweDJkYywKICAgICAgICAgICAgICAgICJ0aW1lczsiOiAweGQ3LCAidGltZXNiOyI6IDB4MjJhMCwKICAgICAgICAgICAgICAgICJ0aW1lc2JhcjsiOiAweDJhMzEsICJ0aW1lc2Q7IjogMHgyYTMwLAogICAgICAgICAgICAgICAgInRpbnQ7IjogMHgyMjJkLCAidG9lYTsiOiAweDI5MjgsCiAgICAgICAgICAgICAgICAidG9wOyI6IDB4MjJhNCwgInRvcGJvdDsiOiAweDIzMzYsCiAgICAgICAgICAgICAgICAidG9wY2lyOyI6IDB4MmFmMSwgInRvcGY7IjogWzB4ZDgzNSwgMHhkZDY1XSwKICAgICAgICAgICAgICAgICJ0b3Bmb3JrOyI6IDB4MmFkYSwgInRvc2E7IjogMHgyOTI5LAogICAgICAgICAgICAgICAgInRwcmltZTsiOiAweDIwMzQsICJ0cmFkZTsiOiAweDIxMjIsCiAgICAgICAgICAgICAgICAidHJpYW5nbGU7IjogMHgyNWI1LCAidHJpYW5nbGVkb3duOyI6IDB4MjViZiwKICAgICAgICAgICAgICAgICJ0cmlhbmdsZWxlZnQ7IjogMHgyNWMzLCAidHJpYW5nbGVsZWZ0ZXE7IjogMHgyMmI0LAogICAgICAgICAgICAgICAgInRyaWFuZ2xlcTsiOiAweDIyNWMsICJ0cmlhbmdsZXJpZ2h0OyI6IDB4MjViOSwKICAgICAgICAgICAgICAgICJ0cmlhbmdsZXJpZ2h0ZXE7IjogMHgyMmI1LCAidHJpZG90OyI6IDB4MjVlYywKICAgICAgICAgICAgICAgICJ0cmllOyI6IDB4MjI1YywgInRyaW1pbnVzOyI6IDB4MmEzYSwKICAgICAgICAgICAgICAgICJ0cmlwbHVzOyI6IDB4MmEzOSwgInRyaXNiOyI6IDB4MjljZCwKICAgICAgICAgICAgICAgICJ0cml0aW1lOyI6IDB4MmEzYiwgInRycGV6aXVtOyI6IDB4MjNlMiwKICAgICAgICAgICAgICAgICJ0c2NyOyI6IFsweGQ4MzUsIDB4ZGNjOV0sICJ0c2N5OyI6IDB4NDQ2LAogICAgICAgICAgICAgICAgInRzaGN5OyI6IDB4NDViLCAidHN0cm9rOyI6IDB4MTY3LAogICAgICAgICAgICAgICAgInR3aXh0OyI6IDB4MjI2YywgInR3b2hlYWRsZWZ0YXJyb3c7IjogMHgyMTllLAogICAgICAgICAgICAgICAgInR3b2hlYWRyaWdodGFycm93OyI6IDB4MjFhMCwgInVBcnI7IjogMHgyMWQxLAogICAgICAgICAgICAgICAgInVIYXI7IjogMHgyOTYzLCAidWFjdXRlOyI6IDB4ZmEsCiAgICAgICAgICAgICAgICAidWFycjsiOiAweDIxOTEsICJ1YnJjeTsiOiAweDQ1ZSwKICAgICAgICAgICAgICAgICJ1YnJldmU7IjogMHgxNmQsICJ1Y2lyYzsiOiAweGZiLAogICAgICAgICAgICAgICAgInVjeTsiOiAweDQ0MywgInVkYXJyOyI6IDB4MjFjNSwKICAgICAgICAgICAgICAgICJ1ZGJsYWM7IjogMHgxNzEsICJ1ZGhhcjsiOiAweDI5NmUsCiAgICAgICAgICAgICAgICAidWZpc2h0OyI6IDB4Mjk3ZSwgInVmcjsiOiBbMHhkODM1LCAweGRkMzJdLAogICAgICAgICAgICAgICAgInVncmF2ZTsiOiAweGY5LCAidWhhcmw7IjogMHgyMWJmLAogICAgICAgICAgICAgICAgInVoYXJyOyI6IDB4MjFiZSwgInVoYmxrOyI6IDB4MjU4MCwKICAgICAgICAgICAgICAgICJ1bGNvcm47IjogMHgyMzFjLCAidWxjb3JuZXI7IjogMHgyMzFjLAogICAgICAgICAgICAgICAgInVsY3JvcDsiOiAweDIzMGYsICJ1bHRyaTsiOiAweDI1ZjgsCiAgICAgICAgICAgICAgICAidW1hY3I7IjogMHgxNmIsICJ1bWw7IjogMHhhOCwKICAgICAgICAgICAgICAgICJ1b2dvbjsiOiAweDE3MywgInVvcGY7IjogWzB4ZDgzNSwgMHhkZDY2XSwKICAgICAgICAgICAgICAgICJ1cGFycm93OyI6IDB4MjE5MSwgInVwZG93bmFycm93OyI6IDB4MjE5NSwKICAgICAgICAgICAgICAgICJ1cGhhcnBvb25sZWZ0OyI6IDB4MjFiZiwgInVwaGFycG9vbnJpZ2h0OyI6IDB4MjFiZSwKICAgICAgICAgICAgICAgICJ1cGx1czsiOiAweDIyOGUsICJ1cHNpOyI6IDB4M2M1LAogICAgICAgICAgICAgICAgInVwc2loOyI6IDB4M2QyLCAidXBzaWxvbjsiOiAweDNjNSwKICAgICAgICAgICAgICAgICJ1cHVwYXJyb3dzOyI6IDB4MjFjOCwgInVyY29ybjsiOiAweDIzMWQsCiAgICAgICAgICAgICAgICAidXJjb3JuZXI7IjogMHgyMzFkLCAidXJjcm9wOyI6IDB4MjMwZSwKICAgICAgICAgICAgICAgICJ1cmluZzsiOiAweDE2ZiwgInVydHJpOyI6IDB4MjVmOSwKICAgICAgICAgICAgICAgICJ1c2NyOyI6IFsweGQ4MzUsIDB4ZGNjYV0sICJ1dGRvdDsiOiAweDIyZjAsCiAgICAgICAgICAgICAgICAidXRpbGRlOyI6IDB4MTY5LCAidXRyaTsiOiAweDI1YjUsCiAgICAgICAgICAgICAgICAidXRyaWY7IjogMHgyNWI0LCAidXVhcnI7IjogMHgyMWM4LAogICAgICAgICAgICAgICAgInV1bWw7IjogMHhmYywgInV3YW5nbGU7IjogMHgyOWE3LAogICAgICAgICAgICAgICAgInZBcnI7IjogMHgyMWQ1LCAidkJhcjsiOiAweDJhZTgsCiAgICAgICAgICAgICAgICAidkJhcnY7IjogMHgyYWU5LCAidkRhc2g7IjogMHgyMmE4LAogICAgICAgICAgICAgICAgInZhbmdydDsiOiAweDI5OWMsICJ2YXJlcHNpbG9uOyI6IDB4M2Y1LAogICAgICAgICAgICAgICAgInZhcmthcHBhOyI6IDB4M2YwLCAidmFybm90aGluZzsiOiAweDIyMDUsCiAgICAgICAgICAgICAgICAidmFycGhpOyI6IDB4M2Q1LCAidmFycGk7IjogMHgzZDYsCiAgICAgICAgICAgICAgICAidmFycHJvcHRvOyI6IDB4MjIxZCwgInZhcnI7IjogMHgyMTk1LAogICAgICAgICAgICAgICAgInZhcnJobzsiOiAweDNmMSwgInZhcnNpZ21hOyI6IDB4M2MyLAogICAgICAgICAgICAgICAgInZhcnN1YnNldG5lcTsiOiBbMHgyMjhhLCAweGZlMDBdLCAidmFyc3Vic2V0bmVxcTsiOiBbMHgyYWNiLCAweGZlMDBdLAogICAgICAgICAgICAgICAgInZhcnN1cHNldG5lcTsiOiBbMHgyMjhiLCAweGZlMDBdLCAidmFyc3Vwc2V0bmVxcTsiOiBbMHgyYWNjLCAweGZlMDBdLAogICAgICAgICAgICAgICAgInZhcnRoZXRhOyI6IDB4M2QxLCAidmFydHJpYW5nbGVsZWZ0OyI6IDB4MjJiMiwKICAgICAgICAgICAgICAgICJ2YXJ0cmlhbmdsZXJpZ2h0OyI6IDB4MjJiMywgInZjeTsiOiAweDQzMiwKICAgICAgICAgICAgICAgICJ2ZGFzaDsiOiAweDIyYTIsICJ2ZWU7IjogMHgyMjI4LAogICAgICAgICAgICAgICAgInZlZWJhcjsiOiAweDIyYmIsICJ2ZWVlcTsiOiAweDIyNWEsCiAgICAgICAgICAgICAgICAidmVsbGlwOyI6IDB4MjJlZSwgInZlcmJhcjsiOiAweDdjLAogICAgICAgICAgICAgICAgInZlcnQ7IjogMHg3YywgInZmcjsiOiBbMHhkODM1LCAweGRkMzNdLAogICAgICAgICAgICAgICAgInZsdHJpOyI6IDB4MjJiMiwgInZuc3ViOyI6IFsweDIyODIsIDB4MjBkMl0sCiAgICAgICAgICAgICAgICAidm5zdXA7IjogWzB4MjI4MywgMHgyMGQyXSwgInZvcGY7IjogWzB4ZDgzNSwgMHhkZDY3XSwKICAgICAgICAgICAgICAgICJ2cHJvcDsiOiAweDIyMWQsICJ2cnRyaTsiOiAweDIyYjMsCiAgICAgICAgICAgICAgICAidnNjcjsiOiBbMHhkODM1LCAweGRjY2JdLCAidnN1Ym5FOyI6IFsweDJhY2IsIDB4ZmUwMF0sCiAgICAgICAgICAgICAgICAidnN1Ym5lOyI6IFsweDIyOGEsIDB4ZmUwMF0sICJ2c3VwbkU7IjogWzB4MmFjYywgMHhmZTAwXSwKICAgICAgICAgICAgICAgICJ2c3VwbmU7IjogWzB4MjI4YiwgMHhmZTAwXSwgInZ6aWd6YWc7IjogMHgyOTlhLAogICAgICAgICAgICAgICAgIndjaXJjOyI6IDB4MTc1LCAid2VkYmFyOyI6IDB4MmE1ZiwKICAgICAgICAgICAgICAgICJ3ZWRnZTsiOiAweDIyMjcsICJ3ZWRnZXE7IjogMHgyMjU5LAogICAgICAgICAgICAgICAgIndlaWVycDsiOiAweDIxMTgsICJ3ZnI7IjogWzB4ZDgzNSwgMHhkZDM0XSwKICAgICAgICAgICAgICAgICJ3b3BmOyI6IFsweGQ4MzUsIDB4ZGQ2OF0sICJ3cDsiOiAweDIxMTgsCiAgICAgICAgICAgICAgICAid3I7IjogMHgyMjQwLCAid3JlYXRoOyI6IDB4MjI0MCwKICAgICAgICAgICAgICAgICJ3c2NyOyI6IFsweGQ4MzUsIDB4ZGNjY10sICJ4Y2FwOyI6IDB4MjJjMiwKICAgICAgICAgICAgICAgICJ4Y2lyYzsiOiAweDI1ZWYsICJ4Y3VwOyI6IDB4MjJjMywKICAgICAgICAgICAgICAgICJ4ZHRyaTsiOiAweDI1YmQsICJ4ZnI7IjogWzB4ZDgzNSwgMHhkZDM1XSwKICAgICAgICAgICAgICAgICJ4aEFycjsiOiAweDI3ZmEsICJ4aGFycjsiOiAweDI3ZjcsCiAgICAgICAgICAgICAgICAieGk7IjogMHgzYmUsICJ4bEFycjsiOiAweDI3ZjgsCiAgICAgICAgICAgICAgICAieGxhcnI7IjogMHgyN2Y1LCAieG1hcDsiOiAweDI3ZmMsCiAgICAgICAgICAgICAgICAieG5pczsiOiAweDIyZmIsICJ4b2RvdDsiOiAweDJhMDAsCiAgICAgICAgICAgICAgICAieG9wZjsiOiBbMHhkODM1LCAweGRkNjldLCAieG9wbHVzOyI6IDB4MmEwMSwKICAgICAgICAgICAgICAgICJ4b3RpbWU7IjogMHgyYTAyLCAieHJBcnI7IjogMHgyN2Y5LAogICAgICAgICAgICAgICAgInhyYXJyOyI6IDB4MjdmNiwgInhzY3I7IjogWzB4ZDgzNSwgMHhkY2NkXSwKICAgICAgICAgICAgICAgICJ4c3FjdXA7IjogMHgyYTA2LCAieHVwbHVzOyI6IDB4MmEwNCwKICAgICAgICAgICAgICAgICJ4dXRyaTsiOiAweDI1YjMsICJ4dmVlOyI6IDB4MjJjMSwKICAgICAgICAgICAgICAgICJ4d2VkZ2U7IjogMHgyMmMwLCAieWFjdXRlOyI6IDB4ZmQsCiAgICAgICAgICAgICAgICAieWFjeTsiOiAweDQ0ZiwgInljaXJjOyI6IDB4MTc3LAogICAgICAgICAgICAgICAgInljeTsiOiAweDQ0YiwgInllbjsiOiAweGE1LAogICAgICAgICAgICAgICAgInlmcjsiOiBbMHhkODM1LCAweGRkMzZdLCAieWljeTsiOiAweDQ1NywKICAgICAgICAgICAgICAgICJ5b3BmOyI6IFsweGQ4MzUsIDB4ZGQ2YV0sICJ5c2NyOyI6IFsweGQ4MzUsIDB4ZGNjZV0sCiAgICAgICAgICAgICAgICAieXVjeTsiOiAweDQ0ZSwgInl1bWw7IjogMHhmZiwKICAgICAgICAgICAgICAgICJ6YWN1dGU7IjogMHgxN2EsICJ6Y2Fyb247IjogMHgxN2UsCiAgICAgICAgICAgICAgICAiemN5OyI6IDB4NDM3LCAiemRvdDsiOiAweDE3YywKICAgICAgICAgICAgICAgICJ6ZWV0cmY7IjogMHgyMTI4LCAiemV0YTsiOiAweDNiNiwKICAgICAgICAgICAgICAgICJ6ZnI7IjogWzB4ZDgzNSwgMHhkZDM3XSwgInpoY3k7IjogMHg0MzYsCiAgICAgICAgICAgICAgICAiemlncmFycjsiOiAweDIxZGQsICJ6b3BmOyI6IFsweGQ4MzUsIDB4ZGQ2Yl0sCiAgICAgICAgICAgICAgICAienNjcjsiOiBbMHhkODM1LCAweGRjY2ZdLCAiendqOyI6IDB4MjAwZCwKICAgICAgICAgICAgICAgICJ6d25qOyI6IDB4MjAwYwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFJlZ3VsYXIgZXhwcmVzc2lvbiBjb25zdGFudHMgdXNlZCBieSB0aGUgdG9rZW5pemVyIGFuZCBwYXJzZXIKCiAgICAgICAgICAgIC8vIFRoaXMgcmVndWxhciBleHByZXNzaW9uIG1hdGNoZXMgdGhlIHBvcnRpb24gb2YgYSBjaGFyYWN0ZXIgcmVmZXJlbmNlCiAgICAgICAgICAgIC8vIChkZWNpbWFsLCBoZXgsIG9yIG5hbWVkKSB0aGF0IGNvbWVzIGFmdGVyIHRoZSBhbXBlcnNhbmQuIEknZCBsaWtlIHRvCiAgICAgICAgICAgIC8vIHVzZSB0aGUgeSBtb2RpZmllciB0byBtYWtlIGl0IG1hdGNoIGF0IGxhc3RJbmRleCwgYnV0IGZvciBjb21wYXRhYmlsaXR5CiAgICAgICAgICAgIC8vIHdpdGggTm9kZSwgSSBjYW4ndC4KICAgICAgICAgICAgdmFyIENIQVJSRUYgPSAvXiNbMC05XStbXjAtOV18XiNbeFhdWzAtOWEtZkEtRl0rW14wLTlhLWZBLUZdfF5bYS16QS1aXVthLXpBLVowLTldKlteYS16QS1aMC05XS87CgogICAgICAgICAgICAvLyBMaWtlIHRoZSBhYm92ZSwgYnV0IGZvciBuYW1lZCBjaGFyIHJlZnMsIHRoZSBsYXN0IGNoYXIgY2FuJ3QgYmUgPQogICAgICAgICAgICB2YXIgQVRUUkNIQVJSRUYgPSAvXiNbMC05XStbXjAtOV18XiNbeFhdWzAtOWEtZkEtRl0rW14wLTlhLWZBLUZdfF5bYS16QS1aXVthLXpBLVowLTldKltePWEtekEtWjAtOV0vOwoKICAgICAgICAgICAgdmFyIERBVEFURVhUID0gL1teJjxcclx1MDAwMFx1ZmZmZl0qL2c7CiAgICAgICAgICAgIHZhciBSQVdURVhUID0gL1tePFxyXHUwMDAwXHVmZmZmXSovZzsKICAgICAgICAgICAgdmFyIFBMQUlOVEVYVCA9IC9bXlxyXHUwMDAwXHVmZmZmXSovZzsKICAgICAgICAgICAgdmFyIFNJTVBMRVRBRyA9IC9eKFwvKT8oW2Etel0rKT4vOwogICAgICAgICAgICB2YXIgU0lNUExFQVRUUiA9IC9eKFthLXpdKykgKj0gKignW14nJlxyXHUwMDAwXSonfCJbXiImXHJcdTAwMDBdKiJ8W14mPiBcdFxuXHJcZlx1MDAwMF1bIFx0XG5cZl0pLzsKCiAgICAgICAgICAgIHZhciBOT05XUyA9IC9bXlx4MDlceDBBXHgwQ1x4MERceDIwXS87CiAgICAgICAgICAgIHZhciBBTExOT05XUyA9IC9bXlx4MDlceDBBXHgwQ1x4MERceDIwXS9nOyAvLyBsaWtlIGFib3ZlLCB3aXRoIGcgZmxhZwogICAgICAgICAgICB2YXIgTk9OV1NOT05OVUwgPSAvW15ceDAwXHgwOVx4MEFceDBDXHgwRFx4MjBdLzsgLy8gZG9uJ3QgYWxsb3cgTlVMIGVpdGhlcgogICAgICAgICAgICB2YXIgTEVBRElOR1dTID0gL15bXHgwOVx4MEFceDBDXHgwRFx4MjBdKy87CiAgICAgICAgICAgIHZhciBOVUxDSEFSUyA9IC9ceDAwL2c7CgogICAgICAgICAgICAvKioqCiAgICAgICAgICAgICAqIFRoZXNlIGFyZSB1dGlsaXR5IGZ1bmN0aW9ucyB0aGF0IGRvbid0IHVzZSBhbnkgb2YgdGhlIHBhcnNlcidzCiAgICAgICAgICAgICAqIGludGVybmFsIHN0YXRlLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgZnVuY3Rpb24gYnVmMnN0cihidWYpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhcHBseShmcm9tQ2hhckNvZGUsIFN0cmluZywgYnVmKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGVsZW1lbnQgaXMgYSBtZW1iZXIgb2YgdGhlIHNldC4KICAgICAgICAgICAgLy8gVGhlIHNldCBpcyBhbiBvYmplY3QgdGhhdCBtYXBzIG5hbWVzcGFjZXMgdG8gb2JqZWN0cy4gVGhlIG9iamVjdHMKICAgICAgICAgICAgLy8gdGhlbiBtYXAgbG9jYWwgdGFnbmFtZXMgdG8gdGhlIHZhbHVlIHRydWUgaWYgdGhhdCB0YWcgaXMgcGFydCBvZiB0aGUgc2V0CiAgICAgICAgICAgIGZ1bmN0aW9uIGlzQShlbHQsIHNldCkgewogICAgICAgICAgICAgICAgdmFyIHRhZ25hbWVzID0gc2V0W2VsdC5uYW1lc3BhY2VVUkldOwogICAgICAgICAgICAgICAgcmV0dXJuIHRhZ25hbWVzID8gZWx0LmxvY2FsTmFtZSBpbiB0YWduYW1lcyA6IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpc01hdGhtbFRleHRJbnRlZ3JhdGlvblBvaW50KG4pIHsKICAgICAgICAgICAgICAgIHJldHVybiBpc0EobiwgbWF0aG1sVGV4dEludGVncmF0aW9uUG9pbnRTZXQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpc0hUTUxJbnRlZ3JhdGlvblBvaW50KG4pIHsKICAgICAgICAgICAgICAgIGlmIChpc0EobiwgaHRtbEludGVncmF0aW9uUG9pbnRTZXQpKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChuLm5hbWVzcGFjZVVSSSA9PT0gTUFUSE1MX05BTUVTUEFDRSAmJiBuLmxvY2FsTmFtZSA9PT0gImFubm90YXRpb24teG1sIikgewogICAgICAgICAgICAgICAgICAgIHZhciBlbmNvZGluZyA9IG4uZ2V0QXR0cmlidXRlKCJlbmNvZGluZyIpOwogICAgICAgICAgICAgICAgICAgIGlmIChlbmNvZGluZykgZW5jb2RpbmcgPSB0b0xvd2VyQ2FzZShlbmNvZGluZyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVuY29kaW5nID09PSAidGV4dC9odG1sIiB8fCBlbmNvZGluZyA9PT0gImFwcGxpY2F0aW9uL3hodG1sK3htbCIpIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBhZGp1c3RTVkdUYWdOYW1lKG5hbWUpIHsKICAgICAgICAgICAgICAgIGlmIChuYW1lIGluIHN2Z1RhZ05hbWVBZGp1c3RtZW50cykgcmV0dXJuIHN2Z1RhZ05hbWVBZGp1c3RtZW50c1tuYW1lXTtlbHNlIHJldHVybiBuYW1lOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBhZGp1c3RTVkdBdHRyaWJ1dGVzKGF0dHJzKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IGF0dHJzLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChhdHRyc1tpXVswXSBpbiBzdmdBdHRyQWRqdXN0bWVudHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnNbaV1bMF0gPSBzdmdBdHRyQWRqdXN0bWVudHNbYXR0cnNbaV1bMF1dOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gYWRqdXN0TWF0aE1MQXR0cmlidXRlcyhhdHRycykgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBhdHRycy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cnNbaV1bMF0gPT09ICJkZWZpbml0aW9udXJsIikgewogICAgICAgICAgICAgICAgICAgICAgICBhdHRyc1tpXVswXSA9ICJkZWZpbml0aW9uVVJMIjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBhZGp1c3RGb3JlaWduQXR0cmlidXRlcyhhdHRycykgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBhdHRycy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cnNbaV1bMF0gaW4gZm9yZWlnbkF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXR0cmlidXRlcyB3aXRoIG5hbWVzcGFjZXMgZ2V0IGEgM3JkIGVsZW1lbnQ6CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFtRbmFtZSwgdmFsdWUsIG5hbWVzcGFjZV0KICAgICAgICAgICAgICAgICAgICAgICAgcHVzaChhdHRyc1tpXSwgZm9yZWlnbkF0dHJpYnV0ZXNbYXR0cnNbaV1bMF1dKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEZvciBlYWNoIGF0dHJpYnV0ZSBpbiBhdHRycywgaWYgZWx0IGRvZXNuJ3QgaGF2ZSBhbiBhdHRyaWJ1dGUKICAgICAgICAgICAgLy8gYnkgdGhhdCBuYW1lLCBhZGQgdGhlIGF0dHJpYnV0ZSB0byBlbHQKICAgICAgICAgICAgLy8gWFhYOiBJJ20gaWdub3JpbmcgbmFtZXNwYWNlcyBmb3Igbm93CiAgICAgICAgICAgIGZ1bmN0aW9uIHRyYW5zZmVyQXR0cmlidXRlcyhhdHRycywgZWx0KSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IGF0dHJzLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gYXR0cnNbaV1bMF0sCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gYXR0cnNbaV1bMV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGVsdC5oYXNBdHRyaWJ1dGUobmFtZSkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGVsdC5fc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLyoqKgogICAgICAgICAgICAgKiBUaGUgRWxlbWVudFN0YWNrIGNsYXNzCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBIVE1MUGFyc2VyLkVsZW1lbnRTdGFjayA9IGZ1bmN0aW9uIEVsZW1lbnRTdGFjaygpIHsKICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudHMgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMudG9wID0gbnVsbDsgLy8gc3RhY2sudG9wIGlzIHRoZSAiY3VycmVudCBub2RlIiBpbiB0aGUgc3BlYwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLyoKICAgICAgICAgICAgLy8gVGhpcyBpcyBmb3IgZGVidWdnaW5nIG9ubHkKICAgICAgICAgICAgSFRNTFBhcnNlci5FbGVtZW50U3RhY2sucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICJTVEFDSzogIiArCiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRzLm1hcChmdW5jdGlvbihlKSB7cmV0dXJuIGUubG9jYWxOYW1lO30pLmpvaW4oIi0iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAqLwoKICAgICAgICAgICAgSFRNTFBhcnNlci5FbGVtZW50U3RhY2sucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgcHVzaCh0aGlzLmVsZW1lbnRzLCBlKTsKICAgICAgICAgICAgICAgIHRoaXMudG9wID0gZTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIEhUTUxQYXJzZXIuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5wb3AgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgcG9wKHRoaXMuZWxlbWVudHMpOwogICAgICAgICAgICAgICAgdGhpcy50b3AgPSB0aGlzLmVsZW1lbnRzW3RoaXMuZWxlbWVudHMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBQb3AgZWxlbWVudHMgb2ZmIHRoZSBzdGFjayB1cCB0byBhbmQgaW5jbHVkaW5nIHRoZSBmaXJzdAogICAgICAgICAgICAvLyBlbGVtZW50IHdpdGggdGhlIHNwZWNpZmllZCAoSFRNTCkgdGFnbmFtZQogICAgICAgICAgICBIVE1MUGFyc2VyLkVsZW1lbnRTdGFjay5wcm90b3R5cGUucG9wVGFnID0gZnVuY3Rpb24gKHRhZykgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuZWxlbWVudHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMuZWxlbWVudHNbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGUubmFtZXNwYWNlVVJJICE9PSBIVE1MX05BTUVTUEFDRSkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKGUubG9jYWxOYW1lID09PSB0YWcpIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50cy5sZW5ndGggPSBpOwogICAgICAgICAgICAgICAgdGhpcy50b3AgPSB0aGlzLmVsZW1lbnRzW2kgLSAxXTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIFBvcCBlbGVtZW50cyBvZmYgdGhlIHN0YWNrIHVwIHRvIGFuZCBpbmNsdWRpbmcgdGhlIGZpcnN0CiAgICAgICAgICAgIC8vIGVsZW1lbnQgdGhhdCBpcyBhbiBpbnN0YW5jZSBvZiB0aGUgc3BlY2lmaWVkIHR5cGUKICAgICAgICAgICAgSFRNTFBhcnNlci5FbGVtZW50U3RhY2sucHJvdG90eXBlLnBvcEVsZW1lbnRUeXBlID0gZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmVsZW1lbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudHNbaV0gaW5zdGFuY2VvZiB0eXBlKSBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudHMubGVuZ3RoID0gaTsKICAgICAgICAgICAgICAgIHRoaXMudG9wID0gdGhpcy5lbGVtZW50c1tpIC0gMV07CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBQb3AgZWxlbWVudHMgb2ZmIHRoZSBzdGFjayB1cCB0byBhbmQgaW5jbHVkaW5nIHRoZSBlbGVtZW50IGUuCiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCB0aGlzIGlzIHZlcnkgZGlmZmVyZW50IGZyb20gcmVtb3ZlRWxlbWVudCgpCiAgICAgICAgICAgIC8vIFRoaXMgcmVxdWlyZXMgdGhhdCBlIGlzIG9uIHRoZSBzdGFjay4KICAgICAgICAgICAgSFRNTFBhcnNlci5FbGVtZW50U3RhY2sucHJvdG90eXBlLnBvcEVsZW1lbnQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuZWxlbWVudHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lbGVtZW50c1tpXSA9PT0gZSkgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRzLmxlbmd0aCA9IGk7CiAgICAgICAgICAgICAgICB0aGlzLnRvcCA9IHRoaXMuZWxlbWVudHNbaSAtIDFdOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gUmVtb3ZlIGEgc3BlY2lmaWMgZWxlbWVudCBmcm9tIHRoZSBzdGFjay4KICAgICAgICAgICAgLy8gRG8gbm90aGluZyBpZiB0aGUgZWxlbWVudCBpcyBub3Qgb24gdGhlIHN0YWNrCiAgICAgICAgICAgIEhUTUxQYXJzZXIuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5yZW1vdmVFbGVtZW50ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvcCA9PT0gZSkgdGhpcy5wb3AoKTtlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gQS5sYXN0SW5kZXhPZih0aGlzLmVsZW1lbnRzLCBlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaWR4ICE9PSAtMSkgc3BsaWNlKHRoaXMuZWxlbWVudHMsIGlkeCwgMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBIVE1MUGFyc2VyLkVsZW1lbnRTdGFjay5wcm90b3R5cGUuY2xlYXJUb0NvbnRleHQgPSBmdW5jdGlvbiAodHlwZSkgewogICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHdlIGRvbid0IGxvb3AgdG8gMC4gTmV2ZXIgcG9wIHRoZSA8aHRtbD4gZWx0IG9mZi4KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmVsZW1lbnRzLmxlbmd0aCAtIDE7IGkgPiAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lbGVtZW50c1tpXSBpbnN0YW5jZW9mIHR5cGUpIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50cy5sZW5ndGggPSBpICsgMTsKICAgICAgICAgICAgICAgIHRoaXMudG9wID0gdGhpcy5lbGVtZW50c1tpXTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIEhUTUxQYXJzZXIuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5pblNwZWNpZmljU2NvcGUgPSBmdW5jdGlvbiAodGFnLCBzZXQpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmVsZW1lbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVsdCA9IHRoaXMuZWxlbWVudHNbaV07CiAgICAgICAgICAgICAgICAgICAgdmFyIG5zID0gZWx0Lm5hbWVzcGFjZVVSSTsKICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYWxuYW1lID0gZWx0LmxvY2FsTmFtZTsKICAgICAgICAgICAgICAgICAgICBpZiAobnMgPT09IEhUTUxfTkFNRVNQQUNFICYmIGxvY2FsbmFtZSA9PT0gdGFnKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB2YXIgdGFncyA9IHNldFtuc107CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZ3MgJiYgbG9jYWxuYW1lIGluIHRhZ3MpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIExpa2UgdGhlIGFib3ZlLCBidXQgZm9yIGEgc3BlY2lmaWMgZWxlbWVudCwgbm90IGEgdGFnbmFtZQogICAgICAgICAgICBIVE1MUGFyc2VyLkVsZW1lbnRTdGFjay5wcm90b3R5cGUuZWxlbWVudEluU3BlY2lmaWNTY29wZSA9IGZ1bmN0aW9uICh0YXJnZXQsIHNldCkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuZWxlbWVudHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZWx0ID0gdGhpcy5lbGVtZW50c1tpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoZWx0ID09PSB0YXJnZXQpIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIHZhciB0YWdzID0gc2V0W2VsdC5uYW1lc3BhY2VVUkldOwogICAgICAgICAgICAgICAgICAgIGlmICh0YWdzICYmIGVsdC5sb2NhbE5hbWUgaW4gdGFncykgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gTGlrZSB0aGUgYWJvdmUsIGJ1dCBmb3IgYW4gZWxlbWVudCBpbnRlcmZhY2UsIG5vdCBhIHRhZ25hbWUKICAgICAgICAgICAgSFRNTFBhcnNlci5FbGVtZW50U3RhY2sucHJvdG90eXBlLmVsZW1lbnRUeXBlSW5TcGVjaWZpY1Njb3BlID0gZnVuY3Rpb24gKHRhcmdldCwgc2V0KSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5lbGVtZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgIHZhciBlbHQgPSB0aGlzLmVsZW1lbnRzW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChlbHQgaW5zdGFuY2VvZiB0YXJnZXQpIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIHZhciB0YWdzID0gc2V0W2VsdC5uYW1lc3BhY2VVUkldOwogICAgICAgICAgICAgICAgICAgIGlmICh0YWdzICYmIGVsdC5sb2NhbE5hbWUgaW4gdGFncykgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgSFRNTFBhcnNlci5FbGVtZW50U3RhY2sucHJvdG90eXBlLmluU2NvcGUgPSBmdW5jdGlvbiAodGFnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pblNwZWNpZmljU2NvcGUodGFnLCBpblNjb3BlU2V0KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIEhUTUxQYXJzZXIuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5lbGVtZW50SW5TY29wZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50SW5TcGVjaWZpY1Njb3BlKGUsIGluU2NvcGVTZXQpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgSFRNTFBhcnNlci5FbGVtZW50U3RhY2sucHJvdG90eXBlLmVsZW1lbnRUeXBlSW5TY29wZSA9IGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50VHlwZUluU3BlY2lmaWNTY29wZSh0eXBlLCBpblNjb3BlU2V0KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIEhUTUxQYXJzZXIuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5pbkJ1dHRvblNjb3BlID0gZnVuY3Rpb24gKHRhZykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5TcGVjaWZpY1Njb3BlKHRhZywgaW5CdXR0b25TY29wZVNldCk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBIVE1MUGFyc2VyLkVsZW1lbnRTdGFjay5wcm90b3R5cGUuaW5MaXN0SXRlbVNjb3BlID0gZnVuY3Rpb24gKHRhZykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5TcGVjaWZpY1Njb3BlKHRhZywgaW5MaXN0SXRlbVNjb3BlU2V0KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIEhUTUxQYXJzZXIuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5pblRhYmxlU2NvcGUgPSBmdW5jdGlvbiAodGFnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pblNwZWNpZmljU2NvcGUodGFnLCBpblRhYmxlU2NvcGVTZXQpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgSFRNTFBhcnNlci5FbGVtZW50U3RhY2sucHJvdG90eXBlLmluU2VsZWN0U2NvcGUgPSBmdW5jdGlvbiAodGFnKSB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBpbXBsZW1lbnQgdGhpcyBvbmUgd2l0aCBpblNwZWNpZmljU2NvcGUsIHNpbmNlIGl0IGludm9sdmVzCiAgICAgICAgICAgICAgICAvLyBhIHNldCBkZWZpbmVkIGJ5IGludmVydGluZyBhbm90aGVyIHNldC4gU28gaW1wbGVtZW50IG1hbnVhbGx5LgogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuZWxlbWVudHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZWx0ID0gdGhpcy5lbGVtZW50c1tpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoZWx0Lm5hbWVzcGFjZVVSSSAhPT0gSFRNTF9OQU1FU1BBQ0UpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYWxuYW1lID0gZWx0LmxvY2FsTmFtZTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9jYWxuYW1lID09PSB0YWcpIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbG5hbWUgIT09ICJvcHRncm91cCIgJiYgbG9jYWxuYW1lICE9PSAib3B0aW9uIikgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgSFRNTFBhcnNlci5FbGVtZW50U3RhY2sucHJvdG90eXBlLmdlbmVyYXRlSW1wbGllZEVuZFRhZ3MgPSBmdW5jdGlvbiAoYnV0bm90KSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5lbGVtZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcy5lbGVtZW50c1tpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoYnV0bm90ICYmIGUubG9jYWxOYW1lID09PSBidXRub3QpIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGlmICghaXNBKHRoaXMuZWxlbWVudHNbaV0sIGltcGxpZWRFbmRUYWdzU2V0KSkgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50cy5sZW5ndGggPSBpICsgMTsKICAgICAgICAgICAgICAgIHRoaXMudG9wID0gdGhpcy5lbGVtZW50c1tpXTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8qKioKICAgICAgICAgICAgICogVGhlIEFjdGl2ZUZvcm1hdHRpbmdFbGVtZW50cyBjbGFzcwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgSFRNTFBhcnNlci5BY3RpdmVGb3JtYXR0aW5nRWxlbWVudHMgPSBmdW5jdGlvbiBBRkUoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxpc3QgPSBbXTsgLy8gZWxlbWVudHMKICAgICAgICAgICAgICAgIHRoaXMuYXR0cnMgPSBbXTsgLy8gYXR0cmlidXRlIHRva2VucyBmb3IgY2xvbmluZwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgSFRNTFBhcnNlci5BY3RpdmVGb3JtYXR0aW5nRWxlbWVudHMucHJvdG90eXBlLk1BUktFUiA9IHsgbG9jYWxOYW1lOiAifCIgfTsKCiAgICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIEZvciBkZWJ1Z2dpbmcKICAgICAgICAgICAgSFRNTFBhcnNlci5BY3RpdmVGb3JtYXR0aW5nRWxlbWVudHMucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIkFGRTogIiArCiAgICAgICAgICAgICAgICB0aGlzLmxpc3QubWFwKGZ1bmN0aW9uKGUpIHsgcmV0dXJuIGUubG9jYWxOYW1lOyB9KS5qb2luKCItIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIEhUTUxQYXJzZXIuQWN0aXZlRm9ybWF0dGluZ0VsZW1lbnRzLnByb3RvdHlwZS5pbnNlcnRNYXJrZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBwdXNoKHRoaXMubGlzdCwgdGhpcy5NQVJLRVIpOwogICAgICAgICAgICAgICAgcHVzaCh0aGlzLmF0dHJzLCB0aGlzLk1BUktFUik7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBIVE1MUGFyc2VyLkFjdGl2ZUZvcm1hdHRpbmdFbGVtZW50cy5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uIChlbHQsIGF0dHJzKSB7CiAgICAgICAgICAgICAgICAvLyBTY2FuIGJhY2t3YXJkczogaWYgdGhlcmUgYXJlIGFscmVhZHkgMyBjb3BpZXMgb2YgdGhpcyBlbGVtZW50CiAgICAgICAgICAgICAgICAvLyBiZWZvcmUgd2UgZW5jb3VudGVyIGEgbWFya2VyLCB0aGVuIGRyb3AgdGhlIGxhc3Qgb25lCiAgICAgICAgICAgICAgICB2YXIgY291bnQgPSAwOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMubGlzdC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxpc3RbaV0gPT09IHRoaXMuTUFSS0VSKSBicmVhazsKICAgICAgICAgICAgICAgICAgICAvLyBlcXVhbCgpIGlzIGRlZmluZWQgYmVsb3cKICAgICAgICAgICAgICAgICAgICBpZiAoZXF1YWwoZWx0LCB0aGlzLmxpc3RbaV0sIHRoaXMuYXR0cnNbaV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCA9PT0gMykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BsaWNlKHRoaXMubGlzdCwgaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpY2UodGhpcy5hdHRycywgaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBOb3cgcHVzaCB0aGUgZWxlbWVudCBvbnRvIHRoZSBsaXN0CiAgICAgICAgICAgICAgICBwdXNoKHRoaXMubGlzdCwgZWx0KTsKCiAgICAgICAgICAgICAgICAvLyBDb3B5IHRoZSBhdHRyaWJ1dGVzIGFuZCBwdXNoIHRob3NlIG9uLCB0b28KICAgICAgICAgICAgICAgIHZhciBhdHRyY29weSA9IFtdOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhdHRycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGF0dHJjb3B5W2ldID0gYXR0cnNbaV07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHVzaCh0aGlzLmF0dHJzLCBhdHRyY29weSk7CgogICAgICAgICAgICAgICAgLy8gVGhpcyBmdW5jdGlvbiBkZWZpbmVzIGVxdWFsaXR5IG9mIHR3byBlbGVtZW50cyBmb3IgdGhlIHB1cnBvc2VzCiAgICAgICAgICAgICAgICAvLyBvZiB0aGUgQUZFIGxpc3QuICBOb3RlIHRoYXQgaXQgY29tcGFyZXMgdGhlIG5ldyBlbGVtZW50cwogICAgICAgICAgICAgICAgLy8gYXR0cmlidXRlcyB0byB0aGUgc2F2ZWQgYXJyYXkgb2YgYXR0cmlidXRlcyBhc3NvY2lhdGVkIHdpdGgKICAgICAgICAgICAgICAgIC8vIHRoZSBvbGQgZWxlbWVudCBiZWNhdXNlIGEgc2NyaXB0IGNvdWxkIGhhdmUgY2hhbmdlZCB0aGUKICAgICAgICAgICAgICAgIC8vIG9sZCBlbGVtZW50J3Mgc2V0IG9mIGF0dHJpYnV0ZXMKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGVxdWFsKG5ld2VsdCwgb2xkZWx0LCBvbGRhdHRycykgewogICAgICAgICAgICAgICAgICAgIGlmIChuZXdlbHQubG9jYWxOYW1lICE9PSBvbGRlbHQubG9jYWxOYW1lKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld2VsdC5fbnVtYXR0cnMgIT09IG9sZGF0dHJzLmxlbmd0aCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gb2xkYXR0cnMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvbGRuYW1lID0gb2xkYXR0cnNbaV1bMF07CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvbGR2YWwgPSBvbGRhdHRyc1tpXVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXdlbHQuaGFzQXR0cmlidXRlKG9sZG5hbWUpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdlbHQuZ2V0QXR0cmlidXRlKG9sZG5hbWUpICE9PSBvbGR2YWwpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBIVE1MUGFyc2VyLkFjdGl2ZUZvcm1hdHRpbmdFbGVtZW50cy5wcm90b3R5cGUuY2xlYXJUb01hcmtlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmxpc3QubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5saXN0W2ldID09PSB0aGlzLk1BUktFUikgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaSA8IDApIGkgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5saXN0Lmxlbmd0aCA9IGk7CiAgICAgICAgICAgICAgICB0aGlzLmF0dHJzLmxlbmd0aCA9IGk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBGaW5kIGFuZCByZXR1cm4gdGhlIGxhc3QgZWxlbWVudCB3aXRoIHRoZSBzcGVjaWZpZWQgdGFnIGJldHdlZW4gdGhlCiAgICAgICAgICAgIC8vIGVuZCBvZiB0aGUgbGlzdCBhbmQgdGhlIGxhc3QgbWFya2VyIG9uIHRoZSBsaXN0LgogICAgICAgICAgICAvLyBVc2VkIHdoZW4gcGFyc2luZyA8YT4gaW5fYm9keV9tb2RlKCkKICAgICAgICAgICAgSFRNTFBhcnNlci5BY3RpdmVGb3JtYXR0aW5nRWxlbWVudHMucHJvdG90eXBlLmZpbmRFbGVtZW50QnlUYWcgPSBmdW5jdGlvbiAodGFnKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5saXN0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVsdCA9IHRoaXMubGlzdFtpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoZWx0ID09PSB0aGlzLk1BUktFUikgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVsdC5sb2NhbE5hbWUgPT09IHRhZykgcmV0dXJuIGVsdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgSFRNTFBhcnNlci5BY3RpdmVGb3JtYXR0aW5nRWxlbWVudHMucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIEEubGFzdEluZGV4T2YodGhpcy5saXN0LCBlKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIEZpbmQgdGhlIGVsZW1lbnQgZSBpbiB0aGUgbGlzdCBhbmQgcmVtb3ZlIGl0CiAgICAgICAgICAgIC8vIFVzZWQgd2hlbiBwYXJzaW5nIDxhPiBpbl9ib2R5KCkKICAgICAgICAgICAgSFRNTFBhcnNlci5BY3RpdmVGb3JtYXR0aW5nRWxlbWVudHMucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICB2YXIgaWR4ID0gQS5sYXN0SW5kZXhPZih0aGlzLmxpc3QsIGUpOwogICAgICAgICAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBzcGxpY2UodGhpcy5saXN0LCBpZHgsIDEpOwogICAgICAgICAgICAgICAgICAgIHNwbGljZSh0aGlzLmF0dHJzLCBpZHgsIDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gRmluZCBlbGVtZW50IGEgaW4gdGhlIGxpc3QgYW5kIHJlcGxhY2UgaXQgd2l0aCBlbGVtZW50IGIKICAgICAgICAgICAgLy8gWFhYOiBEbyBJIG5lZWQgdG8gaGFuZGxlIGF0dHJpYnV0ZXMgaGVyZT8KICAgICAgICAgICAgSFRNTFBhcnNlci5BY3RpdmVGb3JtYXR0aW5nRWxlbWVudHMucHJvdG90eXBlLnJlcGxhY2UgPSBmdW5jdGlvbiAoYSwgYiwgYXR0cnMpIHsKICAgICAgICAgICAgICAgIHZhciBpZHggPSBBLmxhc3RJbmRleE9mKHRoaXMubGlzdCwgYSk7CiAgICAgICAgICAgICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdFtpZHhdID0gYjsKICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cnMpIHRoaXMuYXR0cnNbaWR4XSA9IGF0dHJzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gRmluZCBhIGluIHRoZSBsaXN0IGFuZCBpbnNlcnQgYiBhZnRlciBpdAogICAgICAgICAgICAvLyBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgaW5zZXJ0IGEgYm9va21hcmsgb2JqZWN0LCBzbyB0aGUKICAgICAgICAgICAgLy8gYXR0cnMgYXJyYXkgZG9lc24ndCByZWFsbHkgbWF0dGVyCiAgICAgICAgICAgIEhUTUxQYXJzZXIuQWN0aXZlRm9ybWF0dGluZ0VsZW1lbnRzLnByb3RvdHlwZS5pbnNlcnRBZnRlciA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICB2YXIgaWR4ID0gQS5sYXN0SW5kZXhPZih0aGlzLmxpc3QsIGEpOwogICAgICAgICAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBzcGxpY2UodGhpcy5saXN0LCBpZHgsIDAsIGIpOwogICAgICAgICAgICAgICAgICAgIHNwbGljZSh0aGlzLmF0dHJzLCBpZHgsIDAsIGIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLyoqKgogICAgICAgICAgICAgKiBUaGlzIGlzIHRoZSBwYXJzZXIgZmFjdG9yeSBmdW5jdGlvbi4gSXQgaXMgdGhlIHJldHVybiB2YWx1ZSBvZgogICAgICAgICAgICAgKiB0aGUgb3V0ZXIgY2xvc3VyZSB0aGF0IGl0IGlzIGRlZmluZWQgd2l0aGluLiAgTW9zdCBvZiB0aGUgcGFyc2VyCiAgICAgICAgICAgICAqIGltcGxlbWVudGF0aW9uIGRldGFpbHMgYXJlIGluc2lkZSB0aGlzIGZ1bmN0aW9uLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgZnVuY3Rpb24gSFRNTFBhcnNlcihhZGRyZXNzLCBmcmFnbWVudENvbnRleHQsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIC8qKioKICAgICAgICAgICAgICAgICAqIFRoZXNlIGFyZSB0aGUgcGFyc2VyJ3Mgc3RhdGUgdmFyaWFibGVzCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIC8vIFNjYW5uZXIgc3RhdGUKICAgICAgICAgICAgICAgIHZhciBjaGFycyA9IG51bGw7CiAgICAgICAgICAgICAgICB2YXIgbnVtY2hhcnMgPSAwOyAvLyBMZW5ndGggb2YgY2hhcnMKICAgICAgICAgICAgICAgIHZhciBuZXh0Y2hhciA9IDA7IC8vIEluZGV4IG9mIG5leHQgY2hhcgogICAgICAgICAgICAgICAgdmFyIGlucHV0X2NvbXBsZXRlID0gZmFsc2U7IC8vIEJlY29tZXMgdHJ1ZSB3aGVuIGVuZCgpIGNhbGxlZC4KICAgICAgICAgICAgICAgIHZhciBzY2FubmVyX3NraXBfbmV3bGluZSA9IGZhbHNlOyAvLyBJZiBwcmV2aW91cyBjaGFyIHdhcyBDUgogICAgICAgICAgICAgICAgdmFyIHJlZW50cmFudF9pbnZvY2F0aW9ucyA9IDA7CiAgICAgICAgICAgICAgICB2YXIgc2F2ZWRfc2Nhbm5lcl9zdGF0ZSA9IFtdOwogICAgICAgICAgICAgICAgdmFyIGxlZnRvdmVycyA9ICIiOwogICAgICAgICAgICAgICAgdmFyIGZpcnN0X2JhdGNoID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHZhciBwYXVzZWQgPSAwOyAvLyBCZWNvbWVzIG5vbi16ZXJvIHdoaWxlIGxvYWRpbmcgc2NyaXB0cwoKCiAgICAgICAgICAgICAgICAvLyBUb2tlbml6ZXIgc3RhdGUKICAgICAgICAgICAgICAgIHZhciB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOyAvLyBDdXJyZW50IHRva2VuaXplciBzdGF0ZQogICAgICAgICAgICAgICAgdmFyIHNhdmVkVG9rZW5pemVyU3RhdGVzID0gW107IC8vIFN0YWNrIG9mIHNhdmVkIHN0YXRlcwogICAgICAgICAgICAgICAgdmFyIHRhZ25hbWVidWYgPSBbXTsKICAgICAgICAgICAgICAgIHZhciBsYXN0dGFnbmFtZSA9ICIiOyAvLyBob2xkcyB0aGUgdGFyZ2V0IGVuZCB0YWcgZm9yIHRleHQgc3RhdGVzCiAgICAgICAgICAgICAgICB2YXIgdGVtcGJ1ZiA9IFtdOwogICAgICAgICAgICAgICAgdmFyIGF0dHJuYW1lYnVmID0gW107CiAgICAgICAgICAgICAgICB2YXIgYXR0cnZhbHVlYnVmID0gW107CiAgICAgICAgICAgICAgICB2YXIgY29tbWVudGJ1ZiA9IFtdOwogICAgICAgICAgICAgICAgdmFyIGRvY3R5cGVuYW1lYnVmID0gW107CiAgICAgICAgICAgICAgICB2YXIgZG9jdHlwZXB1YmxpY2J1ZiA9IFtdOwogICAgICAgICAgICAgICAgdmFyIGRvY3R5cGVzeXN0ZW1idWYgPSBbXTsKICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGVzID0gW107CiAgICAgICAgICAgICAgICB2YXIgaXNfZW5kX3RhZyA9IGZhbHNlOwoKICAgICAgICAgICAgICAgIC8vIFRyZWUgYnVpbGRlciBzdGF0ZQogICAgICAgICAgICAgICAgdmFyIHBhcnNlciA9IGluaXRpYWxfbW9kZTsgLy8gQ3VycmVudCBpbnNlcnRpb24gbW9kZQogICAgICAgICAgICAgICAgdmFyIG9yaWdpbmFsSW5zZXJ0aW9uTW9kZSA9IG51bGw7IC8vIEEgc2F2ZWQgaW5zZXJ0aW9uIG1vZGUKICAgICAgICAgICAgICAgIHZhciBzdGFjayA9IG5ldyBIVE1MUGFyc2VyLkVsZW1lbnRTdGFjaygpOyAvLyBTdGFjayBvZiBvcGVuIGVsZW1lbnRzCiAgICAgICAgICAgICAgICB2YXIgYWZlID0gbmV3IEhUTUxQYXJzZXIuQWN0aXZlRm9ybWF0dGluZ0VsZW1lbnRzKCk7IC8vIG1pcy1uZXN0ZWQgdGFncwogICAgICAgICAgICAgICAgdmFyIGZyYWdtZW50ID0gZnJhZ21lbnRDb250ZXh0ICE9PSB1bmRlZmluZWQ7IC8vIEZvciBpbm5lckhUTUwsIGV0Yy4KICAgICAgICAgICAgICAgIHZhciBzY3JpcHRfbmVzdGluZ19sZXZlbCA9IDA7CiAgICAgICAgICAgICAgICB2YXIgcGFyc2VyX3BhdXNlX2ZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHZhciBoZWFkX2VsZW1lbnRfcG9pbnRlciA9IG51bGw7CiAgICAgICAgICAgICAgICB2YXIgZm9ybV9lbGVtZW50X3BvaW50ZXIgPSBudWxsOwogICAgICAgICAgICAgICAgdmFyIHNjcmlwdGluZ19lbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuc2NyaXB0aW5nX2VuYWJsZWQgPT09IGZhbHNlKSBzY3JpcHRpbmdfZW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdmFyIGZyYW1lc2V0X29rID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHZhciBmb3JjZV9xdWlya3MgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHZhciBwZW5kaW5nX3RhYmxlX3RleHQ7CiAgICAgICAgICAgICAgICB2YXIgdGV4dF9pbnRlZ3JhdGlvbl9tb2RlOyAvLyBYWFggYSBzcGVjIGJ1ZyB3b3JrYXJvdW5kPwoKICAgICAgICAgICAgICAgIC8vIEEgc2luZ2xlIHJ1biBvZiBjaGFyYWN0ZXJzLCBidWZmZXJlZCB1cCB0byBiZSBzZW50IHRvCiAgICAgICAgICAgICAgICAvLyB0aGUgcGFyc2VyIGFzIGEgc2luZ2xlIHN0cmluZy4KICAgICAgICAgICAgICAgIHZhciB0ZXh0cnVuID0gW107CiAgICAgICAgICAgICAgICB2YXIgdGV4dEluY2x1ZGVzTlVMID0gZmFsc2U7CiAgICAgICAgICAgICAgICB2YXIgaWdub3JlX2xpbmVmZWVkID0gZmFsc2U7CgogICAgICAgICAgICAgICAgLyoqKgogICAgICAgICAgICAgICAgICogVGhpcyBpcyB0aGUgcGFyc2VyIG9iamVjdCB0aGF0IHdpbGwgYmUgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGlzCiAgICAgICAgICAgICAgICAgKiBmYWN0b3J5IGZ1bmN0aW9uLCB3aGljaCBpcyBzb21lIDUwMDAgbGluZXMgYmVsb3cuCiAgICAgICAgICAgICAgICAgKiBOb3RlIHRoYXQgdGhlIHZhcmlhYmxlICJwYXJzZXIiIGlzIHRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZQogICAgICAgICAgICAgICAgICogcGFyc2VyJ3Mgc3RhdGUgbWFjaGluZS4gIFRoaXMgdmFyaWFibGUgImh0bWxwYXJzZXIiIGlzIHRoZQogICAgICAgICAgICAgICAgICogcmV0dXJuIHZhbHVlIGFuZCBkZWZpbmVzIHRoZSBwdWJsaWMgQVBJIG9mIHRoZSBwYXJzZXIKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdmFyIGh0bWxwYXJzZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIHRoZSBmcmFnbWVudCBjYXNlLCByZXR1cm4gdGhlIGRvY3VtZW50IHVud3JhcHBlZC4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gYSB3cmFwcGVkIGRvY3VtZW50CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmcmFnbWVudCkgcmV0dXJuIGRvYztlbHNlIHJldHVybiB3cmFwKGRvYyk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy8gSW50ZXJuYWwgZnVuY3Rpb24gdXNlZCBmcm9tIEhUTUxTY3JpcHRFbGVtZW50IHRvIHBhdXNlIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIHBhcnNlciB3aGlsZSBhIHNjcmlwdCBpcyBiZWluZyBsb2FkZWQgZnJvbSB0aGUgbmV0d29yawogICAgICAgICAgICAgICAgICAgIHBhdXNlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByaW50KCJwYXVzaW5nIHBhcnNlciIpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXVzZWQrKzsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAvLyBDYWxsZWQgd2hlbiBhIHNjcmlwdCBmaW5pc2hlcyBsb2FkaW5nCiAgICAgICAgICAgICAgICAgICAgcmVzdW1lOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByaW50KCJyZXN1bWluZyBwYXJzZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGF1c2VkLS07CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWDogYWRkZWQgdGhpcyB0byBmb3JjZSBhIHJlc3VtcHRpb24uCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElzIHRoaXMgdGhlIHJpZ2h0IHRoaW5nIHRvIGRvPwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnNlKCIiKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAvLyBQYXJzZSB0aGUgSFRNTCB0ZXh0IHMuCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHNlY29uZCBhcmd1bWVudCBzaG91bGQgYmUgdHJ1ZSBpZiB0aGVyZSBpcyBubyBtb3JlCiAgICAgICAgICAgICAgICAgICAgLy8gdGV4dCB0byBiZSBwYXJzZWQsIGFuZCBzaG91bGQgYmUgZmFsc2Ugb3Igb21pdHRlZCBvdGhlcndpc2UuCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHNlY29uZCBhcmd1bWVudCBtdXN0IG5vdCBiZSBzZXQgZm9yIHJlY3Vyc2l2ZSBpbnZvY2F0aW9ucwogICAgICAgICAgICAgICAgICAgIC8vIGZyb20gZG9jdW1lbnQud3JpdGUoKQogICAgICAgICAgICAgICAgICAgIHBhcnNlOiBmdW5jdGlvbiAocywgZW5kKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSdyZSBwYXVzZWQsIHJlbWVtYmVyIHRoZSB0ZXh0IHRvIHBhcnNlLCBidXQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG9uJ3QgcGFyc2UgaXQgbm93LgogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF1c2VkID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdG92ZXJzICs9IHM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWVudHJhbnRfaW52b2NhdGlvbnMgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEEgbm9ybWFsLCB0b3AtbGV2ZWwgaW52b2NhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxlZnRvdmVycykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBsZWZ0b3ZlcnMgKyBzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRvdmVycyA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCBhIHNwZWNpYWwgbWFya2VyIGNoYXJhY3RlciB0byB0aGUgZW5kIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgYnVmZmVyLiAgSWYgdGhlIHNjYW5uZXIgaXMgYXQgdGhlIGVuZCBvZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGJ1ZmZlciBhbmQgaW5wdXRfY29tcGxldGUgaXMgc2V0LCB0aGVuIHRoaXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoYXJhY3RlciB3aWxsIHRyYW5zZm9ybSBpbnRvIGFuIEVPRiB0b2tlbi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhdmluZyBhbiBhY3R1YWwgY2hhcmFjdGVyIHRoYXQgcmVwcmVzZW50cyBFT0YKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluIHRoZSBjaGFyYWN0ZXIgYnVmZmVyIG1ha2VzIGxvb2thaGVhZCByZWdleHAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1hdGNoaW5nIHdvcmsgbW9yZSBlYXNpbHksIGFuZCB0aGlzIGlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbXBvcnRhbnQgZm9yIGNoYXJhY3RlciByZWZlcmVuY2VzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVuZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gIlx1RkZGRiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRfY29tcGxldGUgPSB0cnVlOyAvLyBNYWtlcyBzY2FuQ2hhcnMoKSBzZW5kIEVPRgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJzID0gczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWNoYXJzID0gcy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhciA9IDA7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0X2JhdGNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2Ugc2tpcCBhIGxlYWRpbmcgQnl0ZSBPcmRlciBNYXJrIChcdUZFRkYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb24gZmlyc3QgYmF0Y2ggb2YgdGV4dCB3ZSdyZSBnaXZlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0X2JhdGNoID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFMuY2hhckNvZGVBdChjaGFycywgMCkgPT09IDB4RkVGRikgbmV4dGNoYXIgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZW50cmFudF9pbnZvY2F0aW9ucysrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbkNoYXJzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0b3ZlcnMgPSBjaGFycy5zdWJzdHJpbmcobmV4dGNoYXIsIG51bWNoYXJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZW50cmFudF9pbnZvY2F0aW9ucy0tOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgcmUtZW50cmFudCBjYXNlLCB3aGljaCB3ZSBoYXZlIHRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgYSBsaXR0bGUgZGlmZmVyZW50bHkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWVudHJhbnRfaW52b2NhdGlvbnMrKzsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTYXZlIGN1cnJlbnQgc2Nhbm5lciBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZWRfc2Nhbm5lcl9zdGF0ZS5wdXNoKGNoYXJzLCBudW1jaGFycywgbmV4dGNoYXIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBuZXcgc2Nhbm5lciBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnMgPSBzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtY2hhcnMgPSBzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyID0gMDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3cgc2NhbiBhcyBtYW55IG9mIHRoZXNlIG5ldyBjaGFycyBhcyB3ZSBjYW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYW5DaGFycygpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRvdmVycyA9IGNoYXJzLnN1YnN0cmluZyhuZXh0Y2hhciwgbnVtY2hhcnMpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlc3RvcmUgb2xkIHNjYW5uZXIgc3RhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyID0gc2F2ZWRfc2Nhbm5lcl9zdGF0ZS5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWNoYXJzID0gc2F2ZWRfc2Nhbm5lcl9zdGF0ZS5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJzID0gc2F2ZWRfc2Nhbm5lcl9zdGF0ZS5wb3AoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSB3ZXJlIGxlZnRvdmVyIGNoYXJzIGZyb20gdGhpcyBpbnZvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbnNlcnQgdGhlbSBpbnRvIHRoZSBwZW5kaW5nIGludm9jYXRpb24ncyBidWZmZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFuZCB0cmltIGFscmVhZHkgcHJvY2Vzc2VkIGNoYXJzIGF0IHRoZSBzYW1lIHRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZWZ0b3ZlcnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFycyA9IGxlZnRvdmVycyArIGNoYXJzLnN1YnN0cmluZyhuZXh0Y2hhcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtY2hhcnMgPSBjaGFycy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXIgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnRvdmVycyA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlY3JlbWVudCB0aGUgY291bnRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVlbnRyYW50X2ludm9jYXRpb25zLS07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGRvY3VtZW50IHdlJ2xsIGJlIGJ1aWxkaW5nIHVwCiAgICAgICAgICAgICAgICB2YXIgZG9jID0gbmV3IGltcGwuRG9jdW1lbnQodHJ1ZSwgYWRkcmVzcyk7CgogICAgICAgICAgICAgICAgLy8gVGhlIGRvY3VtZW50IG5lZWRzIHRvIGtub3cgYWJvdXQgdGhlIHBhcnNlciwgZm9yIGRvY3VtZW50LndyaXRlKCkuCiAgICAgICAgICAgICAgICAvLyBUaGlzIF9wYXJzZXIgcHJvcGVydHkgd2lsbCBiZSBkZWxldGVkIHdoZW4gd2UncmUgZG9uZSBwYXJzaW5nLgogICAgICAgICAgICAgICAgZG9jLl9wYXJzZXIgPSBodG1scGFyc2VyOwoKICAgICAgICAgICAgICAgIC8vIFhYWCBJIHRoaW5rIHRoYXQgYW55IGRvY3VtZW50IHdlIHVzZSB0aGlzIHBhcnNlciBvbiBzaG91bGQgc3VwcG9ydAogICAgICAgICAgICAgICAgLy8gc2NyaXB0cy4gQnV0IEkgbWF5IG5lZWQgdG8gY29uZmlndXJlIHRoYXQgdGhyb3VnaCBhIHBhcnNlciBwYXJhbWV0ZXIKICAgICAgICAgICAgICAgIC8vIE9ubHkgZG9jdW1lbnRzIHdpdGggd2luZG93cyAoImJyb3dzaW5nIGNvbnRleHRzIiB0byBiZSBwcmVjaXNlKQogICAgICAgICAgICAgICAgLy8gYWxsb3cgc2NyaXB0aW5nLgogICAgICAgICAgICAgICAgZG9jLl9zY3JpcHRpbmdfZW5hYmxlZCA9IHNjcmlwdGluZ19lbmFibGVkOwoKICAgICAgICAgICAgICAgIC8qKioKICAgICAgICAgICAgICAgICAqIFRoZSBhY3R1YWwgY29kZSBvZiB0aGUgSFRNTFBhcnNlcigpIGZhY3RvcnkgZnVuY3Rpb24gYmVnaW5zIGhlcmUuCiAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICBpZiAoZnJhZ21lbnRDb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIGlubmVySFRNTCBwYXJzaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKGZyYWdtZW50Q29udGV4dC5vd25lckRvY3VtZW50Ll9xdWlya3MpIGRvYy5fcXVpcmtzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJhZ21lbnRDb250ZXh0Lm93bmVyRG9jdW1lbnQuX2xpbWl0ZWRRdWlya3MpIGRvYy5fbGltaXRlZFF1aXJrcyA9IHRydWU7CgogICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgaW5pdGlhbCB0b2tlbml6ZXIgc3RhdGUKICAgICAgICAgICAgICAgICAgICBpZiAoZnJhZ21lbnRDb250ZXh0Lm5hbWVzcGFjZVVSSSA9PT0gSFRNTF9OQU1FU1BBQ0UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChmcmFnbWVudENvbnRleHQubG9jYWxOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0aXRsZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ZXh0YXJlYSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gcmNkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAic3R5bGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAieG1wIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImlmcmFtZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJub2VtYmVkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm5vZnJhbWVzIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInNjcmlwdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJwbGFpbnRleHQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHBsYWludGV4dF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm5vc2NyaXB0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NyaXB0aW5nX2VuYWJsZWQpIHRva2VuaXplciA9IHBsYWludGV4dF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdmFyIHJvb3QgPSBkb2MuY3JlYXRlRWxlbWVudCgiaHRtbCIpOwogICAgICAgICAgICAgICAgICAgIGRvYy5hcHBlbmRDaGlsZChyb290KTsKICAgICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKHJvb3QpOwogICAgICAgICAgICAgICAgICAgIHJlc2V0SW5zZXJ0aW9uTW9kZSgpOwoKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBlID0gZnJhZ21lbnRDb250ZXh0OyBlICE9PSBudWxsOyBlID0gZS5wYXJlbnRFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgaW1wbC5IVE1MRm9ybUVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1fZWxlbWVudF9wb2ludGVyID0gZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8qKioKICAgICAgICAgICAgICAgICAqIFNjYW5uZXIgZnVuY3Rpb25zCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCB0aGUgY2hhcmFjdGVycyBpbiBjaGFycywgYW5kIHBhc3MgdGhlbSBvbmUgYXQgYSB0aW1lCiAgICAgICAgICAgICAgICAvLyB0byB0aGUgdG9rZW5pemVyIEZTTS4gUmV0dXJuIHdoZW4gbm8gbW9yZSBjaGFyYWN0ZXJzIGNhbiBiZSBwcm9jZXNzZWQKICAgICAgICAgICAgICAgIC8vIChUaGlzIG1heSBsZWF2ZSAxIG9yIG1vcmUgY2hhcmFjdGVycyBpbiB0aGUgYnVmZmVyOiBsaWtlIGEgQ1IKICAgICAgICAgICAgICAgIC8vIHdhaXRpbmcgdG8gc2VlIGlmIHRoZSBuZXh0IGNoYXIgaXMgTEYsIG9yIGZvciBzdGF0ZXMgdGhhdCByZXF1aXJlCiAgICAgICAgICAgICAgICAvLyBsb29rYWhlYWQuLi4pCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzY2FuQ2hhcnMoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNvZGVwb2ludCwgcywgcGF0dGVybiwgZW9mLCBtYXRjaGVkOwoKICAgICAgICAgICAgICAgICAgICB3aGlsZSAobmV4dGNoYXIgPCBudW1jaGFycykgewoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UganVzdCB0b2tlbml6ZWQgYSA8L3NjcmlwdD4gdGFnLCB0aGVuIHRoZSBwYXVzZWQgZmxhZwogICAgICAgICAgICAgICAgICAgICAgICAvLyBtYXkgaGF2ZSBiZWVuIHNldCB0byB0ZWxsIHVzIHRvIHN0b3AgdG9rZW5pemluZyB3aGlsZQogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgc2NyaXB0IGlzIGxvYWRpbmcKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhdXNlZCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgdG9rZW5pemVyLmxvb2thaGVhZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndW5kZWZpbmVkJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlcG9pbnQgPSBTLmNoYXJDb2RlQXQoY2hhcnMsIG5leHRjaGFyKyspOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY2FubmVyX3NraXBfbmV3bGluZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FubmVyX3NraXBfbmV3bGluZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29kZXBvaW50ID09PSAweDAwMEEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGNvZGVwb2ludCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwRDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENSIGFsd2F5cyB0dXJucyBpbnRvIExGLCBidXQgaWYgdGhlIG5leHQgY2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpcyBMRiwgdGhlbiB0aGF0IHNlY29uZCBMRiBpcyBza2lwcGVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRjaGFyIDwgbnVtY2hhcnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoUy5jaGFyQ29kZUF0KGNoYXJzLCBuZXh0Y2hhcikgPT09IDB4MDAwQSkgbmV4dGNoYXIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgZG9uJ3Qga25vdyB0aGUgbmV4dCBjaGFyIHJpZ2h0IG5vdywgc28gd2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjYW4ndCBjaGVjayBpZiBpdCBpcyBhIExGLiAgU28gc2V0IGEgZmxhZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYW5uZXJfc2tpcF9uZXdsaW5lID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbiBlaXRoZXIgY2FzZSwgZW1pdCBhIExGCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIoMHgwMDBBKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweEZGRkY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXRfY29tcGxldGUgJiYgbmV4dGNoYXIgPT09IG51bWNoYXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyKEVPRik7IC8vIGNvZGVwb2ludCB3aWxsIGJlIDB4RkZGRiBoZXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplcihjb2RlcG9pbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZXBvaW50ID0gUy5jaGFyQ29kZUF0KGNoYXJzLCBuZXh0Y2hhcik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBvbmx5IHRva2VuaXplciBzdGF0ZXMgdGhhdCByZXF1aXJlIGZpeGVkIGxvb2thaGVhZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgY29uc3VtZSBhbHBoYW51bSBjaGFyYWN0ZXJzLCBzbyB3ZSBkb24ndCBoYXZlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdG8gd29ycnkgYWJvdXQgQ1IgYW5kIExGIGluIHRoaXMgY2FzZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0b2tlbml6ZXIgd2FudHMgbiBjaGFycyBvZiBsb29rYWhlYWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHRva2VuaXplci5sb29rYWhlYWQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuIDwgbnVtY2hhcnMgLSBuZXh0Y2hhcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSBjYW4gbG9vayBhaGVhZCB0aGF0IGZhcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gc3Vic3RyaW5nKGNoYXJzLCBuZXh0Y2hhciwgbmV4dGNoYXIgKyBuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW9mID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UgZG9uJ3QgaGF2ZSB0aGF0IG1hbnkgY2hhcmFjdGVycwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXRfY29tcGxldGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIG5vIG1vcmUgYXJlIGNvbWluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSnVzdCByZXR1cm4gd2hhdCB3ZSBoYXZlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gc3Vic3RyaW5nKGNoYXJzLCBuZXh0Y2hhciwgbnVtY2hhcnMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW9mID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2RlcG9pbnQgPT09IDB4RkZGRiAmJiBuZXh0Y2hhciA9PT0gbnVtY2hhcnMgLSAxKSBjb2RlcG9pbnQgPSBFT0Y7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gbm93IGFuZCB3YWl0IGZvciBtb3JlIGNoYXJzIGxhdGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyKGNvZGVwb2ludCwgcywgZW9mKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZXBvaW50ID0gUy5jaGFyQ29kZUF0KGNoYXJzLCBuZXh0Y2hhcik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRva2VuaXplciB3YW50cyBjaGFyYWN0ZXJzIHVwIHRvIGEgbWF0Y2hpbmcgc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybiA9IHRva2VuaXplci5sb29rYWhlYWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvcyA9IFMuaW5kZXhPZihjaGFycywgcGF0dGVybiwgbmV4dGNoYXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3MgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBzdWJzdHJpbmcoY2hhcnMsIG5leHRjaGFyLCBwb3MgKyBwYXR0ZXJuLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVvZiA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vIG1hdGNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIG1vcmUgY2hhcmFjdGVycyBjb21pbmcsIHdhaXQgZm9yIHRoZW0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpbnB1dF9jb21wbGV0ZSkgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSd2ZSBnb3QgdG8gcmV0dXJuIHdoYXQgd2UndmUgZ290CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBzdWJzdHJpbmcoY2hhcnMsIG5leHRjaGFyLCBudW1jaGFycyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2RlcG9pbnQgPT09IDB4RkZGRiAmJiBuZXh0Y2hhciA9PT0gbnVtY2hhcnMgLSAxKSBjb2RlcG9pbnQgPSBFT0Y7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVvZiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgdG9rZW5pemVyIHN0YXRlcyB0aGF0IHJlcXVpcmUgdGhpcyBraW5kIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9va2FoZWFkIGhhdmUgdG8gYmUgY2FyZWZ1bCB0byBoYW5kbGUgQ1IgY2hhcmFjdGVycwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvcnJlY3RseQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplcihjb2RlcG9pbnQsIHMsIGVvZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVwb2ludCA9IFMuY2hhckNvZGVBdChjaGFycywgbmV4dGNoYXIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0b2tlbml6ZXIgd2FudHMgY2hhcmFjdGVycyB0aGF0IG1hdGNoIGEgcmVnZXhwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIG9ubHkgdG9rZW5pemVyIHN0YXRlcyB0aGF0IHVzZSByZWdleHAgbG9va2FoZWFkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXJlIGZvciBjaGFyYWN0ZXIgZW50aXRpZXMsIGFuZCB0aGUgcGF0dGVybnMgbmV2ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtYXRjaCBDUiBvciBMRiwgc28gd2UgZG9uJ3QgbmVlZCB0byB3b3JyeSBhYm91dCB0aGF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGVyZS4KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWRlYWxseSwgSSdkIHVzZSB0aGUgbm9uLXN0YW5kYXJkIHkgbW9kaWZpZXIgb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGVzZSByZWdleHBzIGFuZCBzZXQgcGF0dGVybi5sYXN0SW5kZXggdG8gbmV4dGNoYXIuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQnV0IHY4IGFuZCBOb2RlIGRvbid0IHN1cHBvcnQgL3ksIHNvIEkgaGF2ZSB0byBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzdWJzdHJpbmcgYmVsb3cKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuID0gdG9rZW5pemVyLmxvb2thaGVhZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVkID0gbWF0Y2goc3Vic3RyaW5nKGNoYXJzLCBuZXh0Y2hhciksIHBhdHRlcm4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGEgbWF0Y2guCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxhc3RJbmRleCBub3cgcG9pbnRzIHRvIHRoZSBmaXJzdCBjaGFyIGFmdGVyIGl0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBtYXRjaGVkWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlb2YgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBObyBtYXRjaC4gIElmIHdlJ3JlIG5vdCBhdCB0aGUgZW5kIG9mIGlucHV0LCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdhaXQgZm9yIG1vcmUgY2hhcnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpbnB1dF9jb21wbGV0ZSkgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBwYXNzIGFuIGVtcHR5IHN0cmluZy4gIFRoaXMgaXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGlmZmVyZW50IHRoYW4gdGhlIHN0cmluZy1iYXNlZCBsb29rYWhlYWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWJvdmUuIFJlZ2V4cC1iYXNlZCBsb29rYWhlYWQgaXMgb25seSB1c2VkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZvciBjaGFyYWN0ZXIgcmVmZXJlbmNlcywgYW5kIGEgcGFydGlhbCBvbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2lsbCBub3QgcGFyc2UuICBBbHNvLCBhIGNoYXIgcmVmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRlcm1pbmF0ZWQgd2l0aCBFT0Ygd2lsbCBwYXJzZSBpbiB0aGUgaWYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnJhbmNoIGFib3ZlLCBzbyBoZXJlIHdlJ3JlIGRlYWxpbmcgd2l0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGluZ3MgdGhhdCByZWFsbHkgYXJlbid0IGNoYXIgcmVmcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVvZiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIoY29kZXBvaW50LCBzLCBlb2YpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8qKioKICAgICAgICAgICAgICAgICAqIFRva2VuaXplciB1dGlsaXR5IGZ1bmN0aW9ucwogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhZGRBdHRyaWJ1dGUobmFtZWJ1ZiwgdmFsdWVidWYpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGJ1ZjJzdHIobmFtZWJ1Zik7CiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlOwoKICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhlcmUgaXNuJ3QgYWxyZWFkeSBhbiBhdHRyaWJ1dGUgd2l0aCB0aGlzIG5hbWUKICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBpcywgaWdub3JlIHRoaXMgb25lLgogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXR0cmlidXRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlc1tpXVswXSA9PT0gbmFtZSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlYnVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1c2goYXR0cmlidXRlcywgW25hbWUsIGJ1ZjJzdHIodmFsdWVidWYpXSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaChhdHRyaWJ1dGVzLCBbbmFtZV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBTaG9ydGN1dCBmb3Igc2ltcGxlIGF0dHJpYnV0ZXMKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZVNpbXBsZUF0dHJpYnV0ZSgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2hlZCA9IG1hdGNoKHN1YnN0cmluZyhjaGFycywgbmV4dGNoYXIgLSAxKSwgU0lNUExFQVRUUik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVkKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBtYXRjaGVkWzFdOwogICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG1hdGNoZWRbMl07CiAgICAgICAgICAgICAgICAgICAgdmFyIGxlbiA9IHZhbHVlLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlWzBdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJyInOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICInIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gc3Vic3RyaW5nKHZhbHVlLCAxLCBsZW4gLSAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyICs9IG1hdGNoZWRbMF0ubGVuZ3RoIC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGFmdGVyX2F0dHJpYnV0ZV92YWx1ZV9xdW90ZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGJlZm9yZV9hdHRyaWJ1dGVfbmFtZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyICs9IG1hdGNoZWRbMF0ubGVuZ3RoIC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gc3Vic3RyaW5nKHZhbHVlLCAwLCBsZW4gLSAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoZXJlIGlzbid0IGFscmVhZHkgYW4gYXR0cmlidXRlIHdpdGggdGhpcyBuYW1lCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMsIGlnbm9yZSB0aGlzIG9uZS4KICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZXNbaV1bMF0gPT09IG5hbWUpIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcHVzaChhdHRyaWJ1dGVzLCBbbmFtZSwgdmFsdWVdKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBwdXNoU3RhdGUoKSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaChzYXZlZFRva2VuaXplclN0YXRlcywgdG9rZW5pemVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHBvcFN0YXRlKCkgewogICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHBvcChzYXZlZFRva2VuaXplclN0YXRlcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBiZWdpblRhZ05hbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgaXNfZW5kX3RhZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHRhZ25hbWVidWYubGVuZ3RoID0gMDsKICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzLmxlbmd0aCA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBiZWdpbkVuZFRhZ05hbWUoKSB7CiAgICAgICAgICAgICAgICAgICAgaXNfZW5kX3RhZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgdGFnbmFtZWJ1Zi5sZW5ndGggPSAwOwogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMubGVuZ3RoID0gMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBiZWdpblRlbXBCdWYoKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcGJ1Zi5sZW5ndGggPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gYmVnaW5BdHRyTmFtZSgpIHsKICAgICAgICAgICAgICAgICAgICBhdHRybmFtZWJ1Zi5sZW5ndGggPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gYmVnaW5BdHRyVmFsdWUoKSB7CiAgICAgICAgICAgICAgICAgICAgYXR0cnZhbHVlYnVmLmxlbmd0aCA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBiZWdpbkNvbW1lbnQoKSB7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudGJ1Zi5sZW5ndGggPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gYmVnaW5Eb2N0eXBlKCkgewogICAgICAgICAgICAgICAgICAgIGRvY3R5cGVuYW1lYnVmLmxlbmd0aCA9IDA7CiAgICAgICAgICAgICAgICAgICAgZG9jdHlwZXB1YmxpY2J1ZiA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgZG9jdHlwZXN5c3RlbWJ1ZiA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBiZWdpbkRvY3R5cGVQdWJsaWNJZCgpIHsKICAgICAgICAgICAgICAgICAgICBkb2N0eXBlcHVibGljYnVmID0gW107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBiZWdpbkRvY3R5cGVTeXN0ZW1JZCgpIHsKICAgICAgICAgICAgICAgICAgICBkb2N0eXBlc3lzdGVtYnVmID0gW107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhcHBlbmRDaGFyKGJ1ZiwgY2hhcikgewogICAgICAgICAgICAgICAgICAgIHB1c2goYnVmLCBjaGFyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGZvcmNlcXVpcmtzKCkgewogICAgICAgICAgICAgICAgICAgIGZvcmNlX3F1aXJrcyA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjZGF0YUFsbG93ZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YWNrLnRvcCAmJiBzdGFjay50b3AubmFtZXNwYWNlVVJJICE9PSAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRydWUgaWYgdGhlIGNvZGVwb2ludHMgaW4gdGhlIHNwZWNpZmllZCBidWZmZXIgbWF0Y2ggdGhlCiAgICAgICAgICAgICAgICAvLyBjaGFyYWN0ZXJzIG9mIGxhc3R0YWduYW1lCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhcHByb3ByaWF0ZUVuZFRhZyhidWYpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYnVmLmxlbmd0aCAhPT0gbGFzdHRhZ25hbWUubGVuZ3RoKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBidWYubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidWZbaV0gIT09IGxhc3R0YWduYW1lLmNoYXJDb2RlQXQoaSkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gZmx1c2hUZXh0KCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0cnVuLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBidWYyc3RyKHRleHRydW4pOwogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0cnVuLmxlbmd0aCA9IDA7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWdub3JlX2xpbmVmZWVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZ25vcmVfbGluZWZlZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzWzBdID09PSAiXG4iKSBzID0gc3Vic3RyaW5nKHMsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHMubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydFRva2VuKFRFWFQsIHMpOwogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0SW5jbHVkZXNOVUwgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWdub3JlX2xpbmVmZWVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gZW1pdCBhIHN0cmluZyBvZiBjaGFycyB0aGF0IG1hdGNoIGEgcmVnZXhwCiAgICAgICAgICAgICAgICAvLyBSZXR1cm5zIGZhbHNlIGlmIG5vIGNoYXJzIG1hdGNoZWQuCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBlbWl0Q2hhcnNXaGlsZShwYXR0ZXJuKSB7CiAgICAgICAgICAgICAgICAgICAgcGF0dGVybi5sYXN0SW5kZXggPSBuZXh0Y2hhciAtIDE7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gZXhlYyhwYXR0ZXJuLCBjaGFycylbMF07CiAgICAgICAgICAgICAgICAgICAgaWYgKCFtYXRjaCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGVtaXRDaGFyU3RyaW5nKG1hdGNoKTsKICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhciArPSBtYXRjaC5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdXNlZCBieSBDREFUQSBzZWN0aW9ucwogICAgICAgICAgICAgICAgZnVuY3Rpb24gZW1pdENoYXJTdHJpbmcocykgewogICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0cnVuLmxlbmd0aCA+IDApIGZsdXNoVGV4dCgpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoaWdub3JlX2xpbmVmZWVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlnbm9yZV9saW5lZmVlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc1swXSA9PT0gIlxuIikgcyA9IHN1YnN0cmluZyhzLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHMubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpbnNlcnRUb2tlbihURVhULCBzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBlbWl0VGFnKCkgewogICAgICAgICAgICAgICAgICAgIGlmIChpc19lbmRfdGFnKSBpbnNlcnRUb2tlbihFTkRUQUcsIGJ1ZjJzdHIodGFnbmFtZWJ1ZikpO2Vsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1lbWJlciB0aGUgbGFzdCBvcGVuIHRhZyB3ZSBlbWl0dGVkCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWduYW1lID0gYnVmMnN0cih0YWduYW1lYnVmKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGFnbmFtZWJ1Zi5sZW5ndGggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBsYXN0dGFnbmFtZSA9IHRhZ25hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydFRva2VuKFRBRywgdGFnbmFtZSwgYXR0cmlidXRlcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEEgc2hvcnRjdXQ6IGxvb2sgYWhlYWQgYW5kIGlmIHRoaXMgaXMgYSBvcGVuIG9yIGNsb3NlIHRhZwogICAgICAgICAgICAgICAgLy8gaW4gbG93ZXJjYXNlIHdpdGggbm8gc3BhY2VzIGFuZCBubyBhdHRyaWJ1dGVzLCBqdXN0IGVtaXQgaXQgbm93LgogICAgICAgICAgICAgICAgZnVuY3Rpb24gZW1pdFNpbXBsZVRhZygpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2hlZCA9IG1hdGNoKHN1YnN0cmluZyhjaGFycywgbmV4dGNoYXIpLCBTSU1QTEVUQUcpOwogICAgICAgICAgICAgICAgICAgIGlmICghbWF0Y2hlZCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHZhciB0YWduYW1lID0gbWF0Y2hlZFsyXTsKICAgICAgICAgICAgICAgICAgICB2YXIgZW5kdGFnID0gbWF0Y2hlZFsxXTsKICAgICAgICAgICAgICAgICAgICBpZiAoZW5kdGFnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyICs9IHRhZ25hbWUubGVuZ3RoICsgMjsKICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0VG9rZW4oRU5EVEFHLCB0YWduYW1lKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhciArPSB0YWduYW1lLmxlbmd0aCArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3R0YWduYW1lID0gdGFnbmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0VG9rZW4oVEFHLCB0YWduYW1lLCBOT0FUVFJTKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gZW1pdFNlbGZDbG9zaW5nVGFnKCkgewogICAgICAgICAgICAgICAgICAgIGlmIChpc19lbmRfdGFnKSBpbnNlcnRUb2tlbihFTkRUQUcsIGJ1ZjJzdHIodGFnbmFtZWJ1ZiksIG51bGwsIHRydWUpO2Vsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRUb2tlbihUQUcsIGJ1ZjJzdHIodGFnbmFtZWJ1ZiksIGF0dHJpYnV0ZXMsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBlbWl0RG9jdHlwZSgpIHsKICAgICAgICAgICAgICAgICAgICBpbnNlcnRUb2tlbihET0NUWVBFLCBidWYyc3RyKGRvY3R5cGVuYW1lYnVmKSwgZG9jdHlwZXB1YmxpY2J1ZiA/IGJ1ZjJzdHIoZG9jdHlwZXB1YmxpY2J1ZikgOiB1bmRlZmluZWQsIGRvY3R5cGVzeXN0ZW1idWYgPyBidWYyc3RyKGRvY3R5cGVzeXN0ZW1idWYpIDogdW5kZWZpbmVkKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBlbWl0RU9GKCkgewogICAgICAgICAgICAgICAgICAgIGZsdXNoVGV4dCgpOwogICAgICAgICAgICAgICAgICAgIHBhcnNlcihFT0YpOyAvLyBFT0YgbmV2ZXIgZ29lcyB0byBpbnNlcnRGb3JlaWduQ29udGVudCgpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gSW5zZXJ0IGEgdG9rZW4sIGVpdGhlciB1c2luZyB0aGUgY3VycmVudCBwYXJzZXIgaW5zZXJ0aW8gbW9kZQogICAgICAgICAgICAgICAgLy8gKGZvciBIVE1MIHN0dWZmKSBvciB1c2luZyB0aGUgaW5zZXJ0Rm9yZWlnblRva2VuKCkgbWV0aG9kLgogICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5zZXJ0VG9rZW4odCwgdmFsdWUsIGFyZzMsIGFyZzQpIHsKICAgICAgICAgICAgICAgICAgICBmbHVzaFRleHQoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudCA9IHN0YWNrLnRvcDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50IHx8IGN1cnJlbnQubmFtZXNwYWNlVVJJID09PSBIVE1MX05BTUVTUEFDRSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBjb21tb24gY2FzZQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSB3ZSBtYXkgbmVlZCB0byBpbnNlcnQgdGhpcyB0b2tlbiBhcyBmb3JlaWduIGNvbnRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQgIT09IFRBRyAmJiB0ICE9PSBURVhUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRGb3JlaWduVG9rZW4odCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQnV0IGluIHNvbWUgY2FzZXMgd2UgdHJlYXQgaXQgYXMgcmVndWxhciBjb250ZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXRobWxUZXh0SW50ZWdyYXRpb25Qb2ludChjdXJyZW50KSAmJiAodCA9PT0gVEVYVCB8fCB0ID09PSBUQUcgJiYgdmFsdWUgIT09ICJtZ2x5cGgiICYmIHZhbHVlICE9PSAibWFsaWdubWFyayIpIHx8IHQgPT09IFRBRyAmJiB2YWx1ZSA9PT0gInN2ZyIgJiYgY3VycmVudC5uYW1lc3BhY2VVUkkgPT09IE1BVEhNTF9OQU1FU1BBQ0UgJiYgY3VycmVudC5sb2NhbE5hbWUgPT09ICJhbm5vdGF0aW9uLXhtbCIgfHwgaXNIVE1MSW50ZWdyYXRpb25Qb2ludChjdXJyZW50KSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBYWFg6IHRoZSB0ZXh0X2ludGVncmF0aW9uX21vZGUgc3R1ZmYgaXMgYW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhdHRlbXB0ZWQgYnVnIHdvcmthcm91bmQgb2YgbWluZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRfaW50ZWdyYXRpb25fbW9kZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0X2ludGVncmF0aW9uX21vZGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSBpdCBpcyBmb3JlaWduIGNvbnRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRGb3JlaWduVG9rZW4odCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvKioqCiAgICAgICAgICAgICAgICAgKiBUcmVlIGJ1aWxkaW5nIHV0aWxpdHkgZnVuY3Rpb25zCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGluc2VydENvbW1lbnQoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHN0YWNrLnRvcC5hcHBlbmRDaGlsZChkb2MuY3JlYXRlQ29tbWVudChkYXRhKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5zZXJ0VGV4dChzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZvc3Rlcl9wYXJlbnRfbW9kZSAmJiBpc0Eoc3RhY2sudG9wLCB0YWJsZXNlY3Rpb25yb3dTZXQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvc3RlclBhcmVudChkb2MuY3JlYXRlVGV4dE5vZGUocykpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsYXN0Q2hpbGQgPSBzdGFjay50b3AubGFzdENoaWxkOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdENoaWxkICYmIGxhc3RDaGlsZC5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RDaGlsZC5hcHBlbmREYXRhKHMpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sudG9wLmFwcGVuZENoaWxkKGRvYy5jcmVhdGVUZXh0Tm9kZShzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlSFRNTEVsdChuYW1lLCBhdHRycykgewogICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgZWxlbWVudCB0aGlzIHdheSwgcmF0aGVyIHRoYW4gd2l0aAogICAgICAgICAgICAgICAgICAgIC8vIGRvYy5jcmVhdGVFbGVtZW50IGJlY2F1c2UgY3JlYXRlRWxlbWVudCgpIGRvZXMgZXJyb3IKICAgICAgICAgICAgICAgICAgICAvLyBjaGVja2luZyBvbiB0aGUgZWxlbWVudCBuYW1lIHRoYXQgd2UgbmVlZCB0byBhdm9pZCBoZXJlLgogICAgICAgICAgICAgICAgICAgIHZhciBpbnRlcmZhY2VOYW1lID0gdGFnTmFtZVRvSW50ZXJmYWNlTmFtZVtuYW1lXSB8fCAiSFRNTFVua25vd25FbGVtZW50IjsKICAgICAgICAgICAgICAgICAgICB2YXIgZWx0ID0gbmV3IGltcGxbaW50ZXJmYWNlTmFtZV0oZG9jLCBuYW1lLCBudWxsKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gYXR0cnMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIF8gdmVyc2lvbiB0byBhdm9pZCB0ZXN0aW5nIHRoZSB2YWxpZGl0eQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb2YgdGhlIGF0dHJpYnV0ZSBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHQuX3NldEF0dHJpYnV0ZShhdHRyc1tpXVswXSwgYXR0cnNbaV1bMV0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIFhYWAogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBlbGVtZW50IGlzIGEgcmVzZXR0YWJsZSBmb3JtIGVsZW1lbnQsCiAgICAgICAgICAgICAgICAgICAgLy8gcnVuIGl0cyByZXNldCBhbGdvcml0aG0gbm93CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsdDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBUaGUgaW5fdGFibGUgaW5zZXJ0aW9uIG1vZGUgdHVybnMgb24gdGhpcyBmbGFnLCBhbmQgdGhhdCBtYWtlcwogICAgICAgICAgICAgICAgLy8gaW5zZXJ0SFRNTEVsZW1lbnQgdXNlIHRoZSBmb3N0ZXIgcGFyZW50aW5nIGFsZ29yaXRobSBmb3IgZWxlbWVudHMKICAgICAgICAgICAgICAgIC8vIHRhZ3MgaW5zaWRlIGEgdGFibGUKICAgICAgICAgICAgICAgIHZhciBmb3N0ZXJfcGFyZW50X21vZGUgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpbnNlcnRIVE1MRWxlbWVudChuYW1lLCBhdHRycykgewogICAgICAgICAgICAgICAgICAgIHZhciBlbHQgPSBjcmVhdGVIVE1MRWx0KG5hbWUsIGF0dHJzKTsKICAgICAgICAgICAgICAgICAgICBpbnNlcnRFbGVtZW50KGVsdCk7CgogICAgICAgICAgICAgICAgICAgIC8vIFhYWAogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSBmb3JtIGVsZW1lbnQsIHNldCBpdHMgZm9ybSBhdHRyaWJ1dGUgcHJvcGVydHkgaGVyZQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWx0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEluc2VydCB0aGUgZWxlbWVudCBpbnRvIHRoZSBvcGVuIGVsZW1lbnQgb3IgZm9zdGVyIHBhcmVudCBpdAogICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5zZXJ0RWxlbWVudChlbHQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZm9zdGVyX3BhcmVudF9tb2RlICYmIGlzQShzdGFjay50b3AsIHRhYmxlc2VjdGlvbnJvd1NldCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9zdGVyUGFyZW50KGVsdCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sudG9wLmFwcGVuZENoaWxkKGVsdCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKGVsdCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5zZXJ0Rm9yZWlnbkVsZW1lbnQobmFtZSwgYXR0cnMsIG5zKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVsdCA9IGRvYy5jcmVhdGVFbGVtZW50TlMobnMsIG5hbWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChhdHRycykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IGF0dHJzLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHIgPSBhdHRyc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdHRyLmxlbmd0aCA9PSAyKSBlbHQuX3NldEF0dHJpYnV0ZShhdHRyWzBdLCBhdHRyWzFdKTtlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHQuX3NldEF0dHJpYnV0ZU5TKGF0dHJbMl0sIGF0dHJbMF0sIGF0dHJbMV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpbnNlcnRFbGVtZW50KGVsdCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gZm9zdGVyUGFyZW50KGVsdCkgewogICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnQsIGJlZm9yZTsKCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHN0YWNrLmVsZW1lbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFjay5lbGVtZW50c1tpXSBpbnN0YW5jZW9mIGltcGwuSFRNTFRhYmxlRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gc3RhY2suZWxlbWVudHNbaV0ucGFyZW50RWxlbWVudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQpIGJlZm9yZSA9IHN0YWNrLmVsZW1lbnRzW2ldO2Vsc2UgcGFyZW50ID0gc3RhY2suZWxlbWVudHNbaSAtIDFdOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghcGFyZW50KSBwYXJlbnQgPSBzdGFjay5lbGVtZW50c1swXTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGVsdC5ub2RlVHlwZSA9PT0gTm9kZS5URVhUX05PREUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByZXY7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiZWZvcmUpIHByZXYgPSBiZWZvcmUucHJldmlvdXNTaWJsaW5nO2Vsc2UgcHJldiA9IHBhcmVudC5sYXN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmV2ICYmIHByZXYubm9kZVR5cGUgPT09IE5vZGUuVEVYVF9OT0RFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2LmFwcGVuZERhdGEoZWx0LmRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChiZWZvcmUpIHBhcmVudC5pbnNlcnRCZWZvcmUoZWx0LCBiZWZvcmUpO2Vsc2UgcGFyZW50LmFwcGVuZENoaWxkKGVsdCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gcmVzZXRJbnNlcnRpb25Nb2RlKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBsYXN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHN0YWNrLmVsZW1lbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub2RlID0gc3RhY2suZWxlbWVudHNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBmcmFnbWVudENvbnRleHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubmFtZXNwYWNlVVJJID09PSBIVE1MX05BTUVTUEFDRSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhZyA9IG5vZGUubG9jYWxOYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzZWxlY3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBpbl9zZWxlY3RfbW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fcm93X21vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0Ym9keSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGZvb3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRoZWFkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fdGFibGVfYm9keV9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2FwdGlvbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlciA9IGluX2NhcHRpb25fbW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNvbGdyb3VwIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fY29sdW1uX2dyb3VwX21vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0YWJsZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlciA9IGluX3RhYmxlX21vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJoZWFkIjogLy8gTm90IGluX2hlYWRfbW9kZSEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJib2R5IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fYm9keV9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZnJhbWVzZXQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBpbl9mcmFtZXNldF9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaHRtbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlciA9IGJlZm9yZV9oZWFkX21vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxhc3QgJiYgKHRhZyA9PT0gInRkIiB8fCB0YWcgPT09ICJ0aCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBpbl9jZWxsX21vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fYm9keV9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlUmF3VGV4dChuYW1lLCBhdHRycykgewogICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KG5hbWUsIGF0dHJzKTsKICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSByYXd0ZXh0X3N0YXRlOwogICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsSW5zZXJ0aW9uTW9kZSA9IHBhcnNlcjsKICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSB0ZXh0X21vZGU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2VSQ0RBVEEobmFtZSwgYXR0cnMpIHsKICAgICAgICAgICAgICAgICAgICBpbnNlcnRIVE1MRWxlbWVudChuYW1lLCBhdHRycyk7CiAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gcmNkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsSW5zZXJ0aW9uTW9kZSA9IHBhcnNlcjsKICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSB0ZXh0X21vZGU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gTWFrZSBhIGNvcHkgb2YgZWxlbWVudCBpIG9uIHRoZSBsaXN0IG9mIGFjdGl2ZSBmb3JtYXR0aW5nCiAgICAgICAgICAgICAgICAvLyBlbGVtZW50cywgdXNpbmcgaXRzIG9yaWdpbmFsIGF0dHJpYnV0ZXMsIG5vdCBjdXJyZW50CiAgICAgICAgICAgICAgICAvLyBhdHRyaWJ1dGVzICh3aGljaCBtYXkgaGF2ZSBiZWVuIG1vZGlmaWVkIGJ5IGEgc2NyaXB0KQogICAgICAgICAgICAgICAgZnVuY3Rpb24gYWZlY2xvbmUoaSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVIVE1MRWx0KGFmZS5saXN0W2ldLmxvY2FsTmFtZSwgYWZlLmF0dHJzW2ldKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhZmVyZWNvbnN0cnVjdCgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYWZlLmxpc3QubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgdmFyIGVudHJ5ID0gYWZlLmxpc3RbYWZlLmxpc3QubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGxhc3QgaXMgYSBtYXJrZXIgLCBkbyBub3RoaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5ID09PSBhZmUuTUFSS0VSKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgLy8gT3IgaWYgaXQgaXMgYW4gb3BlbiBlbGVtZW50LCBkbyBub3RoaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKEEubGFzdEluZGV4T2Yoc3RhY2suZWxlbWVudHMsIGVudHJ5KSAhPT0gLTEpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgLy8gTG9vcCBiYWNrd2FyZCB0aHJvdWdoIHRoZSBsaXN0IHVudGlsIHdlIGZpbmQgYSBtYXJrZXIgb3IgYW4KICAgICAgICAgICAgICAgICAgICAvLyBvcGVuIGVsZW1lbnQsIGFuZCB0aGVuIG1vdmUgZm9yd2FyZCBvbmUgZnJvbSB0aGVyZS4KICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gYWZlLmxpc3QubGVuZ3RoIC0gMjsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkgPSBhZmUubGlzdFtpXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5ID09PSBhZmUuTUFSS0VSKSBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEEubGFzdEluZGV4T2Yoc3RhY2suZWxlbWVudHMsIGVudHJ5KSAhPT0gLTEpIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gTm93IGxvb3AgZm9yd2FyZCwgc3RhcnRpbmcgZnJvbSB0aGUgZWxlbWVudCBhZnRlciB0aGUgY3VycmVudAogICAgICAgICAgICAgICAgICAgIC8vIG9uZSwgcmVjcmVhdGluZyBmb3JtYXR0aW5nIGVsZW1lbnRzIGFuZCBwdXNoaW5nIHRoZW0gYmFjayBvbnRvCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGxpc3Qgb2Ygb3BlbiBlbGVtZW50cwogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IGkgKyAxOyBpIDwgYWZlLmxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld2VsdCA9IGFmZWNsb25lKGkpOwogICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRFbGVtZW50KG5ld2VsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFmZS5saXN0W2ldID0gbmV3ZWx0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgLy8gVXNlZCBieSB0aGUgYWRvcHRpb25BZ2VuY3koKSBmdW5jdGlvbgogICAgICAgICAgICAgICAgdmFyIEJPT0tNQVJLID0geyBsb2NhbE5hbWU6ICJCTSIgfTsKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhZG9wdGlvbkFnZW5jeSh0YWcpIHsKICAgICAgICAgICAgICAgICAgICAvLyBMZXQgb3V0ZXIgbG9vcCBjb3VudGVyIGJlIHplcm8uCiAgICAgICAgICAgICAgICAgICAgdmFyIG91dGVyID0gMDsKCiAgICAgICAgICAgICAgICAgICAgLy8gT3V0ZXIgbG9vcDogSWYgb3V0ZXIgbG9vcCBjb3VudGVyIGlzIGdyZWF0ZXIgdGhhbiBvcgogICAgICAgICAgICAgICAgICAgIC8vIGVxdWFsIHRvIGVpZ2h0LCB0aGVuIGFib3J0IHRoZXNlIHN0ZXBzLgogICAgICAgICAgICAgICAgICAgIHdoaWxlIChvdXRlciA8IDgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW5jcmVtZW50IG91dGVyIGxvb3AgY291bnRlciBieSBvbmUuCiAgICAgICAgICAgICAgICAgICAgICAgIG91dGVyKys7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBMZXQgdGhlIGZvcm1hdHRpbmcgZWxlbWVudCBiZSB0aGUgbGFzdCBlbGVtZW50IGluIHRoZSBsaXN0CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mIGFjdGl2ZSBmb3JtYXR0aW5nIGVsZW1lbnRzIHRoYXQ6IGlzIGJldHdlZW4gdGhlIGVuZCBvZgogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbGlzdCBhbmQgdGhlIGxhc3Qgc2NvcGUgbWFya2VyIGluIHRoZSBsaXN0LCBpZiBhbnksIG9yCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzdGFydCBvZiB0aGUgbGlzdCBvdGhlcndpc2UsIGFuZCBoYXMgdGhlIHNhbWUgdGFnIG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXMgdGhlIHRva2VuLgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm10ZWx0ID0gYWZlLmZpbmRFbGVtZW50QnlUYWcodGFnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIHN1Y2ggbm9kZSwgdGhlbiBhYm9ydCB0aGVzZSBzdGVwcyBhbmQgaW5zdGVhZAogICAgICAgICAgICAgICAgICAgICAgICAvLyBhY3QgYXMgZGVzY3JpYmVkIGluIHRoZSAiYW55IG90aGVyIGVuZCB0YWciIGVudHJ5IGJlbG93LgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZtdGVsdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBmYWxzZSBtZWFucyBoYW5kbGUgYnkgdGhlIGRlZmF1bHQgY2FzZQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIGlmIHRoZXJlIGlzIHN1Y2ggYSBub2RlLCBidXQgdGhhdCBub2RlIGlzIG5vdCBpbgogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgc3RhY2sgb2Ygb3BlbiBlbGVtZW50cywgdGhlbiB0aGlzIGlzIGEgcGFyc2UgZXJyb3I7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSB0aGUgZWxlbWVudCBmcm9tIHRoZSBsaXN0LCBhbmQgYWJvcnQgdGhlc2Ugc3RlcHMuCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IEEubGFzdEluZGV4T2Yoc3RhY2suZWxlbWVudHMsIGZtdGVsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZS5yZW1vdmUoZm10ZWx0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOyAvLyB0cnVlIG1lYW5zIG5vIG1vcmUgaGFuZGxpbmcgcmVxdWlyZWQKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBpZiB0aGVyZSBpcyBzdWNoIGEgbm9kZSwgYW5kIHRoYXQgbm9kZSBpcyBhbHNvIGluCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzdGFjayBvZiBvcGVuIGVsZW1lbnRzLCBidXQgdGhlIGVsZW1lbnQgaXMgbm90IGluIHNjb3BlLAogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGVuIHRoaXMgaXMgYSBwYXJzZSBlcnJvcjsgaWdub3JlIHRoZSB0b2tlbiwgYW5kIGFib3J0CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZXNlIHN0ZXBzLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YWNrLmVsZW1lbnRJblNjb3BlKGZtdGVsdCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBMZXQgdGhlIGZ1cnRoZXN0IGJsb2NrIGJlIHRoZSB0b3Btb3N0IG5vZGUgaW4gdGhlIHN0YWNrIG9mCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9wZW4gZWxlbWVudHMgdGhhdCBpcyBsb3dlciBpbiB0aGUgc3RhY2sgdGhhbiB0aGUgZm9ybWF0dGluZwogICAgICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50LCBhbmQgaXMgYW4gZWxlbWVudCBpbiB0aGUgc3BlY2lhbCBjYXRlZ29yeS4gVGhlcmUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWlnaHQgbm90IGJlIG9uZS4KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZ1cnRoZXN0YmxvY2sgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVydGhlc3RibG9ja2luZGV4OwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gaW5kZXggKyAxOyBpIDwgc3RhY2suZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0Eoc3RhY2suZWxlbWVudHNbaV0sIHNwZWNpYWxTZXQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVydGhlc3RibG9jayA9IHN0YWNrLmVsZW1lbnRzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1cnRoZXN0YmxvY2tpbmRleCA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIGZ1cnRoZXN0IGJsb2NrLCB0aGVuIHRoZSBVQSBtdXN0IHNraXAgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN1YnNlcXVlbnQgc3RlcHMgYW5kIGluc3RlYWQganVzdCBwb3AgYWxsIHRoZSBub2RlcyBmcm9tIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBib3R0b20gb2YgdGhlIHN0YWNrIG9mIG9wZW4gZWxlbWVudHMsIGZyb20gdGhlIGN1cnJlbnQgbm9kZQogICAgICAgICAgICAgICAgICAgICAgICAvLyB1cCB0byBhbmQgaW5jbHVkaW5nIHRoZSBmb3JtYXR0aW5nIGVsZW1lbnQsIGFuZCByZW1vdmUgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZvcm1hdHRpbmcgZWxlbWVudCBmcm9tIHRoZSBsaXN0IG9mIGFjdGl2ZSBmb3JtYXR0aW5nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVsZW1lbnRzLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZ1cnRoZXN0YmxvY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcEVsZW1lbnQoZm10ZWx0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZS5yZW1vdmUoZm10ZWx0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIExldCB0aGUgY29tbW9uIGFuY2VzdG9yIGJlIHRoZSBlbGVtZW50IGltbWVkaWF0ZWx5IGFib3ZlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZm9ybWF0dGluZyBlbGVtZW50IGluIHRoZSBzdGFjayBvZiBvcGVuIGVsZW1lbnRzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFuY2VzdG9yID0gc3RhY2suZWxlbWVudHNbaW5kZXggLSAxXTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMZXQgYSBib29rbWFyayBub3RlIHRoZSBwb3NpdGlvbiBvZiB0aGUgZm9ybWF0dGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCBpbiB0aGUgbGlzdCBvZiBhY3RpdmUgZm9ybWF0dGluZyBlbGVtZW50cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVsYXRpdmUgdG8gdGhlIGVsZW1lbnRzIG9uIGVpdGhlciBzaWRlIG9mIGl0IGluIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGlzdC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZS5pbnNlcnRBZnRlcihmbXRlbHQsIEJPT0tNQVJLKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMZXQgbm9kZSBhbmQgbGFzdCBub2RlIGJlIHRoZSBmdXJ0aGVzdCBibG9jay4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub2RlID0gZnVydGhlc3RibG9jazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsYXN0bm9kZSA9IGZ1cnRoZXN0YmxvY2s7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZWluZGV4ID0gZnVydGhlc3RibG9ja2luZGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGVhZmVpbmRleDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMZXQgaW5uZXIgbG9vcCBjb3VudGVyIGJlIHplcm8uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5uZXIgPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElubmVyIGxvb3A6IElmIGlubmVyIGxvb3AgY291bnRlciBpcyBncmVhdGVyIHRoYW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9yIGVxdWFsIHRvIHRocmVlLCB0aGVuIGFib3J0IHRoZXNlIHN0ZXBzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGlubmVyIDwgMykgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbmNyZW1lbnQgaW5uZXIgbG9vcCBjb3VudGVyIGJ5IG9uZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbm5lcisrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMZXQgbm9kZSBiZSB0aGUgZWxlbWVudCBpbW1lZGlhdGVseSBhYm92ZSBub2RlIGluCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHN0YWNrIG9mIG9wZW4gZWxlbWVudHMsIG9yIGlmIG5vZGUgaXMgbm8gbG9uZ2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW4gdGhlIHN0YWNrIG9mIG9wZW4gZWxlbWVudHMgKGUuZy4gYmVjYXVzZSBpdCBnb3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmVkIGJ5IHRoZSBuZXh0IHN0ZXApLCB0aGUgZWxlbWVudCB0aGF0IHdhcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGltbWVkaWF0ZWx5IGFib3ZlIG5vZGUgaW4gdGhlIHN0YWNrIG9mIG9wZW4gZWxlbWVudHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBiZWZvcmUgbm9kZSB3YXMgcmVtb3ZlZC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlID0gc3RhY2suZWxlbWVudHNbLS1ub2RlaW5kZXhdOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBub2RlIGlzIG5vdCBpbiB0aGUgbGlzdCBvZiBhY3RpdmUgZm9ybWF0dGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVsZW1lbnRzLCB0aGVuIHJlbW92ZSBub2RlIGZyb20gdGhlIHN0YWNrIG9mIG9wZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50cyBhbmQgdGhlbiBnbyBiYWNrIHRvIHRoZSBzdGVwIGxhYmVsZWQgaW5uZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb29wLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVhZmVpbmRleCA9IGFmZS5pbmRleE9mKG5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlYWZlaW5kZXggPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnJlbW92ZUVsZW1lbnQobm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBpZiBub2RlIGlzIHRoZSBmb3JtYXR0aW5nIGVsZW1lbnQsIHRoZW4gZ28KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0byB0aGUgbmV4dCBzdGVwIGluIHRoZSBvdmVyYWxsIGFsZ29yaXRobS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZSA9PT0gZm10ZWx0KSBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGFuIGVsZW1lbnQgZm9yIHRoZSB0b2tlbiBmb3Igd2hpY2ggdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCBub2RlIHdhcyBjcmVhdGVkLCByZXBsYWNlIHRoZSBlbnRyeSBmb3Igbm9kZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluIHRoZSBsaXN0IG9mIGFjdGl2ZSBmb3JtYXR0aW5nIGVsZW1lbnRzIHdpdGggYW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbnRyeSBmb3IgdGhlIG5ldyBlbGVtZW50LCByZXBsYWNlIHRoZSBlbnRyeSBmb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBub2RlIGluIHRoZSBzdGFjayBvZiBvcGVuIGVsZW1lbnRzIHdpdGggYW4gZW50cnkgZm9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG5ldyBlbGVtZW50LCBhbmQgbGV0IG5vZGUgYmUgdGhlIG5ldyBlbGVtZW50LgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdlbHQgPSBhZmVjbG9uZShub2RlYWZlaW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZS5yZXBsYWNlKG5vZGUsIG5ld2VsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2suZWxlbWVudHNbbm9kZWluZGV4XSA9IG5ld2VsdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlID0gbmV3ZWx0OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBsYXN0IG5vZGUgaXMgdGhlIGZ1cnRoZXN0IGJsb2NrLCB0aGVuIG1vdmUgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWZvcmVtZW50aW9uZWQgYm9va21hcmsgdG8gYmUgaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmV3IG5vZGUgaW4gdGhlIGxpc3Qgb2YgYWN0aXZlIGZvcm1hdHRpbmcgZWxlbWVudHMuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3Rub2RlID09PSBmdXJ0aGVzdGJsb2NrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZS5yZW1vdmUoQk9PS01BUkspOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZmUuaW5zZXJ0QWZ0ZXIobmV3ZWx0LCBCT09LTUFSSyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbnNlcnQgbGFzdCBub2RlIGludG8gbm9kZSwgZmlyc3QgcmVtb3ZpbmcgaXQgZnJvbQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGl0cyBwcmV2aW91cyBwYXJlbnQgbm9kZSBpZiBhbnkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5hcHBlbmRDaGlsZChsYXN0bm9kZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIExldCBsYXN0IG5vZGUgYmUgbm9kZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0bm9kZSA9IG5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGNvbW1vbiBhbmNlc3RvciBub2RlIGlzIGEgdGFibGUsIHRib2R5LCB0Zm9vdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZWFkLCBvciB0ciBlbGVtZW50LCB0aGVuLCBmb3N0ZXIgcGFyZW50IHdoYXRldmVyIGxhc3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vZGUgZW5kZWQgdXAgYmVpbmcgaW4gdGhlIHByZXZpb3VzIHN0ZXAsIGZpcnN0IHJlbW92aW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCBmcm9tIGl0cyBwcmV2aW91cyBwYXJlbnQgbm9kZSBpZiBhbnkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNBKGFuY2VzdG9yLCB0YWJsZXNlY3Rpb25yb3dTZXQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9zdGVyUGFyZW50KGxhc3Rub2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgYXBwZW5kIHdoYXRldmVyIGxhc3Qgbm9kZSBlbmRlZCB1cCBiZWluZyBpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHByZXZpb3VzIHN0ZXAgdG8gdGhlIGNvbW1vbiBhbmNlc3RvciBub2RlLCBmaXJzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZpbmcgaXQgZnJvbSBpdHMgcHJldmlvdXMgcGFyZW50IG5vZGUgaWYgYW55LgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuY2VzdG9yLmFwcGVuZENoaWxkKGxhc3Rub2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGFuIGVsZW1lbnQgZm9yIHRoZSB0b2tlbiBmb3Igd2hpY2ggdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmb3JtYXR0aW5nIGVsZW1lbnQgd2FzIGNyZWF0ZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3ZWx0MiA9IGFmZWNsb25lKGFmZS5pbmRleE9mKGZtdGVsdCkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRha2UgYWxsIG9mIHRoZSBjaGlsZCBub2RlcyBvZiB0aGUgZnVydGhlc3QgYmxvY2sgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhcHBlbmQgdGhlbSB0byB0aGUgZWxlbWVudCBjcmVhdGVkIGluIHRoZSBsYXN0IHN0ZXAuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoZnVydGhlc3RibG9jay5oYXNDaGlsZE5vZGVzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdlbHQyLmFwcGVuZENoaWxkKGZ1cnRoZXN0YmxvY2suZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXBwZW5kIHRoYXQgbmV3IGVsZW1lbnQgdG8gdGhlIGZ1cnRoZXN0IGJsb2NrLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVydGhlc3RibG9jay5hcHBlbmRDaGlsZChuZXdlbHQyKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGZvcm1hdHRpbmcgZWxlbWVudCBmcm9tIHRoZSBsaXN0IG9mIGFjdGl2ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZm9ybWF0dGluZyBlbGVtZW50cywgYW5kIGluc2VydCB0aGUgbmV3IGVsZW1lbnQgaW50byB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxpc3Qgb2YgYWN0aXZlIGZvcm1hdHRpbmcgZWxlbWVudHMgYXQgdGhlIHBvc2l0aW9uIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgYWZvcmVtZW50aW9uZWQgYm9va21hcmsuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZmUucmVtb3ZlKGZtdGVsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZmUucmVwbGFjZShCT09LTUFSSywgbmV3ZWx0Mik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBmb3JtYXR0aW5nIGVsZW1lbnQgZnJvbSB0aGUgc3RhY2sgb2Ygb3BlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudHMsIGFuZCBpbnNlcnQgdGhlIG5ldyBlbGVtZW50IGludG8gdGhlIHN0YWNrIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvcGVuIGVsZW1lbnRzIGltbWVkaWF0ZWx5IGJlbG93IHRoZSBwb3NpdGlvbiBvZiB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZ1cnRoZXN0IGJsb2NrIGluIHRoYXQgc3RhY2suCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5yZW1vdmVFbGVtZW50KGZtdGVsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gQS5sYXN0SW5kZXhPZihzdGFjay5lbGVtZW50cywgZnVydGhlc3RibG9jayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpY2Uoc3RhY2suZWxlbWVudHMsIHBvcyArIDEsIDAsIG5ld2VsdDIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBXZSBkbyB0aGlzIHdoZW4gd2UgZ2V0IC9zY3JpcHQgaW4gaW5fdGV4dF9tb2RlCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVTY3JpcHRFbmQoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gWFhYOgogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMganVzdCBhIHN0dWIgaW1wbGVtZW50YXRpb24gcmlnaHQgbm93IGFuZCBkb2Vzbid0IHJ1biBzY3JpcHRzLgogICAgICAgICAgICAgICAgICAgIC8vIEdldHRpbmcgdGhpcyBtZXRob2QgcmlnaHQgaW52b2x2ZXMgdGhlIGV2ZW50IGxvb3AsIFVSTCByZXNvbHV0aW9uCiAgICAgICAgICAgICAgICAgICAgLy8gc2NyaXB0IGZldGNoaW5nIGV0Yy4gRm9yIG5vdyBJIGp1c3Qgd2FudCB0byBiZSBhYmxlIHRvIHBhcnNlCiAgICAgICAgICAgICAgICAgICAgLy8gZG9jdW1lbnRzIGFuZCB0ZXN0IHRoZSBwYXJzZXIuCgogICAgICAgICAgICAgICAgICAgIHZhciBzY3JpcHQgPSBzdGFjay50b3A7CiAgICAgICAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gb3JpZ2luYWxJbnNlcnRpb25Nb2RlOwogICAgICAgICAgICAgICAgICAgIHNjcmlwdC5fcHJlcGFyZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBoZXJlIGlzIHdoYXQgdGhpcyBtZXRob2QgaXMgc3VwcG9zZWQgdG8gZG8KCiAgICAgICAgICAgICAgICAgICAgLy8gUHJvdmlkZSBhIHN0YWJsZSBzdGF0ZS4KCiAgICAgICAgICAgICAgICAgICAgLy8gTGV0IHNjcmlwdCBiZSB0aGUgY3VycmVudCBub2RlICh3aGljaCB3aWxsIGJlIGEgc2NyaXB0CiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCkuCgogICAgICAgICAgICAgICAgICAgIC8vIFBvcCB0aGUgY3VycmVudCBub2RlIG9mZiB0aGUgc3RhY2sgb2Ygb3BlbiBlbGVtZW50cy4KCiAgICAgICAgICAgICAgICAgICAgLy8gU3dpdGNoIHRoZSBpbnNlcnRpb24gbW9kZSB0byB0aGUgb3JpZ2luYWwgaW5zZXJ0aW9uIG1vZGUuCgogICAgICAgICAgICAgICAgICAgIC8vIExldCB0aGUgb2xkIGluc2VydGlvbiBwb2ludCBoYXZlIHRoZSBzYW1lIHZhbHVlIGFzIHRoZSBjdXJyZW50CiAgICAgICAgICAgICAgICAgICAgLy8gaW5zZXJ0aW9uIHBvaW50LiBMZXQgdGhlIGluc2VydGlvbiBwb2ludCBiZSBqdXN0IGJlZm9yZSB0aGUKICAgICAgICAgICAgICAgICAgICAvLyBuZXh0IGlucHV0IGNoYXJhY3Rlci4KCiAgICAgICAgICAgICAgICAgICAgLy8gSW5jcmVtZW50IHRoZSBwYXJzZXIncyBzY3JpcHQgbmVzdGluZyBsZXZlbCBieSBvbmUuCgogICAgICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgdGhlIHNjcmlwdC4gVGhpcyBtaWdodCBjYXVzZSBzb21lIHNjcmlwdCB0byBleGVjdXRlLAogICAgICAgICAgICAgICAgICAgIC8vIHdoaWNoIG1pZ2h0IGNhdXNlIG5ldyBjaGFyYWN0ZXJzIHRvIGJlIGluc2VydGVkIGludG8gdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gdG9rZW5pemVyLCBhbmQgbWlnaHQgY2F1c2UgdGhlIHRva2VuaXplciB0byBvdXRwdXQgbW9yZSB0b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgLy8gcmVzdWx0aW5nIGluIGEgcmVlbnRyYW50IGludm9jYXRpb24gb2YgdGhlIHBhcnNlci4KCiAgICAgICAgICAgICAgICAgICAgLy8gRGVjcmVtZW50IHRoZSBwYXJzZXIncyBzY3JpcHQgbmVzdGluZyBsZXZlbCBieSBvbmUuIElmIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIHBhcnNlcidzIHNjcmlwdCBuZXN0aW5nIGxldmVsIGlzIHplcm8sIHRoZW4gc2V0IHRoZSBwYXJzZXIKICAgICAgICAgICAgICAgICAgICAvLyBwYXVzZSBmbGFnIHRvIGZhbHNlLgoKICAgICAgICAgICAgICAgICAgICAvLyBMZXQgdGhlIGluc2VydGlvbiBwb2ludCBoYXZlIHRoZSB2YWx1ZSBvZiB0aGUgb2xkIGluc2VydGlvbgogICAgICAgICAgICAgICAgICAgIC8vIHBvaW50LiAoSW4gb3RoZXIgd29yZHMsIHJlc3RvcmUgdGhlIGluc2VydGlvbiBwb2ludCB0byBpdHMKICAgICAgICAgICAgICAgICAgICAvLyBwcmV2aW91cyB2YWx1ZS4gVGhpcyB2YWx1ZSBtaWdodCBiZSB0aGUgInVuZGVmaW5lZCIgdmFsdWUuKQoKICAgICAgICAgICAgICAgICAgICAvLyBBdCB0aGlzIHN0YWdlLCBpZiB0aGVyZSBpcyBhIHBlbmRpbmcgcGFyc2luZy1ibG9ja2luZyBzY3JpcHQsCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlbjoKCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHNjcmlwdCBuZXN0aW5nIGxldmVsIGlzIG5vdCB6ZXJvOgoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgU2V0IHRoZSBwYXJzZXIgcGF1c2UgZmxhZyB0byB0cnVlLCBhbmQgYWJvcnQgdGhlIHByb2Nlc3NpbmcKICAgICAgICAgICAgICAgICAgICAvLyAgICAgb2YgYW55IG5lc3RlZCBpbnZvY2F0aW9ucyBvZiB0aGUgdG9rZW5pemVyLCB5aWVsZGluZwogICAgICAgICAgICAgICAgICAgIC8vICAgICBjb250cm9sIGJhY2sgdG8gdGhlIGNhbGxlci4gKFRva2VuaXphdGlvbiB3aWxsIHJlc3VtZSB3aGVuCiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoZSBjYWxsZXIgcmV0dXJucyB0byB0aGUgIm91dGVyIiB0cmVlIGNvbnN0cnVjdGlvbiBzdGFnZS4pCgogICAgICAgICAgICAgICAgICAgIC8vICAgICBUaGUgdHJlZSBjb25zdHJ1Y3Rpb24gc3RhZ2Ugb2YgdGhpcyBwYXJ0aWN1bGFyIHBhcnNlciBpcwogICAgICAgICAgICAgICAgICAgIC8vICAgICBiZWluZyBjYWxsZWQgcmVlbnRyYW50bHksIHNheSBmcm9tIGEgY2FsbCB0bwogICAgICAgICAgICAgICAgICAgIC8vICAgICBkb2N1bWVudC53cml0ZSgpLgoKICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2U6CgogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgUnVuIHRoZXNlIHN0ZXBzOgoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBMZXQgdGhlIHNjcmlwdCBiZSB0aGUgcGVuZGluZyBwYXJzaW5nLWJsb2NraW5nCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgc2NyaXB0LiBUaGVyZSBpcyBubyBsb25nZXIgYSBwZW5kaW5nCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgcGFyc2luZy1ibG9ja2luZyBzY3JpcHQuCgogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIEJsb2NrIHRoZSB0b2tlbml6ZXIgZm9yIHRoaXMgaW5zdGFuY2Ugb2YgdGhlIEhUTUwKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBwYXJzZXIsIHN1Y2ggdGhhdCB0aGUgZXZlbnQgbG9vcCB3aWxsIG5vdCBydW4gdGFza3MKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICB0aGF0IGludm9rZSB0aGUgdG9rZW5pemVyLgoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBJZiB0aGUgcGFyc2VyJ3MgRG9jdW1lbnQgaGFzIGEgc3R5bGUgc2hlZXQgdGhhdCBpcwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIGJsb2NraW5nIHNjcmlwdHMgb3IgdGhlIHNjcmlwdCdzICJyZWFkeSB0byBiZQogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIHBhcnNlci1leGVjdXRlZCIgZmxhZyBpcyBub3Qgc2V0OiBzcGluIHRoZSBldmVudAogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIGxvb3AgdW50aWwgdGhlIHBhcnNlcidzIERvY3VtZW50IGhhcyBubyBzdHlsZSBzaGVldAogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIHRoYXQgaXMgYmxvY2tpbmcgc2NyaXB0cyBhbmQgdGhlIHNjcmlwdCdzICJyZWFkeSB0bwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIGJlIHBhcnNlci1leGVjdXRlZCIgZmxhZyBpcyBzZXQuCgogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIFVuYmxvY2sgdGhlIHRva2VuaXplciBmb3IgdGhpcyBpbnN0YW5jZSBvZiB0aGUgSFRNTAogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIHBhcnNlciwgc3VjaCB0aGF0IHRhc2tzIHRoYXQgaW52b2tlIHRoZSB0b2tlbml6ZXIKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBjYW4gYWdhaW4gYmUgcnVuLgoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBMZXQgdGhlIGluc2VydGlvbiBwb2ludCBiZSBqdXN0IGJlZm9yZSB0aGUgbmV4dAogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIGlucHV0IGNoYXJhY3Rlci4KCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgSW5jcmVtZW50IHRoZSBwYXJzZXIncyBzY3JpcHQgbmVzdGluZyBsZXZlbCBieSBvbmUKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAoaXQgc2hvdWxkIGJlIHplcm8gYmVmb3JlIHRoaXMgc3RlcCwgc28gdGhpcyBzZXRzCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgaXQgdG8gb25lKS4KCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgRXhlY3V0ZSB0aGUgc2NyaXB0LgoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBEZWNyZW1lbnQgdGhlIHBhcnNlcidzIHNjcmlwdCBuZXN0aW5nIGxldmVsIGJ5CiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgb25lLiBJZiB0aGUgcGFyc2VyJ3Mgc2NyaXB0IG5lc3RpbmcgbGV2ZWwgaXMgemVybwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICh3aGljaCBpdCBhbHdheXMgc2hvdWxkIGJlIGF0IHRoaXMgcG9pbnQpLCB0aGVuIHNldAogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIHRoZSBwYXJzZXIgcGF1c2UgZmxhZyB0byBmYWxzZS4KCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgTGV0IHRoZSBpbnNlcnRpb24gcG9pbnQgYmUgdW5kZWZpbmVkIGFnYWluLgoKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBJZiB0aGVyZSBpcyBvbmNlIGFnYWluIGEgcGVuZGluZyBwYXJzaW5nLWJsb2NraW5nCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgc2NyaXB0LCB0aGVuIHJlcGVhdCB0aGVzZSBzdGVwcyBmcm9tIHN0ZXAgMS4KCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc3RvcFBhcnNpbmcoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gWFhYIFRoaXMgaXMganVzdCBhIHRlbXBvcmFyeSBpbXBsZW1lbnRhdGlvbiB0byBnZXQgdGhlIHBhcnNlciB3b3JraW5nLgogICAgICAgICAgICAgICAgICAgIC8vIEEgZnVsbCBpbXBsZW1lbnRhdGlvbiBpbnZvbHZlcyBzY3JpcHRzIGFuZCBldmVudHMgYW5kIHRoZSBldmVudCBsb29wLgoKICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGxpbmsgZnJvbSBkb2N1bWVudCB0byBwYXJzZXIuCiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBpbnN0ZWFkIG9mICJzZXQgdGhlIGluc2VydGlvbiBwb2ludCB0byB1bmRlZmluZWQiLgogICAgICAgICAgICAgICAgICAgIC8vIEl0IG1lYW5zIHRoYXQgZG9jdW1lbnQud3JpdGUoKSBjYW4ndCB3cml0ZSBpbnRvIHRoZSBkb2MgYW55bW9yZS4KICAgICAgICAgICAgICAgICAgICBkZWxldGUgZG9jLl9wYXJzZXI7CgogICAgICAgICAgICAgICAgICAgIHN0YWNrLmVsZW1lbnRzLmxlbmd0aCA9IDA7IC8vIHBvcCBldmVyeXRoaW5nIG9mZgoKICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIHdpbmRvdyBvYmplY3QgYXNzb2NpYXRlZCB3aXRoIHRoZSBkb2N1bWVudAogICAgICAgICAgICAgICAgICAgIC8vIHRoZW4gdHJpZ2dlciBhbiBsb2FkIGV2ZW50IG9uIGl0CiAgICAgICAgICAgICAgICAgICAgaWYgKGRvYy5kZWZhdWx0VmlldykgewogICAgICAgICAgICAgICAgICAgICAgICBkb2MuZGVmYXVsdFZpZXcuZGlzcGF0Y2hFdmVudChuZXcgaW1wbC5FdmVudCgibG9hZCIsIHt9KSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8qKioqCiAgICAgICAgICAgICAgICAgKiBUb2tlbml6ZXIgc3RhdGVzCiAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoaXMgZmlsZSB3YXMgcGFydGlhbGx5IG1lY2hhbmljYWxseSBnZW5lcmF0ZWQgZnJvbQogICAgICAgICAgICAgICAgICogaHR0cDovL3d3dy53aGF0d2cub3JnL3NwZWNzL3dlYi1hcHBzL2N1cnJlbnQtd29yay9tdWx0aXBhZ2UvdG9rZW5pemF0aW9uLmh0bWwKICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgKiBBZnRlciBtZWNoYW5pY2FsIGNvbnZlcnNpb24sIGl0IHdhcyBmdXJ0aGVyIGNvbnZlcnRlZCBmcm9tCiAgICAgICAgICAgICAgICAgKiBwcm9zZSB0byBKUyBieSBoYW5kLCBidXQgdGhlIGludGVudCBpcyB0aGF0IGl0IGlzIGEgdmVyeQogICAgICAgICAgICAgICAgICogZmFpdGhmdWwgcmVuZGVyaW5nIG9mIHRoZSBIVE1MIHRva2VuaXphdGlvbiBzcGVjIGluCiAgICAgICAgICAgICAgICAgKiBKYXZhU2NyaXB0LgogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIEl0IGlzIG5vdCBhIGdvYWwgb2YgdGhpcyB0b2tlbml6ZXIgdG8gZGV0ZWN0IG9yIHJlcG9ydAogICAgICAgICAgICAgICAgICogcGFyc2UgZXJyb3JzLgogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIFhYWCBUaGUgdG9rZW5pemVyIGlzIHN1cHBvc2VkIHRvIHdvcmsgd2l0aCBzdHJhaWdodCBVVEYzMgogICAgICAgICAgICAgICAgICogY29kZXBvaW50cy4gQnV0IEkgZG9uJ3QgdGhpbmsgaXQgaGFzIGFueSBkZXBlbmRlbmNpZXMgb24KICAgICAgICAgICAgICAgICAqIGFueSBjaGFyYWN0ZXIgb3V0c2lkZSBvZiB0aGUgQk1QIHNvIEkgdGhpbmsgaXQgaXMgc2FmZSB0bwogICAgICAgICAgICAgICAgICogcGFzcyBpdCBVVEYxNiBjaGFyYWN0ZXJzLiBJIGRvbid0IHRoaW5rIGl0IHdpbGwgZXZlciBjaGFuZ2UKICAgICAgICAgICAgICAgICAqIHN0YXRlIGluIHRoZSBtaWRkbGUgb2YgYSBzdXJyb2dhdGUgcGFpci4KICAgICAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgKiBFYWNoIHN0YXRlIGlzIHJlcHJlc2VudGVkIGJ5IGEgZnVuY3Rpb24uICBGb3IgbW9zdCBzdGF0ZXMsIHRoZQogICAgICAgICAgICAgICAgICogc2Nhbm5lciBzaW1wbHkgcGFzc2VzIHRoZSBuZXh0IGNoYXJhY3RlciAoYXMgYW4gaW50ZWdlcgogICAgICAgICAgICAgICAgICogY29kZXBvaW50KSB0byB0aGUgY3VycmVudCBzdGF0ZSBmdW5jdGlvbiBhbmQgYXV0b21hdGljYWxseQogICAgICAgICAgICAgICAgICogY29uc3VtZXMgdGhlIGNoYXJhY3Rlci4gIElmIHRoZSBzdGF0ZSBmdW5jdGlvbiBjYW4ndCBwcm9jZXNzCiAgICAgICAgICAgICAgICAgKiB0aGUgY2hhcmFjdGVyIGl0IGNhbiBjYWxsIHB1c2hiYWNrKCkgdG8gcHVzaCBpdCBiYWNrIHRvIHRoZQogICAgICAgICAgICAgICAgICogc2Nhbm5lci4KICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgKiBTb21lIHN0YXRlcyByZXF1aXJlIGxvb2thaGVhZCwgdGhvdWdoLiAgSWYgYSBzdGF0ZSBmdW5jdGlvbiBoYXMKICAgICAgICAgICAgICAgICAqIGEgbG9va2FoZWFkIHByb3BlcnR5LCB0aGVuIGl0IGlzIGludm9rZWQgZGlmZmVyZW50bHkuICBJbiB0aGlzCiAgICAgICAgICAgICAgICAgKiBjYXNlLCB0aGUgc2Nhbm5lciBpbnZva2VzIHRoZSBmdW5jdGlvbiB3aXRoIDMgYXJndW1lbnRzOiAxKSB0aGUKICAgICAgICAgICAgICAgICAqIG5leHQgY29kZXBvaW50IDIpIGEgc3RyaW5nIG9mIGxvb2thaGVhZCB0ZXh0IDMpIGEgYm9vbGVhbiB0aGF0CiAgICAgICAgICAgICAgICAgKiBpcyB0cnVlIGlmIHRoZSBsb29rYWhlYWQgZ29lcyBhbGwgdGhlIHdheSB0byB0aGUgRU9GLiAoWFhYCiAgICAgICAgICAgICAgICAgKiBhY3R1YWxseSBtYXliZSB0aGlzIHRoaXJkIGlzIG5vdCBuZWNlc3NhcnkuLi4gdGhlIGxvb2thaGVhZAogICAgICAgICAgICAgICAgICogY291bGQganVzdCBpbmNsdWRlIFx1RkZGRj8pCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogSWYgdGhlIGxvb2thaGVhZCBwcm9wZXJ0eSBvZiBhIHN0YXRlIGZ1bmN0aW9uIGlzIGFuIGludGVnZXIsIGl0CiAgICAgICAgICAgICAgICAgKiBzcGVjaWZpZXMgdGhlIG51bWJlciBvZiBjaGFyYWN0ZXJzIHJlcXVpcmVkLiBJZiBpdCBpcyBhIHN0cmluZywKICAgICAgICAgICAgICAgICAqIHRoZW4gdGhlIHNjYW5uZXIgd2lsbCBzY2FuIGZvciB0aGF0IHN0cmluZyBhbmQgcmV0dXJuIGFsbAogICAgICAgICAgICAgICAgICogY2hhcmFjdGVycyB1cCB0byBhbmQgaW5jbHVkaW5nIHRoYXQgc2VxdWVuY2UsIG9yIHVwIHRvIEVPRi4gIElmCiAgICAgICAgICAgICAgICAgKiB0aGUgbG9va2FoZWFkIHByb3BlcnR5IGlzIGEgcmVnZXhwLCB0aGVuIHRoZSBzY2FubmVyIHdpbGwgbWF0Y2gKICAgICAgICAgICAgICAgICAqIHRoZSByZWdleHAgYXQgdGhlIGN1cnJlbnQgcG9pbnQgYW5kIHJldHVybiB0aGUgbWF0Y2hpbmcgc3RyaW5nLgogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIFN0YXRlcyB0aGF0IHJlcXVpcmUgbG9va2FoZWFkIGFyZSByZXNwb25zaWJsZSBmb3IgZXhwbGljaXRseQogICAgICAgICAgICAgICAgICogY29uc3VtaW5nIHRoZSBjaGFyYWN0ZXJzIHRoZXkgcHJvY2Vzcy4gVGhleSBkbyB0aGlzIGJ5CiAgICAgICAgICAgICAgICAgKiBpbmNyZW1lbnRpbmcgbmV4dGNoYXIgYnkgdGhlIG51bWJlciBvZiBwcm9jZXNzZWQgY2hhcmFjdGVycy4KICAgICAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRhdGFfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyNjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBBTVBFUlNBTkQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGNoYXJhY3Rlcl9yZWZlcmVuY2VfaW5fZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzQzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVtaXRTaW1wbGVUYWcoKSkgLy8gU2hvcnRjdXQgZm9yIDxwPiwgPGRsPiwgPC9kaXY+IGV0Yy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHRhZ19vcGVuX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIE5VTEwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVzdWFsbHkgbnVsbCBjaGFyYWN0ZXJzIGVtaXR0ZWQgYnkgdGhlIHRva2VuaXplciB3aWxsIGJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmVkIGJ5IHRoZSB0cmVlIGJ1aWxkZXIsIGJ1dCBzb21ldGltZXMgdGhleSdsbCBiZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29udmVydGVkIHRvIFx1RkZGRC4gIEkgZG9uJ3Qgd2FudCB0byBoYXZlIHRoZSBzZWFyY2ggZXZlcnkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0cmluZyBlbWl0dGVkIHRvIHJlcGxhY2UgTlVMcywgc28gSSdsbCBzZXQgYSBmbGFnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBJJ3ZlIGVtaXR0ZWQgYSBOVUwuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dEluY2x1ZGVzTlVMID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXRFT0YoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGVhZCBvZiBqdXN0IHB1c2hpbmcgYSBzaW5nbGUgY2hhcmFjdGVyIGFuZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb21pbmcgYmFjayB0byB0aGUgdmVyeSBzYW1lIHBsYWNlLCBsb29rYWhlYWQgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbWl0IGV2ZXJ5dGhpbmcgd2UgY2FuIGF0IG9uY2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0Q2hhcnNXaGlsZShEQVRBVEVYVCkgfHwgcHVzaCh0ZXh0cnVuLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjaGFyYWN0ZXJfcmVmZXJlbmNlX2luX2RhdGFfc3RhdGUoYywgbG9va2FoZWFkLCBlb2YpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2hhciA9IHBhcnNlQ2hhclJlZihsb29rYWhlYWQsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hhciAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNoYXIgPT09ICJudW1iZXIiKSBwdXNoKHRleHRydW4sIGNoYXIpO2Vsc2UgcHVzaEFsbCh0ZXh0cnVuLCBjaGFyKTsgLy8gQW4gYXJyYXkgb2YgY2hhcmFjdGVycwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBwdXNoKHRleHRydW4sIDB4MDAyNik7IC8vIEFNUEVSU0FORDsKCiAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNoYXJhY3Rlcl9yZWZlcmVuY2VfaW5fZGF0YV9zdGF0ZS5sb29rYWhlYWQgPSBDSEFSUkVGOwoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJjZGF0YV9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2F2ZSB0aGUgb3BlbiB0YWcgc28gd2UgY2FuIGZpbmQgYSBtYXRjaGluZyBjbG9zZSB0YWcKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgQU1QRVJTQU5ECiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBjaGFyYWN0ZXJfcmVmZXJlbmNlX2luX3JjZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzQzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gcmNkYXRhX2xlc3NfdGhhbl9zaWduX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIE5VTEwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHhGRkZEKTsgLy8gUkVQTEFDRU1FTlQgQ0hBUkFDVEVSCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0SW5jbHVkZXNOVUwgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdEVPRigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNoYXJhY3Rlcl9yZWZlcmVuY2VfaW5fcmNkYXRhX3N0YXRlKGMsIGxvb2thaGVhZCwgZW9mKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNoYXIgPSBwYXJzZUNoYXJSZWYobG9va2FoZWFkLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYXIgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGFyID09PSAibnVtYmVyIikgcHVzaCh0ZXh0cnVuLCBjaGFyKTtlbHNlIHB1c2hBbGwodGV4dHJ1biwgY2hhcik7IC8vIEFuIGFycmF5IG9mIGNoYXJhY3RlcnMKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgcHVzaCh0ZXh0cnVuLCAweDAwMjYpOyAvLyBBTVBFUlNBTkQ7CgogICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHJjZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNoYXJhY3Rlcl9yZWZlcmVuY2VfaW5fcmNkYXRhX3N0YXRlLmxvb2thaGVhZCA9IENIQVJSRUY7CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gcmF3dGV4dF9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNDOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIExFU1MtVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSByYXd0ZXh0X2xlc3NfdGhhbl9zaWduX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIE5VTEwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHhGRkZEKTsgLy8gUkVQTEFDRU1FTlQgQ0hBUkFDVEVSCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0RU9GKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXRDaGFyc1doaWxlKFJBV1RFWFQpIHx8IHB1c2godGV4dHJ1biwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2NyaXB0X2RhdGFfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzQzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfbGVzc190aGFuX3NpZ25fc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweEZGRkQpOyAvLyBSRVBMQUNFTUVOVCBDSEFSQUNURVIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXRFT0YoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdENoYXJzV2hpbGUoUkFXVEVYVCkgfHwgcHVzaCh0ZXh0cnVuLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBwbGFpbnRleHRfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBOVUxMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4RkZGRCk7IC8vIFJFUExBQ0VNRU5UIENIQVJBQ1RFUgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdEVPRigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0Q2hhcnNXaGlsZShQTEFJTlRFWFQpIHx8IHB1c2godGV4dHJ1biwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gdGFnX29wZW5fc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBFWENMQU1BVElPTiBNQVJLCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBtYXJrdXBfZGVjbGFyYXRpb25fb3Blbl9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBlbmRfdGFnX29wZW5fc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDE6IC8vIFtBLVpdCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQyOmNhc2UgMHgwMDQzOmNhc2UgMHgwMDQ0OmNhc2UgMHgwMDQ1OmNhc2UgMHgwMDQ2OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0NzpjYXNlIDB4MDA0ODpjYXNlIDB4MDA0OTpjYXNlIDB4MDA0QTpjYXNlIDB4MDA0QjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNEM6Y2FzZSAweDAwNEQ6Y2FzZSAweDAwNEU6Y2FzZSAweDAwNEY6Y2FzZSAweDAwNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDUxOmNhc2UgMHgwMDUyOmNhc2UgMHgwMDUzOmNhc2UgMHgwMDU0OmNhc2UgMHgwMDU1OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1NjpjYXNlIDB4MDA1NzpjYXNlIDB4MDA1ODpjYXNlIDB4MDA1OTpjYXNlIDB4MDA1QToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgKz0gMHgyMDsgLy8gdG8gbG93ZXJjYXNlCiAgICAgICAgICAgICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDYxOiAvLyBbYS16XQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MjpjYXNlIDB4MDA2MzpjYXNlIDB4MDA2NDpjYXNlIDB4MDA2NTpjYXNlIDB4MDA2NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjc6Y2FzZSAweDAwNjg6Y2FzZSAweDAwNjk6Y2FzZSAweDAwNkE6Y2FzZSAweDAwNkI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDZDOmNhc2UgMHgwMDZEOmNhc2UgMHgwMDZFOmNhc2UgMHgwMDZGOmNhc2UgMHgwMDcwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA3MTpjYXNlIDB4MDA3MjpjYXNlIDB4MDA3MzpjYXNlIDB4MDA3NDpjYXNlIDB4MDA3NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNzY6Y2FzZSAweDAwNzc6Y2FzZSAweDAwNzg6Y2FzZSAweDAwNzk6Y2FzZSAweDAwN0E6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpblRhZ05hbWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGFnbmFtZWJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSB0YWdfbmFtZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBRVUVTVElPTiBNQVJLCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYm9ndXNfY29tbWVudF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwM0MpOyAvLyBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gZW5kX3RhZ19vcGVuX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDE6IC8vIFtBLVpdCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQyOmNhc2UgMHgwMDQzOmNhc2UgMHgwMDQ0OmNhc2UgMHgwMDQ1OmNhc2UgMHgwMDQ2OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0NzpjYXNlIDB4MDA0ODpjYXNlIDB4MDA0OTpjYXNlIDB4MDA0QTpjYXNlIDB4MDA0QjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNEM6Y2FzZSAweDAwNEQ6Y2FzZSAweDAwNEU6Y2FzZSAweDAwNEY6Y2FzZSAweDAwNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDUxOmNhc2UgMHgwMDUyOmNhc2UgMHgwMDUzOmNhc2UgMHgwMDU0OmNhc2UgMHgwMDU1OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1NjpjYXNlIDB4MDA1NzpjYXNlIDB4MDA1ODpjYXNlIDB4MDA1OTpjYXNlIDB4MDA1QToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgKz0gMHgyMDsgLy8gdG8gbG93ZXJjYXNlCiAgICAgICAgICAgICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDYxOiAvLyBbYS16XQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MjpjYXNlIDB4MDA2MzpjYXNlIDB4MDA2NDpjYXNlIDB4MDA2NTpjYXNlIDB4MDA2NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjc6Y2FzZSAweDAwNjg6Y2FzZSAweDAwNjk6Y2FzZSAweDAwNkE6Y2FzZSAweDAwNkI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDZDOmNhc2UgMHgwMDZEOmNhc2UgMHgwMDZFOmNhc2UgMHgwMDZGOmNhc2UgMHgwMDcwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA3MTpjYXNlIDB4MDA3MjpjYXNlIDB4MDA3MzpjYXNlIDB4MDA3NDpjYXNlIDB4MDA3NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNzY6Y2FzZSAweDAwNzc6Y2FzZSAweDAwNzg6Y2FzZSAweDAwNzk6Y2FzZSAweDAwN0E6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkVuZFRhZ05hbWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGFnbmFtZWJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSB0YWdfbmFtZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHgwMDNDKTsgLy8gTEVTUy1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHgwMDJGKTsgLy8gU09MSURVUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBib2d1c19jb21tZW50X3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHRhZ19uYW1lX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDk6IC8vICBDSEFSQUNURVIgVEFCVUxBVElPTiAodGFiKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQTogLy8gIExJTkUgRkVFRCAoTEYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBDOiAvLyAgRk9STSBGRUVEIChGRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU1BBQ0UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGJlZm9yZV9hdHRyaWJ1dGVfbmFtZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzZWxmX2Nsb3Npbmdfc3RhcnRfdGFnX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdFRhZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQxOiAvLyBbQS1aXQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0MjpjYXNlIDB4MDA0MzpjYXNlIDB4MDA0NDpjYXNlIDB4MDA0NTpjYXNlIDB4MDA0NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDc6Y2FzZSAweDAwNDg6Y2FzZSAweDAwNDk6Y2FzZSAweDAwNEE6Y2FzZSAweDAwNEI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDRDOmNhc2UgMHgwMDREOmNhc2UgMHgwMDRFOmNhc2UgMHgwMDRGOmNhc2UgMHgwMDUwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1MTpjYXNlIDB4MDA1MjpjYXNlIDB4MDA1MzpjYXNlIDB4MDA1NDpjYXNlIDB4MDA1NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNTY6Y2FzZSAweDAwNTc6Y2FzZSAweDAwNTg6Y2FzZSAweDAwNTk6Y2FzZSAweDAwNUE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKHRhZ25hbWVidWYsIGMgKyAweDAwMjApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIE5VTEwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGFnbmFtZWJ1ZiwgMHhGRkZEIC8qIFJFUExBQ0VNRU5UIENIQVJBQ1RFUiAqLyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0YWduYW1lYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFwcGVuZENoYXJzV2hpbGUodGFnbmFtZWJ1ZiwgVEFHTkFNRUNIQVJTKSB8fCBhcHBlbmRDaGFyKHRhZ25hbWVidWYsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJjZGF0YV9sZXNzX3RoYW5fc2lnbl9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgLyogaWRlbnRpY2FsIHRvIHRoZSBSQVdURVhUIGxlc3MtdGhhbiBzaWduIHN0YXRlLCBleGNlcHQgcy9SQVdURVhUL1JDREFUQS9nICovCiAgICAgICAgICAgICAgICAgICAgaWYgKGMgPT09IDB4MDAyRikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAgU09MSURVUwogICAgICAgICAgICAgICAgICAgICAgICBiZWdpblRlbXBCdWYoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gcmNkYXRhX2VuZF90YWdfb3Blbl9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAzQyk7IC8vIExFU1MtVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHJjZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gcmNkYXRhX2VuZF90YWdfb3Blbl9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgLyogaWRlbnRpY2FsIHRvIHRoZSBSQVdURVhUIChhbmQgU2NyaXB0IGRhdGEpIGVuZCB0YWcgb3BlbiBzdGF0ZSwgZXhjZXB0IHMvUkFXVEVYVC9SQ0RBVEEvZyAqLwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0MTogLy8gW0EtWl0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDI6Y2FzZSAweDAwNDM6Y2FzZSAweDAwNDQ6Y2FzZSAweDAwNDU6Y2FzZSAweDAwNDY6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQ3OmNhc2UgMHgwMDQ4OmNhc2UgMHgwMDQ5OmNhc2UgMHgwMDRBOmNhc2UgMHgwMDRCOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0QzpjYXNlIDB4MDA0RDpjYXNlIDB4MDA0RTpjYXNlIDB4MDA0RjpjYXNlIDB4MDA1MDoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNTE6Y2FzZSAweDAwNTI6Y2FzZSAweDAwNTM6Y2FzZSAweDAwNTQ6Y2FzZSAweDAwNTU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDU2OmNhc2UgMHgwMDU3OmNhc2UgMHgwMDU4OmNhc2UgMHgwMDU5OmNhc2UgMHgwMDVBOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5FbmRUYWdOYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKHRhZ25hbWVidWYsIGMgKyAweDAwMjApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0ZW1wYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHJjZGF0YV9lbmRfdGFnX25hbWVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjE6IC8vIFthLXpdCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDYyOmNhc2UgMHgwMDYzOmNhc2UgMHgwMDY0OmNhc2UgMHgwMDY1OmNhc2UgMHgwMDY2OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2NzpjYXNlIDB4MDA2ODpjYXNlIDB4MDA2OTpjYXNlIDB4MDA2QTpjYXNlIDB4MDA2QjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNkM6Y2FzZSAweDAwNkQ6Y2FzZSAweDAwNkU6Y2FzZSAweDAwNkY6Y2FzZSAweDAwNzA6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDcxOmNhc2UgMHgwMDcyOmNhc2UgMHgwMDczOmNhc2UgMHgwMDc0OmNhc2UgMHgwMDc1OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA3NjpjYXNlIDB4MDA3NzpjYXNlIDB4MDA3ODpjYXNlIDB4MDA3OTpjYXNlIDB4MDA3QToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luRW5kVGFnTmFtZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0YWduYW1lYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGVtcGJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSByY2RhdGFfZW5kX3RhZ19uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAzQyk7IC8vIExFU1MtVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAyRik7IC8vIFNPTElEVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSByY2RhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gcmNkYXRhX2VuZF90YWdfbmFtZV9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgLyogaWRlbnRpY2FsIHRvIHRoZSBSQVdURVhUIChhbmQgU2NyaXB0IGRhdGEpIGVuZCB0YWcgbmFtZSBzdGF0ZSwgZXhjZXB0IHMvUkFXVEVYVC9SQ0RBVEEvZyAqLwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwOTogLy8gIENIQVJBQ1RFUiBUQUJVTEFUSU9OICh0YWIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBBOiAvLyAgTElORSBGRUVEIChMRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEM6IC8vICBGT1JNIEZFRUQgKEZGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTUEFDRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFwcHJvcHJpYXRlRW5kVGFnKHRhZ25hbWVidWYpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYmVmb3JlX2F0dHJpYnV0ZV9uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXBwcm9wcmlhdGVFbmRUYWcodGFnbmFtZWJ1ZikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzZWxmX2Nsb3Npbmdfc3RhcnRfdGFnX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFwcHJvcHJpYXRlRW5kVGFnKHRhZ25hbWVidWYpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0VGFnKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQxOiAvLyBbQS1aXQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0MjpjYXNlIDB4MDA0MzpjYXNlIDB4MDA0NDpjYXNlIDB4MDA0NTpjYXNlIDB4MDA0NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDc6Y2FzZSAweDAwNDg6Y2FzZSAweDAwNDk6Y2FzZSAweDAwNEE6Y2FzZSAweDAwNEI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDRDOmNhc2UgMHgwMDREOmNhc2UgMHgwMDRFOmNhc2UgMHgwMDRGOmNhc2UgMHgwMDUwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1MTpjYXNlIDB4MDA1MjpjYXNlIDB4MDA1MzpjYXNlIDB4MDA1NDpjYXNlIDB4MDA1NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNTY6Y2FzZSAweDAwNTc6Y2FzZSAweDAwNTg6Y2FzZSAweDAwNTk6Y2FzZSAweDAwNUE6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0YWduYW1lYnVmLCBjICsgMHgwMDIwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGVtcGJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDYxOiAvLyBbYS16XQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MjpjYXNlIDB4MDA2MzpjYXNlIDB4MDA2NDpjYXNlIDB4MDA2NTpjYXNlIDB4MDA2NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjc6Y2FzZSAweDAwNjg6Y2FzZSAweDAwNjk6Y2FzZSAweDAwNkE6Y2FzZSAweDAwNkI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDZDOmNhc2UgMHgwMDZEOmNhc2UgMHgwMDZFOmNhc2UgMHgwMDZGOmNhc2UgMHgwMDcwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA3MTpjYXNlIDB4MDA3MjpjYXNlIDB4MDA3MzpjYXNlIDB4MDA3NDpjYXNlIDB4MDA3NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNzY6Y2FzZSAweDAwNzc6Y2FzZSAweDAwNzg6Y2FzZSAweDAwNzk6Y2FzZSAweDAwN0E6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0YWduYW1lYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGVtcGJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIElmIHdlIGRvbid0IHJldHVybiBpbiBvbmUgb2YgdGhlIGNhc2VzIGFib3ZlLCB0aGVuIHRoaXMgd2FzIG5vdAogICAgICAgICAgICAgICAgICAgIC8vIGFuIGFwcHJvcHJpYXRlbHkgbWF0Y2hpbmcgY2xvc2UgdGFnLCBzbyBiYWNrIG91dCBieSBlbWl0dGluZyBhbGwKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgY2hhcmFjdGVycyBhcyB0ZXh0CiAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwM0MpOyAvLyBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHgwMDJGKTsgLy8gU09MSURVUwogICAgICAgICAgICAgICAgICAgIHB1c2hBbGwodGV4dHJ1biwgdGVtcGJ1Zik7CiAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSByY2RhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gcmF3dGV4dF9sZXNzX3RoYW5fc2lnbl9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgLyogaWRlbnRpY2FsIHRvIHRoZSBSQ0RBVEEgbGVzcy10aGFuIHNpZ24gc3RhdGUsIGV4Y2VwdCBzL1JDREFUQS9SQVdURVhUL2cKICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICBpZiAoYyA9PT0gMHgwMDJGKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luVGVtcEJ1ZigpOwogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSByYXd0ZXh0X2VuZF90YWdfb3Blbl9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAzQyk7IC8vIExFU1MtVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHJhd3RleHRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJhd3RleHRfZW5kX3RhZ19vcGVuX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICAvKiBpZGVudGljYWwgdG8gdGhlIFJDREFUQSAoYW5kIFNjcmlwdCBkYXRhKSBlbmQgdGFnIG9wZW4gc3RhdGUsIGV4Y2VwdCBzL1JDREFUQS9SQVdURVhUL2cgKi8KICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDE6IC8vIFtBLVpdCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQyOmNhc2UgMHgwMDQzOmNhc2UgMHgwMDQ0OmNhc2UgMHgwMDQ1OmNhc2UgMHgwMDQ2OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0NzpjYXNlIDB4MDA0ODpjYXNlIDB4MDA0OTpjYXNlIDB4MDA0QTpjYXNlIDB4MDA0QjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNEM6Y2FzZSAweDAwNEQ6Y2FzZSAweDAwNEU6Y2FzZSAweDAwNEY6Y2FzZSAweDAwNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDUxOmNhc2UgMHgwMDUyOmNhc2UgMHgwMDUzOmNhc2UgMHgwMDU0OmNhc2UgMHgwMDU1OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1NjpjYXNlIDB4MDA1NzpjYXNlIDB4MDA1ODpjYXNlIDB4MDA1OTpjYXNlIDB4MDA1QToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luRW5kVGFnTmFtZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0YWduYW1lYnVmLCBjICsgMHgwMDIwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGVtcGJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSByYXd0ZXh0X2VuZF90YWdfbmFtZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MTogLy8gW2Etel0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjI6Y2FzZSAweDAwNjM6Y2FzZSAweDAwNjQ6Y2FzZSAweDAwNjU6Y2FzZSAweDAwNjY6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDY3OmNhc2UgMHgwMDY4OmNhc2UgMHgwMDY5OmNhc2UgMHgwMDZBOmNhc2UgMHgwMDZCOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2QzpjYXNlIDB4MDA2RDpjYXNlIDB4MDA2RTpjYXNlIDB4MDA2RjpjYXNlIDB4MDA3MDoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNzE6Y2FzZSAweDAwNzI6Y2FzZSAweDAwNzM6Y2FzZSAweDAwNzQ6Y2FzZSAweDAwNzU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDc2OmNhc2UgMHgwMDc3OmNhc2UgMHgwMDc4OmNhc2UgMHgwMDc5OmNhc2UgMHgwMDdBOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5FbmRUYWdOYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKHRhZ25hbWVidWYsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0ZW1wYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHJhd3RleHRfZW5kX3RhZ19uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAzQyk7IC8vIExFU1MtVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAyRik7IC8vIFNPTElEVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSByYXd0ZXh0X3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJhd3RleHRfZW5kX3RhZ19uYW1lX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICAvKiBpZGVudGljYWwgdG8gdGhlIFJDREFUQSAoYW5kIFNjcmlwdCBkYXRhKSBlbmQgdGFnIG5hbWUgc3RhdGUsIGV4Y2VwdCBzL1JDREFUQS9SQVdURVhUL2cgKi8KICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDk6IC8vICBDSEFSQUNURVIgVEFCVUxBVElPTiAodGFiKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQTogLy8gIExJTkUgRkVFRCAoTEYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBDOiAvLyAgRk9STSBGRUVEIChGRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU1BBQ0UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcHByb3ByaWF0ZUVuZFRhZyh0YWduYW1lYnVmKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGJlZm9yZV9hdHRyaWJ1dGVfbmFtZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMkY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU09MSURVUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFwcHJvcHJpYXRlRW5kVGFnKHRhZ25hbWVidWYpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2VsZl9jbG9zaW5nX3N0YXJ0X3RhZ19zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgR1JFQVRFUi1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcHByb3ByaWF0ZUVuZFRhZyh0YWduYW1lYnVmKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdFRhZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0MTogLy8gW0EtWl0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDI6Y2FzZSAweDAwNDM6Y2FzZSAweDAwNDQ6Y2FzZSAweDAwNDU6Y2FzZSAweDAwNDY6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQ3OmNhc2UgMHgwMDQ4OmNhc2UgMHgwMDQ5OmNhc2UgMHgwMDRBOmNhc2UgMHgwMDRCOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0QzpjYXNlIDB4MDA0RDpjYXNlIDB4MDA0RTpjYXNlIDB4MDA0RjpjYXNlIDB4MDA1MDoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNTE6Y2FzZSAweDAwNTI6Y2FzZSAweDAwNTM6Y2FzZSAweDAwNTQ6Y2FzZSAweDAwNTU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDU2OmNhc2UgMHgwMDU3OmNhc2UgMHgwMDU4OmNhc2UgMHgwMDU5OmNhc2UgMHgwMDVBOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0YWduYW1lYnVmLCBjICsgMHgwMDIwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGVtcGJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDYxOiAvLyBbYS16XQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MjpjYXNlIDB4MDA2MzpjYXNlIDB4MDA2NDpjYXNlIDB4MDA2NTpjYXNlIDB4MDA2NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjc6Y2FzZSAweDAwNjg6Y2FzZSAweDAwNjk6Y2FzZSAweDAwNkE6Y2FzZSAweDAwNkI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDZDOmNhc2UgMHgwMDZEOmNhc2UgMHgwMDZFOmNhc2UgMHgwMDZGOmNhc2UgMHgwMDcwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA3MTpjYXNlIDB4MDA3MjpjYXNlIDB4MDA3MzpjYXNlIDB4MDA3NDpjYXNlIDB4MDA3NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNzY6Y2FzZSAweDAwNzc6Y2FzZSAweDAwNzg6Y2FzZSAweDAwNzk6Y2FzZSAweDAwN0E6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKHRhZ25hbWVidWYsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0ZW1wYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UgZG9uJ3QgcmV0dXJuIGluIG9uZSBvZiB0aGUgY2FzZXMgYWJvdmUsIHRoZW4gdGhpcyB3YXMgbm90CiAgICAgICAgICAgICAgICAgICAgLy8gYW4gYXBwcm9wcmlhdGVseSBtYXRjaGluZyBjbG9zZSB0YWcsIHNvIGJhY2sgb3V0IGJ5IGVtaXR0aW5nIGFsbAogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBjaGFyYWN0ZXJzIGFzIHRleHQKICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAzQyk7IC8vIExFU1MtVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwMkYpOyAvLyBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgcHVzaEFsbCh0ZXh0cnVuLCB0ZW1wYnVmKTsKICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHJhd3RleHRfc3RhdGU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2NyaXB0X2RhdGFfbGVzc190aGFuX3NpZ25fc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpblRlbXBCdWYoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2VuZF90YWdfb3Blbl9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBFWENMQU1BVElPTiBNQVJLCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9lc2NhcGVfc3RhcnRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAzQyk7IC8vIExFU1MtVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAyMSk7IC8vIEVYQ0xBTUFUSU9OIE1BUksKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwM0MpOyAvLyBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNjcmlwdF9kYXRhX2VuZF90YWdfb3Blbl9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgLyogaWRlbnRpY2FsIHRvIHRoZSBSQ0RBVEEgKGFuZCBSQVdURVhUKSBlbmQgdGFnIG9wZW4gc3RhdGUsIGV4Y2VwdCBzL1JDREFUQS9TY3JpcHQgZGF0YS9nICovCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQxOiAvLyBbQS1aXQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0MjpjYXNlIDB4MDA0MzpjYXNlIDB4MDA0NDpjYXNlIDB4MDA0NTpjYXNlIDB4MDA0NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDc6Y2FzZSAweDAwNDg6Y2FzZSAweDAwNDk6Y2FzZSAweDAwNEE6Y2FzZSAweDAwNEI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDRDOmNhc2UgMHgwMDREOmNhc2UgMHgwMDRFOmNhc2UgMHgwMDRGOmNhc2UgMHgwMDUwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1MTpjYXNlIDB4MDA1MjpjYXNlIDB4MDA1MzpjYXNlIDB4MDA1NDpjYXNlIDB4MDA1NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNTY6Y2FzZSAweDAwNTc6Y2FzZSAweDAwNTg6Y2FzZSAweDAwNTk6Y2FzZSAweDAwNUE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkVuZFRhZ05hbWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGFnbmFtZWJ1ZiwgYyArIDB4MDAyMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKHRlbXBidWYsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZW5kX3RhZ19uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDYxOiAvLyBbYS16XQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MjpjYXNlIDB4MDA2MzpjYXNlIDB4MDA2NDpjYXNlIDB4MDA2NTpjYXNlIDB4MDA2NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjc6Y2FzZSAweDAwNjg6Y2FzZSAweDAwNjk6Y2FzZSAweDAwNkE6Y2FzZSAweDAwNkI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDZDOmNhc2UgMHgwMDZEOmNhc2UgMHgwMDZFOmNhc2UgMHgwMDZGOmNhc2UgMHgwMDcwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA3MTpjYXNlIDB4MDA3MjpjYXNlIDB4MDA3MzpjYXNlIDB4MDA3NDpjYXNlIDB4MDA3NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNzY6Y2FzZSAweDAwNzc6Y2FzZSAweDAwNzg6Y2FzZSAweDAwNzk6Y2FzZSAweDAwN0E6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkVuZFRhZ05hbWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGFnbmFtZWJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKHRlbXBidWYsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZW5kX3RhZ19uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAzQyk7IC8vIExFU1MtVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAyRik7IC8vIFNPTElEVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzY3JpcHRfZGF0YV9lbmRfdGFnX25hbWVfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIC8qIGlkZW50aWNhbCB0byB0aGUgUkNEQVRBIChhbmQgUkFXVEVYVCkgZW5kIHRhZyBuYW1lIHN0YXRlLCBleGNlcHQgcy9SQ0RBVEEvU2NyaXB0IGRhdGEvZyAqLwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwOTogLy8gIENIQVJBQ1RFUiBUQUJVTEFUSU9OICh0YWIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBBOiAvLyAgTElORSBGRUVEIChMRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEM6IC8vICBGT1JNIEZFRUQgKEZGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTUEFDRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFwcHJvcHJpYXRlRW5kVGFnKHRhZ25hbWVidWYpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYmVmb3JlX2F0dHJpYnV0ZV9uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXBwcm9wcmlhdGVFbmRUYWcodGFnbmFtZWJ1ZikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzZWxmX2Nsb3Npbmdfc3RhcnRfdGFnX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFwcHJvcHJpYXRlRW5kVGFnKHRhZ25hbWVidWYpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0VGFnKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQxOiAvLyBbQS1aXQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0MjpjYXNlIDB4MDA0MzpjYXNlIDB4MDA0NDpjYXNlIDB4MDA0NTpjYXNlIDB4MDA0NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDc6Y2FzZSAweDAwNDg6Y2FzZSAweDAwNDk6Y2FzZSAweDAwNEE6Y2FzZSAweDAwNEI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDRDOmNhc2UgMHgwMDREOmNhc2UgMHgwMDRFOmNhc2UgMHgwMDRGOmNhc2UgMHgwMDUwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1MTpjYXNlIDB4MDA1MjpjYXNlIDB4MDA1MzpjYXNlIDB4MDA1NDpjYXNlIDB4MDA1NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNTY6Y2FzZSAweDAwNTc6Y2FzZSAweDAwNTg6Y2FzZSAweDAwNTk6Y2FzZSAweDAwNUE6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0YWduYW1lYnVmLCBjICsgMHgwMDIwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGVtcGJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDYxOiAvLyBbYS16XQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MjpjYXNlIDB4MDA2MzpjYXNlIDB4MDA2NDpjYXNlIDB4MDA2NTpjYXNlIDB4MDA2NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjc6Y2FzZSAweDAwNjg6Y2FzZSAweDAwNjk6Y2FzZSAweDAwNkE6Y2FzZSAweDAwNkI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDZDOmNhc2UgMHgwMDZEOmNhc2UgMHgwMDZFOmNhc2UgMHgwMDZGOmNhc2UgMHgwMDcwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA3MTpjYXNlIDB4MDA3MjpjYXNlIDB4MDA3MzpjYXNlIDB4MDA3NDpjYXNlIDB4MDA3NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNzY6Y2FzZSAweDAwNzc6Y2FzZSAweDAwNzg6Y2FzZSAweDAwNzk6Y2FzZSAweDAwN0E6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0YWduYW1lYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGVtcGJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIElmIHdlIGRvbid0IHJldHVybiBpbiBvbmUgb2YgdGhlIGNhc2VzIGFib3ZlLCB0aGVuIHRoaXMgd2FzIG5vdAogICAgICAgICAgICAgICAgICAgIC8vIGFuIGFwcHJvcHJpYXRlbHkgbWF0Y2hpbmcgY2xvc2UgdGFnLCBzbyBiYWNrIG91dCBieSBlbWl0dGluZyBhbGwKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgY2hhcmFjdGVycyBhcyB0ZXh0CiAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwM0MpOyAvLyBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHgwMDJGKTsgLy8gU09MSURVUwogICAgICAgICAgICAgICAgICAgIHB1c2hBbGwodGV4dHJ1biwgdGVtcGJ1Zik7CiAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzY3JpcHRfZGF0YV9lc2NhcGVfc3RhcnRfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIGlmIChjID09PSAweDAwMkQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEhZUEhFTi1NSU5VUwogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9lc2NhcGVfc3RhcnRfZGFzaF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwMkQpOyAvLyBIWVBIRU4tTUlOVVMKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2NyaXB0X2RhdGFfZXNjYXBlX3N0YXJ0X2Rhc2hfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIGlmIChjID09PSAweDAwMkQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEhZUEhFTi1NSU5VUwogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9lc2NhcGVkX2Rhc2hfZGFzaF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwMkQpOyAvLyBIWVBIRU4tTUlOVVMKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2NyaXB0X2RhdGFfZXNjYXBlZF9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDJEOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEhZUEhFTi1NSU5VUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZXNjYXBlZF9kYXNoX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwMkQpOyAvLyBIWVBIRU4tTUlOVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzQzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZXNjYXBlZF9sZXNzX3RoYW5fc2lnbl9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBOVUxMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4RkZGRCk7IC8vIFJFUExBQ0VNRU5UIENIQVJBQ1RFUgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2NyaXB0X2RhdGFfZXNjYXBlZF9kYXNoX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMkQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgSFlQSEVOLU1JTlVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9lc2NhcGVkX2Rhc2hfZGFzaF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHgwMDJEKTsgLy8gSFlQSEVOLU1JTlVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTEVTUy1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2VzY2FwZWRfbGVzc190aGFuX3NpZ25fc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZXNjYXBlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHhGRkZEKTsgLy8gUkVQTEFDRU1FTlQgQ0hBUkFDVEVSCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZXNjYXBlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2NyaXB0X2RhdGFfZXNjYXBlZF9kYXNoX2Rhc2hfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBIWVBIRU4tTUlOVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHgwMDJEKTsgLy8gSFlQSEVOLU1JTlVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTEVTUy1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2VzY2FwZWRfbGVzc190aGFuX3NpZ25fc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgR1JFQVRFUi1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwM0UpOyAvLyBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIE5VTEwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2VzY2FwZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4RkZGRCk7IC8vIFJFUExBQ0VNRU5UIENIQVJBQ1RFUgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2VzY2FwZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNjcmlwdF9kYXRhX2VzY2FwZWRfbGVzc190aGFuX3NpZ25fc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpblRlbXBCdWYoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2VzY2FwZWRfZW5kX3RhZ19vcGVuX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQxOiAvLyBbQS1aXQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0MjpjYXNlIDB4MDA0MzpjYXNlIDB4MDA0NDpjYXNlIDB4MDA0NTpjYXNlIDB4MDA0NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDc6Y2FzZSAweDAwNDg6Y2FzZSAweDAwNDk6Y2FzZSAweDAwNEE6Y2FzZSAweDAwNEI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDRDOmNhc2UgMHgwMDREOmNhc2UgMHgwMDRFOmNhc2UgMHgwMDRGOmNhc2UgMHgwMDUwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1MTpjYXNlIDB4MDA1MjpjYXNlIDB4MDA1MzpjYXNlIDB4MDA1NDpjYXNlIDB4MDA1NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNTY6Y2FzZSAweDAwNTc6Y2FzZSAweDAwNTg6Y2FzZSAweDAwNTk6Y2FzZSAweDAwNUE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpblRlbXBCdWYoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGVtcGJ1ZiwgYyArIDB4MDAyMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9kb3VibGVfZXNjYXBlX3N0YXJ0X3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwM0MpOyAvLyBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MTogLy8gW2Etel0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjI6Y2FzZSAweDAwNjM6Y2FzZSAweDAwNjQ6Y2FzZSAweDAwNjU6Y2FzZSAweDAwNjY6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDY3OmNhc2UgMHgwMDY4OmNhc2UgMHgwMDY5OmNhc2UgMHgwMDZBOmNhc2UgMHgwMDZCOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2QzpjYXNlIDB4MDA2RDpjYXNlIDB4MDA2RTpjYXNlIDB4MDA2RjpjYXNlIDB4MDA3MDoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNzE6Y2FzZSAweDAwNzI6Y2FzZSAweDAwNzM6Y2FzZSAweDAwNzQ6Y2FzZSAweDAwNzU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDc2OmNhc2UgMHgwMDc3OmNhc2UgMHgwMDc4OmNhc2UgMHgwMDc5OmNhc2UgMHgwMDdBOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5UZW1wQnVmKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKHRlbXBidWYsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZG91YmxlX2VzY2FwZV9zdGFydF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHgwMDNDKTsgLy8gTEVTUy1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHgwMDNDKTsgLy8gTEVTUy1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9lc2NhcGVkX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNjcmlwdF9kYXRhX2VzY2FwZWRfZW5kX3RhZ19vcGVuX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDE6IC8vIFtBLVpdCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQyOmNhc2UgMHgwMDQzOmNhc2UgMHgwMDQ0OmNhc2UgMHgwMDQ1OmNhc2UgMHgwMDQ2OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0NzpjYXNlIDB4MDA0ODpjYXNlIDB4MDA0OTpjYXNlIDB4MDA0QTpjYXNlIDB4MDA0QjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNEM6Y2FzZSAweDAwNEQ6Y2FzZSAweDAwNEU6Y2FzZSAweDAwNEY6Y2FzZSAweDAwNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDUxOmNhc2UgMHgwMDUyOmNhc2UgMHgwMDUzOmNhc2UgMHgwMDU0OmNhc2UgMHgwMDU1OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1NjpjYXNlIDB4MDA1NzpjYXNlIDB4MDA1ODpjYXNlIDB4MDA1OTpjYXNlIDB4MDA1QToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luRW5kVGFnTmFtZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0YWduYW1lYnVmLCBjICsgMHgwMDIwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGVtcGJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9lc2NhcGVkX2VuZF90YWdfbmFtZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MTogLy8gW2Etel0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjI6Y2FzZSAweDAwNjM6Y2FzZSAweDAwNjQ6Y2FzZSAweDAwNjU6Y2FzZSAweDAwNjY6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDY3OmNhc2UgMHgwMDY4OmNhc2UgMHgwMDY5OmNhc2UgMHgwMDZBOmNhc2UgMHgwMDZCOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2QzpjYXNlIDB4MDA2RDpjYXNlIDB4MDA2RTpjYXNlIDB4MDA2RjpjYXNlIDB4MDA3MDoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNzE6Y2FzZSAweDAwNzI6Y2FzZSAweDAwNzM6Y2FzZSAweDAwNzQ6Y2FzZSAweDAwNzU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDc2OmNhc2UgMHgwMDc3OmNhc2UgMHgwMDc4OmNhc2UgMHgwMDc5OmNhc2UgMHgwMDdBOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5FbmRUYWdOYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKHRhZ25hbWVidWYsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0ZW1wYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2VzY2FwZWRfZW5kX3RhZ19uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAzQyk7IC8vIExFU1MtVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAyRik7IC8vIFNPTElEVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9lc2NhcGVkX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNjcmlwdF9kYXRhX2VzY2FwZWRfZW5kX3RhZ19uYW1lX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDk6IC8vICBDSEFSQUNURVIgVEFCVUxBVElPTiAodGFiKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQTogLy8gIExJTkUgRkVFRCAoTEYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBDOiAvLyAgRk9STSBGRUVEIChGRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU1BBQ0UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcHByb3ByaWF0ZUVuZFRhZyh0YWduYW1lYnVmKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGJlZm9yZV9hdHRyaWJ1dGVfbmFtZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMkY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU09MSURVUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFwcHJvcHJpYXRlRW5kVGFnKHRhZ25hbWVidWYpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2VsZl9jbG9zaW5nX3N0YXJ0X3RhZ19zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgR1JFQVRFUi1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcHByb3ByaWF0ZUVuZFRhZyh0YWduYW1lYnVmKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdFRhZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0MTogLy8gW0EtWl0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDI6Y2FzZSAweDAwNDM6Y2FzZSAweDAwNDQ6Y2FzZSAweDAwNDU6Y2FzZSAweDAwNDY6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQ3OmNhc2UgMHgwMDQ4OmNhc2UgMHgwMDQ5OmNhc2UgMHgwMDRBOmNhc2UgMHgwMDRCOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0QzpjYXNlIDB4MDA0RDpjYXNlIDB4MDA0RTpjYXNlIDB4MDA0RjpjYXNlIDB4MDA1MDoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNTE6Y2FzZSAweDAwNTI6Y2FzZSAweDAwNTM6Y2FzZSAweDAwNTQ6Y2FzZSAweDAwNTU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDU2OmNhc2UgMHgwMDU3OmNhc2UgMHgwMDU4OmNhc2UgMHgwMDU5OmNhc2UgMHgwMDVBOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0YWduYW1lYnVmLCBjICsgMHgwMDIwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGVtcGJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDYxOiAvLyBbYS16XQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MjpjYXNlIDB4MDA2MzpjYXNlIDB4MDA2NDpjYXNlIDB4MDA2NTpjYXNlIDB4MDA2NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjc6Y2FzZSAweDAwNjg6Y2FzZSAweDAwNjk6Y2FzZSAweDAwNkE6Y2FzZSAweDAwNkI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDZDOmNhc2UgMHgwMDZEOmNhc2UgMHgwMDZFOmNhc2UgMHgwMDZGOmNhc2UgMHgwMDcwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA3MTpjYXNlIDB4MDA3MjpjYXNlIDB4MDA3MzpjYXNlIDB4MDA3NDpjYXNlIDB4MDA3NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNzY6Y2FzZSAweDAwNzc6Y2FzZSAweDAwNzg6Y2FzZSAweDAwNzk6Y2FzZSAweDAwN0E6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKHRhZ25hbWVidWYsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0ZW1wYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgZ2V0IGhlcmUgaW4gdGhlIGRlZmF1bHQgY2FzZSwgYW5kIGlmIHRoZSBjbG9zaW5nIHRhZ25hbWUKICAgICAgICAgICAgICAgICAgICAvLyBpcyBub3QgYW4gYXBwcm9wcmlhdGUgdGFnbmFtZS4KICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAzQyk7IC8vIExFU1MtVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwMkYpOyAvLyBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgcHVzaEFsbCh0ZXh0cnVuLCB0ZW1wYnVmKTsKICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2VzY2FwZWRfc3RhdGU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2NyaXB0X2RhdGFfZG91YmxlX2VzY2FwZV9zdGFydF9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDA5OiAvLyAgQ0hBUkFDVEVSIFRBQlVMQVRJT04gKHRhYikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEE6IC8vICBMSU5FIEZFRUQgKExGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQzogLy8gIEZPUk0gRkVFRCAoRkYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDIwOiAvLyAgU1BBQ0UKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMkY6IC8vICBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnVmMnN0cih0ZW1wYnVmKSA9PT0gInNjcmlwdCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9kb3VibGVfZXNjYXBlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZXNjYXBlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDE6IC8vIFtBLVpdCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQyOmNhc2UgMHgwMDQzOmNhc2UgMHgwMDQ0OmNhc2UgMHgwMDQ1OmNhc2UgMHgwMDQ2OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0NzpjYXNlIDB4MDA0ODpjYXNlIDB4MDA0OTpjYXNlIDB4MDA0QTpjYXNlIDB4MDA0QjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNEM6Y2FzZSAweDAwNEQ6Y2FzZSAweDAwNEU6Y2FzZSAweDAwNEY6Y2FzZSAweDAwNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDUxOmNhc2UgMHgwMDUyOmNhc2UgMHgwMDUzOmNhc2UgMHgwMDU0OmNhc2UgMHgwMDU1OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1NjpjYXNlIDB4MDA1NzpjYXNlIDB4MDA1ODpjYXNlIDB4MDA1OTpjYXNlIDB4MDA1QToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGVtcGJ1ZiwgYyArIDB4MDAyMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDYxOiAvLyBbYS16XQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MjpjYXNlIDB4MDA2MzpjYXNlIDB4MDA2NDpjYXNlIDB4MDA2NTpjYXNlIDB4MDA2NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjc6Y2FzZSAweDAwNjg6Y2FzZSAweDAwNjk6Y2FzZSAweDAwNkE6Y2FzZSAweDAwNkI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDZDOmNhc2UgMHgwMDZEOmNhc2UgMHgwMDZFOmNhc2UgMHgwMDZGOmNhc2UgMHgwMDcwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA3MTpjYXNlIDB4MDA3MjpjYXNlIDB4MDA3MzpjYXNlIDB4MDA3NDpjYXNlIDB4MDA3NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNzY6Y2FzZSAweDAwNzc6Y2FzZSAweDAwNzg6Y2FzZSAweDAwNzk6Y2FzZSAweDAwN0E6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKHRlbXBidWYsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2VzY2FwZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2NyaXB0X2RhdGFfZG91YmxlX2VzY2FwZWRfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBIWVBIRU4tTUlOVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2RvdWJsZV9lc2NhcGVkX2Rhc2hfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAyRCk7IC8vIEhZUEhFTi1NSU5VUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNDOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIExFU1MtVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9kb3VibGVfZXNjYXBlZF9sZXNzX3RoYW5fc2lnbl9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHgwMDNDKTsgLy8gTEVTUy1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBOVUxMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4RkZGRCk7IC8vIFJFUExBQ0VNRU5UIENIQVJBQ1RFUgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2NyaXB0X2RhdGFfZG91YmxlX2VzY2FwZWRfZGFzaF9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDJEOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEhZUEhFTi1NSU5VUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZG91YmxlX2VzY2FwZWRfZGFzaF9kYXNoX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwMkQpOyAvLyBIWVBIRU4tTUlOVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzQzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZG91YmxlX2VzY2FwZWRfbGVzc190aGFuX3NpZ25fc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4MDAzQyk7IC8vIExFU1MtVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZG91YmxlX2VzY2FwZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIDB4RkZGRCk7IC8vIFJFUExBQ0VNRU5UIENIQVJBQ1RFUgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2RvdWJsZV9lc2NhcGVkX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzY3JpcHRfZGF0YV9kb3VibGVfZXNjYXBlZF9kYXNoX2Rhc2hfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBIWVBIRU4tTUlOVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHgwMDJEKTsgLy8gSFlQSEVOLU1JTlVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTEVTUy1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2RvdWJsZV9lc2NhcGVkX2xlc3NfdGhhbl9zaWduX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwM0MpOyAvLyBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHgwMDNFKTsgLy8gR1JFQVRFUi1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBOVUxMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9kb3VibGVfZXNjYXBlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgMHhGRkZEKTsgLy8gUkVQTEFDRU1FTlQgQ0hBUkFDVEVSCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZG91YmxlX2VzY2FwZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNjcmlwdF9kYXRhX2RvdWJsZV9lc2NhcGVkX2xlc3NfdGhhbl9zaWduX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYyA9PT0gMHgwMDJGKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luVGVtcEJ1ZigpOwogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzY3JpcHRfZGF0YV9kb3VibGVfZXNjYXBlX2VuZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCAweDAwMkYpOyAvLyBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZG91YmxlX2VzY2FwZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNjcmlwdF9kYXRhX2RvdWJsZV9lc2NhcGVfZW5kX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDk6IC8vICBDSEFSQUNURVIgVEFCVUxBVElPTiAodGFiKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQTogLy8gIExJTkUgRkVFRCAoTEYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBDOiAvLyAgRk9STSBGRUVEIChGRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjA6IC8vICBTUEFDRQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRjogLy8gIFNPTElEVVMKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgR1JFQVRFUi1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidWYyc3RyKHRlbXBidWYpID09PSAic2NyaXB0IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2VzY2FwZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNjcmlwdF9kYXRhX2RvdWJsZV9lc2NhcGVkX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0ZXh0cnVuLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0MTogLy8gW0EtWl0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDI6Y2FzZSAweDAwNDM6Y2FzZSAweDAwNDQ6Y2FzZSAweDAwNDU6Y2FzZSAweDAwNDY6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQ3OmNhc2UgMHgwMDQ4OmNhc2UgMHgwMDQ5OmNhc2UgMHgwMDRBOmNhc2UgMHgwMDRCOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0QzpjYXNlIDB4MDA0RDpjYXNlIDB4MDA0RTpjYXNlIDB4MDA0RjpjYXNlIDB4MDA1MDoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNTE6Y2FzZSAweDAwNTI6Y2FzZSAweDAwNTM6Y2FzZSAweDAwNTQ6Y2FzZSAweDAwNTU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDU2OmNhc2UgMHgwMDU3OmNhc2UgMHgwMDU4OmNhc2UgMHgwMDU5OmNhc2UgMHgwMDVBOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcih0ZW1wYnVmLCBjICsgMHgwMDIwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godGV4dHJ1biwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNjE6IC8vIFthLXpdCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDYyOmNhc2UgMHgwMDYzOmNhc2UgMHgwMDY0OmNhc2UgMHgwMDY1OmNhc2UgMHgwMDY2OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2NzpjYXNlIDB4MDA2ODpjYXNlIDB4MDA2OTpjYXNlIDB4MDA2QTpjYXNlIDB4MDA2QjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNkM6Y2FzZSAweDAwNkQ6Y2FzZSAweDAwNkU6Y2FzZSAweDAwNkY6Y2FzZSAweDAwNzA6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDcxOmNhc2UgMHgwMDcyOmNhc2UgMHgwMDczOmNhc2UgMHgwMDc0OmNhc2UgMHgwMDc1OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA3NjpjYXNlIDB4MDA3NzpjYXNlIDB4MDA3ODpjYXNlIDB4MDA3OTpjYXNlIDB4MDA3QToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIodGVtcGJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRleHRydW4sIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfZG91YmxlX2VzY2FwZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYmVmb3JlX2F0dHJpYnV0ZV9uYW1lX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDk6IC8vICBDSEFSQUNURVIgVEFCVUxBVElPTiAodGFiKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQTogLy8gIExJTkUgRkVFRCAoTEYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBDOiAvLyAgRk9STSBGRUVEIChGRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU1BBQ0UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIElnbm9yZSB0aGUgY2hhcmFjdGVyLiAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDJGOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIFNPTElEVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHNlbGZfY2xvc2luZ19zdGFydF90YWdfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgR1JFQVRFUi1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0VGFnKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDE6IC8vIFtBLVpdCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQyOmNhc2UgMHgwMDQzOmNhc2UgMHgwMDQ0OmNhc2UgMHgwMDQ1OmNhc2UgMHgwMDQ2OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0NzpjYXNlIDB4MDA0ODpjYXNlIDB4MDA0OTpjYXNlIDB4MDA0QTpjYXNlIDB4MDA0QjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNEM6Y2FzZSAweDAwNEQ6Y2FzZSAweDAwNEU6Y2FzZSAweDAwNEY6Y2FzZSAweDAwNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDUxOmNhc2UgMHgwMDUyOmNhc2UgMHgwMDUzOmNhc2UgMHgwMDU0OmNhc2UgMHgwMDU1OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1NjpjYXNlIDB4MDA1NzpjYXNlIDB4MDA1ODpjYXNlIDB4MDA1OTpjYXNlIDB4MDA1QToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luQXR0ck5hbWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoYXR0cm5hbWVidWYsIGMgKyAweDAwMjApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYXR0cmlidXRlX25hbWVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5BdHRyTmFtZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihhdHRybmFtZWJ1ZiwgMHhGRkZEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGF0dHJpYnV0ZV9uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjI6IC8vICBRVU9UQVRJT04gTUFSSwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyNzogLy8gIEFQT1NUUk9QSEUKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0M6IC8vICBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRDogLy8gIEVRVUFMUyBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYW5kbGVTaW1wbGVBdHRyaWJ1dGUoKSkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkF0dHJOYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGF0dHJuYW1lYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGF0dHJpYnV0ZV9uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGF0dHJpYnV0ZV9uYW1lX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDk6IC8vICBDSEFSQUNURVIgVEFCVUxBVElPTiAodGFiKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQTogLy8gIExJTkUgRkVFRCAoTEYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBDOiAvLyAgRk9STSBGRUVEIChGRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU1BBQ0UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGFmdGVyX2F0dHJpYnV0ZV9uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDJGOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIFNPTElEVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZShhdHRybmFtZWJ1Zik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzZWxmX2Nsb3Npbmdfc3RhcnRfdGFnX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNEOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEVRVUFMUyBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkF0dHJWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYmVmb3JlX2F0dHJpYnV0ZV92YWx1ZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkQXR0cmlidXRlKGF0dHJuYW1lYnVmKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0VGFnKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDE6IC8vIFtBLVpdCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQyOmNhc2UgMHgwMDQzOmNhc2UgMHgwMDQ0OmNhc2UgMHgwMDQ1OmNhc2UgMHgwMDQ2OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0NzpjYXNlIDB4MDA0ODpjYXNlIDB4MDA0OTpjYXNlIDB4MDA0QTpjYXNlIDB4MDA0QjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNEM6Y2FzZSAweDAwNEQ6Y2FzZSAweDAwNEU6Y2FzZSAweDAwNEY6Y2FzZSAweDAwNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDUxOmNhc2UgMHgwMDUyOmNhc2UgMHgwMDUzOmNhc2UgMHgwMDU0OmNhc2UgMHgwMDU1OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1NjpjYXNlIDB4MDA1NzpjYXNlIDB4MDA1ODpjYXNlIDB4MDA1OTpjYXNlIDB4MDA1QToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoYXR0cm5hbWVidWYsIGMgKyAweDAwMjApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIE5VTEwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoYXR0cm5hbWVidWYsIDB4RkZGRCAvKiBSRVBMQUNFTUVOVCBDSEFSQUNURVIgKi8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjI6IC8vICBRVU9UQVRJT04gTUFSSwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyNzogLy8gIEFQT1NUUk9QSEUKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0M6IC8vICBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGF0dHJuYW1lYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhZnRlcl9hdHRyaWJ1dGVfbmFtZV9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDA5OiAvLyAgQ0hBUkFDVEVSIFRBQlVMQVRJT04gKHRhYikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEE6IC8vICBMSU5FIEZFRUQgKExGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQzogLy8gIEZPUk0gRkVFRCAoRkYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDIwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIFNQQUNFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBJZ25vcmUgdGhlIGNoYXJhY3Rlci4gKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoYXR0cm5hbWVidWYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2VsZl9jbG9zaW5nX3N0YXJ0X3RhZ19zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBFUVVBTFMgU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5BdHRyVmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGJlZm9yZV9hdHRyaWJ1dGVfdmFsdWVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgR1JFQVRFUi1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoYXR0cm5hbWVidWYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdFRhZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQxOiAvLyBbQS1aXQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0MjpjYXNlIDB4MDA0MzpjYXNlIDB4MDA0NDpjYXNlIDB4MDA0NTpjYXNlIDB4MDA0NjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDc6Y2FzZSAweDAwNDg6Y2FzZSAweDAwNDk6Y2FzZSAweDAwNEE6Y2FzZSAweDAwNEI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDRDOmNhc2UgMHgwMDREOmNhc2UgMHgwMDRFOmNhc2UgMHgwMDRGOmNhc2UgMHgwMDUwOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1MTpjYXNlIDB4MDA1MjpjYXNlIDB4MDA1MzpjYXNlIDB4MDA1NDpjYXNlIDB4MDA1NToKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNTY6Y2FzZSAweDAwNTc6Y2FzZSAweDAwNTg6Y2FzZSAweDAwNTk6Y2FzZSAweDAwNUE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoYXR0cm5hbWVidWYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5BdHRyTmFtZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihhdHRybmFtZWJ1ZiwgYyArIDB4MDAyMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBhdHRyaWJ1dGVfbmFtZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBOVUxMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoYXR0cm5hbWVidWYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5BdHRyTmFtZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihhdHRybmFtZWJ1ZiwgMHhGRkZEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGF0dHJpYnV0ZV9uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjI6IC8vICBRVU9UQVRJT04gTUFSSwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyNzogLy8gIEFQT1NUUk9QSEUKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0M6IC8vICBMRVNTLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoYXR0cm5hbWVidWYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5BdHRyTmFtZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihhdHRybmFtZWJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBhdHRyaWJ1dGVfbmFtZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBiZWZvcmVfYXR0cmlidXRlX3ZhbHVlX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDk6IC8vICBDSEFSQUNURVIgVEFCVUxBVElPTiAodGFiKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQTogLy8gIExJTkUgRkVFRCAoTEYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBDOiAvLyAgRk9STSBGRUVEIChGRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU1BBQ0UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIElnbm9yZSB0aGUgY2hhcmFjdGVyLiAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDIyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIFFVT1RBVElPTiBNQVJLCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBhdHRyaWJ1dGVfdmFsdWVfZG91YmxlX3F1b3RlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyNjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBBTVBFUlNBTkQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBhdHRyaWJ1dGVfdmFsdWVfdW5xdW90ZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgQVBPU1RST1BIRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYXR0cmlidXRlX3ZhbHVlX3NpbmdsZV9xdW90ZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihhdHRydmFsdWVidWYsIDB4RkZGRCAvKiBSRVBMQUNFTUVOVCBDSEFSQUNURVIgKi8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYXR0cmlidXRlX3ZhbHVlX3VucXVvdGVkX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoYXR0cm5hbWVidWYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdFRhZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNDOiAvLyAgTEVTUy1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0Q6IC8vICBFUVVBTFMgU0lHTgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MDogLy8gIEdSQVZFIEFDQ0VOVAogICAgICAgICAgICAgICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGF0dHJ2YWx1ZWJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBhdHRyaWJ1dGVfdmFsdWVfdW5xdW90ZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYXR0cmlidXRlX3ZhbHVlX2RvdWJsZV9xdW90ZWRfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBRVU9UQVRJT04gTUFSSwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkQXR0cmlidXRlKGF0dHJuYW1lYnVmLCBhdHRydmFsdWVidWYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYWZ0ZXJfYXR0cmlidXRlX3ZhbHVlX3F1b3RlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyNjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBBTVBFUlNBTkQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2hTdGF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gY2hhcmFjdGVyX3JlZmVyZW5jZV9pbl9hdHRyaWJ1dGVfdmFsdWVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihhdHRydmFsdWVidWYsIDB4RkZGRCAvKiBSRVBMQUNFTUVOVCBDSEFSQUNURVIgKi8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoYXR0cnZhbHVlYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFwcGVuZENoYXJzV2hpbGUoYXR0cnZhbHVlYnVmLCBEQkxRVU9URUFUVFJWQUwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGF0dHJpYnV0ZV92YWx1ZV9zaW5nbGVfcXVvdGVkX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgQVBPU1RST1BIRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkQXR0cmlidXRlKGF0dHJuYW1lYnVmLCBhdHRydmFsdWVidWYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYWZ0ZXJfYXR0cmlidXRlX3ZhbHVlX3F1b3RlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyNjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBBTVBFUlNBTkQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2hTdGF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gY2hhcmFjdGVyX3JlZmVyZW5jZV9pbl9hdHRyaWJ1dGVfdmFsdWVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihhdHRydmFsdWVidWYsIDB4RkZGRCAvKiBSRVBMQUNFTUVOVCBDSEFSQUNURVIgKi8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoYXR0cnZhbHVlYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFwcGVuZENoYXJzV2hpbGUoYXR0cnZhbHVlYnVmLCBTSU5HTEVRVU9URUFUVFJWQUwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGF0dHJpYnV0ZV92YWx1ZV91bnF1b3RlZF9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDA5OiAvLyAgQ0hBUkFDVEVSIFRBQlVMQVRJT04gKHRhYikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEE6IC8vICBMSU5FIEZFRUQgKExGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQzogLy8gIEZPUk0gRkVFRCAoRkYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDIwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIFNQQUNFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoYXR0cm5hbWVidWYsIGF0dHJ2YWx1ZWJ1Zik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBiZWZvcmVfYXR0cmlidXRlX25hbWVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgQU1QRVJTQU5ECiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoU3RhdGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGNoYXJhY3Rlcl9yZWZlcmVuY2VfaW5fYXR0cmlidXRlX3ZhbHVlX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoYXR0cm5hbWVidWYsIGF0dHJ2YWx1ZWJ1Zik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdFRhZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIE5VTEwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoYXR0cnZhbHVlYnVmLCAweEZGRkQgLyogUkVQTEFDRU1FTlQgQ0hBUkFDVEVSICovKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDIyOiAvLyAgUVVPVEFUSU9OIE1BUksKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjc6IC8vICBBUE9TVFJPUEhFCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNDOiAvLyAgTEVTUy1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0Q6IC8vICBFUVVBTFMgU0lHTgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA2MDogLy8gIEdSQVZFIEFDQ0VOVAogICAgICAgICAgICAgICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGF0dHJ2YWx1ZWJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhcHBlbmRDaGFyc1doaWxlKGF0dHJ2YWx1ZWJ1ZiwgVU5RVU9URURBVFRSVkFMKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjaGFyYWN0ZXJfcmVmZXJlbmNlX2luX2F0dHJpYnV0ZV92YWx1ZV9zdGF0ZShjLCBsb29rYWhlYWQsIGVvZikgewogICAgICAgICAgICAgICAgICAgIHZhciBjaGFyID0gcGFyc2VDaGFyUmVmKGxvb2thaGVhZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYXIgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGFyID09PSAibnVtYmVyIikgYXBwZW5kQ2hhcihhdHRydmFsdWVidWYsIGNoYXIpO2Vsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQW4gYXJyYXkgb2YgbnVtYmVycwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihhdHRydmFsdWVidWYsIGNoYXJbaV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihhdHRydmFsdWVidWYsIDB4MDAyNik7IC8vIEFNUEVSU0FORDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHBvcFN0YXRlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjaGFyYWN0ZXJfcmVmZXJlbmNlX2luX2F0dHJpYnV0ZV92YWx1ZV9zdGF0ZS5sb29rYWhlYWQgPSBBVFRSQ0hBUlJFRjsKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhZnRlcl9hdHRyaWJ1dGVfdmFsdWVfcXVvdGVkX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDk6IC8vICBDSEFSQUNURVIgVEFCVUxBVElPTiAodGFiKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQTogLy8gIExJTkUgRkVFRCAoTEYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBDOiAvLyAgRk9STSBGRUVEIChGRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU1BBQ0UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGJlZm9yZV9hdHRyaWJ1dGVfbmFtZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTT0xJRFVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBzZWxmX2Nsb3Npbmdfc3RhcnRfdGFnX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdFRhZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBiZWZvcmVfYXR0cmlidXRlX25hbWVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2VsZl9jbG9zaW5nX3N0YXJ0X3RhZ19zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIDxpPnNlbGYtY2xvc2luZyBmbGFnPC9pPiBvZiB0aGUgY3VycmVudCB0YWcgdG9rZW4uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdFNlbGZDbG9zaW5nVGFnKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBiZWZvcmVfYXR0cmlidXRlX25hbWVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYm9ndXNfY29tbWVudF9zdGF0ZShjLCBsb29rYWhlYWQsIGVvZikgewogICAgICAgICAgICAgICAgICAgIHZhciBsZW4gPSBsb29rYWhlYWQubGVuZ3RoOwoKICAgICAgICAgICAgICAgICAgICBpZiAoZW9mKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyICs9IGxlbiAtIDE7IC8vIGRvbid0IGNvbnN1bWUgdGhlIGVvZgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyICs9IGxlbjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHZhciBjb21tZW50ID0gc3Vic3RyaW5nKGxvb2thaGVhZCwgMCwgbGVuIC0gMSk7CgogICAgICAgICAgICAgICAgICAgIGNvbW1lbnQgPSByZXBsYWNlKGNvbW1lbnQsIC9cdTAwMDAvZywgIlx1RkZGRCIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnQgPSByZXBsYWNlKGNvbW1lbnQsIC9cdTAwMERcdTAwMEEvZywgIlx1MDAwQSIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnQgPSByZXBsYWNlKGNvbW1lbnQsIC9cdTAwMEQvZywgIlx1MDAwQSIpOwoKICAgICAgICAgICAgICAgICAgICBpbnNlcnRUb2tlbihDT01NRU5ULCBjb21tZW50KTsKICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYm9ndXNfY29tbWVudF9zdGF0ZS5sb29rYWhlYWQgPSAiPiI7CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gbWFya3VwX2RlY2xhcmF0aW9uX29wZW5fc3RhdGUoYywgbG9va2FoZWFkLCBlb2YpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobG9va2FoZWFkWzBdID09PSAiLSIgJiYgbG9va2FoZWFkWzFdID09PSAiLSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXIgKz0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5Db21tZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGNvbW1lbnRfc3RhcnRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICh0b1VwcGVyQ2FzZShsb29rYWhlYWQpID09PSAiRE9DVFlQRSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXIgKz0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZG9jdHlwZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxvb2thaGVhZCA9PT0gIltDREFUQVsiICYmIGNkYXRhQWxsb3dlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyICs9IDc7CiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGNkYXRhX3NlY3Rpb25fc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYm9ndXNfY29tbWVudF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtYXJrdXBfZGVjbGFyYXRpb25fb3Blbl9zdGF0ZS5sb29rYWhlYWQgPSA3OwoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNvbW1lbnRfc3RhcnRfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIGJlZ2luQ29tbWVudCgpOwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBIWVBIRU4tTUlOVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGNvbW1lbnRfc3RhcnRfZGFzaF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBOVUxMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGNvbW1lbnRidWYsIDB4RkZGRCAvKiBSRVBMQUNFTUVOVCBDSEFSQUNURVIgKi8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gY29tbWVudF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydFRva2VuKENPTU1FTlQsIGJ1ZjJzdHIoY29tbWVudGJ1ZikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8qIHNlZSBjb21tZW50IGluIGNvbW1lbnQgZW5kIHN0YXRlICovCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0VG9rZW4oQ09NTUVOVCwgYnVmMnN0cihjb21tZW50YnVmKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihjb21tZW50YnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGNvbW1lbnRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gY29tbWVudF9zdGFydF9kYXNoX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMkQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgSFlQSEVOLU1JTlVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBjb21tZW50X2VuZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBOVUxMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGNvbW1lbnRidWYsIDB4MDAyRCAvKiBIWVBIRU4tTUlOVVMgKi8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihjb21tZW50YnVmLCAweEZGRkQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gY29tbWVudF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydFRva2VuKENPTU1FTlQsIGJ1ZjJzdHIoY29tbWVudGJ1ZikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0VG9rZW4oQ09NTUVOVCwgYnVmMnN0cihjb21tZW50YnVmKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvKiBzZWUgY29tbWVudCBpbiBjb21tZW50IGVuZCBzdGF0ZSAqLwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihjb21tZW50YnVmLCAweDAwMkQgLyogSFlQSEVOLU1JTlVTICovKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoY29tbWVudGJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBjb21tZW50X3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNvbW1lbnRfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBIWVBIRU4tTUlOVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGNvbW1lbnRfZW5kX2Rhc2hfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihjb21tZW50YnVmLCAweEZGRkQgLyogUkVQTEFDRU1FTlQgQ0hBUkFDVEVSICovKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydFRva2VuKENPTU1FTlQsIGJ1ZjJzdHIoY29tbWVudGJ1ZikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsgLyogc2VlIGNvbW1lbnQgaW4gY29tbWVudCBlbmQgc3RhdGUgKi8KICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoY29tbWVudGJ1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gY29tbWVudF9lbmRfZGFzaF9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDJEOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEhZUEhFTi1NSU5VUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gY29tbWVudF9lbmRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihjb21tZW50YnVmLCAweDAwMkQgLyogSFlQSEVOLU1JTlVTICovKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoY29tbWVudGJ1ZiwgMHhGRkZEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGNvbW1lbnRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRUb2tlbihDT01NRU5ULCBidWYyc3RyKGNvbW1lbnRidWYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8qIHNlZSBjb21tZW50IGluIGNvbW1lbnQgZW5kIHN0YXRlICovCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGNvbW1lbnRidWYsIDB4MDAyRCAvKiBIWVBIRU4tTUlOVVMgKi8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihjb21tZW50YnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGNvbW1lbnRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gY29tbWVudF9lbmRfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydFRva2VuKENPTU1FTlQsIGJ1ZjJzdHIoY29tbWVudGJ1ZikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIE5VTEwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoY29tbWVudGJ1ZiwgMHgwMDJEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoY29tbWVudGJ1ZiwgMHgwMDJEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoY29tbWVudGJ1ZiwgMHhGRkZEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGNvbW1lbnRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgRVhDTEFNQVRJT04gTUFSSwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gY29tbWVudF9lbmRfYmFuZ19zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyRDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBIWVBIRU4tTUlOVVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoY29tbWVudGJ1ZiwgMHgwMDJEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydFRva2VuKENPTU1FTlQsIGJ1ZjJzdHIoY29tbWVudGJ1ZikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsgLyogRm9yIHNlY3VyaXR5IHJlYXNvbnM6IG90aGVyd2lzZSwgaG9zdGlsZSB1c2VyIGNvdWxkIHB1dCBhIHNjcmlwdCBpbiBhIGNvbW1lbnQgZS5nLiBpbiBhIGJsb2cgY29tbWVudCBhbmQgdGhlbiBET1MgdGhlIHNlcnZlciBzbyB0aGF0IHRoZSBlbmQgdGFnIGlzbid0IHJlYWQsIGFuZCB0aGVuIHRoZSBjb21tZW50ZWQgc2NyaXB0IHRhZyB3b3VsZCBiZSB0cmVhdGVkIGFzIGxpdmUgY29kZSAqLwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihjb21tZW50YnVmLCAweDAwMkQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihjb21tZW50YnVmLCAweDAwMkQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihjb21tZW50YnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGNvbW1lbnRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gY29tbWVudF9lbmRfYmFuZ19zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDJEOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEhZUEhFTi1NSU5VUwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihjb21tZW50YnVmLCAweDAwMkQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihjb21tZW50YnVmLCAweDAwMkQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihjb21tZW50YnVmLCAweDAwMjEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gY29tbWVudF9lbmRfZGFzaF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydFRva2VuKENPTU1FTlQsIGJ1ZjJzdHIoY29tbWVudGJ1ZikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIE5VTEwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoY29tbWVudGJ1ZiwgMHgwMDJEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoY29tbWVudGJ1ZiwgMHgwMDJEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoY29tbWVudGJ1ZiwgMHgwMDIxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoY29tbWVudGJ1ZiwgMHhGRkZEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGNvbW1lbnRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRUb2tlbihDT01NRU5ULCBidWYyc3RyKGNvbW1lbnRidWYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8qIHNlZSBjb21tZW50IGluIGNvbW1lbnQgZW5kIHN0YXRlICovCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGNvbW1lbnRidWYsIDB4MDAyRCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGNvbW1lbnRidWYsIDB4MDAyRCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGNvbW1lbnRidWYsIDB4MDAyMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGNvbW1lbnRidWYsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gY29tbWVudF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBkb2N0eXBlX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDk6IC8vICBDSEFSQUNURVIgVEFCVUxBVElPTiAodGFiKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQTogLy8gIExJTkUgRkVFRCAoTEYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBDOiAvLyAgRk9STSBGRUVEIChGRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU1BBQ0UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGJlZm9yZV9kb2N0eXBlX25hbWVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkRvY3R5cGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlcXVpcmtzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0RG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBiZWZvcmVfZG9jdHlwZV9uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGJlZm9yZV9kb2N0eXBlX25hbWVfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwOTogLy8gIENIQVJBQ1RFUiBUQUJVTEFUSU9OICh0YWIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBBOiAvLyAgTElORSBGRUVEIChMRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEM6IC8vICBGT1JNIEZFRUQgKEZGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTUEFDRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogSWdub3JlIHRoZSBjaGFyYWN0ZXIuICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDE6IC8vIFtBLVpdCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQyOmNhc2UgMHgwMDQzOmNhc2UgMHgwMDQ0OmNhc2UgMHgwMDQ1OmNhc2UgMHgwMDQ2OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0NzpjYXNlIDB4MDA0ODpjYXNlIDB4MDA0OTpjYXNlIDB4MDA0QTpjYXNlIDB4MDA0QjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNEM6Y2FzZSAweDAwNEQ6Y2FzZSAweDAwNEU6Y2FzZSAweDAwNEY6Y2FzZSAweDAwNTA6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDUxOmNhc2UgMHgwMDUyOmNhc2UgMHgwMDUzOmNhc2UgMHgwMDU0OmNhc2UgMHgwMDU1OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA1NjpjYXNlIDB4MDA1NzpjYXNlIDB4MDA1ODpjYXNlIDB4MDA1OTpjYXNlIDB4MDA1QToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luRG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihkb2N0eXBlbmFtZWJ1ZiwgYyArIDB4MDAyMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkb2N0eXBlX25hbWVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5Eb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGRvY3R5cGVuYW1lYnVmLCAweEZGRkQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZG9jdHlwZV9uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkRvY3R5cGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JjZXF1aXJrcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdERvY3R5cGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luRG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXREb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5Eb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGRvY3R5cGVuYW1lYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRvY3R5cGVfbmFtZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBkb2N0eXBlX25hbWVfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwOTogLy8gIENIQVJBQ1RFUiBUQUJVTEFUSU9OICh0YWIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBBOiAvLyAgTElORSBGRUVEIChMRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEM6IC8vICBGT1JNIEZFRUQgKEZGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTUEFDRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYWZ0ZXJfZG9jdHlwZV9uYW1lX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdERvY3R5cGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0MTogLy8gW0EtWl0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNDI6Y2FzZSAweDAwNDM6Y2FzZSAweDAwNDQ6Y2FzZSAweDAwNDU6Y2FzZSAweDAwNDY6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDQ3OmNhc2UgMHgwMDQ4OmNhc2UgMHgwMDQ5OmNhc2UgMHgwMDRBOmNhc2UgMHgwMDRCOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDA0QzpjYXNlIDB4MDA0RDpjYXNlIDB4MDA0RTpjYXNlIDB4MDA0RjpjYXNlIDB4MDA1MDoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwNTE6Y2FzZSAweDAwNTI6Y2FzZSAweDAwNTM6Y2FzZSAweDAwNTQ6Y2FzZSAweDAwNTU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDU2OmNhc2UgMHgwMDU3OmNhc2UgMHgwMDU4OmNhc2UgMHgwMDU5OmNhc2UgMHgwMDVBOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihkb2N0eXBlbmFtZWJ1ZiwgYyArIDB4MDAyMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihkb2N0eXBlbmFtZWJ1ZiwgMHhGRkZEIC8qIFJFUExBQ0VNRU5UIENIQVJBQ1RFUiAqLyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JjZXF1aXJrcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdERvY3R5cGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGRvY3R5cGVuYW1lYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhZnRlcl9kb2N0eXBlX25hbWVfc3RhdGUoYywgbG9va2FoZWFkLCBlb2YpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDk6IC8vICBDSEFSQUNURVIgVEFCVUxBVElPTiAodGFiKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQTogLy8gIExJTkUgRkVFRCAoTEYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBDOiAvLyAgRk9STSBGRUVEIChGRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU1BBQ0UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIElnbm9yZSB0aGUgY2hhcmFjdGVyLiAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXIgKz0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyICs9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0RG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXREb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb29rYWhlYWQgPSB0b1VwcGVyQ2FzZShsb29rYWhlYWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvb2thaGVhZCA9PT0gIlBVQkxJQyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhciArPSA2OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGFmdGVyX2RvY3R5cGVfcHVibGljX2tleXdvcmRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxvb2thaGVhZCA9PT0gIlNZU1RFTSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhciArPSA2OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGFmdGVyX2RvY3R5cGVfc3lzdGVtX2tleXdvcmRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlcXVpcmtzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYm9ndXNfZG9jdHlwZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGFmdGVyX2RvY3R5cGVfbmFtZV9zdGF0ZS5sb29rYWhlYWQgPSA2OwoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGFmdGVyX2RvY3R5cGVfcHVibGljX2tleXdvcmRfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwOTogLy8gIENIQVJBQ1RFUiBUQUJVTEFUSU9OICh0YWIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBBOiAvLyAgTElORSBGRUVEIChMRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEM6IC8vICBGT1JNIEZFRUQgKEZGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTUEFDRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYmVmb3JlX2RvY3R5cGVfcHVibGljX2lkZW50aWZpZXJfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgUVVPVEFUSU9OIE1BUksKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luRG9jdHlwZVB1YmxpY0lkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkb2N0eXBlX3B1YmxpY19pZGVudGlmaWVyX2RvdWJsZV9xdW90ZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgQVBPU1RST1BIRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5Eb2N0eXBlUHVibGljSWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRvY3R5cGVfcHVibGljX2lkZW50aWZpZXJfc2luZ2xlX3F1b3RlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0RG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXREb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGJvZ3VzX2RvY3R5cGVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYmVmb3JlX2RvY3R5cGVfcHVibGljX2lkZW50aWZpZXJfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwOTogLy8gIENIQVJBQ1RFUiBUQUJVTEFUSU9OICh0YWIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBBOiAvLyAgTElORSBGRUVEIChMRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEM6IC8vICBGT1JNIEZFRUQgKEZGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTUEFDRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogSWdub3JlIHRoZSBjaGFyYWN0ZXIuICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgUVVPVEFUSU9OIE1BUksKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luRG9jdHlwZVB1YmxpY0lkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkb2N0eXBlX3B1YmxpY19pZGVudGlmaWVyX2RvdWJsZV9xdW90ZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgQVBPU1RST1BIRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5Eb2N0eXBlUHVibGljSWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRvY3R5cGVfcHVibGljX2lkZW50aWZpZXJfc2luZ2xlX3F1b3RlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0RG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXREb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGJvZ3VzX2RvY3R5cGVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gZG9jdHlwZV9wdWJsaWNfaWRlbnRpZmllcl9kb3VibGVfcXVvdGVkX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgUVVPVEFUSU9OIE1BUksKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGFmdGVyX2RvY3R5cGVfcHVibGljX2lkZW50aWZpZXJfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihkb2N0eXBlcHVibGljYnVmLCAweEZGRkQgLyogUkVQTEFDRU1FTlQgQ0hBUkFDVEVSICovKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0RG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXREb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihkb2N0eXBlcHVibGljYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBkb2N0eXBlX3B1YmxpY19pZGVudGlmaWVyX3NpbmdsZV9xdW90ZWRfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyNzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBBUE9TVFJPUEhFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBhZnRlcl9kb2N0eXBlX3B1YmxpY19pZGVudGlmaWVyX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIE5VTEwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoZG9jdHlwZXB1YmxpY2J1ZiwgMHhGRkZEIC8qIFJFUExBQ0VNRU5UIENIQVJBQ1RFUiAqLyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgR1JFQVRFUi1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlcXVpcmtzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdERvY3R5cGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlcXVpcmtzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0RG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZENoYXIoZG9jdHlwZXB1YmxpY2J1ZiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYWZ0ZXJfZG9jdHlwZV9wdWJsaWNfaWRlbnRpZmllcl9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDA5OiAvLyAgQ0hBUkFDVEVSIFRBQlVMQVRJT04gKHRhYikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEE6IC8vICBMSU5FIEZFRUQgKExGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQzogLy8gIEZPUk0gRkVFRCAoRkYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDIwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIFNQQUNFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBiZXR3ZWVuX2RvY3R5cGVfcHVibGljX2FuZF9zeXN0ZW1faWRlbnRpZmllcnNfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwM0U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgR1JFQVRFUi1USEFOIFNJR04KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0RG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDIyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIFFVT1RBVElPTiBNQVJLCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkRvY3R5cGVTeXN0ZW1JZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZG9jdHlwZV9zeXN0ZW1faWRlbnRpZmllcl9kb3VibGVfcXVvdGVkX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDI3OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEFQT1NUUk9QSEUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luRG9jdHlwZVN5c3RlbUlkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkb2N0eXBlX3N5c3RlbV9pZGVudGlmaWVyX3NpbmdsZV9xdW90ZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JjZXF1aXJrcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdERvY3R5cGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JjZXF1aXJrcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYm9ndXNfZG9jdHlwZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBiZXR3ZWVuX2RvY3R5cGVfcHVibGljX2FuZF9zeXN0ZW1faWRlbnRpZmllcnNfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwOTogLy8gIENIQVJBQ1RFUiBUQUJVTEFUSU9OICh0YWIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBBOiAvLyAgTElORSBGRUVEIChMRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEM6IC8vICBGT1JNIEZFRUQgKEZGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTUEFDRSBJZ25vcmUgdGhlIGNoYXJhY3Rlci4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXREb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgUVVPVEFUSU9OIE1BUksKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luRG9jdHlwZVN5c3RlbUlkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkb2N0eXBlX3N5c3RlbV9pZGVudGlmaWVyX2RvdWJsZV9xdW90ZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgQVBPU1RST1BIRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5Eb2N0eXBlU3lzdGVtSWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRvY3R5cGVfc3lzdGVtX2lkZW50aWZpZXJfc2luZ2xlX3F1b3RlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlcXVpcmtzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0RG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlcXVpcmtzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBib2d1c19kb2N0eXBlX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGFmdGVyX2RvY3R5cGVfc3lzdGVtX2tleXdvcmRfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwOTogLy8gIENIQVJBQ1RFUiBUQUJVTEFUSU9OICh0YWIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBBOiAvLyAgTElORSBGRUVEIChMRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEM6IC8vICBGT1JNIEZFRUQgKEZGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTUEFDRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYmVmb3JlX2RvY3R5cGVfc3lzdGVtX2lkZW50aWZpZXJfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgUVVPVEFUSU9OIE1BUksKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luRG9jdHlwZVN5c3RlbUlkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkb2N0eXBlX3N5c3RlbV9pZGVudGlmaWVyX2RvdWJsZV9xdW90ZWRfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgQVBPU1RST1BIRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5Eb2N0eXBlU3lzdGVtSWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRvY3R5cGVfc3lzdGVtX2lkZW50aWZpZXJfc2luZ2xlX3F1b3RlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0RG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXREb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGJvZ3VzX2RvY3R5cGVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYmVmb3JlX2RvY3R5cGVfc3lzdGVtX2lkZW50aWZpZXJfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwOTogLy8gIENIQVJBQ1RFUiBUQUJVTEFUSU9OICh0YWIpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBBOiAvLyAgTElORSBGRUVEIChMRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMEM6IC8vICBGT1JNIEZFRUQgKEZGKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTUEFDRSBJZ25vcmUgdGhlIGNoYXJhY3Rlci4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBRVU9UQVRJT04gTUFSSwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5Eb2N0eXBlU3lzdGVtSWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRvY3R5cGVfc3lzdGVtX2lkZW50aWZpZXJfZG91YmxlX3F1b3RlZF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyNzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBBUE9TVFJPUEhFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkRvY3R5cGVTeXN0ZW1JZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZG9jdHlwZV9zeXN0ZW1faWRlbnRpZmllcl9zaW5nbGVfcXVvdGVkX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JjZXF1aXJrcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXREb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JjZXF1aXJrcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdERvY3R5cGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JjZXF1aXJrcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYm9ndXNfZG9jdHlwZV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBkb2N0eXBlX3N5c3RlbV9pZGVudGlmaWVyX2RvdWJsZV9xdW90ZWRfc3RhdGUoYykgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAyMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBRVU9UQVRJT04gTUFSSwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gYWZ0ZXJfZG9jdHlwZV9zeXN0ZW1faWRlbnRpZmllcl9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBOVUxMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGRvY3R5cGVzeXN0ZW1idWYsIDB4RkZGRCAvKiBSRVBMQUNFTUVOVCBDSEFSQUNURVIgKi8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JjZXF1aXJrcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXREb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JjZXF1aXJrcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdERvY3R5cGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyLS07IC8vIHB1c2hiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRDaGFyKGRvY3R5cGVzeXN0ZW1idWYsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRvY3R5cGVfc3lzdGVtX2lkZW50aWZpZXJfc2luZ2xlX3F1b3RlZF9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDI3OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEFQT1NUUk9QSEUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGFmdGVyX2RvY3R5cGVfc3lzdGVtX2lkZW50aWZpZXJfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgTlVMTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihkb2N0eXBlc3lzdGVtYnVmLCAweEZGRkQgLyogUkVQTEFDRU1FTlQgQ0hBUkFDVEVSICovKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAzRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBHUkVBVEVSLVRIQU4gU0lHTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0RG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VxdWlya3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXREb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kQ2hhcihkb2N0eXBlc3lzdGVtYnVmLCBjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhZnRlcl9kb2N0eXBlX3N5c3RlbV9pZGVudGlmaWVyX3N0YXRlKGMpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMDk6IC8vICBDSEFSQUNURVIgVEFCVUxBVElPTiAodGFiKQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDAwQTogLy8gIExJTkUgRkVFRCAoTEYpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDBDOiAvLyAgRk9STSBGRUVEIChGRikKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU1BBQ0UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIElnbm9yZSB0aGUgY2hhcmFjdGVyLiAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdERvY3R5cGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlcXVpcmtzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0RG9jdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXItLTsgLy8gcHVzaGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGRhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IGJvZ3VzX2RvY3R5cGVfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBUaGlzIGRvZXMgKm5vdCogc2V0IHRoZSBET0NUWVBFIHRva2VuJ3MgZm9yY2UtcXVpcmtzIGZsYWcuICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYm9ndXNfZG9jdHlwZV9zdGF0ZShjKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMDNFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEdSRUFURVItVEhBTiBTSUdOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdERvY3R5cGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXREb2N0eXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhci0tOyAvLyBwdXNoYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogSWdub3JlIHRoZSBjaGFyYWN0ZXIuICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gY2RhdGFfc2VjdGlvbl9zdGF0ZShjLCBsb29rYWhlYWQsIGVvZikgewogICAgICAgICAgICAgICAgICAgIHZhciBsZW4gPSBsb29rYWhlYWQubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIHZhciBvdXRwdXQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVvZikgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhciArPSBsZW4gLSAxOyAvLyBsZWF2ZSB0aGUgRU9GIGluIHRoZSBzY2FubmVyCiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IHN1YnN0cmluZyhsb29rYWhlYWQsIDAsIGxlbiAtIDEpOyAvLyBkb24ndCBpbmNsdWRlIHRoZSBFT0YKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhciArPSBsZW47CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IHN1YnN0cmluZyhsb29rYWhlYWQsIDAsIGxlbiAtIDMpOyAvLyBkb24ndCBlbWl0IHRoZSBdXT4KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChvdXRwdXQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAob3V0cHV0LmluZGV4T2YoIlx1MDAwMCIpICE9PSAtMSkgdGV4dEluY2x1ZGVzTlVMID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWCBIYXZlIHRvIGRlYWwgd2l0aCBDUiBhbmQgQ1JMRiBoZXJlPwogICAgICAgICAgICAgICAgICAgICAgICBpZiAob3V0cHV0LmluZGV4T2YoIlxyIikgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSBvdXRwdXQucmVwbGFjZSgvXHJcbi8sICJcbiIpLnJlcGxhY2UoL1xyLywgIlxuIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGVtaXRDaGFyU3RyaW5nKG91dHB1dCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIgPSBkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2RhdGFfc2VjdGlvbl9zdGF0ZS5sb29rYWhlYWQgPSAiXV0+IjsKCiAgICAgICAgICAgICAgICAvKioqCiAgICAgICAgICAgICAgICAgKiBUaGUgdHJlZSBidWlsZGVyIGluc2VydGlvbiBtb2RlcwogICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgLy8gMTEuMi41LjQuMSBUaGUgImluaXRpYWwiIGluc2VydGlvbiBtb2RlCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpbml0aWFsX21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBURVhUOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSByZXBsYWNlKHZhbHVlLCBMRUFESU5HV1MsICIiKTsgLy8gSWdub3JlIHNwYWNlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCkgcmV0dXJuOyAvLyBBcmUgd2UgZG9uZT8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBIYW5kbGUgYW55dGhpbmcgbm9uLXNwYWNlIHRleHQgYmVsb3cKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT01NRU5UOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLmFwcGVuZENoaWxkKGRvYy5jcmVhdGVDb21tZW50KHZhbHVlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRE9DVFlQRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHVibGljaWQgPSBhcmczOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN5c3RlbWlkID0gYXJnNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgY29uc3RydWN0b3IgZGlyZWN0bHkgaW5zdGVhZCBvZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW1wbGVtZW50YXRpb24uY3JlYXRlRG9jdW1lbnRUeXBlIGJlY2F1c2UgdGhlIGNyZWF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZnVuY3Rpb24gdGhyb3dzIGVycm9ycyBvbiBpbnZhbGlkIGNoYXJhY3RlcnMsIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgZG9uJ3Qgd2FudCB0aGUgcGFyc2VyIHRvIHRocm93IHRoZW0uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MuYXBwZW5kQ2hpbGQobmV3IGltcGwuRG9jdW1lbnRUeXBlKG5hbWUsIHB1YmxpY2lkLCBzeXN0ZW1pZCkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdGUgdGhhdCB0aGVyZSBpcyBubyBwdWJsaWMgQVBJIGZvciBzZXR0aW5nIHF1aXJrcyBtb2RlIFdlIGNhbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG8gdGhpcyBoZXJlIGJlY2F1c2Ugd2UgaGF2ZSBhY2Nlc3MgdG8gaW1wbGVtZW50YXRpb24gZGV0YWlscwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcmNlX3F1aXJrcyB8fCB0b0xvd2VyQ2FzZShuYW1lKSAhPT0gImh0bWwiIHx8IHRlc3QocXVpcmt5UHVibGljSWRzLCBwdWJsaWNpZCkgfHwgc3lzdGVtaWQgJiYgdG9Mb3dlckNhc2Uoc3lzdGVtaWQpID09PSBxdWlya3lTeXN0ZW1JZCB8fCBzeXN0ZW1pZCA9PT0gdW5kZWZpbmVkICYmIHRlc3QoY29uZGl0aW9uYWxseVF1aXJreVB1YmxpY0lkcywgcHVibGljaWQpKSBkb2MuX3F1aXJrcyA9IHRydWU7ZWxzZSBpZiAodGVzdChsaW1pdGVkUXVpcmt5UHVibGljSWRzLCBwdWJsaWNpZCkgfHwgc3lzdGVtaWQgIT09IHVuZGVmaW5lZCAmJiB0ZXN0KGNvbmRpdGlvbmFsbHlRdWlya3lQdWJsaWNJZHMsIHB1YmxpY2lkKSkgZG9jLl9saW1pdGVkUXVpcmtzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlciA9IGJlZm9yZV9odG1sX21vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyB0YWdzIG9yIG5vbi13aGl0ZXNwYWNlIHRleHQKICAgICAgICAgICAgICAgICAgICBkb2MuX3F1aXJrcyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gYmVmb3JlX2h0bWxfbW9kZTsKICAgICAgICAgICAgICAgICAgICBwYXJzZXIodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDExLjIuNS40LjIgVGhlICJiZWZvcmUgaHRtbCIgaW5zZXJ0aW9uIG1vZGUKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGJlZm9yZV9odG1sX21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZWx0OwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRFWFQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHJlcGxhY2UodmFsdWUsIExFQURJTkdXUywgIiIpOyAvLyBJZ25vcmUgc3BhY2VzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSByZXR1cm47IC8vIEFyZSB3ZSBkb25lPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIEhhbmRsZSBhbnl0aGluZyBub24tc3BhY2UgdGV4dCBiZWxvdwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERPQ1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBpZ25vcmUgdGhlIHRva2VuICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09NTUVOVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5hcHBlbmRDaGlsZChkb2MuY3JlYXRlQ29tbWVudCh2YWx1ZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gImh0bWwiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWx0ID0gY3JlYXRlSFRNTEVsdCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaChlbHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5hcHBlbmRDaGlsZChlbHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWDogaGFuZGxlIGFwcGxpY2F0aW9uIGNhY2hlIGhlcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBiZWZvcmVfaGVhZF9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVORFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJodG1sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJoZWFkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJib2R5IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJiciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBmYWxsIHRocm91Z2ggb24gdGhlc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIGlnbm9yZSBtb3N0IGVuZCB0YWdzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBBbnl0aGluZyB0aGF0IGRpZG4ndCBnZXQgaGFuZGxlZCBhYm92ZSBpcyBoYW5kbGVkIGxpa2UgdGhpczoKICAgICAgICAgICAgICAgICAgICBlbHQgPSBjcmVhdGVIVE1MRWx0KCJodG1sIiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaChlbHQpOwogICAgICAgICAgICAgICAgICAgIGRvYy5hcHBlbmRDaGlsZChlbHQpOwogICAgICAgICAgICAgICAgICAgIC8vIFhYWDogaGFuZGxlIGFwcGxpY2F0aW9uIGNhY2hlIGhlcmUKICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBiZWZvcmVfaGVhZF9tb2RlOwogICAgICAgICAgICAgICAgICAgIHBhcnNlcih0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gMTEuMi41LjQuMyBUaGUgImJlZm9yZSBoZWFkIiBpbnNlcnRpb24gbW9kZQogICAgICAgICAgICAgICAgZnVuY3Rpb24gYmVmb3JlX2hlYWRfbW9kZSh0LCB2YWx1ZSwgYXJnMywgYXJnNCkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRFWFQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHJlcGxhY2UodmFsdWUsIExFQURJTkdXUywgIiIpOyAvLyBJZ25vcmUgc3BhY2VzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSByZXR1cm47IC8vIEFyZSB3ZSBkb25lPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIEhhbmRsZSBhbnl0aGluZyBub24tc3BhY2UgdGV4dCBiZWxvdwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERPQ1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBpZ25vcmUgdGhlIHRva2VuICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09NTUVOVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydENvbW1lbnQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJodG1sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fYm9keV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImhlYWQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWx0ID0gaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkX2VsZW1lbnRfcG9pbnRlciA9IGVsdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5faGVhZF9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkRUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaHRtbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaGVhZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYm9keSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYnIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIGlnbm9yZSBtb3N0IGVuZCB0YWdzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBJZiBub3QgaGFuZGxlZCBleHBsaWNpdGx5IGFib3ZlCiAgICAgICAgICAgICAgICAgICAgYmVmb3JlX2hlYWRfbW9kZShUQUcsICJoZWFkIiwgbnVsbCk7IC8vIGNyZWF0ZSBhIGhlYWQgdGFnCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsgLy8gdGhlbiB0cnkgYWdhaW4gd2l0aCB0aGlzIHRva2VuCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5faGVhZF9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEVYVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3cyA9IG1hdGNoKHZhbHVlLCBMRUFESU5HV1MpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0VGV4dCh3c1swXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBzdWJzdHJpbmcodmFsdWUsIHdzWzBdLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsgLy8gSGFuZGxlIG5vbi13aGl0ZXNwYWNlIGJlbG93CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09NTUVOVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydENvbW1lbnQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERPQ1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEFHOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImh0bWwiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9ib2R5X21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibWV0YSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1heSBuZWVkIHRvIGNoYW5nZSB0aGUgZW5jb2RpbmcgYmFzZWQgb24gdGhpcyB0YWcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYmFzZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYmFzZWZvbnQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJnc291bmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNvbW1hbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImxpbmsiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRIVE1MRWxlbWVudCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGl0bGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZVJDREFUQSh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJub3NjcmlwdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2NyaXB0aW5nX2VuYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlciA9IGluX2hlYWRfbm9zY3JpcHRfbW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgaWYgc2NyaXB0aW5nIGlzIGVuYWJsZWQuLi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibm9mcmFtZXMiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInN0eWxlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VSYXdUZXh0KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInNjcmlwdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbHQgPSBjcmVhdGVIVE1MRWx0KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWx0Ll9wYXJzZXJfaW5zZXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHQuX2ZvcmNlX2FzeW5jID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmcmFnbWVudCkgZWx0Ll9hbHJlYWR5X3N0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbHVzaFRleHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sudG9wLmFwcGVuZENoaWxkKGVsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goZWx0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gc2NyaXB0X2RhdGFfc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsSW5zZXJ0aW9uTW9kZSA9IHBhcnNlcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gdGV4dF9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaGVhZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gaWdub3JlIGl0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkRUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaGVhZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBhZnRlcl9oZWFkX21vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJib2R5IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJodG1sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJiciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBoYW5kbGUgdGhlc2UgYXQgdGhlIGJvdHRvbSBvZiB0aGUgZnVuY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgYW55IG90aGVyIGVuZCB0YWcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBJZiBub3QgaGFuZGxlZCBhYm92ZQogICAgICAgICAgICAgICAgICAgIGluX2hlYWRfbW9kZShFTkRUQUcsICJoZWFkIiwgbnVsbCk7IC8vIHN5bnRoZXRpYyA8L2hlYWQ+CiAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsgLy8gVGhlbiByZWRvIHRoaXMgb25lCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gMTMuMi41LjQuNSBUaGUgImluIGhlYWQgbm9zY3JpcHQiIGluc2VydGlvbiBtb2RlCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpbl9oZWFkX25vc2NyaXB0X21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBET0NUWVBFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTU1FTlQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9oZWFkX21vZGUodCwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRFWFQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgd3MgPSBtYXRjaCh2YWx1ZSwgTEVBRElOR1dTKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2hlYWRfbW9kZSh0LCB3c1swXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBzdWJzdHJpbmcodmFsdWUsIHdzWzBdLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSByZXR1cm47IC8vIG5vIG1vcmUgdGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIEhhbmRsZSBub24td2hpdGVzcGFjZSBiZWxvdwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJodG1sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fYm9keV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJhc2Vmb250IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJiZ3NvdW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJsaW5rIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJtZXRhIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJub2ZyYW1lcyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAic3R5bGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9oZWFkX21vZGUodCwgdmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaGVhZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibm9zY3JpcHQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkRUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibm9zY3JpcHQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5faGVhZF9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYnIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsgLy8gZ29lcyB0byB0aGUgb3V0ZXIgZGVmYXVsdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gaWdub3JlIG90aGVyIGVuZCB0YWdzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIElmIG5vdCBoYW5kbGVkIGFib3ZlCiAgICAgICAgICAgICAgICAgICAgaW5faGVhZF9ub3NjcmlwdF9tb2RlKEVORFRBRywgIm5vc2NyaXB0IiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhZnRlcl9oZWFkX21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBURVhUOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdzID0gbWF0Y2godmFsdWUsIExFQURJTkdXUyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRUZXh0KHdzWzBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHN1YnN0cmluZyh2YWx1ZSwgd3NbMF0ubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBIYW5kbGUgbm9uLXdoaXRlc3BhY2UgYmVsb3cKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT01NRU5UOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0Q29tbWVudCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRE9DVFlQRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaHRtbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2JvZHlfbW9kZSh0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJib2R5IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFtZXNldF9vayA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBpbl9ib2R5X21vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJmcmFtZXNldCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fZnJhbWVzZXRfbW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJhc2UiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJhc2Vmb250IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJiZ3NvdW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJsaW5rIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJtZXRhIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJub2ZyYW1lcyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAic2NyaXB0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzdHlsZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGl0bGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKGhlYWRfZWxlbWVudF9wb2ludGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5faGVhZF9tb2RlKFRBRywgdmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5yZW1vdmVFbGVtZW50KGhlYWRfZWxlbWVudF9wb2ludGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImhlYWQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkRUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYm9keSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaHRtbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYnIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIGlnbm9yZSBhbnkgb3RoZXIgZW5kIHRhZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBhZnRlcl9oZWFkX21vZGUoVEFHLCAiYm9keSIsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGZyYW1lc2V0X29rID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBwYXJzZXIodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDEzLjIuNS40LjcgVGhlICJpbiBib2R5IiBpbnNlcnRpb24gbW9kZQogICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5fYm9keV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGJvZHksIGksIG5vZGU7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEVYVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0SW5jbHVkZXNOVUwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHJlcGxhY2UodmFsdWUsIE5VTENIQVJTLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgYW55IG5vbi1zcGFjZSBjaGFyYWN0ZXJzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnJhbWVzZXRfb2sgJiYgdGVzdChOT05XUywgdmFsdWUpKSBmcmFtZXNldF9vayA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZlcmVjb25zdHJ1Y3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydFRleHQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERPQ1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09NTUVOVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydENvbW1lbnQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3BQYXJzaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEFHOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImh0bWwiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2ZlckF0dHJpYnV0ZXMoYXJnMywgc3RhY2suZWxlbWVudHNbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYmFzZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYmFzZWZvbnQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJnc291bmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNvbW1hbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImxpbmsiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm1ldGEiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm5vZnJhbWVzIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzY3JpcHQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInN0eWxlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0aXRsZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2hlYWRfbW9kZShUQUcsIHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJvZHkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5ID0gc3RhY2suZWxlbWVudHNbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYm9keSB8fCAhKGJvZHkgaW5zdGFuY2VvZiBpbXBsLkhUTUxCb2R5RWxlbWVudCkpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWVzZXRfb2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmZXJBdHRyaWJ1dGVzKGFyZzMsIGJvZHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZnJhbWVzZXQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZyYW1lc2V0X29rKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkgPSBzdGFjay5lbGVtZW50c1sxXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFib2R5IHx8ICEoYm9keSBpbnN0YW5jZW9mIGltcGwuSFRNTEJvZHlFbGVtZW50KSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm9keS5wYXJlbnROb2RlKSBib2R5LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYm9keSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICghKHN0YWNrLnRvcCBpbnN0YW5jZW9mIGltcGwuSFRNTEh0bWxFbGVtZW50KSkgc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fZnJhbWVzZXRfbW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhZGRyZXNzIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhcnRpY2xlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhc2lkZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYmxvY2txdW90ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2VudGVyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJkZXRhaWxzIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJkaXIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImRpdiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZGwiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImZpZWxkc2V0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJmaWdjYXB0aW9uIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJmaWd1cmUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImZvb3RlciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaGVhZGVyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJoZ3JvdXAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm1lbnUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm5hdiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAib2wiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInNlY3Rpb24iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInN1bW1hcnkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInVsIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLmluQnV0dG9uU2NvcGUoInAiKSkgaW5fYm9keV9tb2RlKEVORFRBRywgInAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImgxIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJoMiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaDMiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImg0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJoNSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaDYiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhY2suaW5CdXR0b25TY29wZSgicCIpKSBpbl9ib2R5X21vZGUoRU5EVEFHLCAicCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhY2sudG9wIGluc3RhbmNlb2YgaW1wbC5IVE1MSGVhZGluZ0VsZW1lbnQpIHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRIVE1MRWxlbWVudCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAicHJlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJsaXN0aW5nIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLmluQnV0dG9uU2NvcGUoInAiKSkgaW5fYm9keV9tb2RlKEVORFRBRywgInAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZ25vcmVfbGluZWZlZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFtZXNldF9vayA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImZvcm0iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybV9lbGVtZW50X3BvaW50ZXIpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLmluQnV0dG9uU2NvcGUoInAiKSkgaW5fYm9keV9tb2RlKEVORFRBRywgInAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybV9lbGVtZW50X3BvaW50ZXIgPSBpbnNlcnRIVE1MRWxlbWVudCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibGkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFtZXNldF9vayA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSBzdGFjay5lbGVtZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IHN0YWNrLmVsZW1lbnRzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUgaW5zdGFuY2VvZiBpbXBsLkhUTUxMSUVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9ib2R5X21vZGUoRU5EVEFHLCAibGkiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0Eobm9kZSwgc3BlY2lhbFNldCkgJiYgIWlzQShub2RlLCBhZGRyZXNzZGl2cFNldCkpIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFjay5pbkJ1dHRvblNjb3BlKCJwIikpIGluX2JvZHlfbW9kZShFTkRUQUcsICJwIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJkZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZHQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFtZXNldF9vayA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSBzdGFjay5lbGVtZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IHN0YWNrLmVsZW1lbnRzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQShub2RlLCBkZGR0U2V0KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2JvZHlfbW9kZShFTkRUQUcsIG5vZGUubG9jYWxOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0Eobm9kZSwgc3BlY2lhbFNldCkgJiYgIWlzQShub2RlLCBhZGRyZXNzZGl2cFNldCkpIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFjay5pbkJ1dHRvblNjb3BlKCJwIikpIGluX2JvZHlfbW9kZShFTkRUQUcsICJwIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJwbGFpbnRleHQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhY2suaW5CdXR0b25TY29wZSgicCIpKSBpbl9ib2R5X21vZGUoRU5EVEFHLCAicCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRIVE1MRWxlbWVudCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuaXplciA9IHBsYWludGV4dF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJidXR0b24iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhY2suaW5TY29wZSgiYnV0dG9uIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2JvZHlfbW9kZShFTkRUQUcsICJidXR0b24iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlcih0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZmVyZWNvbnN0cnVjdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWVzZXRfb2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImEiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlRWxlbWVudCA9IGFmZS5maW5kRWxlbWVudEJ5VGFnKCJhIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmVFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9ib2R5X21vZGUoRU5EVEFHLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZmUucmVtb3ZlKGFjdGl2ZUVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucmVtb3ZlRWxlbWVudChhY3RpdmVFbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYmlnIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb2RlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZm9udCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAicyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAic21hbGwiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInN0cmlrZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAic3Ryb25nIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0dCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZXJlY29uc3RydWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZS5wdXNoKGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibm9iciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZXJlY29uc3RydWN0KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhY2suaW5TY29wZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2JvZHlfbW9kZShFTkRUQUcsIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZXJlY29uc3RydWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZlLnB1c2goaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhcHBsZXQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm1hcnF1ZWUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm9iamVjdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZXJlY29uc3RydWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZlLmluc2VydE1hcmtlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFtZXNldF9vayA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRhYmxlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkb2MuX3F1aXJrcyAmJiBzdGFjay5pbkJ1dHRvblNjb3BlKCJwIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2JvZHlfbW9kZShFTkRUQUcsICJwIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFtZXNldF9vayA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBpbl90YWJsZV9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImFyZWEiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbWJlZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaW1nIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJrZXlnZW4iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIndiciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmZXJlY29uc3RydWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lc2V0X29rID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaW5wdXQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZmVyZWNvbnN0cnVjdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWx0ID0gaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBlbHQuZ2V0QXR0cmlidXRlKCJ0eXBlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHlwZSB8fCB0b0xvd2VyQ2FzZSh0eXBlKSAhPT0gImhpZGRlbiIpIGZyYW1lc2V0X29rID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAicGFyYW0iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInNvdXJjZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidHJhY2siOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRIVE1MRWxlbWVudCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImhyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLmluQnV0dG9uU2NvcGUoInAiKSkgaW5fYm9keV9tb2RlKEVORFRBRywgInAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWVzZXRfb2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJpbWFnZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2JvZHlfbW9kZShUQUcsICJpbWciLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJpc2luZGV4IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm1fZWxlbWVudF9wb2ludGVyKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiBoYW5kbGVJc0luZGV4VGFnKGF0dHJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvbXB0ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmb3JtYXR0cnMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdhdHRycyA9IFtbIm5hbWUiLCAiaXNpbmRleCJdXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXR0cnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IGF0dHJzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhWzBdID09PSAiYWN0aW9uIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKGZvcm1hdHRycywgYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhWzBdID09PSAicHJvbXB0IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHQgPSBhWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYVswXSAhPT0gIm5hbWUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2gobmV3YXR0cnMsIGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGRlZmF1bHQgcHJvbXB0IHByZXN1bWFibHkgbmVlZHMgbG9jYWxpemF0aW9uLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHNwYWNlIGFmdGVyIHRoZSBjb2xvbiBpbiB0aGlzIHByb21wdCBpcyByZXF1aXJlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnkgdGhlIGh0bWw1bGliIHRlc3QgY2FzZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJvbXB0KSBwcm9tcHQgPSAiVGhpcyBpcyBhIHNlYXJjaGFibGUgaW5kZXguICIgKyAiRW50ZXIgc2VhcmNoIGtleXdvcmRzOiAiOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlcihUQUcsICJmb3JtIiwgZm9ybWF0dHJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlcihUQUcsICJociIsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKFRBRywgImxhYmVsIiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIoVEVYVCwgcHJvbXB0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlcihUQUcsICJpbnB1dCIsIG5ld2F0dHJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlcihFTkRUQUcsICJsYWJlbCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKFRBRywgImhyIiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIoRU5EVEFHLCAiZm9ybSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KShhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ZXh0YXJlYSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWdub3JlX2xpbmVmZWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWVzZXRfb2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gcmNkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbEluc2VydGlvbk1vZGUgPSBwYXJzZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlciA9IHRleHRfbW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ4bXAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhY2suaW5CdXR0b25TY29wZSgicCIpKSBpbl9ib2R5X21vZGUoRU5EVEFHLCAicCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZmVyZWNvbnN0cnVjdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFtZXNldF9vayA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZVJhd1RleHQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImlmcmFtZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lc2V0X29rID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlUmF3VGV4dCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibm9lbWJlZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlUmF3VGV4dCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibm9zY3JpcHQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NyaXB0aW5nX2VuYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlUmF3VGV4dCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIFhYWCBPdGhlcndpc2UgdHJlYXQgaXQgYXMgYW55IG90aGVyIG9wZW4gdGFnPwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzZWxlY3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZmVyZWNvbnN0cnVjdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRIVE1MRWxlbWVudCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lc2V0X29rID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIgPT09IGluX3RhYmxlX21vZGUgfHwgcGFyc2VyID09PSBpbl9jYXB0aW9uX21vZGUgfHwgcGFyc2VyID09PSBpbl90YWJsZV9ib2R5X21vZGUgfHwgcGFyc2VyID09PSBpbl9yb3dfbW9kZSB8fCBwYXJzZXIgPT09IGluX2NlbGxfbW9kZSkgcGFyc2VyID0gaW5fc2VsZWN0X2luX3RhYmxlX21vZGU7ZWxzZSBwYXJzZXIgPSBpbl9zZWxlY3RfbW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJvcHRncm91cCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAib3B0aW9uIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLnRvcCBpbnN0YW5jZW9mIGltcGwuSFRNTE9wdGlvbkVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2JvZHlfbW9kZShFTkRUQUcsICJvcHRpb24iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZmVyZWNvbnN0cnVjdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRIVE1MRWxlbWVudCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAicnAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInJ0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLmluU2NvcGUoInJ1YnkiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2suZ2VuZXJhdGVJbXBsaWVkRW5kVGFncygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJtYXRoIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZlcmVjb25zdHJ1Y3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRqdXN0TWF0aE1MQXR0cmlidXRlcyhhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRqdXN0Rm9yZWlnbkF0dHJpYnV0ZXMoYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEZvcmVpZ25FbGVtZW50KHZhbHVlLCBhcmczLCBNQVRITUxfTkFNRVNQQUNFKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZzQpIC8vIHNlbGYtY2xvc2luZyBmbGFnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzdmciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZmVyZWNvbnN0cnVjdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGp1c3RTVkdBdHRyaWJ1dGVzKGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGp1c3RGb3JlaWduQXR0cmlidXRlcyhhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0Rm9yZWlnbkVsZW1lbnQodmFsdWUsIGFyZzMsIFNWR19OQU1FU1BBQ0UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJnNCkgLy8gc2VsZi1jbG9zaW5nIGZsYWcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNhcHRpb24iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNvbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29sZ3JvdXAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImZyYW1lIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJoZWFkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0Ym9keSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRmb290IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0aCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGhlYWQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIHRhYmxlIHRhZ3MgaWYgd2UncmUgbm90IGluX3RhYmxlIG1vZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBhbnkgb3RoZXIgc3RhcnQgdGFnIGhlcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIChhbmQgYWxzbyBub3NjcmlwdCB0YWdzIHdoZW4gc2NyaXB0aW5nIGlzIGRpc2FibGVkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZlcmVjb25zdHJ1Y3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU5EVEFHOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJvZHkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YWNrLmluU2NvcGUoImJvZHkiKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBhZnRlcl9ib2R5X21vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJodG1sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFjay5pblNjb3BlKCJib2R5IikpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gYWZ0ZXJfYm9keV9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIodCwgdmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImFkZHJlc3MiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImFydGljbGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImFzaWRlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJibG9ja3F1b3RlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJidXR0b24iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNlbnRlciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZGV0YWlscyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZGlyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJkaXYiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImRsIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJmaWVsZHNldCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZmlnY2FwdGlvbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZmlndXJlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJmb290ZXIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImhlYWRlciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaGdyb3VwIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJsaXN0aW5nIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJtZW51IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJuYXYiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm9sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJwcmUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInNlY3Rpb24iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInN1bW1hcnkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInVsIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIGlmIHRoZXJlIGlzIG5vdCBhIG1hdGNoaW5nIG9wZW4gdGFnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RhY2suaW5TY29wZSh2YWx1ZSkpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2suZ2VuZXJhdGVJbXBsaWVkRW5kVGFncygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3BUYWcodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImZvcm0iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3BlbmZvcm0gPSBmb3JtX2VsZW1lbnRfcG9pbnRlcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybV9lbGVtZW50X3BvaW50ZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9wZW5mb3JtIHx8ICFzdGFjay5lbGVtZW50SW5TY29wZShvcGVuZm9ybSkpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2suZ2VuZXJhdGVJbXBsaWVkRW5kVGFncygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5yZW1vdmVFbGVtZW50KG9wZW5mb3JtKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJwIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFjay5pbkJ1dHRvblNjb3BlKHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fYm9keV9tb2RlKFRBRywgdmFsdWUsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLmdlbmVyYXRlSW1wbGllZEVuZFRhZ3ModmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucG9wVGFnKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImxpIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFjay5pbkxpc3RJdGVtU2NvcGUodmFsdWUpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLmdlbmVyYXRlSW1wbGllZEVuZFRhZ3ModmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3BUYWcodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImRkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJkdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RhY2suaW5TY29wZSh2YWx1ZSkpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2suZ2VuZXJhdGVJbXBsaWVkRW5kVGFncyh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcFRhZyh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaDEiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImgyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJoMyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaDQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImg1IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJoNiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RhY2suZWxlbWVudFR5cGVJblNjb3BlKGltcGwuSFRNTEhlYWRpbmdFbGVtZW50KSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5nZW5lcmF0ZUltcGxpZWRFbmRUYWdzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcEVsZW1lbnRUeXBlKGltcGwuSFRNTEhlYWRpbmdFbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJiIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJiaWciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNvZGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVtIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJmb250IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJpIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJub2JyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzbWFsbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAic3RyaWtlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzdHJvbmciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInR0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ1IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGFkb3B0aW9uQWdlbmN5KHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgcmV0dXJuOyAvLyBJZiB3ZSBkaWQgc29tZXRoaW5nIHdlJ3JlIGRvbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIEdvIHRvIHRoZSAiYW55IG90aGVyIGVuZCB0YWciIGNhc2UKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYXBwbGV0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJtYXJxdWVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJvYmplY3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YWNrLmluU2NvcGUodmFsdWUpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLmdlbmVyYXRlSW1wbGllZEVuZFRhZ3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucG9wVGFnKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZlLmNsZWFyVG9NYXJrZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJiciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2JvZHlfbW9kZShUQUcsIHZhbHVlLCBudWxsKTsgLy8gVHVybiA8L2JyPiBpbnRvIDxicj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFueSBvdGhlciBlbmQgdGFnIGdvZXMgaGVyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gc3RhY2suZWxlbWVudHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlID0gc3RhY2suZWxlbWVudHNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubG9jYWxOYW1lID09PSB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5nZW5lcmF0ZUltcGxpZWRFbmRUYWdzKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucG9wRWxlbWVudChub2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc0Eobm9kZSwgc3BlY2lhbFNldCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHRleHRfbW9kZSh0LCB2YWx1ZSwgYXJnMywgYXJnNCkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRFWFQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRUZXh0KHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhY2sudG9wIGluc3RhbmNlb2YgaW1wbC5IVE1MU2NyaXB0RWxlbWVudCkgc3RhY2sudG9wLl9hbHJlYWR5X3N0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBvcmlnaW5hbEluc2VydGlvbk1vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIodCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU5EVEFHOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSAic2NyaXB0IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZVNjcmlwdEVuZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBvcmlnaW5hbEluc2VydGlvbk1vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBzaG91bGQgbmV2ZXIgZ2V0IGFueSBvdGhlciB0b2tlbiB0eXBlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpbl90YWJsZV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VHlwZUF0dHIoYXR0cnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBhdHRycy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdHRyc1tpXVswXSA9PT0gInR5cGUiKSByZXR1cm4gdG9Mb3dlckNhc2UoYXR0cnNbaV1bMV0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEVYVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWCB0aGUgdGV4dF9pbnRlZ3JhdGlvbl9tb2RlIHN0dWZmIGlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBqdXN0IGEgaGFjayBJIG1hZGUgdXAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0X2ludGVncmF0aW9uX21vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9ib2R5X21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nX3RhYmxlX3RleHQgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbEluc2VydGlvbk1vZGUgPSBwYXJzZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fdGFibGVfdGV4dF9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlcih0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09NTUVOVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydENvbW1lbnQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERPQ1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEFHOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNhcHRpb24iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5jbGVhclRvQ29udGV4dChpbXBsLkhUTUxUYWJsZUVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZmUuaW5zZXJ0TWFya2VyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fY2FwdGlvbl9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29sZ3JvdXAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5jbGVhclRvQ29udGV4dChpbXBsLkhUTUxUYWJsZUVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRIVE1MRWxlbWVudCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlciA9IGluX2NvbHVtbl9ncm91cF9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fdGFibGVfbW9kZShUQUcsICJjb2xncm91cCIsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGJvZHkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRmb290IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0aGVhZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLmNsZWFyVG9Db250ZXh0KGltcGwuSFRNTFRhYmxlRWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fdGFibGVfYm9keV9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRoIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX3RhYmxlX21vZGUoVEFHLCAidGJvZHkiLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0YWJsZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXBybyA9IHN0YWNrLmluVGFibGVTY29wZSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX3RhYmxlX21vZGUoRU5EVEFHLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBybykgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzdHlsZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAic2NyaXB0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5faGVhZF9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJpbnB1dCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlID0gZ2V0VHlwZUF0dHIoYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlICE9PSAiaGlkZGVuIikgYnJlYWs7IC8vIHRvIHRoZSBhbnl0aGluZyBlbHNlIGNhc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJmb3JtIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm1fZWxlbWVudF9wb2ludGVyKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1fZWxlbWVudF9wb2ludGVyID0gaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU5EVEFHOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRhYmxlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFjay5pblRhYmxlU2NvcGUodmFsdWUpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcFRhZyh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0SW5zZXJ0aW9uTW9kZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYm9keSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2FwdGlvbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb2xncm91cCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaHRtbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGJvZHkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0Zm9vdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGgiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRoZWFkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wUGFyc2luZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgYW55dGhpbmcgZWxzZSBjYXNlCiAgICAgICAgICAgICAgICAgICAgZm9zdGVyX3BhcmVudF9tb2RlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBpbl9ib2R5X21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgIGZvc3Rlcl9wYXJlbnRfbW9kZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGluX3RhYmxlX3RleHRfbW9kZSh0LCB2YWx1ZSwgYXJnMywgYXJnNCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0ID09PSBURVhUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0SW5jbHVkZXNOVUwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcmVwbGFjZSh2YWx1ZSwgTlVMQ0hBUlMsICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHBlbmRpbmdfdGFibGVfdGV4dCwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzID0gam9pbihwZW5kaW5nX3RhYmxlX3RleHQsICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ190YWJsZV90ZXh0Lmxlbmd0aCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXN0KE5PTldTLCBzKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgYW55IG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlcnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgbXVzdCBiZSB0aGUgc2FtZSBjb2RlIGFzIHRoZSAiYW55dGhpbmcgZWxzZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhc2Ugb2YgdGhlIGluX3RhYmxlIG1vZGUgYWJvdmUuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3N0ZXJfcGFyZW50X21vZGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fYm9keV9tb2RlKFRFWFQsIHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9zdGVyX3BhcmVudF9tb2RlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRUZXh0KHMpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlciA9IG9yaWdpbmFsSW5zZXJ0aW9uTW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5fY2FwdGlvbl9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZW5kX2NhcHRpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RhY2suaW5UYWJsZVNjb3BlKCJjYXB0aW9uIikpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2suZ2VuZXJhdGVJbXBsaWVkRW5kVGFncygpOwogICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3BUYWcoImNhcHRpb24iKTsKICAgICAgICAgICAgICAgICAgICAgICAgYWZlLmNsZWFyVG9NYXJrZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fdGFibGVfbW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2FwdGlvbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb2xncm91cCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGJvZHkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0Zm9vdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGgiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRoZWFkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbmRfY2FwdGlvbigpKSBwYXJzZXIodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkRUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2FwdGlvbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZF9jYXB0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0YWJsZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbmRfY2FwdGlvbigpKSBwYXJzZXIodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYm9keSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb2xncm91cCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaHRtbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGJvZHkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0Zm9vdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGgiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRoZWFkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIEFueXRoaW5nIEVsc2UgY2FzZQogICAgICAgICAgICAgICAgICAgIGluX2JvZHlfbW9kZSh0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5fY29sdW1uX2dyb3VwX21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBURVhUOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdzID0gbWF0Y2godmFsdWUsIExFQURJTkdXUyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRUZXh0KHdzWzBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHN1YnN0cmluZyh2YWx1ZSwgd3NbMF0ubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBIYW5kbGUgbm9uLXdoaXRlc3BhY2UgYmVsb3cKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09NTUVOVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydENvbW1lbnQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERPQ1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEFHOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImh0bWwiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9ib2R5X21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU5EVEFHOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNvbGdyb3VwIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLnRvcCBpbnN0YW5jZW9mIGltcGwuSFRNTEh0bWxFbGVtZW50KSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBpbl90YWJsZV9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLnRvcCBpbnN0YW5jZW9mIGltcGwuSFRNTEh0bWxFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFBhcnNpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIEFueXRoaW5nIGVsc2UKICAgICAgICAgICAgICAgICAgICBpZiAoIShzdGFjay50b3AgaW5zdGFuY2VvZiBpbXBsLkhUTUxIdG1sRWxlbWVudCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5fY29sdW1uX2dyb3VwX21vZGUoRU5EVEFHLCAiY29sZ3JvdXAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5fdGFibGVfYm9keV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZW5kc2VjdCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFjay5pblRhYmxlU2NvcGUoInRib2R5IikgJiYgIXN0YWNrLmluVGFibGVTY29wZSgidGhlYWQiKSAmJiAhc3RhY2suaW5UYWJsZVNjb3BlKCJ0Zm9vdCIpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLmNsZWFyVG9Db250ZXh0KGltcGwuSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICBpbl90YWJsZV9ib2R5X21vZGUoRU5EVEFHLCBzdGFjay50b3AubG9jYWxOYW1lLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLmNsZWFyVG9Db250ZXh0KGltcGwuSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRIVE1MRWxlbWVudCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlciA9IGluX3Jvd19tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGgiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fdGFibGVfYm9keV9tb2RlKFRBRywgInRyIiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlcih0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjYXB0aW9uIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb2wiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNvbGdyb3VwIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0Ym9keSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGZvb3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRoZWFkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kc2VjdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkRUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGFibGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRzZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0Ym9keSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGZvb3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRoZWFkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLmluVGFibGVTY29wZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLmNsZWFyVG9Db250ZXh0KGltcGwuSFRNTFRhYmxlU2VjdGlvbkVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBpbl90YWJsZV9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJib2R5IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjYXB0aW9uIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb2wiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNvbGdyb3VwIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJodG1sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGgiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBBbnl0aGluZyBlbHNlOgogICAgICAgICAgICAgICAgICAgIGluX3RhYmxlX21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGluX3Jvd19tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZW5kcm93KCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YWNrLmluVGFibGVTY29wZSgidHIiKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5jbGVhclRvQ29udGV4dChpbXBsLkhUTUxUYWJsZVJvd0VsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fdGFibGVfYm9keV9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0aCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5jbGVhclRvQ29udGV4dChpbXBsLkhUTUxUYWJsZVJvd0VsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRIVE1MRWxlbWVudCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlciA9IGluX2NlbGxfbW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZlLmluc2VydE1hcmtlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2FwdGlvbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb2xncm91cCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGJvZHkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRmb290IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0aGVhZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidHIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5kcm93KCkpIHBhcnNlcih0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVORFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHJvdygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGFibGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5kcm93KCkpIHBhcnNlcih0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0Ym9keSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGZvb3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRoZWFkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLmluVGFibGVTY29wZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX3Jvd19tb2RlKEVORFRBRywgInRyIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJib2R5IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjYXB0aW9uIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb2wiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNvbGdyb3VwIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJodG1sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGgiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGFueXRoaW5nIGVsc2UKICAgICAgICAgICAgICAgICAgICBpbl90YWJsZV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpbl9jZWxsX21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2FwdGlvbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb2xncm91cCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGJvZHkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0Zm9vdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGgiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRoZWFkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFjay5pblRhYmxlU2NvcGUoInRkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2NlbGxfbW9kZShFTkRUQUcsICJ0ZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGFjay5pblRhYmxlU2NvcGUoInRoIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2NlbGxfbW9kZShFTkRUQUcsICJ0aCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkRUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRoIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFjay5pblRhYmxlU2NvcGUodmFsdWUpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLmdlbmVyYXRlSW1wbGllZEVuZFRhZ3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucG9wVGFnKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZlLmNsZWFyVG9NYXJrZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gaW5fcm93X21vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYm9keSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2FwdGlvbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb2xncm91cCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaHRtbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGFibGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRib2R5IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0Zm9vdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGhlYWQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFjay5pblRhYmxlU2NvcGUodmFsdWUpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2NlbGxfbW9kZShFTkRUQUcsIHN0YWNrLmluVGFibGVTY29wZSgidGQiKSA/ICJ0ZCIgOiAidGgiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBhbnl0aGluZyBlbHNlCiAgICAgICAgICAgICAgICAgICAgaW5fYm9keV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpbl9zZWxlY3RfbW9kZSh0LCB2YWx1ZSwgYXJnMywgYXJnNCkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRFWFQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGV4dEluY2x1ZGVzTlVMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSByZXBsYWNlKHZhbHVlLCBOVUxDSEFSUywgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydFRleHQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTU1FTlQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRDb21tZW50KHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBET0NUWVBFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVPRjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3BQYXJzaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEFHOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImh0bWwiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9ib2R5X21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAib3B0aW9uIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLnRvcCBpbnN0YW5jZW9mIGltcGwuSFRNTE9wdGlvbkVsZW1lbnQpIGluX3NlbGVjdF9tb2RlKEVORFRBRywgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRIVE1MRWxlbWVudCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJvcHRncm91cCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFjay50b3AgaW5zdGFuY2VvZiBpbXBsLkhUTUxPcHRpb25FbGVtZW50KSBpbl9zZWxlY3RfbW9kZShFTkRUQUcsICJvcHRpb24iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLnRvcCBpbnN0YW5jZW9mIGltcGwuSFRNTE9wdEdyb3VwRWxlbWVudCkgaW5fc2VsZWN0X21vZGUoRU5EVEFHLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydEhUTUxFbGVtZW50KHZhbHVlLCBhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInNlbGVjdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX3NlbGVjdF9tb2RlKEVORFRBRywgdmFsdWUpOyAvLyB0cmVhdCBpdCBhcyBhIGNsb3NlIHRhZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImlucHV0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJrZXlnZW4iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRleHRhcmVhIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFjay5pblNlbGVjdFNjb3BlKCJzZWxlY3QiKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9zZWxlY3RfbW9kZShFTkRUQUcsICJzZWxlY3QiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzY3JpcHQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9oZWFkX21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkRUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAib3B0Z3JvdXAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhY2sudG9wIGluc3RhbmNlb2YgaW1wbC5IVE1MT3B0aW9uRWxlbWVudCAmJiBzdGFjay5lbGVtZW50c1tzdGFjay5lbGVtZW50cy5sZW5ndGggLSAyXSBpbnN0YW5jZW9mIGltcGwuSFRNTE9wdEdyb3VwRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fc2VsZWN0X21vZGUoRU5EVEFHLCAib3B0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWNrLnRvcCBpbnN0YW5jZW9mIGltcGwuSFRNTE9wdEdyb3VwRWxlbWVudCkgc3RhY2sucG9wKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm9wdGlvbiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFjay50b3AgaW5zdGFuY2VvZiBpbXBsLkhUTUxPcHRpb25FbGVtZW50KSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzZWxlY3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YWNrLmluU2VsZWN0U2NvcGUodmFsdWUpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcFRhZyh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0SW5zZXJ0aW9uTW9kZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBhbnl0aGluZyBlbHNlOiBqdXN0IGlnbm9yZSB0aGUgdG9rZW4KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpbl9zZWxlY3RfaW5fdGFibGVfbW9kZSh0LCB2YWx1ZSwgYXJnMywgYXJnNCkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2FwdGlvbiI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRhYmxlIjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidGJvZHkiOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0Zm9vdCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRoZWFkIjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidHIiOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0ZCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRoIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEFHOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9zZWxlY3RfaW5fdGFibGVfbW9kZShFTkRUQUcsICJzZWxlY3QiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU5EVEFHOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhY2suaW5UYWJsZVNjb3BlKHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fc2VsZWN0X2luX3RhYmxlX21vZGUoRU5EVEFHLCAic2VsZWN0Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGFueXRoaW5nIGVsc2UKICAgICAgICAgICAgICAgICAgICBpbl9zZWxlY3RfbW9kZSh0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYWZ0ZXJfYm9keV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEVYVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGFueSBub24tc3BhY2UgY2hhcnMsIGhhbmRsZSBiZWxvdwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRlc3QoTk9OV1MsIHZhbHVlKSkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9ib2R5X21vZGUodCwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTU1FTlQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBcHBlbmQgaXQgdG8gdGhlIDxodG1sPiBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5lbGVtZW50c1swXS5hcHBlbmRDaGlsZChkb2MuY3JlYXRlQ29tbWVudCh2YWx1ZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERPQ1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFBhcnNpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09ICJodG1sIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2JvZHlfbW9kZSh0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIGZvciBhbnkgb3RoZXIgdGFncwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVORFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gImh0bWwiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZyYWdtZW50KSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gYWZ0ZXJfYWZ0ZXJfYm9keV9tb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBmb3IgYW55IG90aGVyIHRhZ3MKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGFueXRoaW5nIGVsc2UKICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBpbl9ib2R5X21vZGU7CiAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpbl9mcmFtZXNldF9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEVYVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZSBhbnkgbm9uLXNwYWNlIGNoYXJhY3RlcnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcmVwbGFjZSh2YWx1ZSwgQUxMTk9OV1MsICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAwKSBpbnNlcnRUZXh0KHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT01NRU5UOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0Q29tbWVudCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRE9DVFlQRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wUGFyc2luZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJodG1sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fYm9keV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImZyYW1lc2V0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0SFRNTEVsZW1lbnQodmFsdWUsIGFyZzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZnJhbWUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRIVE1MRWxlbWVudCh2YWx1ZSwgYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibm9mcmFtZXMiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9oZWFkX21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkRUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09ICJmcmFtZXNldCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnJhZ21lbnQgJiYgc3RhY2sudG9wIGluc3RhbmNlb2YgaW1wbC5IVE1MSHRtbEVsZW1lbnQpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZyYWdtZW50ICYmICEoc3RhY2sudG9wIGluc3RhbmNlb2YgaW1wbC5IVE1MRnJhbWVTZXRFbGVtZW50KSkgcGFyc2VyID0gYWZ0ZXJfZnJhbWVzZXRfbW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBhbnl0aGluZyBlbHNlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYWZ0ZXJfZnJhbWVzZXRfbW9kZSh0LCB2YWx1ZSwgYXJnMywgYXJnNCkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRFWFQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgYW55IG5vbi1zcGFjZSBjaGFyYWN0ZXJzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHJlcGxhY2UodmFsdWUsIEFMTE5PTldTLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gMCkgaW5zZXJ0VGV4dCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQ09NTUVOVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydENvbW1lbnQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERPQ1RZUEU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFBhcnNpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaHRtbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2JvZHlfbW9kZSh0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJub2ZyYW1lcyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2hlYWRfbW9kZSh0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVORFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gImh0bWwiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyID0gYWZ0ZXJfYWZ0ZXJfZnJhbWVzZXRfbW9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBhbnl0aGluZyBlbHNlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZnVuY3Rpb24gYWZ0ZXJfYWZ0ZXJfYm9keV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEVYVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGFueSBub24tc3BhY2UgY2hhcnMsIGhhbmRsZSBiZWxvdwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRlc3QoTk9OV1MsIHZhbHVlKSkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9ib2R5X21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTU1FTlQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MuYXBwZW5kQ2hpbGQoZG9jLmNyZWF0ZUNvbW1lbnQodmFsdWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBET0NUWVBFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fYm9keV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wUGFyc2luZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gImh0bWwiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fYm9keV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGFueXRoaW5nIGVsc2UKICAgICAgICAgICAgICAgICAgICBwYXJzZXIgPSBpbl9ib2R5X21vZGU7CiAgICAgICAgICAgICAgICAgICAgcGFyc2VyKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhZnRlcl9hZnRlcl9mcmFtZXNldF9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEVYVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZSBhbnkgbm9uLXNwYWNlIGNoYXJhY3RlcnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcmVwbGFjZSh2YWx1ZSwgQUxMTk9OV1MsICIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAwKSBpbl9ib2R5X21vZGUodCwgdmFsdWUsIGFyZzMsIGFyZzQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIENPTU1FTlQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MuYXBwZW5kQ2hpbGQoZG9jLmNyZWF0ZUNvbW1lbnQodmFsdWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBET0NUWVBFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fYm9keV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wUGFyc2luZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJodG1sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5fYm9keV9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm5vZnJhbWVzIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5faGVhZF9tb2RlKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgYW55dGhpbmcgZWxzZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDEzLjIuNS41IFRoZSBydWxlcyBmb3IgcGFyc2luZyB0b2tlbnMgaW4gZm9yZWlnbiBjb250ZW50CiAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBsaWtlIG9uZSBvZiB0aGUgaW5zZXJ0aW9uIG1vZGVzIGFib3ZlLCBidXQgaXMKICAgICAgICAgICAgICAgIC8vIGludm9rZWQgc29tZXdoYXQgZGlmZmVyZW50bHkgd2hlbiB0aGUgY3VycmVudCB0b2tlbiBpcyBub3QgSFRNTC4KICAgICAgICAgICAgICAgIC8vIFNlZSB0aGUgaW5zZXJ0VG9rZW4oKSBmdW5jdGlvbi4KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGluc2VydEZvcmVpZ25Ub2tlbih0LCB2YWx1ZSwgYXJnMywgYXJnNCkgewogICAgICAgICAgICAgICAgICAgIC8vIEEgPGZvbnQ+IHRhZyBpcyBhbiBIVE1MIGZvbnQgdGFnIGlmIGl0IGhhcyBhIGNvbG9yLCBmb250LCBvciBzaXplCiAgICAgICAgICAgICAgICAgICAgLy8gYXR0cmlidXRlLiAgT3RoZXJ3aXNlIHdlIGFzc3VtZSBpdCBpcyBmb3JlaWduIGNvbnRlbnQKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBpc0hUTUxGb250KGF0dHJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gYXR0cnMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGF0dHJzW2ldWzBdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY29sb3IiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImZvbnQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInNpemUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudDsKCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEVYVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGFueSBub24tc3BhY2UsIG5vbi1udWwgY2hhcmFjdGVycwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZyYW1lc2V0X29rICYmIHRlc3QoTk9OV1NOT05OVUwsIHZhbHVlKSkgZnJhbWVzZXRfb2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0SW5jbHVkZXNOVUwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHJlcGxhY2UodmFsdWUsIE5VTENIQVJTLCAiXHVGRkZEIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRUZXh0KHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT01NRU5UOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0Q29tbWVudCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRE9DVFlQRToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBpdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJmb250IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0hUTUxGb250KGFyZzMpKSBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYmlnIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJibG9ja3F1b3RlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJib2R5IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJiciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2VudGVyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjb2RlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJkZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZGl2IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJkbCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZHQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVtIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbWJlZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaDEiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImgyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJoMyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaDQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImg1IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJoNiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaGVhZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaHIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImltZyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibGkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImxpc3RpbmciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm1lbnUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm1ldGEiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm5vYnIiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm9sIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJwIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJwcmUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInJ1YnkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInMiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInNtYWxsIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzcGFuIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzdHJvbmciOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInN0cmlrZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAic3ViIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzdXAiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInRhYmxlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ0dCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidWwiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInZhciI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9IHN0YWNrLnRvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoY3VycmVudC5uYW1lc3BhY2VVUkkgIT09IEhUTUxfTkFNRVNQQUNFICYmICFpc01hdGhtbFRleHRJbnRlZ3JhdGlvblBvaW50KGN1cnJlbnQpICYmICFpc0hUTUxJbnRlZ3JhdGlvblBvaW50KGN1cnJlbnQpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydFRva2VuKHQsIHZhbHVlLCBhcmczLCBhcmc0KTsgLy8gcmVwcm9jZXNzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBbnkgb3RoZXIgc3RhcnQgdGFnIGNhc2UgZ29lcyBoZXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gc3RhY2sudG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQubmFtZXNwYWNlVVJJID09PSBNQVRITUxfTkFNRVNQQUNFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRqdXN0TWF0aE1MQXR0cmlidXRlcyhhcmczKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudC5uYW1lc3BhY2VVUkkgPT09IFNWR19OQU1FU1BBQ0UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGFkanVzdFNWR1RhZ05hbWUodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkanVzdFNWR0F0dHJpYnV0ZXMoYXJnMyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGp1c3RGb3JlaWduQXR0cmlidXRlcyhhcmczKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRGb3JlaWduRWxlbWVudCh2YWx1ZSwgYXJnMywgY3VycmVudC5uYW1lc3BhY2VVUkkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZzQpIC8vIHRoZSBzZWxmLWNsb3NpbmcgZmxhZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkRUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gc3RhY2sudG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSAic2NyaXB0IiAmJiBjdXJyZW50Lm5hbWVzcGFjZVVSSSA9PT0gU1ZHX05BTUVTUEFDRSAmJiBjdXJyZW50LmxvY2FsTmFtZSA9PT0gInNjcmlwdCIpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlYWwgd2l0aCBTVkcgc2NyaXB0cyBoZXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhbnkgb3RoZXIgZW5kIHRhZyBjYXNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBzdGFjay5lbGVtZW50cy5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub2RlID0gc3RhY2suZWxlbWVudHNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg7OykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9Mb3dlckNhc2Uobm9kZS5sb2NhbE5hbWUpID09PSB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucG9wRWxlbWVudChub2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBzdGFjay5lbGVtZW50c1stLWldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBub24taHRtbCwga2VlcCBsb29waW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLm5hbWVzcGFjZVVSSSAhPT0gSFRNTF9OQU1FU1BBQ0UpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UgcHJvY2VzcyB0aGUgZW5kIHRhZyBhcyBodG1sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlcih0LCB2YWx1ZSwgYXJnMywgYXJnNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLyoqKgogICAgICAgICAgICAgICAgICogcGFyc2luZyBjb2RlIGZvciBjaGFyYWN0ZXIgcmVmZXJlbmNlcwogICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgLy8gUGFyc2UgYSBjaGFyYWN0ZXIgcmVmZXJlbmNlIGZyb20gcyBhbmQgcmV0dXJuIGEgY29kZXBvaW50IG9yIGFuCiAgICAgICAgICAgICAgICAvLyBhcnJheSBvZiBjb2RlcG9pbnRzIG9yIG51bGwgaWYgdGhlcmUgaXMgbm8gdmFsaWQgY2hhciByZWYgaW4gcy4KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlQ2hhclJlZihzLCBpc2F0dHIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbGVuID0gcy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJ2OwogICAgICAgICAgICAgICAgICAgIGlmIChsZW4gPT09IDApIHJldHVybiBudWxsOyAvLyBObyBjaGFyYWN0ZXIgcmVmZXJlbmNlIG1hdGNoZWQKCiAgICAgICAgICAgICAgICAgICAgaWYgKHNbMF0gPT09ICIjIikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBOdW1lcmljIGNoYXJhY3RlciByZWZlcmVuY2UKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvZGVwb2ludDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzWzFdID09PSAieCIgfHwgc1sxXSA9PT0gIlgiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIZXgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVwb2ludCA9IHBhcnNlSW50KHN1YnN0cmluZyhzLCAyKSwgMTYpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVjaW1hbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZXBvaW50ID0gcGFyc2VJbnQoc3Vic3RyaW5nKHMsIDEpLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzW2xlbiAtIDFdID09PSAiOyIpIC8vIElmIHRoZSBzdHJpbmcgZW5kcyB3aXRoIGEgc2VtaWNvbG9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhciArPSBsZW47IC8vIENvbnN1bWUgYWxsIHRoZSBjaGFycwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIG5leHRjaGFyICs9IGxlbiAtIDE7IC8vIE90aGVyd2lzZSwgYWxsIGJ1dCB0aGUgbGFzdCBjaGFyYWN0ZXIKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2RlcG9pbnQgaW4gbnVtZXJpY0NoYXJSZWZSZXBsYWNlbWVudHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVwb2ludCA9IG51bWVyaWNDaGFyUmVmUmVwbGFjZW1lbnRzW2NvZGVwb2ludF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29kZXBvaW50ID4gMHgxMEZGRkYgfHwgY29kZXBvaW50ID49IDB4RDgwMCAmJiBjb2RlcG9pbnQgPCAweEUwMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVwb2ludCA9IDB4RkZGRDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvZGVwb2ludCA8PSAweEZGRkYpIHJldHVybiBjb2RlcG9pbnQ7CgogICAgICAgICAgICAgICAgICAgICAgICBjb2RlcG9pbnQgPSBjb2RlcG9pbnQgLSAweDEwMDAwOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzB4RDgwMCArIChjb2RlcG9pbnQgPj4gMTApLCAweERDMDAgKyAoY29kZXBvaW50ICYgMHgwM0ZGKV07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gTmFtZWQgY2hhcmFjdGVyIHJlZmVyZW5jZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHRvIGJlIGFibGUgdG8gcGFyc2Ugc29tZSBuYW1lZCBjaGFyIHJlZnMgZXZlbiB3aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzZW1pY29sb24gaXMgb21pdHRlZCwgYnV0IGhhdmUgdG8gbWF0Y2ggdGhlIGxvbmdlc3Qgb25lCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBvc3NpYmxlLiAgU28gaWYgdGhlIGxvb2thaGVhZCBkb2Vzbid0IGVuZCB3aXRoIHNlbWljb2xvbgogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGVuIHdlIGhhdmUgdG8gbG9vcCBiYWNrd2FyZCBsb29raW5nIGZvciBsb25nZXN0IHRvIHNob3J0ZXN0CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1hdGNoZXMuICBGb3J0dW5hdGVseSwgdGhlIG5hbWVzIHRoYXQgZG9uJ3QgcmVxdWlyZSBzZW1pcwogICAgICAgICAgICAgICAgICAgICAgICAvLyBhcmUgYWxsIGJldHdlZW4gMiBhbmQgNiBjaGFyYWN0ZXJzIGxvbmcuCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc1tsZW4gLSAxXSA9PT0gIjsiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydiA9IG5hbWVkQ2hhclJlZnNbc107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocnYgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRjaGFyICs9IGxlbjsgLy8gY29uc3VtZSBhbGwgdGhlIGNoYXJhY3RlcnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcnY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGl0IGRpZG4ndCBlbmQgd2l0aCBhIHNlbWljb2xvbiwgc2VlIGlmIHdlIGNhbiBtYXRjaAogICAgICAgICAgICAgICAgICAgICAgICAvLyBldmVyeXRoaW5nIGJ1dCB0aGUgdGVybWluYXRpbmcgY2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGxlbi0tOyAvLyBJZ25vcmUgd2hhdGV2ZXIgdGhlIHRlcm1pbmF0aW5nIGNoYXJhY3RlciBpcwogICAgICAgICAgICAgICAgICAgICAgICBydiA9IG5hbWVkQ2hhclJlZnNOb1NlbWlbc3Vic3RyaW5nKHMsIDAsIGxlbildOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocnYgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dGNoYXIgKz0gbGVuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJ2OwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBpdCBzdGlsbCBkaWRuJ3QgbWF0Y2gsIGFuZCB3ZSdyZSBub3QgcGFyc2luZyBhCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoYXJhY3RlciByZWZlcmVuY2UgaW4gYW4gYXR0cmlidXRlIHZhbHVlLCB0aGVuIHRyeQogICAgICAgICAgICAgICAgICAgICAgICAvLyBtYXRjaGluZyBzaG9ydGVyIHN1YnN0cmluZ3MuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNhdHRyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4tLTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZW4gPiA2KSBsZW4gPSA2OyAvLyBNYXhpbXVtIHBvc3NpYmxlIG1hdGNoIGxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGxlbiA+PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnYgPSBuYW1lZENoYXJSZWZzTm9TZW1pW3N1YnN0cmluZyhzLCAwLCBsZW4pXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocnYgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0Y2hhciArPSBsZW47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBydjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuLS07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvdWxkbid0IGZpbmQgYW55IG1hdGNoCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvKioqCiAgICAgICAgICAgICAgICAgKiBGaW5hbGx5LCB0aGlzIGlzIHRoZSBlbmQgb2YgdGhlIEhUTUxQYXJzZXIoKSBmYWN0b3J5IGZ1bmN0aW9uLgogICAgICAgICAgICAgICAgICogSXQgcmV0dXJucyB0aGUgaHRtbHBhcnNlciBvYmplY3Qgd2l0aCB0aGUgYXBwZW5kKCkgYW5kIGVuZCgpIG1ldGhvZHMuCiAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAvLyBTbmVhayBhbm90aGVyIG1ldGhvZCBpbnRvIHRoZSBodG1scGFyc2VyIG9iamVjdCB0byBhbGxvdyB1cyB0byBydW4KICAgICAgICAgICAgICAgIC8vIHRva2VuaXplciB0ZXN0cy4gIFRoaXMgY2FuIGJlIGNvbW1lbnRlZCBvdXQgaW4gcHJvZHVjdGlvbiBjb2RlLgogICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIGhvb2sgZm9yIHRlc3RpbmcgdGhlIHRva2VuaXplci4gSXQgaGFzIHRvIGJlIGhlcmUKICAgICAgICAgICAgICAgIC8vIGJlY2F1c2UgdGhlIHRva2VuaXplciBkZXRhaWxzIGFyZSBhbGwgaGlkZGVuIGF3YXkgd2l0aGluIHRoZSBjbG9zdXJlLgogICAgICAgICAgICAgICAgLy8gSXQgc2hvdWxkIHJldHVybiBhbiBhcnJheSBvZiB0b2tlbnMgZ2VuZXJhdGVkIHdoaWxlIHBhcnNpbmcgdGhlCiAgICAgICAgICAgICAgICAvLyBpbnB1dCBzdHJpbmcuCiAgICAgICAgICAgICAgICBodG1scGFyc2VyLnRlc3RUb2tlbml6ZXIgPSBmdW5jdGlvbiAoaW5wdXQsIGluaXRpYWxTdGF0ZSwgbGFzdFN0YXJ0VGFnLCBjaGFyYnljaGFyKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VucyA9IFtdOwoKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGluaXRpYWxTdGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJQQ0RBVEEgc3RhdGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gZGF0YV9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJSQ0RBVEEgc3RhdGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gcmNkYXRhX3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIlJBV1RFWFQgc3RhdGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gcmF3dGV4dF9zdGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJQTEFJTlRFWFQgc3RhdGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyID0gcGxhaW50ZXh0X3N0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAobGFzdFN0YXJ0VGFnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3R0YWduYW1lID0gbGFzdFN0YXJ0VGFnOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0VG9rZW4gPSBmdW5jdGlvbiAodCwgdmFsdWUsIGFyZzMsIGFyZzQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmx1c2hUZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBURVhUOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbnMubGVuZ3RoID4gMCAmJiB0b2tlbnNbdG9rZW5zLmxlbmd0aCAtIDFdWzBdID09PSAiQ2hhcmFjdGVyIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnNbdG9rZW5zLmxlbmd0aCAtIDFdWzFdICs9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBwdXNoKHRva2VucywgWyJDaGFyYWN0ZXIiLCB2YWx1ZV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBDT01NRU5UOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godG9rZW5zLCBbIkNvbW1lbnQiLCB2YWx1ZV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBET0NUWVBFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2godG9rZW5zLCBbIkRPQ1RZUEUiLCB2YWx1ZSwgYXJnMyA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IGFyZzMsIGFyZzQgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBhcmc0LCAhZm9yY2VfcXVpcmtzXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRBRzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0cnMgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZzMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBkb2VzIGF0dHJpYnV0ZSBvcmRlciBtYXR0ZXI/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gYXJnM1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyc1thWzBdXSA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnNbYVswXV0gPSBhWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IFsiU3RhcnRUYWciLCB2YWx1ZSwgYXR0cnNdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmc0KSBwdXNoKHRva2VuLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKHRva2VucywgdG9rZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkRUQUc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCh0b2tlbnMsIFsiRW5kVGFnIiwgdmFsdWVdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRU9GOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFjaGFyYnljaGFyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2UoaW5wdXQsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2UoaW5wdXRbaV0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2UoIiIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9rZW5zOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIHBhcnNlciBvYmplY3QgZnJvbSB0aGUgSFRNTFBhcnNlcigpIGZhY3RvcnkgZnVuY3Rpb24KICAgICAgICAgICAgICAgIHJldHVybiBodG1scGFyc2VyOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBSZXR1cm4gdGhlIEhUTUxQYXJzZXIgZmFjdG9yeSBmdW5jdGlvbiBmcm9tIHRoZSBjb250YWluaW5nCiAgICAgICAgICAgIC8vIGNsb3N1cmUgdGhhdCBob2xkcyBhbGwgdGhlIGRldGFpbHMuCiAgICAgICAgICAgIHJldHVybiBIVE1MUGFyc2VyOwogICAgICAgIH0oKTsKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICAqICBzcmMvaW1wbC9DU1NTdHlsZURlY2xhcmF0aW9uLmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9DU1NTdHlsZURlY2xhcmF0aW9uLmpzIgogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShpbXBsLCAiQ1NTU3R5bGVEZWNsYXJhdGlvbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gQ1NTU3R5bGVEZWNsYXJhdGlvbihlbHQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2VsZW1lbnQgPSBlbHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFV0aWxpdHkgZnVuY3Rpb24gZm9yIHBhcnNpbmcgc3R5bGUgZGVjbGFyYXRpb25zCiAgICAgICAgICAgIC8vIFBhc3MgaW4gYSBzdHJpbmcgbGlrZSAibWFyZ2luLWxlZnQ6IDVweDsgYm9yZGVyLXN0eWxlOiBzb2xpZCIKICAgICAgICAgICAgLy8gYW5kIHRoaXMgZnVuY3Rpb24gcmV0dXJucyBhbiBvYmplY3QgbGlrZQogICAgICAgICAgICAvLyB7Im1hcmdpbi1sZWZ0IjoiNXB4IiwgImJvcmRlci1zdHlsZSI6InNvbGlkIn0KICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2VTdHlsZXMocykgewogICAgICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBwYXJzZXJsaWIuY3NzLlBhcnNlcigpOwogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICAgICAgICAgICAgcGFyc2VyLmFkZExpc3RlbmVyKCJwcm9wZXJ0eSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGUuaW52YWxpZCkgcmV0dXJuOyAvLyBTa2lwIGVycm9ycwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtlLnByb3BlcnR5LnRleHRdID0gZS52YWx1ZS50ZXh0OwogICAgICAgICAgICAgICAgICAgIGlmIChlLmltcG9ydGFudCkgcmVzdWx0LmltcG9ydGFudFtuYW1lXSA9IGUuaW1wb3J0YW50OwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBwYXJzZXIucGFyc2VTdHlsZUF0dHJpYnV0ZShzKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIENTU1N0eWxlRGVjbGFyYXRpb24ucHJvdG90eXBlID0gTy5jcmVhdGUoT2JqZWN0LnByb3RvdHlwZSwgewogICAgICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJDU1NTdHlsZURlY2xhcmF0aW9uIiksCgogICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBwYXJzZWQgZm9ybSBvZiB0aGUgZWxlbWVudCdzIHN0eWxlIGF0dHJpYnV0ZS4KICAgICAgICAgICAgICAgIC8vIElmIHRoZSBlbGVtZW50J3Mgc3R5bGUgYXR0cmlidXRlIGhhcyBuZXZlciBiZWVuIHBhcnNlZAogICAgICAgICAgICAgICAgLy8gb3IgaWYgaXQgaGFzIGNoYW5nZWQgc2luY2UgdGhlIGxhc3QgcGFyc2UsIHRoZW4gcmVwYXJzZSBpdAogICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoZSBzdHlsZXMgZG9uJ3QgZ2V0IHBhcnNlZCB1bnRpbCB0aGV5J3JlIGFjdHVhbGx5IG5lZWRlZAogICAgICAgICAgICAgICAgX3BhcnNlZDogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3BhcnNlZFN0eWxlcyB8fCB0aGlzLmNzc1RleHQgIT09IHRoaXMuX2xhc3RQYXJzZWRUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gdGhpcy5jc3NUZXh0OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJzZWRTdHlsZXMgPSBwYXJzZVN0eWxlcyh0ZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGFzdFBhcnNlZFRleHQgPSB0ZXh0OwogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fbmFtZXM7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJzZWRTdHlsZXM7CiAgICAgICAgICAgICAgICB9KSwKCiAgICAgICAgICAgICAgICAvLyBDYWxsIHRoaXMgbWV0aG9kIGFueSB0aW1lIHRoZSBwYXJzZWQgcmVwcmVzZW50YXRpb24gb2YgdGhlCiAgICAgICAgICAgICAgICAvLyBzdHlsZSBjaGFuZ2VzLiAgSXQgY29udmVydHMgdGhlIHN0eWxlIHByb3BlcnRpZXMgdG8gYSBzdHJpbmcgYW5kCiAgICAgICAgICAgICAgICAvLyBzZXRzIGNzc1RleHQgYW5kIHRoZSBlbGVtZW50J3Mgc3R5bGUgYXR0cmlidXRlCiAgICAgICAgICAgICAgICBfc2VyaWFsaXplOiBjb25zdGFudChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHN0eWxlcyA9IHRoaXMuX3BhcnNlZDsKICAgICAgICAgICAgICAgICAgICB2YXIgcyA9ICIiOwoKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBuYW1lIGluIHN0eWxlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocykgcyArPSAiOyAiOwogICAgICAgICAgICAgICAgICAgICAgICBzICs9IG5hbWUgKyAiOiIgKyBzdHlsZXNbbmFtZV07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB0aGlzLmNzc1RleHQgPSBzOyAvLyBhbHNvIHNldHMgdGhlIHN0eWxlIGF0dHJpYnV0ZQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RQYXJzZWRUZXh0ID0gczsgLy8gc28gd2UgZG9uJ3QgcmVwYXJzZQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9uYW1lczsKICAgICAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgICAgIGNzc1RleHQ6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiB0aGlzIGlzIGEgQ1NTU3R5bGVEZWNsYXJhdGlvbiBmb3IgYW4gZWxlbWVudC4KICAgICAgICAgICAgICAgICAgICAvLyBBIGRpZmZlcmVudCBpbXBsIG1pZ2h0IGJlIG5lY2Vzc2FyeSBmb3IgYSBzZXQgb2Ygc3R5bGVzCiAgICAgICAgICAgICAgICAgICAgLy8gYXNzb2NpYXRlZCByZXR1cm5lZCBieSBnZXRDb21wdXRlZFN0eWxlKCksIGUuZy4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZWxlbWVudC5nZXRBdHRyaWJ1dGUoInN0eWxlIik7CiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBYWFg6IEkgc2hvdWxkIHBhcnNlIGFuZCBzZXJpYWxpemUgdGhlIHZhbHVlIHRvCiAgICAgICAgICAgICAgICAgICAgLy8gbm9ybWFsaXplIGl0IGFuZCByZW1vdmUgZXJyb3JzLiBGRiBhbmQgY2hyb21lIGRvIHRoYXQuCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZWxlbWVudC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgdmFsdWUpOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgbGVuZ3RoOiBhdHRyaWJ1dGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fbmFtZXMpIHRoaXMuX25hbWVzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcy5fcGFyc2VkKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgaXRlbTogY29uc3RhbnQoZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX25hbWVzKSB0aGlzLl9uYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMuX3BhcnNlZCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWVzW25dOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgZ2V0UHJvcGVydHlWYWx1ZTogY29uc3RhbnQoZnVuY3Rpb24gKHByb3BlcnR5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnNlZFt0b0xvd2VyQ2FzZShwcm9wZXJ0eSldOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gWFhYOiBmb3Igbm93IHdlIGlnbm9yZSAhaW1wb3J0YW50IGRlY2xhcmF0aW9ucwogICAgICAgICAgICAgICAgZ2V0UHJvcGVydHlQcmlvcml0eTogY29uc3RhbnQoZnVuY3Rpb24gKHByb3BlcnR5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgLy8gWFhYIHRoZSBwcmlvcml0eSBhcmd1bWVudCBpcyBpZ25vcmVkIGZvciBub3cKICAgICAgICAgICAgICAgIHNldFByb3BlcnR5OiBjb25zdGFudChmdW5jdGlvbiAocHJvcGVydHksIHZhbHVlLCBwcmlvcml0eSkgewogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gdG9Mb3dlckNhc2UocHJvcGVydHkpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVQcm9wZXJ0eShwcm9wZXJ0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFhYWCBhcmUgdGhlcmUgb3RoZXIgbGVnYWwgcHJpb3JpdHkgdmFsdWVzPwogICAgICAgICAgICAgICAgICAgIGlmIChwcmlvcml0eSAhPT0gdW5kZWZpbmVkICYmIHByaW9yaXR5ICE9PSAiaW1wb3J0YW50IikgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICAvLyBXZSBkb24ndCBqdXN0IGFjY2VwdCB0aGUgcHJvcGVydHkgdmFsdWUuICBJbnN0ZWFkCiAgICAgICAgICAgICAgICAgICAgLy8gd2UgcGFyc2UgaXQgdG8gZW5zdXJlIHRoYXQgaXQgaXMgc29tZXRoaW5nIHZhbGlkLgogICAgICAgICAgICAgICAgICAgIC8vIElmIGl0IGNvbnRhaW5zIGEgc2VtaWNvbG9uIGl0IGlzIGludmFsaWQKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuaW5kZXhPZigiOyIpICE9PSAtMSkgcmV0dXJuOwoKICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcHMgPSBwYXJzZVN0eWxlcyhwcm9wZXJ0eSArICI6IiArIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB2YXIgbmV3dmFsdWUgPSBwcm9wc1twcm9wZXJ0eV07CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gdmFsdWUgbm93LCBpdCB3YXNuJ3QgdmFsaWQKICAgICAgICAgICAgICAgICAgICBpZiAoIW5ld3ZhbHVlKSByZXR1cm47CgogICAgICAgICAgICAgICAgICAgIHZhciBzdHlsZXMgPSB0aGlzLl9wYXJzZWQ7CgogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSB2YWx1ZSBkaWRuJ3QgY2hhbmdlLCByZXR1cm4gd2l0aG91dCBkb2luZyBhbnl0aGluZy4KICAgICAgICAgICAgICAgICAgICB2YXIgb2xkdmFsdWUgPSBzdHlsZXNbcHJvcGVydHldOwogICAgICAgICAgICAgICAgICAgIGlmIChuZXd2YWx1ZSA9PT0gb2xkdmFsdWUpIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgc3R5bGVzW3Byb3BlcnR5XSA9IHZhbHVlOwoKICAgICAgICAgICAgICAgICAgICAvLyBTZXJpYWxpemUgYW5kIHVwZGF0ZSBjc3NUZXh0IGFuZCBlbGVtZW50LnN0eWxlIQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlcmlhbGl6ZSgpOwogICAgICAgICAgICAgICAgfSksCgogICAgICAgICAgICAgICAgcmVtb3ZlUHJvcGVydHk6IGNvbnN0YW50KGZ1bmN0aW9uIChwcm9wZXJ0eSkgewogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gdG9Mb3dlckNhc2UocHJvcGVydHkpOwogICAgICAgICAgICAgICAgICAgIHZhciBzdHlsZXMgPSB0aGlzLl9wYXJzZWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5IGluIHN0eWxlcykgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgc3R5bGVzW3Byb3BlcnR5XTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlcmlhbGl6ZSBhbmQgdXBkYXRlIGNzc1RleHQgYW5kIGVsZW1lbnQuc3R5bGUhCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlcmlhbGl6ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFyIGNzc1Byb3BlcnRpZXMgPSB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAiYmFja2dyb3VuZCIsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQXR0YWNobWVudDogImJhY2tncm91bmQtYXR0YWNobWVudCIsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICJiYWNrZ3JvdW5kLWNvbG9yIiwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogImJhY2tncm91bmQtaW1hZ2UiLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiAiYmFja2dyb3VuZC1wb3NpdGlvbiIsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUmVwZWF0OiAiYmFja2dyb3VuZC1yZXBlYXQiLAogICAgICAgICAgICAgICAgYm9yZGVyOiAiYm9yZGVyIiwKICAgICAgICAgICAgICAgIGJvcmRlckNvbGxhcHNlOiAiYm9yZGVyLWNvbGxhcHNlIiwKICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiAiYm9yZGVyLWNvbG9yIiwKICAgICAgICAgICAgICAgIGJvcmRlclNwYWNpbmc6ICJib3JkZXItc3BhY2luZyIsCiAgICAgICAgICAgICAgICBib3JkZXJTdHlsZTogImJvcmRlci1zdHlsZSIsCiAgICAgICAgICAgICAgICBib3JkZXJUb3A6ICJib3JkZXItdG9wIiwKICAgICAgICAgICAgICAgIGJvcmRlclJpZ2h0OiAiYm9yZGVyLXJpZ2h0IiwKICAgICAgICAgICAgICAgIGJvcmRlckJvdHRvbTogImJvcmRlci1ib3R0b20iLAogICAgICAgICAgICAgICAgYm9yZGVyTGVmdDogImJvcmRlci1sZWZ0IiwKICAgICAgICAgICAgICAgIGJvcmRlclRvcENvbG9yOiAiYm9yZGVyLXRvcC1jb2xvciIsCiAgICAgICAgICAgICAgICBib3JkZXJSaWdodENvbG9yOiAiYm9yZGVyLXJpZ2h0LWNvbG9yIiwKICAgICAgICAgICAgICAgIGJvcmRlckJvdHRvbUNvbG9yOiAiYm9yZGVyLWJvdHRvbS1jb2xvciIsCiAgICAgICAgICAgICAgICBib3JkZXJMZWZ0Q29sb3I6ICJib3JkZXItbGVmdC1jb2xvciIsCiAgICAgICAgICAgICAgICBib3JkZXJUb3BTdHlsZTogImJvcmRlci10b3Atc3R5bGUiLAogICAgICAgICAgICAgICAgYm9yZGVyUmlnaHRTdHlsZTogImJvcmRlci1yaWdodC1zdHlsZSIsCiAgICAgICAgICAgICAgICBib3JkZXJCb3R0b21TdHlsZTogImJvcmRlci1ib3R0b20tc3R5bGUiLAogICAgICAgICAgICAgICAgYm9yZGVyTGVmdFN0eWxlOiAiYm9yZGVyLWxlZnQtc3R5bGUiLAogICAgICAgICAgICAgICAgYm9yZGVyVG9wV2lkdGg6ICJib3JkZXItdG9wLXdpZHRoIiwKICAgICAgICAgICAgICAgIGJvcmRlclJpZ2h0V2lkdGg6ICJib3JkZXItcmlnaHQtd2lkdGgiLAogICAgICAgICAgICAgICAgYm9yZGVyQm90dG9tV2lkdGg6ICJib3JkZXItYm90dG9tLXdpZHRoIiwKICAgICAgICAgICAgICAgIGJvcmRlckxlZnRXaWR0aDogImJvcmRlci1sZWZ0LXdpZHRoIiwKICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAiYm9yZGVyLXdpZHRoIiwKICAgICAgICAgICAgICAgIGJvdHRvbTogImJvdHRvbSIsCiAgICAgICAgICAgICAgICBjYXB0aW9uU2lkZTogImNhcHRpb24tc2lkZSIsCiAgICAgICAgICAgICAgICBjbGVhcjogImNsZWFyIiwKICAgICAgICAgICAgICAgIGNsaXA6ICJjbGlwIiwKICAgICAgICAgICAgICAgIGNvbG9yOiAiY29sb3IiLAogICAgICAgICAgICAgICAgY29udGVudDogImNvbnRlbnQiLAogICAgICAgICAgICAgICAgY291bnRlckluY3JlbWVudDogImNvdW50ZXItaW5jcmVtZW50IiwKICAgICAgICAgICAgICAgIGNvdW50ZXJSZXNldDogImNvdW50ZXItcmVzZXQiLAogICAgICAgICAgICAgICAgY3Vyc29yOiAiY3Vyc29yIiwKICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogImRpcmVjdGlvbiIsCiAgICAgICAgICAgICAgICBkaXNwbGF5OiAiZGlzcGxheSIsCiAgICAgICAgICAgICAgICBlbXB0eUNlbGxzOiAiZW1wdHktY2VsbHMiLAogICAgICAgICAgICAgICAgY3NzRmxvYXQ6ICJmbG9hdCIsCiAgICAgICAgICAgICAgICBmb250OiAiZm9udCIsCiAgICAgICAgICAgICAgICBmb250RmFtaWx5OiAiZm9udC1mYW1pbHkiLAogICAgICAgICAgICAgICAgZm9udFNpemU6ICJmb250LXNpemUiLAogICAgICAgICAgICAgICAgZm9udFNpemVBZGp1c3Q6ICJmb250LXNpemUtYWRqdXN0IiwKICAgICAgICAgICAgICAgIGZvbnRTdHJldGNoOiAiZm9udC1zdHJldGNoIiwKICAgICAgICAgICAgICAgIGZvbnRTdHlsZTogImZvbnQtc3R5bGUiLAogICAgICAgICAgICAgICAgZm9udFZhcmlhbnQ6ICJmb250LXZhcmlhbnQiLAogICAgICAgICAgICAgICAgZm9udFdlaWdodDogImZvbnQtd2VpZ2h0IiwKICAgICAgICAgICAgICAgIGhlaWdodDogImhlaWdodCIsCiAgICAgICAgICAgICAgICBsZWZ0OiAibGVmdCIsCiAgICAgICAgICAgICAgICBsZXR0ZXJTcGFjaW5nOiAibGV0dGVyLXNwYWNpbmciLAogICAgICAgICAgICAgICAgbGluZUhlaWdodDogImxpbmUtaGVpZ2h0IiwKICAgICAgICAgICAgICAgIGxpc3RTdHlsZTogImxpc3Qtc3R5bGUiLAogICAgICAgICAgICAgICAgbGlzdFN0eWxlSW1hZ2U6ICJsaXN0LXN0eWxlLWltYWdlIiwKICAgICAgICAgICAgICAgIGxpc3RTdHlsZVBvc2l0aW9uOiAibGlzdC1zdHlsZS1wb3NpdGlvbiIsCiAgICAgICAgICAgICAgICBsaXN0U3R5bGVUeXBlOiAibGlzdC1zdHlsZS10eXBlIiwKICAgICAgICAgICAgICAgIG1hcmdpbjogIm1hcmdpbiIsCiAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6ICJtYXJnaW4tdG9wIiwKICAgICAgICAgICAgICAgIG1hcmdpblJpZ2h0OiAibWFyZ2luLXJpZ2h0IiwKICAgICAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogIm1hcmdpbi1ib3R0b20iLAogICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogIm1hcmdpbi1sZWZ0IiwKICAgICAgICAgICAgICAgIG1hcmtlck9mZnNldDogIm1hcmtlci1vZmZzZXQiLAogICAgICAgICAgICAgICAgbWFya3M6ICJtYXJrcyIsCiAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6ICJtYXgtaGVpZ2h0IiwKICAgICAgICAgICAgICAgIG1heFdpZHRoOiAibWF4LXdpZHRoIiwKICAgICAgICAgICAgICAgIG1pbkhlaWdodDogIm1pbi1oZWlnaHQiLAogICAgICAgICAgICAgICAgbWluV2lkdGg6ICJtaW4td2lkdGgiLAogICAgICAgICAgICAgICAgb3BhY2l0eTogIm9wYWNpdHkiLAogICAgICAgICAgICAgICAgb3JwaGFuczogIm9ycGhhbnMiLAogICAgICAgICAgICAgICAgb3V0bGluZTogIm91dGxpbmUiLAogICAgICAgICAgICAgICAgb3V0bGluZUNvbG9yOiAib3V0bGluZS1jb2xvciIsCiAgICAgICAgICAgICAgICBvdXRsaW5lU3R5bGU6ICJvdXRsaW5lLXN0eWxlIiwKICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogIm91dGxpbmUtd2lkdGgiLAogICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICJvdmVyZmxvdyIsCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAicGFkZGluZyIsCiAgICAgICAgICAgICAgICBwYWRkaW5nVG9wOiAicGFkZGluZy10b3AiLAogICAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0OiAicGFkZGluZy1yaWdodCIsCiAgICAgICAgICAgICAgICBwYWRkaW5nQm90dG9tOiAicGFkZGluZy1ib3R0b20iLAogICAgICAgICAgICAgICAgcGFkZGluZ0xlZnQ6ICJwYWRkaW5nLWxlZnQiLAogICAgICAgICAgICAgICAgcGFnZTogInBhZ2UiLAogICAgICAgICAgICAgICAgcGFnZUJyZWFrQWZ0ZXI6ICJwYWdlLWJyZWFrLWFmdGVyIiwKICAgICAgICAgICAgICAgIHBhZ2VCcmVha0JlZm9yZTogInBhZ2UtYnJlYWstYmVmb3JlIiwKICAgICAgICAgICAgICAgIHBhZ2VCcmVha0luc2lkZTogInBhZ2UtYnJlYWstaW5zaWRlIiwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAicG9zaXRpb24iLAogICAgICAgICAgICAgICAgcXVvdGVzOiAicXVvdGVzIiwKICAgICAgICAgICAgICAgIHJpZ2h0OiAicmlnaHQiLAogICAgICAgICAgICAgICAgc2l6ZTogInNpemUiLAogICAgICAgICAgICAgICAgdGFibGVMYXlvdXQ6ICJ0YWJsZS1sYXlvdXQiLAogICAgICAgICAgICAgICAgdGV4dEFsaWduOiAidGV4dC1hbGlnbiIsCiAgICAgICAgICAgICAgICB0ZXh0RGVjb3JhdGlvbjogInRleHQtZGVjb3JhdGlvbiIsCiAgICAgICAgICAgICAgICB0ZXh0SW5kZW50OiAidGV4dC1pbmRlbnQiLAogICAgICAgICAgICAgICAgdGV4dFNoYWRvdzogInRleHQtc2hhZG93IiwKICAgICAgICAgICAgICAgIHRleHRUcmFuc2Zvcm06ICJ0ZXh0LXRyYW5zZm9ybSIsCiAgICAgICAgICAgICAgICB0b3A6ICJ0b3AiLAogICAgICAgICAgICAgICAgdW5pY29kZUJpZGk6ICJ1bmljb2RlLWJpZGkiLAogICAgICAgICAgICAgICAgdmVydGljYWxBbGlnbjogInZlcnRpY2FsLWFsaWduIiwKICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6ICJ2aXNpYmlsaXR5IiwKICAgICAgICAgICAgICAgIHdoaXRlU3BhY2U6ICJ3aGl0ZS1zcGFjZSIsCiAgICAgICAgICAgICAgICB3aWRvd3M6ICJ3aWRvd3MiLAogICAgICAgICAgICAgICAgd2lkdGg6ICJ3aWR0aCIsCiAgICAgICAgICAgICAgICB3b3JkU3BhY2luZzogIndvcmQtc3BhY2luZyIsCiAgICAgICAgICAgICAgICB6SW5kZXg6ICJ6LWluZGV4IgogICAgICAgICAgICB9OwoKICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBjc3NQcm9wZXJ0aWVzKSBkZWZpbmVTdHlsZVByb3BlcnR5KHByb3ApOwoKICAgICAgICAgICAgZnVuY3Rpb24gZGVmaW5lU3R5bGVQcm9wZXJ0eShqc25hbWUpIHsKICAgICAgICAgICAgICAgIHZhciBjc3NuYW1lID0gY3NzUHJvcGVydGllc1tqc25hbWVdOwogICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENTU1N0eWxlRGVjbGFyYXRpb24ucHJvdG90eXBlLCBqc25hbWUsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UHJvcGVydHlWYWx1ZShjc3NuYW1lKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gIiIgfHwgdmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVQcm9wZXJ0eShjc3NuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWCBIYW5kbGUgaW1wb3J0YW50IGRlY2xhcmF0aW9ucyBoZXJlIQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQcm9wZXJ0eShjc3NuYW1lLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIENTU1N0eWxlRGVjbGFyYXRpb247CiAgICAgICAgfSk7CgogICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgKiAgc3JjL2ltcGwvY3NzcGFyc2VyLmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9jc3NwYXJzZXIuanMiCiAgICAgICAgLyohCiAgICAgICAgUGFyc2VyLUxpYgogICAgICAgIENvcHlyaWdodCAoYykgMjAwOS0yMDExIE5pY2hvbGFzIEMuIFpha2FzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgoKICAgICAgICBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5CiAgICAgICAgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKICAgICAgICBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiAgICAgICAgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAogICAgICAgIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwogICAgICAgIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgogICAgICAgIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCiAgICAgICAgYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCgogICAgICAgIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCiAgICAgICAgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCiAgICAgICAgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCiAgICAgICAgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgogICAgICAgIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCiAgICAgICAgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgogICAgICAgIFRIRSBTT0ZUV0FSRS4KCiAgICAgICAgKi8KICAgICAgICAvKiBCdWlsZCB0aW1lOiAyNS1KdWx5LTIwMTYgMDE6MDk6NTkgKi8KICAgICAgICB2YXIgcGFyc2VybGliID0ge307CiAgICAgICAgKGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBBIGdlbmVyaWMgYmFzZSB0byBpbmhlcml0IGZyb20gZm9yIGFueSBvYmplY3QKICAgICAgICAgICAgICogdGhhdCBuZWVkcyBldmVudCBoYW5kbGluZy4KICAgICAgICAgICAgICogQGNsYXNzIEV2ZW50VGFyZ2V0CiAgICAgICAgICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgZnVuY3Rpb24gRXZlbnRUYXJnZXQoKSB7CgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBUaGUgYXJyYXkgb2YgbGlzdGVuZXJzIGZvciB2YXJpb3VzIGV2ZW50cy4KICAgICAgICAgICAgICAgICAqIEB0eXBlIE9iamVjdAogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IF9saXN0ZW5lcnMKICAgICAgICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVycyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBFdmVudFRhcmdldC5wcm90b3R5cGUgPSB7CgogICAgICAgICAgICAgICAgLy9yZXN0b3JlIGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAgICBjb25zdHJ1Y3RvcjogRXZlbnRUYXJnZXQsCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBBZGRzIGEgbGlzdGVuZXIgZm9yIGEgZ2l2ZW4gZXZlbnQgdHlwZS4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSB0eXBlIG9mIGV2ZW50IHRvIGFkZCBhIGxpc3RlbmVyIGZvci4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGxpc3RlbmVyIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIGV2ZW50IG9jY3Vycy4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge3ZvaWR9CiAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIGFkZExpc3RlbmVyCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIGFkZExpc3RlbmVyOiBmdW5jdGlvbiAodHlwZSwgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2xpc3RlbmVyc1t0eXBlXSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9saXN0ZW5lcnNbdHlwZV0gPSBbXTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBGaXJlcyBhbiBldmVudCBiYXNlZCBvbiB0aGUgcGFzc2VkLWluIG9iamVjdC4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gZXZlbnQgQW4gb2JqZWN0IHdpdGggYXQgbGVhc3QgYSAndHlwZScgYXR0cmlidXRlCiAgICAgICAgICAgICAgICAgKiAgICAgIG9yIGEgc3RyaW5nIGluZGljYXRpbmcgdGhlIGV2ZW50IG5hbWUuCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICAgICAgICAgICAgICogQG1ldGhvZCBmaXJlCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIGZpcmU6IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZXZlbnQgPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQgPSB7IHR5cGU6IGV2ZW50IH07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZXZlbnQudGFyZ2V0ICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldCA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGV2ZW50LnR5cGUgPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFdmVudCBvYmplY3QgbWlzc2luZyAndHlwZScgcHJvcGVydHkuIik7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fbGlzdGVuZXJzW2V2ZW50LnR5cGVdKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAvL2NyZWF0ZSBhIGNvcHkgb2YgdGhlIGFycmF5IGFuZCB1c2UgdGhhdCBzbyBsaXN0ZW5lcnMgY2FuJ3QgY2hhbmUKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyc1tldmVudC50eXBlXS5jb25jYXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGxpc3RlbmVycy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXJzW2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFJlbW92ZXMgYSBsaXN0ZW5lciBmb3IgYSBnaXZlbiBldmVudCB0eXBlLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIHR5cGUgb2YgZXZlbnQgdG8gcmVtb3ZlIGEgbGlzdGVuZXIgZnJvbS4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGxpc3RlbmVyIFRoZSBmdW5jdGlvbiB0byByZW1vdmUgZnJvbSB0aGUgZXZlbnQuCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICAgICAgICAgICAgICogQG1ldGhvZCByZW1vdmVMaXN0ZW5lcgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICByZW1vdmVMaXN0ZW5lcjogZnVuY3Rpb24gKHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2xpc3RlbmVyc1t0eXBlXSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzW3R5cGVdOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbGlzdGVuZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXJzW2ldID09PSBsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RlbmVycy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBDb252ZW5pZW50IHdheSB0byByZWFkIHRocm91Z2ggc3RyaW5ncy4KICAgICAgICAgICAgICogQG5hbWVzcGFjZSBwYXJzZXJsaWIudXRpbAogICAgICAgICAgICAgKiBAY2xhc3MgU3RyaW5nUmVhZGVyCiAgICAgICAgICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUaGUgdGV4dCB0byByZWFkLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgZnVuY3Rpb24gU3RyaW5nUmVhZGVyKHRleHQpIHsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSBpbnB1dCB0ZXh0IHdpdGggbGluZSBlbmRpbmdzIG5vcm1hbGl6ZWQuCiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkgX2lucHV0CiAgICAgICAgICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMuX2lucHV0ID0gdGV4dC5yZXBsYWNlKC9cblxyPy9nLCAiXG4iKTsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSByb3cgZm9yIHRoZSBjaGFyYWN0ZXIgdG8gYmUgcmVhZCBuZXh0LgogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IF9saW5lCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBpbnQKICAgICAgICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMuX2xpbmUgPSAxOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogVGhlIGNvbHVtbiBmb3IgdGhlIGNoYXJhY3RlciB0byBiZSByZWFkIG5leHQuCiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkgX2NvbAogICAgICAgICAgICAgICAgICogQHR5cGUgaW50CiAgICAgICAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB0aGlzLl9jb2wgPSAxOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogVGhlIGluZGV4IG9mIHRoZSBjaGFyYWN0ZXIgaW4gdGhlIGlucHV0IHRvIGJlIHJlYWQgbmV4dC4KICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBfY3Vyc29yCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBpbnQKICAgICAgICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMuX2N1cnNvciA9IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFN0cmluZ1JlYWRlci5wcm90b3R5cGUgPSB7CgogICAgICAgICAgICAgICAgLy9yZXN0b3JlIGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAgICBjb25zdHJ1Y3RvcjogU3RyaW5nUmVhZGVyLAoKICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAgICAgLy8gUG9zaXRpb24gaW5mbwogICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBjb2x1bW4gb2YgdGhlIGNoYXJhY3RlciB0byBiZSByZWFkIG5leHQuCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtpbnR9IFRoZSBjb2x1bW4gb2YgdGhlIGNoYXJhY3RlciB0byBiZSByZWFkIG5leHQuCiAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIGdldENvbAogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBnZXRDb2w6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29sOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFJldHVybnMgdGhlIHJvdyBvZiB0aGUgY2hhcmFjdGVyIHRvIGJlIHJlYWQgbmV4dC4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge2ludH0gVGhlIHJvdyBvZiB0aGUgY2hhcmFjdGVyIHRvIGJlIHJlYWQgbmV4dC4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgZ2V0TGluZQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBnZXRMaW5lOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmU7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogRGV0ZXJtaW5lcyBpZiB5b3UncmUgYXQgdGhlIGVuZCBvZiB0aGUgaW5wdXQuCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtCb29sZWFufSBUcnVlIGlmIHRoZXJlJ3Mgbm8gbW9yZSBpbnB1dCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICAgICAgICAgICAgICogQG1ldGhvZCBlb2YKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgZW9mOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnNvciA9PSB0aGlzLl9pbnB1dC5sZW5ndGg7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAgICAgLy8gQmFzaWMgcmVhZGluZwogICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBSZWFkcyB0aGUgbmV4dCBjaGFyYWN0ZXIgd2l0aG91dCBhZHZhbmNpbmcgdGhlIGN1cnNvci4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBjb3VudCBIb3cgbWFueSBjaGFyYWN0ZXJzIHRvIGxvb2sgYWhlYWQgKGRlZmF1bHQgaXMgMSkuCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFRoZSBuZXh0IGNoYXJhY3RlciBvciBudWxsIGlmIHRoZXJlIGlzIG5vIG5leHQgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQG1ldGhvZCBwZWVrCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHBlZWs6IGZ1bmN0aW9uIChjb3VudCkgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBjb3VudCA9IHR5cGVvZiBjb3VudCA9PSAidW5kZWZpbmVkIiA/IDEgOiBjb3VudDsKCiAgICAgICAgICAgICAgICAgICAgLy9pZiB3ZSdyZSBub3QgYXQgdGhlIGVuZCBvZiB0aGUgaW5wdXQuLi4KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3Vyc29yIDwgdGhpcy5faW5wdXQubGVuZ3RoKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAvL2dldCBjaGFyYWN0ZXIgYW5kIGluY3JlbWVudCBjdXJzb3IgYW5kIGNvbHVtbgogICAgICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5faW5wdXQuY2hhckF0KHRoaXMuX2N1cnNvciArIGNvdW50IC0gMSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYzsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBSZWFkcyB0aGUgbmV4dCBjaGFyYWN0ZXIgZnJvbSB0aGUgaW5wdXQgYW5kIGFkanVzdHMgdGhlIHJvdyBhbmQgY29sdW1uCiAgICAgICAgICAgICAgICAgKiBhY2NvcmRpbmdseS4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge1N0cmluZ30gVGhlIG5leHQgY2hhcmFjdGVyIG9yIG51bGwgaWYgdGhlcmUgaXMgbm8gbmV4dCBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIHJlYWQKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgcmVhZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gbnVsbDsKCiAgICAgICAgICAgICAgICAgICAgLy9pZiB3ZSdyZSBub3QgYXQgdGhlIGVuZCBvZiB0aGUgaW5wdXQuLi4KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3Vyc29yIDwgdGhpcy5faW5wdXQubGVuZ3RoKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAvL2lmIHRoZSBsYXN0IGNoYXJhY3RlciB3YXMgYSBuZXdsaW5lLCBpbmNyZW1lbnQgcm93IGNvdW50CiAgICAgICAgICAgICAgICAgICAgICAgIC8vYW5kIHJlc2V0IGNvbHVtbiBjb3VudAogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5faW5wdXQuY2hhckF0KHRoaXMuX2N1cnNvcikgPT0gIlxuIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGluZSsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29sID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbCsrOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvL2dldCBjaGFyYWN0ZXIgYW5kIGluY3JlbWVudCBjdXJzb3IgYW5kIGNvbHVtbgogICAgICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5faW5wdXQuY2hhckF0KHRoaXMuX2N1cnNvcisrKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBjOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAgICAgICAgIC8vIE1pc2MKICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogU2F2ZXMgdGhlIGN1cnJlbnQgbG9jYXRpb24gc28gaXQgY2FuIGJlIHJldHVybmVkIHRvIGxhdGVyLgogICAgICAgICAgICAgICAgICogQG1ldGhvZCBtYXJrCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBtYXJrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYm9va21hcmsgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvcjogdGhpcy5fY3Vyc29yLAogICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiB0aGlzLl9saW5lLAogICAgICAgICAgICAgICAgICAgICAgICBjb2w6IHRoaXMuX2NvbAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2Jvb2ttYXJrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnNvciA9IHRoaXMuX2Jvb2ttYXJrLmN1cnNvcjsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGluZSA9IHRoaXMuX2Jvb2ttYXJrLmxpbmU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbCA9IHRoaXMuX2Jvb2ttYXJrLmNvbDsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2Jvb2ttYXJrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgICAgICAvLyBBZHZhbmNlZCByZWFkaW5nCiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFJlYWRzIHVwIHRvIGFuZCBpbmNsdWRpbmcgdGhlIGdpdmVuIHN0cmluZy4gVGhyb3dzIGFuIGVycm9yIGlmIHRoYXQKICAgICAgICAgICAgICAgICAqIHN0cmluZyBpcyBub3QgZm91bmQuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gcGF0dGVybiBUaGUgc3RyaW5nIHRvIHJlYWQuCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFRoZSBzdHJpbmcgd2hlbiBpdCBpcyBmb3VuZC4KICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgRXJyb3Igd2hlbiB0aGUgc3RyaW5nIHBhdHRlcm4gaXMgbm90IGZvdW5kLgogICAgICAgICAgICAgICAgICogQG1ldGhvZCByZWFkVG8KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgcmVhZFRvOiBmdW5jdGlvbiAocGF0dGVybikgewoKICAgICAgICAgICAgICAgICAgICB2YXIgYnVmZmVyID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGM7CgogICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICogRmlyc3QsIGJ1ZmZlciBtdXN0IGJlIHRoZSBzYW1lIGxlbmd0aCBhcyB0aGUgcGF0dGVybi4KICAgICAgICAgICAgICAgICAgICAgKiBUaGVuLCBidWZmZXIgbXVzdCBlbmQgd2l0aCB0aGUgcGF0dGVybiBvciBlbHNlIHJlYWNoIHRoZQogICAgICAgICAgICAgICAgICAgICAqIGVuZCBvZiB0aGUgaW5wdXQuCiAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ1ZmZlci5sZW5ndGggPCBwYXR0ZXJuLmxlbmd0aCB8fCBidWZmZXIubGFzdEluZGV4T2YocGF0dGVybikgIT0gYnVmZmVyLmxlbmd0aCAtIHBhdHRlcm4ubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLnJlYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlciArPSBjOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFeHBlY3RlZCBcIiIgKyBwYXR0ZXJuICsgIlwiIGF0IGxpbmUgIiArIHRoaXMuX2xpbmUgKyAiLCBjb2wgIiArIHRoaXMuX2NvbCArICIuIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBidWZmZXI7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogUmVhZHMgY2hhcmFjdGVycyB3aGlsZSBlYWNoIGNoYXJhY3RlciBjYXVzZXMgdGhlIGdpdmVuCiAgICAgICAgICAgICAgICAgKiBmaWx0ZXIgZnVuY3Rpb24gdG8gcmV0dXJuIHRydWUuIFRoZSBmdW5jdGlvbiBpcyBwYXNzZWQKICAgICAgICAgICAgICAgICAqIGluIGVhY2ggY2hhcmFjdGVyIGFuZCBlaXRoZXIgcmV0dXJucyB0cnVlIHRvIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgKiByZWFkaW5nIG9yIGZhbHNlIHRvIHN0b3AuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmaWx0ZXIgVGhlIGZ1bmN0aW9uIHRvIHJlYWQgb24gZWFjaCBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFRoZSBzdHJpbmcgbWFkZSB1cCBvZiBhbGwgY2hhcmFjdGVycyB0aGF0IHBhc3NlZCB0aGUKICAgICAgICAgICAgICAgICAqICAgICAgZmlsdGVyIGNoZWNrLgogICAgICAgICAgICAgICAgICogQG1ldGhvZCByZWFkV2hpbGUKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgcmVhZFdoaWxlOiBmdW5jdGlvbiAoZmlsdGVyKSB7CgogICAgICAgICAgICAgICAgICAgIHZhciBidWZmZXIgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMucmVhZCgpOwoKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYyAhPT0gbnVsbCAmJiBmaWx0ZXIoYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyICs9IGM7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSB0aGlzLnJlYWQoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBidWZmZXI7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogUmVhZHMgY2hhcmFjdGVycyB0aGF0IG1hdGNoIGVpdGhlciB0ZXh0IG9yIGEgcmVndWxhciBleHByZXNzaW9uIGFuZAogICAgICAgICAgICAgICAgICogcmV0dXJucyB0aG9zZSBjaGFyYWN0ZXJzLiBJZiBhIG1hdGNoIGlzIGZvdW5kLCB0aGUgcm93IGFuZCBjb2x1bW4KICAgICAgICAgICAgICAgICAqIGFyZSBhZGp1c3RlZDsgaWYgbm8gbWF0Y2ggaXMgZm91bmQsIHRoZSByZWFkZXIncyBzdGF0ZSBpcyB1bmNoYW5nZWQuCiAgICAgICAgICAgICAgICAgKiByZWFkaW5nIG9yIGZhbHNlIHRvIHN0b3AuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ3xSZWdFeHB9IG1hdGNodGVyIElmIGEgc3RyaW5nLCB0aGVuIHRoZSBsaXRlcmFsIHN0cmluZwogICAgICAgICAgICAgICAgICogICAgICB2YWx1ZSBpcyBzZWFyY2hlZCBmb3IuIElmIGEgcmVndWxhciBleHByZXNzaW9uLCB0aGVuIGFueSBzdHJpbmcKICAgICAgICAgICAgICAgICAqICAgICAgbWF0Y2hpbmcgdGhlIHBhdHRlcm4gaXMgc2VhcmNoIGZvci4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge1N0cmluZ30gVGhlIHN0cmluZyBtYWRlIHVwIG9mIGFsbCBjaGFyYWN0ZXJzIHRoYXQgbWF0Y2hlZCBvcgogICAgICAgICAgICAgICAgICogICAgICBudWxsIGlmIHRoZXJlIHdhcyBubyBtYXRjaC4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgcmVhZE1hdGNoCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHJlYWRNYXRjaDogZnVuY3Rpb24gKG1hdGNoZXIpIHsKCiAgICAgICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IHRoaXMuX2lucHV0LnN1YnN0cmluZyh0aGlzLl9jdXJzb3IpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgIC8vaWYgaXQncyBhIHN0cmluZywganVzdCBkbyBhIHN0cmFpZ2h0IG1hdGNoCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtYXRjaGVyID09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2UuaW5kZXhPZihtYXRjaGVyKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLnJlYWRDb3VudChtYXRjaGVyLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoZXIgaW5zdGFuY2VvZiBSZWdFeHApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoZXIudGVzdChzb3VyY2UpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMucmVhZENvdW50KFJlZ0V4cC5sYXN0TWF0Y2gubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFJlYWRzIGEgZ2l2ZW4gbnVtYmVyIG9mIGNoYXJhY3RlcnMuIElmIHRoZSBlbmQgb2YgdGhlIGlucHV0IGlzIHJlYWNoZWQsCiAgICAgICAgICAgICAgICAgKiBpdCByZWFkcyBvbmx5IHRoZSByZW1haW5pbmcgY2hhcmFjdGVycyBhbmQgZG9lcyBub3QgdGhyb3cgYW4gZXJyb3IuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gY291bnQgVGhlIG51bWJlciBvZiBjaGFyYWN0ZXJzIHRvIHJlYWQuCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFRoZSBzdHJpbmcgbWFkZSB1cCB0aGUgcmVhZCBjaGFyYWN0ZXJzLgogICAgICAgICAgICAgICAgICogQG1ldGhvZCByZWFkQ291bnQKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgcmVhZENvdW50OiBmdW5jdGlvbiAoY291bnQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYnVmZmVyID0gIiI7CgogICAgICAgICAgICAgICAgICAgIHdoaWxlIChjb3VudC0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlciArPSB0aGlzLnJlYWQoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBidWZmZXI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9OwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogVHlwZSB0byB1c2Ugd2hlbiBhIHN5bnRheCBlcnJvciBvY2N1cnMuCiAgICAgICAgICAgICAqIEBjbGFzcyBTeW50YXhFcnJvcgogICAgICAgICAgICAgKiBAbmFtZXNwYWNlIHBhcnNlcmxpYi51dGlsCiAgICAgICAgICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSBUaGUgZXJyb3IgbWVzc2FnZS4KICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IGxpbmUgVGhlIGxpbmUgYXQgd2hpY2ggdGhlIGVycm9yIG9jY3VycmVkLgogICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gY29sIFRoZSBjb2x1bW4gYXQgd2hpY2ggdGhlIGVycm9yIG9jY3VycmVkLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgZnVuY3Rpb24gU3ludGF4RXJyb3IobWVzc2FnZSwgbGluZSwgY29sKSB7CgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBUaGUgY29sdW1uIGF0IHdoaWNoIHRoZSBlcnJvciBvY2N1cnJlZC4KICAgICAgICAgICAgICAgICAqIEB0eXBlIGludAogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IGNvbAogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB0aGlzLmNvbCA9IGNvbDsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSBsaW5lIGF0IHdoaWNoIHRoZSBlcnJvciBvY2N1cnJlZC4KICAgICAgICAgICAgICAgICAqIEB0eXBlIGludAogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IGxpbmUKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdGhpcy5saW5lID0gbGluZTsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSB1bml0LgogICAgICAgICAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkgdGV4dAogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL2luaGVyaXQgZnJvbSBFcnJvcgogICAgICAgICAgICBTeW50YXhFcnJvci5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEJhc2UgdHlwZSB0byByZXByZXNlbnQgYSBzaW5nbGUgc3ludGFjdGljIHVuaXQuCiAgICAgICAgICAgICAqIEBjbGFzcyBTeW50YXhVbml0CiAgICAgICAgICAgICAqIEBuYW1lc3BhY2UgcGFyc2VybGliLnV0aWwKICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IG9mIHRoZSB1bml0LgogICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gbGluZSBUaGUgbGluZSBvZiB0ZXh0IG9uIHdoaWNoIHRoZSB1bml0IHJlc2lkZXMuCiAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBjb2wgVGhlIGNvbHVtbiBvZiB0ZXh0IG9uIHdoaWNoIHRoZSB1bml0IHJlc2lkZXMuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBmdW5jdGlvbiBTeW50YXhVbml0KHRleHQsIGxpbmUsIGNvbCwgdHlwZSkgewoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogVGhlIGNvbHVtbiBvZiB0ZXh0IG9uIHdoaWNoIHRoZSB1bml0IHJlc2lkZXMuCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBpbnQKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBjb2wKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdGhpcy5jb2wgPSBjb2w7CgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBUaGUgbGluZSBvZiB0ZXh0IG9uIHdoaWNoIHRoZSB1bml0IHJlc2lkZXMuCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBpbnQKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBsaW5lCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMubGluZSA9IGxpbmU7CgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBUaGUgdGV4dCByZXByZXNlbnRhdGlvbiBvZiB0aGUgdW5pdC4KICAgICAgICAgICAgICAgICAqIEB0eXBlIFN0cmluZwogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHRleHQKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSB0eXBlIG9mIHN5bnRheCB1bml0LgogICAgICAgICAgICAgICAgICogQHR5cGUgaW50CiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkgdHlwZQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQ3JlYXRlIGEgbmV3IHN5bnRheCB1bml0IGJhc2VkIHNvbGVseSBvbiB0aGUgZ2l2ZW4gdG9rZW4uCiAgICAgICAgICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCBmb3IgY3JlYXRpbmcgYSBuZXcgc3ludGF4IHVuaXQgd2hlbgogICAgICAgICAgICAgKiBpdCByZXByZXNlbnRzIGEgc2luZ2xlIHRva2VuIGluc3RlYWQgb2YgbXVsdGlwbGUuCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB0b2tlbiBUaGUgdG9rZW4gb2JqZWN0IHRvIHJlcHJlc2VudC4KICAgICAgICAgICAgICogQHJldHVybiB7cGFyc2VybGliLnV0aWwuU3ludGF4VW5pdH0gVGhlIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRva2VuLgogICAgICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICAgICAqIEBtZXRob2QgZnJvbVRva2VuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBTeW50YXhVbml0LmZyb21Ub2tlbiA9IGZ1bmN0aW9uICh0b2tlbikgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTeW50YXhVbml0KHRva2VuLnZhbHVlLCB0b2tlbi5zdGFydExpbmUsIHRva2VuLnN0YXJ0Q29sKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIFN5bnRheFVuaXQucHJvdG90eXBlID0gewoKICAgICAgICAgICAgICAgIC8vcmVzdG9yZSBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgICAgY29uc3RydWN0b3I6IFN5bnRheFVuaXQsCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBSZXR1cm5zIHRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSB1bml0LgogICAgICAgICAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgdGV4dCByZXByZXNlbnRhdGlvbiBvZiB0aGUgdW5pdC4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgdmFsdWVPZgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB2YWx1ZU9mOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBSZXR1cm5zIHRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSB1bml0LgogICAgICAgICAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgdGV4dCByZXByZXNlbnRhdGlvbiBvZiB0aGUgdW5pdC4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgdG9TdHJpbmcKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50ZXh0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfTsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEdlbmVyaWMgVG9rZW5TdHJlYW0gcHJvdmlkaW5nIGJhc2UgZnVuY3Rpb25hbGl0eS4KICAgICAgICAgICAgICogQGNsYXNzIFRva2VuU3RyZWFtQmFzZQogICAgICAgICAgICAgKiBAbmFtZXNwYWNlIHBhcnNlcmxpYi51dGlsCiAgICAgICAgICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ3xTdHJpbmdSZWFkZXJ9IGlucHV0IFRoZSB0ZXh0IHRvIHRva2VuaXplIG9yIGEgcmVhZGVyIGZyb20KICAgICAgICAgICAgICogICAgICB3aGljaCB0byByZWFkIHRoZSBpbnB1dC4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIGZ1bmN0aW9uIFRva2VuU3RyZWFtQmFzZShpbnB1dCwgdG9rZW5EYXRhKSB7CgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBUaGUgc3RyaW5nIHJlYWRlciBmb3IgZWFzeSBhY2Nlc3MgdG8gdGhlIHRleHQuCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBTdHJpbmdSZWFkZXIKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBfcmVhZGVyCiAgICAgICAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAvL3RoaXMuX3JlYWRlciA9ICh0eXBlb2YgaW5wdXQgPT0gInN0cmluZyIpID8gbmV3IFN0cmluZ1JlYWRlcihpbnB1dCkgOiBpbnB1dDsKICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRlciA9IGlucHV0ID8gbmV3IFN0cmluZ1JlYWRlcihpbnB1dC50b1N0cmluZygpKSA6IG51bGw7CgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBUb2tlbiBvYmplY3QgZm9yIHRoZSBsYXN0IGNvbnN1bWVkIHRva2VuLgogICAgICAgICAgICAgICAgICogQHR5cGUgVG9rZW4KICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBfdG9rZW4KICAgICAgICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMuX3Rva2VuID0gbnVsbDsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSBhcnJheSBvZiB0b2tlbiBpbmZvcm1hdGlvbi4KICAgICAgICAgICAgICAgICAqIEB0eXBlIEFycmF5CiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkgX3Rva2VuRGF0YQogICAgICAgICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdGhpcy5fdG9rZW5EYXRhID0gdG9rZW5EYXRhOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogTG9va2FoZWFkIHRva2VuIGJ1ZmZlci4KICAgICAgICAgICAgICAgICAqIEB0eXBlIEFycmF5CiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkgX2x0CiAgICAgICAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB0aGlzLl9sdCA9IFtdOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogTG9va2FoZWFkIHRva2VuIGJ1ZmZlciBpbmRleC4KICAgICAgICAgICAgICAgICAqIEB0eXBlIGludAogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IF9sdEluZGV4CiAgICAgICAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB0aGlzLl9sdEluZGV4ID0gMDsKCiAgICAgICAgICAgICAgICB0aGlzLl9sdEluZGV4Q2FjaGUgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEFjY2VwdHMgYW4gYXJyYXkgb2YgdG9rZW4gaW5mb3JtYXRpb24gYW5kIG91dHB1dHMKICAgICAgICAgICAgICogYW4gYXJyYXkgb2YgdG9rZW4gZGF0YSBjb250YWluaW5nIGtleS12YWx1ZSBtYXBwaW5ncwogICAgICAgICAgICAgKiBhbmQgbWF0Y2hpbmcgZnVuY3Rpb25zIHRoYXQgdGhlIFRva2VuU3RyZWFtIG5lZWRzLgogICAgICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSB0b2tlbnMgQW4gYXJyYXkgb2YgdG9rZW4gZGVzY3JpcHRvcnMuCiAgICAgICAgICAgICAqIEByZXR1cm4ge0FycmF5fSBBbiBhcnJheSBvZiBwcm9jZXNzZWQgdG9rZW4gZGF0YS4KICAgICAgICAgICAgICogQG1ldGhvZCBjcmVhdGVUb2tlbkRhdGEKICAgICAgICAgICAgICogQHN0YXRpYwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgVG9rZW5TdHJlYW1CYXNlLmNyZWF0ZVRva2VuRGF0YSA9IGZ1bmN0aW9uICh0b2tlbnMpIHsKCiAgICAgICAgICAgICAgICB2YXIgbmFtZU1hcCA9IFtdLAogICAgICAgICAgICAgICAgICAgIHR5cGVNYXAgPSB7fSwKICAgICAgICAgICAgICAgICAgICB0b2tlbkRhdGEgPSB0b2tlbnMuY29uY2F0KFtdKSwKICAgICAgICAgICAgICAgICAgICBpID0gMCwKICAgICAgICAgICAgICAgICAgICBsZW4gPSB0b2tlbkRhdGEubGVuZ3RoICsgMTsKCiAgICAgICAgICAgICAgICB0b2tlbkRhdGEuVU5LTk9XTiA9IC0xOwogICAgICAgICAgICAgICAgdG9rZW5EYXRhLnVuc2hpZnQoeyBuYW1lOiAiRU9GIiB9KTsKCiAgICAgICAgICAgICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgbmFtZU1hcC5wdXNoKHRva2VuRGF0YVtpXS5uYW1lKTsKICAgICAgICAgICAgICAgICAgICB0b2tlbkRhdGFbdG9rZW5EYXRhW2ldLm5hbWVdID0gaTsKICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5EYXRhW2ldLnRleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZU1hcFt0b2tlbkRhdGFbaV0udGV4dF0gPSBpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0b2tlbkRhdGEubmFtZSA9IGZ1bmN0aW9uICh0dCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBuYW1lTWFwW3R0XTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgdG9rZW5EYXRhLnR5cGUgPSBmdW5jdGlvbiAoYykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlTWFwW2NdOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICByZXR1cm4gdG9rZW5EYXRhOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgVG9rZW5TdHJlYW1CYXNlLnByb3RvdHlwZSA9IHsKCiAgICAgICAgICAgICAgICAvL3Jlc3RvcmUgY29uc3RydWN0b3IKICAgICAgICAgICAgICAgIGNvbnN0cnVjdG9yOiBUb2tlblN0cmVhbUJhc2UsCgogICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgICAgICAvLyBNYXRjaGluZyBtZXRob2RzCiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIERldGVybWluZXMgaWYgdGhlIG5leHQgdG9rZW4gbWF0Y2hlcyB0aGUgZ2l2ZW4gdG9rZW4gdHlwZS4KICAgICAgICAgICAgICAgICAqIElmIHNvLCB0aGF0IHRva2VuIGlzIGNvbnN1bWVkOyBpZiBub3QsIHRoZSB0b2tlbiBpcyBwbGFjZWQKICAgICAgICAgICAgICAgICAqIGJhY2sgb250byB0aGUgdG9rZW4gc3RyZWFtLiBZb3UgY2FuIHBhc3MgaW4gYW55IG51bWJlciBvZgogICAgICAgICAgICAgICAgICogdG9rZW4gdHlwZXMgYW5kIHRoaXMgd2lsbCByZXR1cm4gdHJ1ZSBpZiBhbnkgb2YgdGhlIHRva2VuCiAgICAgICAgICAgICAgICAgKiB0eXBlcyBpcyBmb3VuZC4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fGludFtdfSB0b2tlblR5cGVzIEVpdGhlciBhIHNpbmdsZSB0b2tlbiB0eXBlIG9yIGFuIGFycmF5IG9mCiAgICAgICAgICAgICAgICAgKiAgICAgIHRva2VuIHR5cGVzIHRoYXQgdGhlIG5leHQgdG9rZW4gbWlnaHQgYmUuIElmIGFuIGFycmF5IGlzIHBhc3NlZCwKICAgICAgICAgICAgICAgICAqICAgICAgaXQncyBhc3N1bWVkIHRoYXQgdGhlIHRva2VuIGNhbiBiZSBhbnkgb2YgdGhlc2UuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3ZhcmlhbnR9IGNoYW5uZWwgKE9wdGlvbmFsKSBUaGUgY2hhbm5lbCB0byByZWFkIGZyb20uIElmIG5vdAogICAgICAgICAgICAgICAgICogICAgICBwcm92aWRlZCwgcmVhZHMgZnJvbSB0aGUgZGVmYXVsdCAodW5uYW1lZCkgY2hhbm5lbC4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IFRydWUgaWYgdGhlIHRva2VuIHR5cGUgbWF0Y2hlcywgZmFsc2UgaWYgbm90LgogICAgICAgICAgICAgICAgICogQG1ldGhvZCBtYXRjaAogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBtYXRjaDogZnVuY3Rpb24gKHRva2VuVHlwZXMsIGNoYW5uZWwpIHsKCiAgICAgICAgICAgICAgICAgICAgLy9hbHdheXMgY29udmVydCB0byBhbiBhcnJheSwgbWFrZXMgdGhpbmdzIGVhc2llcgogICAgICAgICAgICAgICAgICAgIGlmICghKHRva2VuVHlwZXMgaW5zdGFuY2VvZiBBcnJheSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5UeXBlcyA9IFt0b2tlblR5cGVzXTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHZhciB0dCA9IHRoaXMuZ2V0KGNoYW5uZWwpLAogICAgICAgICAgICAgICAgICAgICAgICBpID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgbGVuID0gdG9rZW5UeXBlcy5sZW5ndGg7CgogICAgICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgbGVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0dCA9PSB0b2tlblR5cGVzW2krK10pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvL25vIG1hdGNoIGZvdW5kLCBwdXQgdGhlIHRva2VuIGJhY2sKICAgICAgICAgICAgICAgICAgICB0aGlzLnVuZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIERldGVybWluZXMgaWYgdGhlIG5leHQgdG9rZW4gbWF0Y2hlcyB0aGUgZ2l2ZW4gdG9rZW4gdHlwZS4KICAgICAgICAgICAgICAgICAqIElmIHNvLCB0aGF0IHRva2VuIGlzIGNvbnN1bWVkOyBpZiBub3QsIGFuIGVycm9yIGlzIHRocm93bi4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fGludFtdfSB0b2tlblR5cGVzIEVpdGhlciBhIHNpbmdsZSB0b2tlbiB0eXBlIG9yIGFuIGFycmF5IG9mCiAgICAgICAgICAgICAgICAgKiAgICAgIHRva2VuIHR5cGVzIHRoYXQgdGhlIG5leHQgdG9rZW4gc2hvdWxkIGJlLiBJZiBhbiBhcnJheSBpcyBwYXNzZWQsCiAgICAgICAgICAgICAgICAgKiAgICAgIGl0J3MgYXNzdW1lZCB0aGF0IHRoZSB0b2tlbiBtdXN0IGJlIG9uZSBvZiB0aGVzZS4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dmFyaWFudH0gY2hhbm5lbCAoT3B0aW9uYWwpIFRoZSBjaGFubmVsIHRvIHJlYWQgZnJvbS4gSWYgbm90CiAgICAgICAgICAgICAgICAgKiAgICAgIHByb3ZpZGVkLCByZWFkcyBmcm9tIHRoZSBkZWZhdWx0ICh1bm5hbWVkKSBjaGFubmVsLgogICAgICAgICAgICAgICAgICogQHJldHVybiB7dm9pZH0KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgbXVzdE1hdGNoCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIG11c3RNYXRjaDogZnVuY3Rpb24gKHRva2VuVHlwZXMsIGNoYW5uZWwpIHsKCiAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuOwoKICAgICAgICAgICAgICAgICAgICAvL2Fsd2F5cyBjb252ZXJ0IHRvIGFuIGFycmF5LCBtYWtlcyB0aGluZ3MgZWFzaWVyCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodG9rZW5UeXBlcyBpbnN0YW5jZW9mIEFycmF5KSkgewogICAgICAgICAgICAgICAgICAgICAgICB0b2tlblR5cGVzID0gW3Rva2VuVHlwZXNdOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLm1hdGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLkxUKDEpOwogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoIkV4cGVjdGVkICIgKyB0aGlzLl90b2tlbkRhdGFbdG9rZW5UeXBlc1swXV0ubmFtZSArICIgYXQgbGluZSAiICsgdG9rZW4uc3RhcnRMaW5lICsgIiwgY29sICIgKyB0b2tlbi5zdGFydENvbCArICIuIiwgdG9rZW4uc3RhcnRMaW5lLCB0b2tlbi5zdGFydENvbCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAgICAgICAgIC8vIENvbnN1bWluZyBtZXRob2RzCiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIEtlZXBzIHJlYWRpbmcgZnJvbSB0aGUgdG9rZW4gc3RyZWFtIHVudGlsIGVpdGhlciBvbmUgb2YgdGhlIHNwZWNpZmllZAogICAgICAgICAgICAgICAgICogdG9rZW4gdHlwZXMgaXMgZm91bmQgb3IgdW50aWwgdGhlIGVuZCBvZiB0aGUgaW5wdXQgaXMgcmVhY2hlZC4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fGludFtdfSB0b2tlblR5cGVzIEVpdGhlciBhIHNpbmdsZSB0b2tlbiB0eXBlIG9yIGFuIGFycmF5IG9mCiAgICAgICAgICAgICAgICAgKiAgICAgIHRva2VuIHR5cGVzIHRoYXQgdGhlIG5leHQgdG9rZW4gc2hvdWxkIGJlLiBJZiBhbiBhcnJheSBpcyBwYXNzZWQsCiAgICAgICAgICAgICAgICAgKiAgICAgIGl0J3MgYXNzdW1lZCB0aGF0IHRoZSB0b2tlbiBtdXN0IGJlIG9uZSBvZiB0aGVzZS4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7dmFyaWFudH0gY2hhbm5lbCAoT3B0aW9uYWwpIFRoZSBjaGFubmVsIHRvIHJlYWQgZnJvbS4gSWYgbm90CiAgICAgICAgICAgICAgICAgKiAgICAgIHByb3ZpZGVkLCByZWFkcyBmcm9tIHRoZSBkZWZhdWx0ICh1bm5hbWVkKSBjaGFubmVsLgogICAgICAgICAgICAgICAgICogQHJldHVybiB7dm9pZH0KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgYWR2YW5jZQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBhZHZhbmNlOiBmdW5jdGlvbiAodG9rZW5UeXBlcywgY2hhbm5lbCkgewoKICAgICAgICAgICAgICAgICAgICB3aGlsZSAodGhpcy5MQSgwKSAhPSAwICYmICF0aGlzLm1hdGNoKHRva2VuVHlwZXMsIGNoYW5uZWwpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5MQSgwKTsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBDb25zdW1lcyB0aGUgbmV4dCB0b2tlbiBmcm9tIHRoZSB0b2tlbiBzdHJlYW0uCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtpbnR9IFRoZSB0b2tlbiB0eXBlIG9mIHRoZSB0b2tlbiB0aGF0IHdhcyBqdXN0IGNvbnN1bWVkLgogICAgICAgICAgICAgICAgICogQG1ldGhvZCBnZXQKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoY2hhbm5lbCkgewoKICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5JbmZvID0gdGhpcy5fdG9rZW5EYXRhLAogICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSB0aGlzLl9yZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgICBpID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgbGVuID0gdG9rZW5JbmZvLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4sCiAgICAgICAgICAgICAgICAgICAgICAgIGluZm87CgogICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgdGhlIGxvb2thaGVhZCBidWZmZXIgZmlyc3QKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fbHQubGVuZ3RoICYmIHRoaXMuX2x0SW5kZXggPj0gMCAmJiB0aGlzLl9sdEluZGV4IDwgdGhpcy5fbHQubGVuZ3RoKSB7CgogICAgICAgICAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rva2VuID0gdGhpcy5fbHRbdGhpcy5fbHRJbmRleCsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9IHRva2VuSW5mb1t0aGlzLl90b2tlbi50eXBlXTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vb2JleSBjaGFubmVscyBsb2dpYwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaW5mby5jaGFubmVsICE9PSB1bmRlZmluZWQgJiYgY2hhbm5lbCAhPT0gaW5mby5jaGFubmVsICYmIHRoaXMuX2x0SW5kZXggPCB0aGlzLl9sdC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rva2VuID0gdGhpcy5fbHRbdGhpcy5fbHRJbmRleCsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSB0b2tlbkluZm9bdGhpcy5fdG9rZW4udHlwZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vaGVyZSBiZSBkcmFnb25zCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaW5mby5jaGFubmVsID09PSB1bmRlZmluZWQgfHwgY2hhbm5lbCA9PT0gaW5mby5jaGFubmVsKSAmJiB0aGlzLl9sdEluZGV4IDw9IHRoaXMuX2x0Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbHRJbmRleENhY2hlLnB1c2goaSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdG9rZW4udHlwZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy9jYWxsIHRva2VuIHJldHJpZXZlciBtZXRob2QKICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuX2dldFRva2VuKCk7CgogICAgICAgICAgICAgICAgICAgIC8vaWYgaXQgc2hvdWxkIGJlIGhpZGRlbiwgZG9uJ3Qgc2F2ZSBhIHRva2VuCiAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuLnR5cGUgPiAtMSAmJiAhdG9rZW5JbmZvW3Rva2VuLnR5cGVdLmhpZGUpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vYXBwbHkgdG9rZW4gY2hhbm5lbAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbi5jaGFubmVsID0gdG9rZW5JbmZvW3Rva2VuLnR5cGVdLmNoYW5uZWw7CgogICAgICAgICAgICAgICAgICAgICAgICAvL3NhdmUgZm9yIGxhdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rva2VuID0gdG9rZW47CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2x0LnB1c2godG9rZW4pOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9zYXZlIHNwYWNlIHRoYXQgd2lsbCBiZSBtb3ZlZCAobXVzdCBiZSBkb25lIGJlZm9yZSBhcnJheSBpcyB0cnVuY2F0ZWQpCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2x0SW5kZXhDYWNoZS5wdXNoKHRoaXMuX2x0Lmxlbmd0aCAtIHRoaXMuX2x0SW5kZXggKyBpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8va2VlcCB0aGUgYnVmZmVyIHVuZGVyIDUgaXRlbXMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2x0Lmxlbmd0aCA+IDUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2x0LnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vYWxzbyBrZWVwIHRoZSBzaGlmdCBidWZmZXIgdW5kZXIgNSBpdGVtcwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fbHRJbmRleENhY2hlLmxlbmd0aCA+IDUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2x0SW5kZXhDYWNoZS5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvL3VwZGF0ZSBsb29rYWhlYWQgaW5kZXgKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbHRJbmRleCA9IHRoaXMuX2x0Lmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICogU2tpcCB0byB0aGUgbmV4dCB0b2tlbiBpZjoKICAgICAgICAgICAgICAgICAgICAgKiAxLiBUaGUgdG9rZW4gdHlwZSBpcyBtYXJrZWQgYXMgaGlkZGVuLgogICAgICAgICAgICAgICAgICAgICAqIDIuIFRoZSB0b2tlbiB0eXBlIGhhcyBhIGNoYW5uZWwgc3BlY2lmaWVkIGFuZCBpdCBpc24ndCB0aGUgY3VycmVudCBjaGFubmVsLgogICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgIGluZm8gPSB0b2tlbkluZm9bdG9rZW4udHlwZV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8gJiYgKGluZm8uaGlkZSB8fCBpbmZvLmNoYW5uZWwgIT09IHVuZGVmaW5lZCAmJiBjaGFubmVsICE9PSBpbmZvLmNoYW5uZWwpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldChjaGFubmVsKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvL3JldHVybiBqdXN0IHRoZSB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0b2tlbi50eXBlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBMb29rcyBhaGVhZCBhIGNlcnRhaW4gbnVtYmVyIG9mIHRva2VucyBhbmQgcmV0dXJucyB0aGUgdG9rZW4gdHlwZSBhdAogICAgICAgICAgICAgICAgICogdGhhdCBwb3NpdGlvbi4gVGhpcyB3aWxsIHRocm93IGFuIGVycm9yIGlmIHlvdSBsb29rYWhlYWQgcGFzdCB0aGUKICAgICAgICAgICAgICAgICAqIGVuZCBvZiBpbnB1dCwgcGFzdCB0aGUgc2l6ZSBvZiB0aGUgbG9va2FoZWFkIGJ1ZmZlciwgb3IgYmFjayBwYXN0CiAgICAgICAgICAgICAgICAgKiB0aGUgZmlyc3QgdG9rZW4gaW4gdGhlIGxvb2thaGVhZCBidWZmZXIuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gVGhlIGluZGV4IG9mIHRoZSB0b2tlbiB0eXBlIHRvIHJldHJpZXZlLiAwIGZvciB0aGUKICAgICAgICAgICAgICAgICAqICAgICAgY3VycmVudCB0b2tlbiwgMSBmb3IgdGhlIG5leHQsIC0xIGZvciB0aGUgcHJldmlvdXMsIGV0Yy4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge2ludH0gVGhlIHRva2VuIHR5cGUgb2YgdGhlIHRva2VuIGluIHRoZSBnaXZlbiBwb3NpdGlvbi4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgTEEKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgTEE6IGZ1bmN0aW9uIChpbmRleCkgewogICAgICAgICAgICAgICAgICAgIHZhciB0b3RhbCA9IGluZGV4LAogICAgICAgICAgICAgICAgICAgICAgICB0dDsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vVE9ETzogU3RvcmUgNSBzb21ld2hlcmUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gNSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUb28gbXVjaCBsb29rYWhlYWQuIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vZ2V0IGFsbCB0aG9zZSB0b2tlbnMKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRvdGFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dCA9IHRoaXMuZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbC0tOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvL3VuZ2V0IGFsbCB0aG9zZSB0b2tlbnMKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRvdGFsIDwgaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudW5nZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGluZGV4IDwgMCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2x0W3RoaXMuX2x0SW5kZXggKyBpbmRleF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0ID0gdGhpcy5fbHRbdGhpcy5fbHRJbmRleCArIGluZGV4XS50eXBlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUb28gbXVjaCBsb29rYmVoaW5kLiIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHQgPSB0aGlzLl90b2tlbi50eXBlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR0OwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIExvb2tzIGFoZWFkIGEgY2VydGFpbiBudW1iZXIgb2YgdG9rZW5zIGFuZCByZXR1cm5zIHRoZSB0b2tlbiBhdAogICAgICAgICAgICAgICAgICogdGhhdCBwb3NpdGlvbi4gVGhpcyB3aWxsIHRocm93IGFuIGVycm9yIGlmIHlvdSBsb29rYWhlYWQgcGFzdCB0aGUKICAgICAgICAgICAgICAgICAqIGVuZCBvZiBpbnB1dCwgcGFzdCB0aGUgc2l6ZSBvZiB0aGUgbG9va2FoZWFkIGJ1ZmZlciwgb3IgYmFjayBwYXN0CiAgICAgICAgICAgICAgICAgKiB0aGUgZmlyc3QgdG9rZW4gaW4gdGhlIGxvb2thaGVhZCBidWZmZXIuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gVGhlIGluZGV4IG9mIHRoZSB0b2tlbiB0eXBlIHRvIHJldHJpZXZlLiAwIGZvciB0aGUKICAgICAgICAgICAgICAgICAqICAgICAgY3VycmVudCB0b2tlbiwgMSBmb3IgdGhlIG5leHQsIC0xIGZvciB0aGUgcHJldmlvdXMsIGV0Yy4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gVGhlIHRva2VuIG9mIHRoZSB0b2tlbiBpbiB0aGUgZ2l2ZW4gcG9zaXRpb24uCiAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIExBCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIExUOiBmdW5jdGlvbiAoaW5kZXgpIHsKCiAgICAgICAgICAgICAgICAgICAgLy9sb29rYWhlYWQgZmlyc3QgdG8gcHJpbWUgdGhlIHRva2VuIGJ1ZmZlcgogICAgICAgICAgICAgICAgICAgIHRoaXMuTEEoaW5kZXgpOwoKICAgICAgICAgICAgICAgICAgICAvL25vdyBmaW5kIHRoZSB0b2tlbiwgc3VidHJhY3Qgb25lIGJlY2F1c2UgX2x0SW5kZXggaXMgYWxyZWFkeSBhdCB0aGUgbmV4dCBpbmRleAogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9sdFt0aGlzLl9sdEluZGV4ICsgaW5kZXggLSAxXTsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBSZXR1cm5zIHRoZSB0b2tlbiB0eXBlIGZvciB0aGUgbmV4dCB0b2tlbiBpbiB0aGUgc3RyZWFtIHdpdGhvdXQKICAgICAgICAgICAgICAgICAqIGNvbnN1bWluZyBpdC4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge2ludH0gVGhlIHRva2VuIHR5cGUgb2YgdGhlIG5leHQgdG9rZW4gaW4gdGhlIHN0cmVhbS4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgcGVlawogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBwZWVrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuTEEoMSk7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogUmV0dXJucyB0aGUgYWN0dWFsIHRva2VuIG9iamVjdCBmb3IgdGhlIGxhc3QgY29uc3VtZWQgdG9rZW4uCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtUb2tlbn0gVGhlIHRva2VuIG9iamVjdCBmb3IgdGhlIGxhc3QgY29uc3VtZWQgdG9rZW4uCiAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIHRva2VuCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRva2VuOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Rva2VuOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFJldHVybnMgdGhlIG5hbWUgb2YgdGhlIHRva2VuIGZvciB0aGUgZ2l2ZW4gdG9rZW4gdHlwZS4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSB0b2tlblR5cGUgVGhlIHR5cGUgb2YgdG9rZW4gdG8gZ2V0IHRoZSBuYW1lIG9mLgogICAgICAgICAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgbmFtZSBvZiB0aGUgdG9rZW4gb3IgIlVOS05PV05fVE9LRU4iIGZvciBhbnkKICAgICAgICAgICAgICAgICAqICAgICAgaW52YWxpZCB0b2tlbiB0eXBlLgogICAgICAgICAgICAgICAgICogQG1ldGhvZCB0b2tlbk5hbWUKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdG9rZW5OYW1lOiBmdW5jdGlvbiAodG9rZW5UeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuVHlwZSA8IDAgfHwgdG9rZW5UeXBlID4gdGhpcy5fdG9rZW5EYXRhLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlVOS05PV05fVE9LRU4iOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90b2tlbkRhdGFbdG9rZW5UeXBlXS5uYW1lOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBSZXR1cm5zIHRoZSB0b2tlbiB0eXBlIHZhbHVlIGZvciB0aGUgZ2l2ZW4gdG9rZW4gbmFtZS4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0b2tlbk5hbWUgVGhlIG5hbWUgb2YgdGhlIHRva2VuIHdob3NlIHZhbHVlIHNob3VsZCBiZSByZXR1cm5lZC4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge2ludH0gVGhlIHRva2VuIHR5cGUgdmFsdWUgZm9yIHRoZSBnaXZlbiB0b2tlbiBuYW1lIG9yIC0xCiAgICAgICAgICAgICAgICAgKiAgICAgIGZvciBhbiB1bmtub3duIHRva2VuLgogICAgICAgICAgICAgICAgICogQG1ldGhvZCB0b2tlbk5hbWUKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdG9rZW5UeXBlOiBmdW5jdGlvbiAodG9rZW5OYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Rva2VuRGF0YVt0b2tlbk5hbWVdIHx8IC0xOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFJldHVybnMgdGhlIGxhc3QgY29uc3VtZWQgdG9rZW4gdG8gdGhlIHRva2VuIHN0cmVhbS4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgdW5nZXQKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdW5nZXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAvL2lmICh0aGlzLl9sdEluZGV4ID4gLTEpewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9sdEluZGV4Q2FjaGUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2x0SW5kZXggLT0gdGhpcy5fbHRJbmRleENhY2hlLnBvcCgpOyAvLy0tOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90b2tlbiA9IHRoaXMuX2x0W3RoaXMuX2x0SW5kZXggLSAxXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRvbyBtdWNoIGxvb2thaGVhZC4iKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcGFyc2VybGliLnV0aWwgPSB7CiAgICAgICAgICAgICAgICBTdHJpbmdSZWFkZXI6IFN0cmluZ1JlYWRlciwKICAgICAgICAgICAgICAgIFN5bnRheEVycm9yOiBTeW50YXhFcnJvciwKICAgICAgICAgICAgICAgIFN5bnRheFVuaXQ6IFN5bnRheFVuaXQsCiAgICAgICAgICAgICAgICBFdmVudFRhcmdldDogRXZlbnRUYXJnZXQsCiAgICAgICAgICAgICAgICBUb2tlblN0cmVhbUJhc2U6IFRva2VuU3RyZWFtQmFzZQogICAgICAgICAgICB9OwogICAgICAgIH0pKCk7CiAgICAgICAgLyoKICAgICAgICBQYXJzZXItTGliCiAgICAgICAgQ29weXJpZ2h0IChjKSAyMDA5LTIwMTEgTmljaG9sYXMgQy4gWmFrYXMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCgogICAgICAgIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKICAgICAgICBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAogICAgICAgIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKICAgICAgICB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiAgICAgICAgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCiAgICAgICAgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKCiAgICAgICAgVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KICAgICAgICBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCiAgICAgICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKICAgICAgICBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKICAgICAgICBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKICAgICAgICBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiAgICAgICAgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKICAgICAgICBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOCiAgICAgICAgVEhFIFNPRlRXQVJFLgoKICAgICAgICAqLwogICAgICAgIC8qIEJ1aWxkIHRpbWU6IDI1LUp1bHktMjAxNiAwMTowOTo1OSAqLwogICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBFdmVudFRhcmdldCA9IHBhcnNlcmxpYi51dGlsLkV2ZW50VGFyZ2V0LAogICAgICAgICAgICAgICAgVG9rZW5TdHJlYW1CYXNlID0gcGFyc2VybGliLnV0aWwuVG9rZW5TdHJlYW1CYXNlLAogICAgICAgICAgICAgICAgU3RyaW5nUmVhZGVyID0gcGFyc2VybGliLnV0aWwuU3RyaW5nUmVhZGVyLAogICAgICAgICAgICAgICAgU3ludGF4RXJyb3IgPSBwYXJzZXJsaWIudXRpbC5TeW50YXhFcnJvciwKICAgICAgICAgICAgICAgIFN5bnRheFVuaXQgPSBwYXJzZXJsaWIudXRpbC5TeW50YXhVbml0OwoKICAgICAgICAgICAgdmFyIENvbG9ycyA9IHsKICAgICAgICAgICAgICAgIGFsaWNlYmx1ZTogIiNmMGY4ZmYiLAogICAgICAgICAgICAgICAgYW50aXF1ZXdoaXRlOiAiI2ZhZWJkNyIsCiAgICAgICAgICAgICAgICBhcXVhOiAiIzAwZmZmZiIsCiAgICAgICAgICAgICAgICBhcXVhbWFyaW5lOiAiIzdmZmZkNCIsCiAgICAgICAgICAgICAgICBhenVyZTogIiNmMGZmZmYiLAogICAgICAgICAgICAgICAgYmVpZ2U6ICIjZjVmNWRjIiwKICAgICAgICAgICAgICAgIGJpc3F1ZTogIiNmZmU0YzQiLAogICAgICAgICAgICAgICAgYmxhY2s6ICIjMDAwMDAwIiwKICAgICAgICAgICAgICAgIGJsYW5jaGVkYWxtb25kOiAiI2ZmZWJjZCIsCiAgICAgICAgICAgICAgICBibHVlOiAiIzAwMDBmZiIsCiAgICAgICAgICAgICAgICBibHVldmlvbGV0OiAiIzhhMmJlMiIsCiAgICAgICAgICAgICAgICBicm93bjogIiNhNTJhMmEiLAogICAgICAgICAgICAgICAgYnVybHl3b29kOiAiI2RlYjg4NyIsCiAgICAgICAgICAgICAgICBjYWRldGJsdWU6ICIjNWY5ZWEwIiwKICAgICAgICAgICAgICAgIGNoYXJ0cmV1c2U6ICIjN2ZmZjAwIiwKICAgICAgICAgICAgICAgIGNob2NvbGF0ZTogIiNkMjY5MWUiLAogICAgICAgICAgICAgICAgY29yYWw6ICIjZmY3ZjUwIiwKICAgICAgICAgICAgICAgIGNvcm5mbG93ZXJibHVlOiAiIzY0OTVlZCIsCiAgICAgICAgICAgICAgICBjb3Juc2lsazogIiNmZmY4ZGMiLAogICAgICAgICAgICAgICAgY3JpbXNvbjogIiNkYzE0M2MiLAogICAgICAgICAgICAgICAgY3lhbjogIiMwMGZmZmYiLAogICAgICAgICAgICAgICAgZGFya2JsdWU6ICIjMDAwMDhiIiwKICAgICAgICAgICAgICAgIGRhcmtjeWFuOiAiIzAwOGI4YiIsCiAgICAgICAgICAgICAgICBkYXJrZ29sZGVucm9kOiAiI2I4ODYwYiIsCiAgICAgICAgICAgICAgICBkYXJrZ3JheTogIiNhOWE5YTkiLAogICAgICAgICAgICAgICAgZGFya2dyZWVuOiAiIzAwNjQwMCIsCiAgICAgICAgICAgICAgICBkYXJra2hha2k6ICIjYmRiNzZiIiwKICAgICAgICAgICAgICAgIGRhcmttYWdlbnRhOiAiIzhiMDA4YiIsCiAgICAgICAgICAgICAgICBkYXJrb2xpdmVncmVlbjogIiM1NTZiMmYiLAogICAgICAgICAgICAgICAgZGFya29yYW5nZTogIiNmZjhjMDAiLAogICAgICAgICAgICAgICAgZGFya29yY2hpZDogIiM5OTMyY2MiLAogICAgICAgICAgICAgICAgZGFya3JlZDogIiM4YjAwMDAiLAogICAgICAgICAgICAgICAgZGFya3NhbG1vbjogIiNlOTk2N2EiLAogICAgICAgICAgICAgICAgZGFya3NlYWdyZWVuOiAiIzhmYmM4ZiIsCiAgICAgICAgICAgICAgICBkYXJrc2xhdGVibHVlOiAiIzQ4M2Q4YiIsCiAgICAgICAgICAgICAgICBkYXJrc2xhdGVncmF5OiAiIzJmNGY0ZiIsCiAgICAgICAgICAgICAgICBkYXJrdHVycXVvaXNlOiAiIzAwY2VkMSIsCiAgICAgICAgICAgICAgICBkYXJrdmlvbGV0OiAiIzk0MDBkMyIsCiAgICAgICAgICAgICAgICBkZWVwcGluazogIiNmZjE0OTMiLAogICAgICAgICAgICAgICAgZGVlcHNreWJsdWU6ICIjMDBiZmZmIiwKICAgICAgICAgICAgICAgIGRpbWdyYXk6ICIjNjk2OTY5IiwKICAgICAgICAgICAgICAgIGRvZGdlcmJsdWU6ICIjMWU5MGZmIiwKICAgICAgICAgICAgICAgIGZpcmVicmljazogIiNiMjIyMjIiLAogICAgICAgICAgICAgICAgZmxvcmFsd2hpdGU6ICIjZmZmYWYwIiwKICAgICAgICAgICAgICAgIGZvcmVzdGdyZWVuOiAiIzIyOGIyMiIsCiAgICAgICAgICAgICAgICBmdWNoc2lhOiAiI2ZmMDBmZiIsCiAgICAgICAgICAgICAgICBnYWluc2Jvcm86ICIjZGNkY2RjIiwKICAgICAgICAgICAgICAgIGdob3N0d2hpdGU6ICIjZjhmOGZmIiwKICAgICAgICAgICAgICAgIGdvbGQ6ICIjZmZkNzAwIiwKICAgICAgICAgICAgICAgIGdvbGRlbnJvZDogIiNkYWE1MjAiLAogICAgICAgICAgICAgICAgZ3JheTogIiM4MDgwODAiLAogICAgICAgICAgICAgICAgZ3JlZW46ICIjMDA4MDAwIiwKICAgICAgICAgICAgICAgIGdyZWVueWVsbG93OiAiI2FkZmYyZiIsCiAgICAgICAgICAgICAgICBob25leWRldzogIiNmMGZmZjAiLAogICAgICAgICAgICAgICAgaG90cGluazogIiNmZjY5YjQiLAogICAgICAgICAgICAgICAgaW5kaWFucmVkOiAiI2NkNWM1YyIsCiAgICAgICAgICAgICAgICBpbmRpZ286ICIjNGIwMDgyIiwKICAgICAgICAgICAgICAgIGl2b3J5OiAiI2ZmZmZmMCIsCiAgICAgICAgICAgICAgICBraGFraTogIiNmMGU2OGMiLAogICAgICAgICAgICAgICAgbGF2ZW5kZXI6ICIjZTZlNmZhIiwKICAgICAgICAgICAgICAgIGxhdmVuZGVyYmx1c2g6ICIjZmZmMGY1IiwKICAgICAgICAgICAgICAgIGxhd25ncmVlbjogIiM3Y2ZjMDAiLAogICAgICAgICAgICAgICAgbGVtb25jaGlmZm9uOiAiI2ZmZmFjZCIsCiAgICAgICAgICAgICAgICBsaWdodGJsdWU6ICIjYWRkOGU2IiwKICAgICAgICAgICAgICAgIGxpZ2h0Y29yYWw6ICIjZjA4MDgwIiwKICAgICAgICAgICAgICAgIGxpZ2h0Y3lhbjogIiNlMGZmZmYiLAogICAgICAgICAgICAgICAgbGlnaHRnb2xkZW5yb2R5ZWxsb3c6ICIjZmFmYWQyIiwKICAgICAgICAgICAgICAgIGxpZ2h0Z3JleTogIiNkM2QzZDMiLAogICAgICAgICAgICAgICAgbGlnaHRncmVlbjogIiM5MGVlOTAiLAogICAgICAgICAgICAgICAgbGlnaHRwaW5rOiAiI2ZmYjZjMSIsCiAgICAgICAgICAgICAgICBsaWdodHNhbG1vbjogIiNmZmEwN2EiLAogICAgICAgICAgICAgICAgbGlnaHRzZWFncmVlbjogIiMyMGIyYWEiLAogICAgICAgICAgICAgICAgbGlnaHRza3libHVlOiAiIzg3Y2VmYSIsCiAgICAgICAgICAgICAgICBsaWdodHNsYXRlZ3JheTogIiM3Nzg4OTkiLAogICAgICAgICAgICAgICAgbGlnaHRzdGVlbGJsdWU6ICIjYjBjNGRlIiwKICAgICAgICAgICAgICAgIGxpZ2h0eWVsbG93OiAiI2ZmZmZlMCIsCiAgICAgICAgICAgICAgICBsaW1lOiAiIzAwZmYwMCIsCiAgICAgICAgICAgICAgICBsaW1lZ3JlZW46ICIjMzJjZDMyIiwKICAgICAgICAgICAgICAgIGxpbmVuOiAiI2ZhZjBlNiIsCiAgICAgICAgICAgICAgICBtYWdlbnRhOiAiI2ZmMDBmZiIsCiAgICAgICAgICAgICAgICBtYXJvb246ICIjODAwMDAwIiwKICAgICAgICAgICAgICAgIG1lZGl1bWFxdWFtYXJpbmU6ICIjNjZjZGFhIiwKICAgICAgICAgICAgICAgIG1lZGl1bWJsdWU6ICIjMDAwMGNkIiwKICAgICAgICAgICAgICAgIG1lZGl1bW9yY2hpZDogIiNiYTU1ZDMiLAogICAgICAgICAgICAgICAgbWVkaXVtcHVycGxlOiAiIzkzNzBkOCIsCiAgICAgICAgICAgICAgICBtZWRpdW1zZWFncmVlbjogIiMzY2IzNzEiLAogICAgICAgICAgICAgICAgbWVkaXVtc2xhdGVibHVlOiAiIzdiNjhlZSIsCiAgICAgICAgICAgICAgICBtZWRpdW1zcHJpbmdncmVlbjogIiMwMGZhOWEiLAogICAgICAgICAgICAgICAgbWVkaXVtdHVycXVvaXNlOiAiIzQ4ZDFjYyIsCiAgICAgICAgICAgICAgICBtZWRpdW12aW9sZXRyZWQ6ICIjYzcxNTg1IiwKICAgICAgICAgICAgICAgIG1pZG5pZ2h0Ymx1ZTogIiMxOTE5NzAiLAogICAgICAgICAgICAgICAgbWludGNyZWFtOiAiI2Y1ZmZmYSIsCiAgICAgICAgICAgICAgICBtaXN0eXJvc2U6ICIjZmZlNGUxIiwKICAgICAgICAgICAgICAgIG1vY2Nhc2luOiAiI2ZmZTRiNSIsCiAgICAgICAgICAgICAgICBuYXZham93aGl0ZTogIiNmZmRlYWQiLAogICAgICAgICAgICAgICAgbmF2eTogIiMwMDAwODAiLAogICAgICAgICAgICAgICAgb2xkbGFjZTogIiNmZGY1ZTYiLAogICAgICAgICAgICAgICAgb2xpdmU6ICIjODA4MDAwIiwKICAgICAgICAgICAgICAgIG9saXZlZHJhYjogIiM2YjhlMjMiLAogICAgICAgICAgICAgICAgb3JhbmdlOiAiI2ZmYTUwMCIsCiAgICAgICAgICAgICAgICBvcmFuZ2VyZWQ6ICIjZmY0NTAwIiwKICAgICAgICAgICAgICAgIG9yY2hpZDogIiNkYTcwZDYiLAogICAgICAgICAgICAgICAgcGFsZWdvbGRlbnJvZDogIiNlZWU4YWEiLAogICAgICAgICAgICAgICAgcGFsZWdyZWVuOiAiIzk4ZmI5OCIsCiAgICAgICAgICAgICAgICBwYWxldHVycXVvaXNlOiAiI2FmZWVlZSIsCiAgICAgICAgICAgICAgICBwYWxldmlvbGV0cmVkOiAiI2Q4NzA5MyIsCiAgICAgICAgICAgICAgICBwYXBheWF3aGlwOiAiI2ZmZWZkNSIsCiAgICAgICAgICAgICAgICBwZWFjaHB1ZmY6ICIjZmZkYWI5IiwKICAgICAgICAgICAgICAgIHBlcnU6ICIjY2Q4NTNmIiwKICAgICAgICAgICAgICAgIHBpbms6ICIjZmZjMGNiIiwKICAgICAgICAgICAgICAgIHBsdW06ICIjZGRhMGRkIiwKICAgICAgICAgICAgICAgIHBvd2RlcmJsdWU6ICIjYjBlMGU2IiwKICAgICAgICAgICAgICAgIHB1cnBsZTogIiM4MDAwODAiLAogICAgICAgICAgICAgICAgcmVkOiAiI2ZmMDAwMCIsCiAgICAgICAgICAgICAgICByb3N5YnJvd246ICIjYmM4ZjhmIiwKICAgICAgICAgICAgICAgIHJveWFsYmx1ZTogIiM0MTY5ZTEiLAogICAgICAgICAgICAgICAgc2FkZGxlYnJvd246ICIjOGI0NTEzIiwKICAgICAgICAgICAgICAgIHNhbG1vbjogIiNmYTgwNzIiLAogICAgICAgICAgICAgICAgc2FuZHlicm93bjogIiNmNGE0NjAiLAogICAgICAgICAgICAgICAgc2VhZ3JlZW46ICIjMmU4YjU3IiwKICAgICAgICAgICAgICAgIHNlYXNoZWxsOiAiI2ZmZjVlZSIsCiAgICAgICAgICAgICAgICBzaWVubmE6ICIjYTA1MjJkIiwKICAgICAgICAgICAgICAgIHNpbHZlcjogIiNjMGMwYzAiLAogICAgICAgICAgICAgICAgc2t5Ymx1ZTogIiM4N2NlZWIiLAogICAgICAgICAgICAgICAgc2xhdGVibHVlOiAiIzZhNWFjZCIsCiAgICAgICAgICAgICAgICBzbGF0ZWdyYXk6ICIjNzA4MDkwIiwKICAgICAgICAgICAgICAgIHNub3c6ICIjZmZmYWZhIiwKICAgICAgICAgICAgICAgIHNwcmluZ2dyZWVuOiAiIzAwZmY3ZiIsCiAgICAgICAgICAgICAgICBzdGVlbGJsdWU6ICIjNDY4MmI0IiwKICAgICAgICAgICAgICAgIHRhbjogIiNkMmI0OGMiLAogICAgICAgICAgICAgICAgdGVhbDogIiMwMDgwODAiLAogICAgICAgICAgICAgICAgdGhpc3RsZTogIiNkOGJmZDgiLAogICAgICAgICAgICAgICAgdG9tYXRvOiAiI2ZmNjM0NyIsCiAgICAgICAgICAgICAgICB0dXJxdW9pc2U6ICIjNDBlMGQwIiwKICAgICAgICAgICAgICAgIHZpb2xldDogIiNlZTgyZWUiLAogICAgICAgICAgICAgICAgd2hlYXQ6ICIjZjVkZWIzIiwKICAgICAgICAgICAgICAgIHdoaXRlOiAiI2ZmZmZmZiIsCiAgICAgICAgICAgICAgICB3aGl0ZXNtb2tlOiAiI2Y1ZjVmNSIsCiAgICAgICAgICAgICAgICB5ZWxsb3c6ICIjZmZmZjAwIiwKICAgICAgICAgICAgICAgIHllbGxvd2dyZWVuOiAiIzlhY2QzMiIKICAgICAgICAgICAgfTsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFJlcHJlc2VudHMgYSBzZWxlY3RvciBjb21iaW5hdG9yICh3aGl0ZXNwYWNlLCArLCA+KS4KICAgICAgICAgICAgICogQG5hbWVzcGFjZSBwYXJzZXJsaWIuY3NzCiAgICAgICAgICAgICAqIEBjbGFzcyBDb21iaW5hdG9yCiAgICAgICAgICAgICAqIEBleHRlbmRzIHBhcnNlcmxpYi51dGlsLlN5bnRheFVuaXQKICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSB1bml0LgogICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gbGluZSBUaGUgbGluZSBvZiB0ZXh0IG9uIHdoaWNoIHRoZSB1bml0IHJlc2lkZXMuCiAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBjb2wgVGhlIGNvbHVtbiBvZiB0ZXh0IG9uIHdoaWNoIHRoZSB1bml0IHJlc2lkZXMuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBmdW5jdGlvbiBDb21iaW5hdG9yKHRleHQsIGxpbmUsIGNvbCkgewoKICAgICAgICAgICAgICAgIFN5bnRheFVuaXQuY2FsbCh0aGlzLCB0ZXh0LCBsaW5lLCBjb2wsIFBhcnNlci5DT01CSU5BVE9SX1RZUEUpOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogVGhlIHR5cGUgb2YgbW9kaWZpZXIuCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB0eXBlCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJ1bmtub3duIjsKCiAgICAgICAgICAgICAgICAvL3ByZXR0eSBzaW1wbGUKICAgICAgICAgICAgICAgIGlmICgvXlxzKyQvLnRlc3QodGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSAiZGVzY2VuZGFudCI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRleHQgPT0gIj4iKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50eXBlID0gImNoaWxkIjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGV4dCA9PSAiKyIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSAiYWRqYWNlbnQtc2libGluZyI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRleHQgPT0gIn4iKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50eXBlID0gInNpYmxpbmciOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBDb21iaW5hdG9yLnByb3RvdHlwZSA9IG5ldyBTeW50YXhVbml0KCk7CiAgICAgICAgICAgIENvbWJpbmF0b3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ29tYmluYXRvcjsKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBSZXByZXNlbnRzIGEgbWVkaWEgZmVhdHVyZSwgc3VjaCBhcyBtYXgtd2lkdGg6NTAwLgogICAgICAgICAgICAgKiBAbmFtZXNwYWNlIHBhcnNlcmxpYi5jc3MKICAgICAgICAgICAgICogQGNsYXNzIE1lZGlhRmVhdHVyZQogICAgICAgICAgICAgKiBAZXh0ZW5kcyBwYXJzZXJsaWIudXRpbC5TeW50YXhVbml0CiAgICAgICAgICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgKiBAcGFyYW0ge1N5bnRheFVuaXR9IG5hbWUgVGhlIG5hbWUgb2YgdGhlIGZlYXR1cmUuCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3ludGF4VW5pdH0gdmFsdWUgVGhlIHZhbHVlIG9mIHRoZSBmZWF0dXJlIG9yIG51bGwgaWYgbm9uZS4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIGZ1bmN0aW9uIE1lZGlhRmVhdHVyZShuYW1lLCB2YWx1ZSkgewoKICAgICAgICAgICAgICAgIFN5bnRheFVuaXQuY2FsbCh0aGlzLCAiKCIgKyBuYW1lICsgKHZhbHVlICE9PSBudWxsID8gIjoiICsgdmFsdWUgOiAiIikgKyAiKSIsIG5hbWUuc3RhcnRMaW5lLCBuYW1lLnN0YXJ0Q29sLCBQYXJzZXIuTUVESUFfRkVBVFVSRV9UWVBFKTsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSBuYW1lIG9mIHRoZSBtZWRpYSBmZWF0dXJlCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBuYW1lCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7CgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBUaGUgdmFsdWUgZm9yIHRoZSBmZWF0dXJlIG9yIG51bGwgaWYgdGhlcmUgaXMgbm9uZS4KICAgICAgICAgICAgICAgICAqIEB0eXBlIFN5bnRheFVuaXQKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB2YWx1ZQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIE1lZGlhRmVhdHVyZS5wcm90b3R5cGUgPSBuZXcgU3ludGF4VW5pdCgpOwogICAgICAgICAgICBNZWRpYUZlYXR1cmUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTWVkaWFGZWF0dXJlOwoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFJlcHJlc2VudHMgYW4gaW5kaXZpZHVhbCBtZWRpYSBxdWVyeS4KICAgICAgICAgICAgICogQG5hbWVzcGFjZSBwYXJzZXJsaWIuY3NzCiAgICAgICAgICAgICAqIEBjbGFzcyBNZWRpYVF1ZXJ5CiAgICAgICAgICAgICAqIEBleHRlbmRzIHBhcnNlcmxpYi51dGlsLlN5bnRheFVuaXQKICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtb2RpZmllciBUaGUgbW9kaWZpZXIgIm5vdCIgb3IgIm9ubHkiIChvciBudWxsKS4KICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG1lZGlhVHlwZSBUaGUgdHlwZSBvZiBtZWRpYSAoaS5lLiwgInByaW50IikuCiAgICAgICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHBhcnRzIEFycmF5IG9mIHNlbGVjdG9ycyBwYXJ0cyBtYWtpbmcgdXAgdGhpcyBzZWxlY3Rvci4KICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IGxpbmUgVGhlIGxpbmUgb2YgdGV4dCBvbiB3aGljaCB0aGUgdW5pdCByZXNpZGVzLgogICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gY29sIFRoZSBjb2x1bW4gb2YgdGV4dCBvbiB3aGljaCB0aGUgdW5pdCByZXNpZGVzLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgZnVuY3Rpb24gTWVkaWFRdWVyeShtb2RpZmllciwgbWVkaWFUeXBlLCBmZWF0dXJlcywgbGluZSwgY29sKSB7CgogICAgICAgICAgICAgICAgU3ludGF4VW5pdC5jYWxsKHRoaXMsIChtb2RpZmllciA/IG1vZGlmaWVyICsgIiAiIDogIiIpICsgKG1lZGlhVHlwZSA/IG1lZGlhVHlwZSArICIgIiA6ICIiKSArIGZlYXR1cmVzLmpvaW4oIiBhbmQgIiksIGxpbmUsIGNvbCwgUGFyc2VyLk1FRElBX1FVRVJZX1RZUEUpOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogVGhlIG1lZGlhIG1vZGlmaWVyICgibm90IiBvciAib25seSIpCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBtb2RpZmllcgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB0aGlzLm1vZGlmaWVyID0gbW9kaWZpZXI7CgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBUaGUgbWVkaWFUeXBlIChpLmUuLCAicHJpbnQiKQogICAgICAgICAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkgbWVkaWFUeXBlCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMubWVkaWFUeXBlID0gbWVkaWFUeXBlOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogVGhlIHBhcnRzIHRoYXQgbWFrZSB1cCB0aGUgc2VsZWN0b3IuCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBBcnJheQogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IGZlYXR1cmVzCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMuZmVhdHVyZXMgPSBmZWF0dXJlczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgTWVkaWFRdWVyeS5wcm90b3R5cGUgPSBuZXcgU3ludGF4VW5pdCgpOwogICAgICAgICAgICBNZWRpYVF1ZXJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IE1lZGlhUXVlcnk7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQSBDU1MzIHBhcnNlci4KICAgICAgICAgICAgICogQG5hbWVzcGFjZSBwYXJzZXJsaWIuY3NzCiAgICAgICAgICAgICAqIEBjbGFzcyBQYXJzZXIKICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIChPcHRpb25hbCkgVmFyaW91cyBvcHRpb25zIGZvciB0aGUgcGFyc2VyOgogICAgICAgICAgICAgKiAgICAgIHN0YXJIYWNrICh0cnVlfGZhbHNlKSB0byBhbGxvdyBJRTYgc3RhciBoYWNrIGFzIHZhbGlkLAogICAgICAgICAgICAgKiAgICAgIHVuZGVyc2NvcmVIYWNrICh0cnVlfGZhbHNlKSB0byBpbnRlcnByZXQgbGVhZGluZyB1bmRlcnNjb3JlcwogICAgICAgICAgICAgKiAgICAgIGFzIElFNi03IHRhcmdldGluZyBmb3Iga25vd24gcHJvcGVydGllcywgaWVGaWx0ZXJzICh0cnVlfGZhbHNlKQogICAgICAgICAgICAgKiAgICAgIHRvIGluZGljYXRlIHRoYXQgSUUgPCA4IGZpbHRlcnMgc2hvdWxkIGJlIGFjY2VwdGVkIGFuZCBub3QgdGhyb3cKICAgICAgICAgICAgICogICAgICBzeW50YXggZXJyb3JzLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgZnVuY3Rpb24gUGFyc2VyKG9wdGlvbnMpIHsKCiAgICAgICAgICAgICAgICAvL2luaGVyaXQgZXZlbnQgZnVuY3Rpb25hbGl0eQogICAgICAgICAgICAgICAgRXZlbnRUYXJnZXQuY2FsbCh0aGlzKTsKCiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAgICAgICAgICAgICAgIHRoaXMuX3Rva2VuU3RyZWFtID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9TdGF0aWMgY29uc3RhbnRzCiAgICAgICAgICAgIFBhcnNlci5ERUZBVUxUX1RZUEUgPSAwOwogICAgICAgICAgICBQYXJzZXIuQ09NQklOQVRPUl9UWVBFID0gMTsKICAgICAgICAgICAgUGFyc2VyLk1FRElBX0ZFQVRVUkVfVFlQRSA9IDI7CiAgICAgICAgICAgIFBhcnNlci5NRURJQV9RVUVSWV9UWVBFID0gMzsKICAgICAgICAgICAgUGFyc2VyLlBST1BFUlRZX05BTUVfVFlQRSA9IDQ7CiAgICAgICAgICAgIFBhcnNlci5QUk9QRVJUWV9WQUxVRV9UWVBFID0gNTsKICAgICAgICAgICAgUGFyc2VyLlBST1BFUlRZX1ZBTFVFX1BBUlRfVFlQRSA9IDY7CiAgICAgICAgICAgIFBhcnNlci5TRUxFQ1RPUl9UWVBFID0gNzsKICAgICAgICAgICAgUGFyc2VyLlNFTEVDVE9SX1BBUlRfVFlQRSA9IDg7CiAgICAgICAgICAgIFBhcnNlci5TRUxFQ1RPUl9TVUJfUEFSVF9UWVBFID0gOTsKCiAgICAgICAgICAgIFBhcnNlci5wcm90b3R5cGUgPSBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICAgICAgdmFyIHByb3RvID0gbmV3IEV2ZW50VGFyZ2V0KCksCiAgICAgICAgICAgICAgICAgICAgLy9uZXcgcHJvdG90eXBlCiAgICAgICAgICAgICAgICBwcm9wLAogICAgICAgICAgICAgICAgICAgIGFkZGl0aW9ucyA9IHsKCiAgICAgICAgICAgICAgICAgICAgLy9yZXN0b3JlIGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAgICAgICAgY29uc3RydWN0b3I6IFBhcnNlciwKCiAgICAgICAgICAgICAgICAgICAgLy9pbnN0YW5jZSBjb25zdGFudHMgLSB5dWNrCiAgICAgICAgICAgICAgICAgICAgREVGQVVMVF9UWVBFOiAwLAogICAgICAgICAgICAgICAgICAgIENPTUJJTkFUT1JfVFlQRTogMSwKICAgICAgICAgICAgICAgICAgICBNRURJQV9GRUFUVVJFX1RZUEU6IDIsCiAgICAgICAgICAgICAgICAgICAgTUVESUFfUVVFUllfVFlQRTogMywKICAgICAgICAgICAgICAgICAgICBQUk9QRVJUWV9OQU1FX1RZUEU6IDQsCiAgICAgICAgICAgICAgICAgICAgUFJPUEVSVFlfVkFMVUVfVFlQRTogNSwKICAgICAgICAgICAgICAgICAgICBQUk9QRVJUWV9WQUxVRV9QQVJUX1RZUEU6IDYsCiAgICAgICAgICAgICAgICAgICAgU0VMRUNUT1JfVFlQRTogNywKICAgICAgICAgICAgICAgICAgICBTRUxFQ1RPUl9QQVJUX1RZUEU6IDgsCiAgICAgICAgICAgICAgICAgICAgU0VMRUNUT1JfU1VCX1BBUlRfVFlQRTogOSwKCiAgICAgICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAgICAgICAgIC8vIEdyYW1tYXIKICAgICAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgICAgICAgICAgICAgICAgIF9zdHlsZXNoZWV0OiBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBzdHlsZXNoZWV0CiAgICAgICAgICAgICAgICAgICAgICAgICAqICA6IFsgQ0hBUlNFVF9TWU0gUyogU1RSSU5HIFMqICc7JyBdPwogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICBbU3xDRE98Q0RDXSogWyBpbXBvcnQgW1N8Q0RPfENEQ10qIF0qCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgIFsgbmFtZXNwYWNlIFtTfENET3xDRENdKiBdKgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICBbIFsgcnVsZXNldCB8IG1lZGlhIHwgcGFnZSB8IGZvbnRfZmFjZSB8IGtleWZyYW1lcyBdIFtTfENET3xDRENdKiBdKgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnNldCA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0OwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKCJzdGFydHN0eWxlc2hlZXQiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vdHJ5IHRvIHJlYWQgY2hhcmFjdGVyIHNldAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jaGFyc2V0KCk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9za2lwQ3J1ZnQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vdHJ5IHRvIHJlYWQgaW1wb3J0cyAtIG1heSBiZSBtb3JlIHRoYW4gb25lCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICh0b2tlblN0cmVhbS5wZWVrKCkgPT0gVG9rZW5zLklNUE9SVF9TWU0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2ltcG9ydCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2tpcENydWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vdHJ5IHRvIHJlYWQgbmFtZXNwYWNlcyAtIG1heSBiZSBtb3JlIHRoYW4gb25lCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICh0b2tlblN0cmVhbS5wZWVrKCkgPT0gVG9rZW5zLk5BTUVTUEFDRV9TWU0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX25hbWVzcGFjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2tpcENydWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vZ2V0IHRoZSBuZXh0IHRva2VuCiAgICAgICAgICAgICAgICAgICAgICAgIHR0ID0gdG9rZW5TdHJlYW0ucGVlaygpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy90cnkgdG8gcmVhZCB0aGUgcmVzdAogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAodHQgPiBUb2tlbnMuRU9GKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRva2Vucy5NRURJQV9TWU06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2tpcENydWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUb2tlbnMuUEFHRV9TWU06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9za2lwQ3J1ZnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRva2Vucy5GT05UX0ZBQ0VfU1lNOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZm9udF9mYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9za2lwQ3J1ZnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRva2Vucy5LRVlGUkFNRVNfU1lNOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fa2V5ZnJhbWVzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9za2lwQ3J1ZnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRva2Vucy5TOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9ydWxlc2V0KCkpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9lcnJvciBoYW5kbGluZyBmb3Iga25vd24gaXNzdWVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRva2Vucy5DSEFSU0VUX1NZTToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdG9rZW5TdHJlYW0uTFQoMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jaGFyc2V0KGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiQGNoYXJzZXQgbm90IGFsbG93ZWQgaGVyZS4iLCB0b2tlbi5zdGFydExpbmUsIHRva2VuLnN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUb2tlbnMuSU1QT1JUX1NZTToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdG9rZW5TdHJlYW0uTFQoMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbXBvcnQoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCJAaW1wb3J0IG5vdCBhbGxvd2VkIGhlcmUuIiwgdG9rZW4uc3RhcnRMaW5lLCB0b2tlbi5zdGFydENvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVG9rZW5zLk5BTUVTUEFDRV9TWU06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRva2VuU3RyZWFtLkxUKDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbmFtZXNwYWNlKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiQG5hbWVzcGFjZSBub3QgYWxsb3dlZCBoZXJlLiIsIHRva2VuLnN0YXJ0TGluZSwgdG9rZW4uc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5TdHJlYW0uZ2V0KCk7IC8vZ2V0IHRoZSBsYXN0IHRva2VuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl91bmV4cGVjdGVkVG9rZW4odG9rZW5TdHJlYW0udG9rZW4oKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4IGluc3RhbmNlb2YgU3ludGF4RXJyb3IgJiYgIXRoaXMub3B0aW9ucy5zdHJpY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBleC5tZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogZXgubGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogZXguY29sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dCA9IHRva2VuU3RyZWFtLnBlZWsoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR0ICE9IFRva2Vucy5FT0YpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3VuZXhwZWN0ZWRUb2tlbih0b2tlblN0cmVhbS50b2tlbigpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKCJlbmRzdHlsZXNoZWV0Iik7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgX2NoYXJzZXQ6IGZ1bmN0aW9uIChlbWl0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnNldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuQ0hBUlNFVF9TWU0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gdG9rZW5TdHJlYW0udG9rZW4oKS5zdGFydExpbmU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSB0b2tlblN0cmVhbS50b2tlbigpLnN0YXJ0Q29sOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLlNUUklORyk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0b2tlblN0cmVhbS50b2tlbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnNldCA9IHRva2VuLnZhbHVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLlNFTUlDT0xPTik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVtaXQgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImNoYXJzZXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFyc2V0OiBjaGFyc2V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBsaW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w6IGNvbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgX2ltcG9ydDogZnVuY3Rpb24gKGVtaXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogaW1wb3J0CiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBJTVBPUlRfU1lNIFMqCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgIFtTVFJJTkd8VVJJXSBTKiBtZWRpYV9xdWVyeV9saXN0PyAnOycgUyoKICAgICAgICAgICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0VG9rZW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYUxpc3QgPSBbXTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVhZCBpbXBvcnQgc3ltYm9sCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm11c3RNYXRjaChUb2tlbnMuSU1QT1JUX1NZTSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydFRva2VuID0gdG9rZW5TdHJlYW0udG9rZW4oKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm11c3RNYXRjaChbVG9rZW5zLlNUUklORywgVG9rZW5zLlVSSV0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9ncmFiIHRoZSBVUkkgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgdXJpID0gdG9rZW5TdHJlYW0udG9rZW4oKS52YWx1ZS5yZXBsYWNlKC8oPzp1cmxcKCk/WyInXShbXiInXSspWyInXVwpPy8sICIkMSIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhTGlzdCA9IHRoaXMuX21lZGlhX3F1ZXJ5X2xpc3QoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vbXVzdCBlbmQgd2l0aCBhIHNlbWljb2xvbgogICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLlNFTUlDT0xPTik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW1pdCAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImltcG9ydCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJpOiB1cmksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWE6IG1lZGlhTGlzdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBpbXBvcnRUb2tlbi5zdGFydExpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBpbXBvcnRUb2tlbi5zdGFydENvbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBfbmFtZXNwYWNlOiBmdW5jdGlvbiAoZW1pdCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBuYW1lc3BhY2UKICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IE5BTUVTUEFDRV9TWU0gUyogW25hbWVzcGFjZV9wcmVmaXggUypdPyBbU1RSSU5HfFVSSV0gUyogJzsnIFMqCiAgICAgICAgICAgICAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlZml4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9yZWFkIGltcG9ydCBzeW1ib2wKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5TdHJlYW0ubXVzdE1hdGNoKFRva2Vucy5OQU1FU1BBQ0VfU1lNKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IHRva2VuU3RyZWFtLnRva2VuKCkuc3RhcnRMaW5lOwogICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSB0b2tlblN0cmVhbS50b2tlbigpLnN0YXJ0Q29sOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9pdCdzIGEgbmFtZXNwYWNlIHByZWZpeCAtIG5vIF9uYW1lc3BhY2VfcHJlZml4KCkgbWV0aG9kIGJlY2F1c2UgaXQncyBqdXN0IGFuIElERU5UCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuSURFTlQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXggPSB0b2tlblN0cmVhbS50b2tlbigpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5TdHJlYW0ubXVzdE1hdGNoKFtUb2tlbnMuU1RSSU5HLCBUb2tlbnMuVVJJXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qaWYgKCF0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuU1RSSU5HKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLlVSSSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0qLwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9ncmFiIHRoZSBVUkkgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgdXJpID0gdG9rZW5TdHJlYW0udG9rZW4oKS52YWx1ZS5yZXBsYWNlKC8oPzp1cmxcKCk/WyInXShbXiInXSspWyInXVwpPy8sICIkMSIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vbXVzdCBlbmQgd2l0aCBhIHNlbWljb2xvbgogICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLlNFTUlDT0xPTik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW1pdCAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIm5hbWVzcGFjZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlZml4OiBwcmVmaXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJpOiB1cmksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w6IGNvbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBfbWVkaWE6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogbWVkaWEKICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IE1FRElBX1NZTSBTKiBtZWRpYV9xdWVyeV9saXN0IFMqICd7JyBTKiBydWxlc2V0KiAnfScgUyoKICAgICAgICAgICAgICAgICAgICAgICAgICogICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYUxpc3Q7IC8vICAgICAgID0gW107CgogICAgICAgICAgICAgICAgICAgICAgICAvL2xvb2sgZm9yIEBtZWRpYQogICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLk1FRElBX1NZTSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSB0b2tlblN0cmVhbS50b2tlbigpLnN0YXJ0TGluZTsKICAgICAgICAgICAgICAgICAgICAgICAgY29sID0gdG9rZW5TdHJlYW0udG9rZW4oKS5zdGFydENvbDsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICBtZWRpYUxpc3QgPSB0aGlzLl9tZWRpYV9xdWVyeV9saXN0KCk7CgogICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLkxCUkFDRSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogInN0YXJ0bWVkaWEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWE6IG1lZGlhTGlzdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IGxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w6IGNvbAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5TdHJlYW0ucGVlaygpID09IFRva2Vucy5QQUdFX1NZTSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhZ2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX3J1bGVzZXQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLlJCUkFDRSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVuZG1lZGlhIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhOiBtZWRpYUxpc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBsaW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBjb2wKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy9DU1MzIE1lZGlhIFF1ZXJpZXMKICAgICAgICAgICAgICAgICAgICBfbWVkaWFfcXVlcnlfbGlzdDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBtZWRpYV9xdWVyeV9saXN0CiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBTKiBbbWVkaWFfcXVlcnkgWyAnLCcgUyogbWVkaWFfcXVlcnkgXSogXT8KICAgICAgICAgICAgICAgICAgICAgICAgICogICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhTGlzdCA9IFtdOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5wZWVrKCkgPT0gVG9rZW5zLklERU5UIHx8IHRva2VuU3RyZWFtLnBlZWsoKSA9PSBUb2tlbnMuTFBBUkVOKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYUxpc3QucHVzaCh0aGlzLl9tZWRpYV9xdWVyeSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5DT01NQSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYUxpc3QucHVzaCh0aGlzLl9tZWRpYV9xdWVyeSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lZGlhTGlzdDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAqIE5vdGU6ICJleHByZXNzaW9uIiBpbiB0aGUgZ3JhbW1hciBtYXBzIHRvIHRoZSBfbWVkaWFfZXhwcmVzc2lvbgogICAgICAgICAgICAgICAgICAgICAqIG1ldGhvZC4KICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgX21lZGlhX3F1ZXJ5OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIG1lZGlhX3F1ZXJ5CiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBbT05MWSB8IE5PVF0/IFMqIG1lZGlhX3R5cGUgUyogWyBBTkQgUyogZXhwcmVzc2lvbiBdKgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIHwgZXhwcmVzc2lvbiBbIEFORCBTKiBleHByZXNzaW9uIF0qCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50ID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb25zID0gW107CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5TdHJlYW0ubWF0Y2goVG9rZW5zLklERU5UKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnQgPSB0b2tlblN0cmVhbS50b2tlbigpLnZhbHVlLnRvTG93ZXJDYXNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9zaW5jZSB0aGVyZSdzIG5vIGN1c3RvbSB0b2tlbnMgZm9yIHRoZXNlLCBuZWVkIHRvIG1hbnVhbGx5IGNoZWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWRlbnQgIT0gIm9ubHkiICYmIGlkZW50ICE9ICJub3QiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5TdHJlYW0udW5nZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVudCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdG9rZW5TdHJlYW0udG9rZW4oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5wZWVrKCkgPT0gVG9rZW5zLklERU5UKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gdGhpcy5fbWVkaWFfdHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0b2tlblN0cmVhbS50b2tlbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRva2VuU3RyZWFtLnBlZWsoKSA9PSBUb2tlbnMuTFBBUkVOKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRva2VuU3RyZWFtLkxUKDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaCh0aGlzLl9tZWRpYV9leHByZXNzaW9uKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gbnVsbCAmJiBleHByZXNzaW9ucy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICh0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuSURFTlQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLnRva2VuKCkudmFsdWUudG9Mb3dlckNhc2UoKSAhPSAiYW5kIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl91bmV4cGVjdGVkVG9rZW4odG9rZW5TdHJlYW0udG9rZW4oKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb25zLnB1c2godGhpcy5fbWVkaWFfZXhwcmVzc2lvbigpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNZWRpYVF1ZXJ5KGlkZW50LCB0eXBlLCBleHByZXNzaW9ucywgdG9rZW4uc3RhcnRMaW5lLCB0b2tlbi5zdGFydENvbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy9DU1MzIE1lZGlhIFF1ZXJpZXMKICAgICAgICAgICAgICAgICAgICBfbWVkaWFfdHlwZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBtZWRpYV90eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBJREVOVAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tZWRpYV9mZWF0dXJlKCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgICAgICogTm90ZTogaW4gQ1NTMyBNZWRpYSBRdWVyaWVzLCB0aGlzIGlzIGNhbGxlZCAiZXhwcmVzc2lvbiIuCiAgICAgICAgICAgICAgICAgICAgICogUmVuYW1lZCBoZXJlIHRvIGF2b2lkIGNvbmZsaWN0IHdpdGggQ1NTMyBTZWxlY3RvcnMKICAgICAgICAgICAgICAgICAgICAgKiBkZWZpbml0aW9uIG9mICJleHByZXNzaW9uIi4gQWxzbyBub3RlIHRoYXQgImV4cHIiIGluIHRoZQogICAgICAgICAgICAgICAgICAgICAqIGdyYW1tYXIgbm93IG1hcHMgdG8gImV4cHJlc3Npb24iIGZyb20gQ1NTMyBzZWxlY3RvcnMuCiAgICAgICAgICAgICAgICAgICAgICogQG1ldGhvZCBfbWVkaWFfZXhwcmVzc2lvbgogICAgICAgICAgICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgX21lZGlhX2V4cHJlc3Npb246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogZXhwcmVzc2lvbgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgOiAnKCcgUyogbWVkaWFfZmVhdHVyZSBTKiBbICc6JyBTKiBleHByIF0/ICcpJyBTKgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbiA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLkxQQVJFTik7CgogICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlID0gdGhpcy5fbWVkaWFfZmVhdHVyZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5DT0xPTikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRva2VuU3RyZWFtLkxUKDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbiA9IHRoaXMuX2V4cHJlc3Npb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5TdHJlYW0ubXVzdE1hdGNoKFRva2Vucy5SUEFSRU4pOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNZWRpYUZlYXR1cmUoZmVhdHVyZSwgZXhwcmVzc2lvbiA/IG5ldyBTeW50YXhVbml0KGV4cHJlc3Npb24sIHRva2VuLnN0YXJ0TGluZSwgdG9rZW4uc3RhcnRDb2wpIDogbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy9DU1MzIE1lZGlhIFF1ZXJpZXMKICAgICAgICAgICAgICAgICAgICBfbWVkaWFfZmVhdHVyZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBtZWRpYV9mZWF0dXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBJREVOVAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtOwoKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5TdHJlYW0ubXVzdE1hdGNoKFRva2Vucy5JREVOVCk7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3ludGF4VW5pdC5mcm9tVG9rZW4odG9rZW5TdHJlYW0udG9rZW4oKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy9DU1MzIFBhZ2VkIE1lZGlhCiAgICAgICAgICAgICAgICAgICAgX3BhZ2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogcGFnZToKICAgICAgICAgICAgICAgICAgICAgICAgICogICAgUEFHRV9TWU0gUyogSURFTlQ/IHBzZXVkb19wYWdlPyBTKgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICAneycgUyogWyBkZWNsYXJhdGlvbiB8IG1hcmdpbiBdPyBbICc7JyBTKiBbIGRlY2xhcmF0aW9uIHwgbWFyZ2luIF0/IF0qICd9JyBTKgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBzZXVkb1BhZ2UgPSBudWxsOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9sb29rIGZvciBAcGFnZQogICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLlBBR0VfU1lNKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IHRva2VuU3RyZWFtLnRva2VuKCkuc3RhcnRMaW5lOwogICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSB0b2tlblN0cmVhbS50b2tlbigpLnN0YXJ0Q29sOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuSURFTlQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVudGlmaWVyID0gdG9rZW5TdHJlYW0udG9rZW4oKS52YWx1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1RoZSB2YWx1ZSAnYXV0bycgbWF5IG5vdCBiZSB1c2VkIGFzIGEgcGFnZSBuYW1lIGFuZCBNVVNUIGJlIHRyZWF0ZWQgYXMgYSBzeW50YXggZXJyb3IuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWRlbnRpZmllci50b0xvd2VyQ2FzZSgpID09PSAiYXV0byIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl91bmV4cGVjdGVkVG9rZW4odG9rZW5TdHJlYW0udG9rZW4oKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2VlIGlmIHRoZXJlJ3MgYSBjb2xvbiB1cGNvbWluZwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5TdHJlYW0ucGVlaygpID09IFRva2Vucy5DT0xPTikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHNldWRvUGFnZSA9IHRoaXMuX3BzZXVkb19wYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogInN0YXJ0cGFnZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaWRlbnRpZmllciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBzZXVkbzogcHNldWRvUGFnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IGxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w6IGNvbAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWREZWNsYXJhdGlvbnModHJ1ZSwgdHJ1ZSk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVuZHBhZ2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkZW50aWZpZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwc2V1ZG86IHBzZXVkb1BhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBsaW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBjb2wKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy9DU1MzIFBhZ2VkIE1lZGlhCiAgICAgICAgICAgICAgICAgICAgX21hcmdpbjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBtYXJnaW4gOgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICBtYXJnaW5fc3ltIFMqICd7JyBkZWNsYXJhdGlvbiBbICc7JyBTKiBkZWNsYXJhdGlvbj8gXSogJ30nIFMqCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpblN5bSA9IHRoaXMuX21hcmdpbl9zeW0oKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXJnaW5TeW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSB0b2tlblN0cmVhbS50b2tlbigpLnN0YXJ0TGluZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9IHRva2VuU3RyZWFtLnRva2VuKCkuc3RhcnRDb2w7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAic3RhcnRwYWdlbWFyZ2luIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46IG1hcmdpblN5bSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBsaW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogY29sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkRGVjbGFyYXRpb25zKHRydWUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVuZHBhZ2VtYXJnaW4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbjogbWFyZ2luU3ltLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IGxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBjb2wKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAvL0NTUzMgUGFnZWQgTWVkaWEKICAgICAgICAgICAgICAgICAgICBfbWFyZ2luX3N5bTogZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogbWFyZ2luX3N5bSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgIFRPUExFRlRDT1JORVJfU1lNIHwKICAgICAgICAgICAgICAgICAgICAgICAgICogICAgVE9QTEVGVF9TWU0gfAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICBUT1BDRU5URVJfU1lNIHwKICAgICAgICAgICAgICAgICAgICAgICAgICogICAgVE9QUklHSFRfU1lNIHwKICAgICAgICAgICAgICAgICAgICAgICAgICogICAgVE9QUklHSFRDT1JORVJfU1lNIHwKICAgICAgICAgICAgICAgICAgICAgICAgICogICAgQk9UVE9NTEVGVENPUk5FUl9TWU0gfAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICBCT1RUT01MRUZUX1NZTSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgIEJPVFRPTUNFTlRFUl9TWU0gfAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICBCT1RUT01SSUdIVF9TWU0gfAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICBCT1RUT01SSUdIVENPUk5FUl9TWU0gfAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICBMRUZUVE9QX1NZTSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgIExFRlRNSURETEVfU1lNIHwKICAgICAgICAgICAgICAgICAgICAgICAgICogICAgTEVGVEJPVFRPTV9TWU0gfAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICBSSUdIVFRPUF9TWU0gfAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICBSSUdIVE1JRERMRV9TWU0gfAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICBSSUdIVEJPVFRPTV9TWU0KICAgICAgICAgICAgICAgICAgICAgICAgICogICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLm1hdGNoKFtUb2tlbnMuVE9QTEVGVENPUk5FUl9TWU0sIFRva2Vucy5UT1BMRUZUX1NZTSwgVG9rZW5zLlRPUENFTlRFUl9TWU0sIFRva2Vucy5UT1BSSUdIVF9TWU0sIFRva2Vucy5UT1BSSUdIVENPUk5FUl9TWU0sIFRva2Vucy5CT1RUT01MRUZUQ09STkVSX1NZTSwgVG9rZW5zLkJPVFRPTUxFRlRfU1lNLCBUb2tlbnMuQk9UVE9NQ0VOVEVSX1NZTSwgVG9rZW5zLkJPVFRPTVJJR0hUX1NZTSwgVG9rZW5zLkJPVFRPTVJJR0hUQ09STkVSX1NZTSwgVG9rZW5zLkxFRlRUT1BfU1lNLCBUb2tlbnMuTEVGVE1JRERMRV9TWU0sIFRva2Vucy5MRUZUQk9UVE9NX1NZTSwgVG9rZW5zLlJJR0hUVE9QX1NZTSwgVG9rZW5zLlJJR0hUTUlERExFX1NZTSwgVG9rZW5zLlJJR0hUQk9UVE9NX1NZTV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3ludGF4VW5pdC5mcm9tVG9rZW4odG9rZW5TdHJlYW0udG9rZW4oKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIF9wc2V1ZG9fcGFnZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBwc2V1ZG9fcGFnZQogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDogJzonIElERU5UCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtOwoKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5TdHJlYW0ubXVzdE1hdGNoKFRva2Vucy5DT0xPTik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm11c3RNYXRjaChUb2tlbnMuSURFTlQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiBDU1MzIFBhZ2VkIE1lZGlhIHNheXMgb25seSAibGVmdCIsICJjZW50ZXIiLCBhbmQgInJpZ2h0IiBhcmUgYWxsb3dlZAoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRva2VuU3RyZWFtLnRva2VuKCkudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgX2ZvbnRfZmFjZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBmb250X2ZhY2UKICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IEZPTlRfRkFDRV9TWU0gUyoKICAgICAgICAgICAgICAgICAgICAgICAgICogICAgICd7JyBTKiBkZWNsYXJhdGlvbiBbICc7JyBTKiBkZWNsYXJhdGlvbiBdKiAnfScgUyoKICAgICAgICAgICAgICAgICAgICAgICAgICogICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w7CgogICAgICAgICAgICAgICAgICAgICAgICAvL2xvb2sgZm9yIEBwYWdlCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm11c3RNYXRjaChUb2tlbnMuRk9OVF9GQUNFX1NZTSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSB0b2tlblN0cmVhbS50b2tlbigpLnN0YXJ0TGluZTsKICAgICAgICAgICAgICAgICAgICAgICAgY29sID0gdG9rZW5TdHJlYW0udG9rZW4oKS5zdGFydENvbDsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogInN0YXJ0Zm9udGZhY2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogY29sCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZERlY2xhcmF0aW9ucyh0cnVlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZW5kZm9udGZhY2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogY29sCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIF9vcGVyYXRvcjogZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogb3BlcmF0b3IKICAgICAgICAgICAgICAgICAgICAgICAgICogIDogJy8nIFMqIHwgJywnIFMqIHwgLyggZW1wdHkgKS8KICAgICAgICAgICAgICAgICAgICAgICAgICogIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gbnVsbDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaChbVG9rZW5zLlNMQVNILCBUb2tlbnMuQ09NTUFdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0b2tlblN0cmVhbS50b2tlbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9rZW4gPyBQcm9wZXJ0eVZhbHVlUGFydC5mcm9tVG9rZW4odG9rZW4pIDogbnVsbDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBfY29tYmluYXRvcjogZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogY29tYmluYXRvcgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgOiBQTFVTIFMqIHwgR1JFQVRFUiBTKiB8IFRJTERFIFMqIHwgUysKICAgICAgICAgICAgICAgICAgICAgICAgICogIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLm1hdGNoKFtUb2tlbnMuUExVUywgVG9rZW5zLkdSRUFURVIsIFRva2Vucy5USUxERV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRva2VuU3RyZWFtLnRva2VuKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG5ldyBDb21iaW5hdG9yKHRva2VuLnZhbHVlLCB0b2tlbi5zdGFydExpbmUsIHRva2VuLnN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBfdW5hcnlfb3BlcmF0b3I6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIHVuYXJ5X29wZXJhdG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAqICA6ICctJyB8ICcrJwogICAgICAgICAgICAgICAgICAgICAgICAgKiAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLm1hdGNoKFtUb2tlbnMuTUlOVVMsIFRva2Vucy5QTFVTXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0b2tlblN0cmVhbS50b2tlbigpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBfcHJvcGVydHk6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIHByb3BlcnR5CiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBJREVOVCBTKgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhY2sgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5WYWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgZm9yIHN0YXIgaGFjayAtIHRocm93cyBlcnJvciBpZiBub3QgYWxsb3dlZAogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5TdHJlYW0ucGVlaygpID09IFRva2Vucy5TVEFSICYmIHRoaXMub3B0aW9ucy5zdGFySGFjaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5TdHJlYW0uZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRva2VuU3RyZWFtLnRva2VuKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYWNrID0gdG9rZW4udmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gdG9rZW4uc3RhcnRMaW5lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sID0gdG9rZW4uc3RhcnRDb2w7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuSURFTlQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRva2VuU3RyZWFtLnRva2VuKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlblZhbHVlID0gdG9rZW4udmFsdWU7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jaGVjayBmb3IgdW5kZXJzY29yZSBoYWNrIC0gbm8gZXJyb3IgaWYgbm90IGFsbG93ZWQgYmVjYXVzZSBpdCdzIHZhbGlkIENTUyBzeW50YXgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblZhbHVlLmNoYXJBdCgwKSA9PSAiXyIgJiYgdGhpcy5vcHRpb25zLnVuZGVyc2NvcmVIYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFjayA9ICJfIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlblZhbHVlID0gdG9rZW5WYWx1ZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBuZXcgUHJvcGVydHlOYW1lKHRva2VuVmFsdWUsIGhhY2ssIGxpbmUgfHwgdG9rZW4uc3RhcnRMaW5lLCBjb2wgfHwgdG9rZW4uc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIC8vQXVnbWVudGVkIHdpdGggQ1NTMyBTZWxlY3RvcnMKICAgICAgICAgICAgICAgICAgICBfcnVsZXNldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBydWxlc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBzZWxlY3RvcnNfZ3JvdXAKICAgICAgICAgICAgICAgICAgICAgICAgICogICAgICd7JyBTKiBkZWNsYXJhdGlvbj8gWyAnOycgUyogZGVjbGFyYXRpb24/IF0qICd9JyBTKgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3JzOwoKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogRXJyb3IgUmVjb3Zlcnk6IElmIGV2ZW4gYSBzaW5nbGUgc2VsZWN0b3IgZmFpbHMgdG8gcGFyc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAqIHRoZW4gdGhlIGVudGlyZSBydWxlc2V0IHNob3VsZCBiZSB0aHJvd24gYXdheS4KICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RvcnMgPSB0aGlzLl9zZWxlY3RvcnNfZ3JvdXAoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIFN5bnRheEVycm9yICYmICF0aGlzLm9wdGlvbnMuc3RyaWN0KSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZmlyZSBlcnJvciBldmVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZXgubWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogZXgubGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBleC5jb2wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9za2lwIG92ZXIgZXZlcnl0aGluZyB1bnRpbCBjbG9zaW5nIGJyYWNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQgPSB0b2tlblN0cmVhbS5hZHZhbmNlKFtUb2tlbnMuUkJSQUNFXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR0ID09IFRva2Vucy5SQlJBQ0UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiB0aGVyZSdzIGEgcmlnaHQgYnJhY2UsIHRoZSBydWxlIGlzIGZpbmlzaGVkIHNvIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9vdGhlcndpc2UsIHJldGhyb3cgdGhlIGVycm9yIGJlY2F1c2UgaXQgd2Fzbid0IGhhbmRsZWQgcHJvcGVybHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL25vdCBhIHN5bnRheCBlcnJvciwgcmV0aHJvdyBpdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdHJpZ2dlciBwYXJzZXIgdG8gY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvL2lmIGl0IGdvdCBoZXJlLCBhbGwgc2VsZWN0b3JzIHBhcnNlZAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3JzKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAic3RhcnRydWxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RvcnM6IHNlbGVjdG9ycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBzZWxlY3RvcnNbMF0ubGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w6IHNlbGVjdG9yc1swXS5jb2wKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWREZWNsYXJhdGlvbnModHJ1ZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZW5kcnVsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3JzOiBzZWxlY3RvcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogc2VsZWN0b3JzWzBdLmxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBzZWxlY3RvcnNbMF0uY29sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdG9yczsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAvL0NTUzMgU2VsZWN0b3JzCiAgICAgICAgICAgICAgICAgICAgX3NlbGVjdG9yc19ncm91cDogZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogc2VsZWN0b3JzX2dyb3VwCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBzZWxlY3RvciBbIENPTU1BIFMqIHNlbGVjdG9yIF0qCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RvcnMgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yOwoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IgPSB0aGlzLl9zZWxlY3RvcigpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3IgIT09IG51bGwpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RvcnMucHVzaChzZWxlY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAodG9rZW5TdHJlYW0ubWF0Y2goVG9rZW5zLkNPTU1BKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IgPSB0aGlzLl9zZWxlY3RvcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RvciAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RvcnMucHVzaChzZWxlY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdW5leHBlY3RlZFRva2VuKHRva2VuU3RyZWFtLkxUKDEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RvcnMubGVuZ3RoID8gc2VsZWN0b3JzIDogbnVsbDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAvL0NTUzMgU2VsZWN0b3JzCiAgICAgICAgICAgICAgICAgICAgX3NlbGVjdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIHNlbGVjdG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBzaW1wbGVfc2VsZWN0b3Jfc2VxdWVuY2UgWyBjb21iaW5hdG9yIHNpbXBsZV9zZWxlY3Rvcl9zZXF1ZW5jZSBdKgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0U2VsZWN0b3IgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tYmluYXRvciA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cyA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgICAgICAvL2lmIHRoZXJlJ3Mgbm8gc2ltcGxlIHNlbGVjdG9yLCB0aGVuIHRoZXJlJ3Mgbm8gc2VsZWN0b3IKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dFNlbGVjdG9yID0gdGhpcy5fc2ltcGxlX3NlbGVjdG9yX3NlcXVlbmNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0U2VsZWN0b3IgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvci5wdXNoKG5leHRTZWxlY3Rvcik7CgogICAgICAgICAgICAgICAgICAgICAgICBkbyB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9sb29rIGZvciBhIGNvbWJpbmF0b3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbWJpbmF0b3IgPSB0aGlzLl9jb21iaW5hdG9yKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbWJpbmF0b3IgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvci5wdXNoKGNvbWJpbmF0b3IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRTZWxlY3RvciA9IHRoaXMuX3NpbXBsZV9zZWxlY3Rvcl9zZXF1ZW5jZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RoZXJlIG11c3QgYmUgYSBuZXh0IHNlbGVjdG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRTZWxlY3RvciA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl91bmV4cGVjdGVkVG9rZW4odGhpcy5MVCgxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbmV4dFNlbGVjdG9yIGlzIGFuIGluc3RhbmNlIG9mIFNlbGVjdG9yUGFydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvci5wdXNoKG5leHRTZWxlY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiB0aGVyZSdzIG5vdCB3aGl0ZXNwYWNlLCB3ZSdyZSBkb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCkpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vYWRkIHdoaXRlc3BhY2Ugc2VwYXJhdG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdzID0gbmV3IENvbWJpbmF0b3IodG9rZW5TdHJlYW0udG9rZW4oKS52YWx1ZSwgdG9rZW5TdHJlYW0udG9rZW4oKS5zdGFydExpbmUsIHRva2VuU3RyZWFtLnRva2VuKCkuc3RhcnRDb2wpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb21iaW5hdG9yIGlzIG5vdCByZXF1aXJlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21iaW5hdG9yID0gdGhpcy5fY29tYmluYXRvcigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9zZWxlY3RvciBpcyByZXF1aXJlZCBpZiB0aGVyZSdzIGEgY29tYmluYXRvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0U2VsZWN0b3IgPSB0aGlzLl9zaW1wbGVfc2VsZWN0b3Jfc2VxdWVuY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRTZWxlY3RvciA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbWJpbmF0b3IgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl91bmV4cGVjdGVkVG9rZW4odG9rZW5TdHJlYW0uTFQoMSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb21iaW5hdG9yICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IucHVzaChjb21iaW5hdG9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IucHVzaCh3cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IucHVzaChuZXh0U2VsZWN0b3IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlICh0cnVlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2VsZWN0b3Ioc2VsZWN0b3IsIHNlbGVjdG9yWzBdLmxpbmUsIHNlbGVjdG9yWzBdLmNvbCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy9DU1MzIFNlbGVjdG9ycwogICAgICAgICAgICAgICAgICAgIF9zaW1wbGVfc2VsZWN0b3Jfc2VxdWVuY2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogc2ltcGxlX3NlbGVjdG9yX3NlcXVlbmNlCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBbIHR5cGVfc2VsZWN0b3IgfCB1bml2ZXJzYWwgXQogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICAgWyBIQVNIIHwgY2xhc3MgfCBhdHRyaWIgfCBwc2V1ZG8gfCBuZWdhdGlvbiBdKgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIHwgWyBIQVNIIHwgY2xhc3MgfCBhdHRyaWIgfCBwc2V1ZG8gfCBuZWdhdGlvbiBdKwogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKCgogICAgICAgICAgICAgICAgICAgICAgICAvL3BhcnRzIG9mIGEgc2ltcGxlIHNlbGVjdG9yCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnROYW1lID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVycyA9IFtdLAoKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29tcGxldGUgc2VsZWN0b3IgdGV4dAogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RvclRleHQgPSAiIiwKCgogICAgICAgICAgICAgICAgICAgICAgICAvL3RoZSBkaWZmZXJlbnQgcGFydHMgYWZ0ZXIgdGhlIGVsZW1lbnQgbmFtZSB0byBzZWFyY2ggZm9yCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudHMgPSBbCiAgICAgICAgICAgICAgICAgICAgICAgIC8vSEFTSAogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9rZW5TdHJlYW0ubWF0Y2goVG9rZW5zLkhBU0gpID8gbmV3IFNlbGVjdG9yU3ViUGFydCh0b2tlblN0cmVhbS50b2tlbigpLnZhbHVlLCAiaWQiLCB0b2tlblN0cmVhbS50b2tlbigpLnN0YXJ0TGluZSwgdG9rZW5TdHJlYW0udG9rZW4oKS5zdGFydENvbCkgOiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLl9jbGFzcywgdGhpcy5fYXR0cmliLCB0aGlzLl9wc2V1ZG8sIHRoaXMuX25lZ2F0aW9uXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuID0gY29tcG9uZW50cy5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w7CgogICAgICAgICAgICAgICAgICAgICAgICAvL2dldCBzdGFydGluZyBsaW5lIGFuZCBjb2x1bW4gZm9yIHRoZSBzZWxlY3RvcgogICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gdG9rZW5TdHJlYW0uTFQoMSkuc3RhcnRMaW5lOwogICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSB0b2tlblN0cmVhbS5MVCgxKS5zdGFydENvbDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnROYW1lID0gdGhpcy5fdHlwZV9zZWxlY3RvcigpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50TmFtZSA9IHRoaXMuX3VuaXZlcnNhbCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudE5hbWUgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yVGV4dCArPSBlbGVtZW50TmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3doaXRlc3BhY2UgbWVhbnMgd2UncmUgZG9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLnBlZWsoKSA9PT0gVG9rZW5zLlMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NoZWNrIGZvciBlYWNoIGNvbXBvbmVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGkgPCBsZW4gJiYgY29tcG9uZW50ID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50c1tpKytdLmNhbGwodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudCA9PT0gbnVsbCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3dlIGRvbid0IGhhdmUgYSBzZWxlY3RvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RvclRleHQgPT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZXJzLnB1c2goY29tcG9uZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RvclRleHQgKz0gY29tcG9uZW50LnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdG9yVGV4dCAhPT0gIiIgPyBuZXcgU2VsZWN0b3JQYXJ0KGVsZW1lbnROYW1lLCBtb2RpZmllcnMsIHNlbGVjdG9yVGV4dCwgbGluZSwgY29sKSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy9DU1MzIFNlbGVjdG9ycwogICAgICAgICAgICAgICAgICAgIF90eXBlX3NlbGVjdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIHR5cGVfc2VsZWN0b3IKICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IFsgbmFtZXNwYWNlX3ByZWZpeCBdPyBlbGVtZW50X25hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICogICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBucyA9IHRoaXMuX25hbWVzcGFjZV9wcmVmaXgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnROYW1lID0gdGhpcy5fZWxlbWVudF9uYW1lKCk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogTmVlZCB0byBiYWNrIG91dCB0aGUgbmFtZXNwYWNlIHRoYXQgd2FzIHJlYWQgZHVlIHRvIGJvdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIHR5cGVfc2VsZWN0b3IgYW5kIHVuaXZlcnNhbCByZWFkaW5nIG5hbWVzcGFjZV9wcmVmaXgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGZpcnN0LiBLaW5kIG9mIGhhY2t5LCBidXQgb25seSB3YXkgSSBjYW4gZmlndXJlIG91dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogcmlnaHQgbm93IGhvdyB0byBub3QgY2hhbmdlIHRoZSBncmFtbWFyLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS51bmdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChucy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLnVuZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudE5hbWUudGV4dCA9IG5zICsgZWxlbWVudE5hbWUudGV4dDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50TmFtZS5jb2wgLT0gbnMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnROYW1lOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy9DU1MzIFNlbGVjdG9ycwogICAgICAgICAgICAgICAgICAgIF9jbGFzczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBjbGFzcwogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDogJy4nIElERU5UCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW47CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5TdHJlYW0ubWF0Y2goVG9rZW5zLkRPVCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm11c3RNYXRjaChUb2tlbnMuSURFTlQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0b2tlblN0cmVhbS50b2tlbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RvclN1YlBhcnQoIi4iICsgdG9rZW4udmFsdWUsICJjbGFzcyIsIHRva2VuLnN0YXJ0TGluZSwgdG9rZW4uc3RhcnRDb2wgLSAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy9DU1MzIFNlbGVjdG9ycwogICAgICAgICAgICAgICAgICAgIF9lbGVtZW50X25hbWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogZWxlbWVudF9uYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBJREVOVAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5JREVOVCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdG9rZW5TdHJlYW0udG9rZW4oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2VsZWN0b3JTdWJQYXJ0KHRva2VuLnZhbHVlLCAiZWxlbWVudE5hbWUiLCB0b2tlbi5zdGFydExpbmUsIHRva2VuLnN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy9DU1MzIFNlbGVjdG9ycwogICAgICAgICAgICAgICAgICAgIF9uYW1lc3BhY2VfcHJlZml4OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIG5hbWVzcGFjZV9wcmVmaXgKICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IFsgSURFTlQgfCAnKicgXT8gJ3wnCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICIiOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy92ZXJpZnkgdGhhdCB0aGlzIGlzIGEgbmFtZXNwYWNlIHByZWZpeAogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5TdHJlYW0uTEEoMSkgPT09IFRva2Vucy5QSVBFIHx8IHRva2VuU3RyZWFtLkxBKDIpID09PSBUb2tlbnMuUElQRSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaChbVG9rZW5zLklERU5ULCBUb2tlbnMuU1RBUl0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gdG9rZW5TdHJlYW0udG9rZW4oKS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLlBJUEUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gInwiOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUubGVuZ3RoID8gdmFsdWUgOiBudWxsOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIC8vQ1NTMyBTZWxlY3RvcnMKICAgICAgICAgICAgICAgICAgICBfdW5pdmVyc2FsOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIHVuaXZlcnNhbAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDogWyBuYW1lc3BhY2VfcHJlZml4IF0/ICcqJwogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5zOwoKICAgICAgICAgICAgICAgICAgICAgICAgbnMgPSB0aGlzLl9uYW1lc3BhY2VfcHJlZml4KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChucykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gbnM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuU1RBUikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9ICIqIjsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlLmxlbmd0aCA/IHZhbHVlIDogbnVsbDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAvL0NTUzMgU2VsZWN0b3JzCiAgICAgICAgICAgICAgICAgICAgX2F0dHJpYjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBhdHRyaWIKICAgICAgICAgICAgICAgICAgICAgICAgICogICA6ICdbJyBTKiBbIG5hbWVzcGFjZV9wcmVmaXggXT8gSURFTlQgUyoKICAgICAgICAgICAgICAgICAgICAgICAgICogICAgICAgICBbIFsgUFJFRklYTUFUQ0ggfAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICAgICAgICAgICBTVUZGSVhNQVRDSCB8CiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgICAgICAgICAgIFNVQlNUUklOR01BVENIIHwKICAgICAgICAgICAgICAgICAgICAgICAgICogICAgICAgICAgICAgJz0nIHwKICAgICAgICAgICAgICAgICAgICAgICAgICogICAgICAgICAgICAgSU5DTFVERVMgfAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICAgICAgICAgICBEQVNITUFUQ0ggXSBTKiBbIElERU5UIHwgU1RSSU5HIF0gUyoKICAgICAgICAgICAgICAgICAgICAgICAgICogICAgICAgICBdPyAnXScKICAgICAgICAgICAgICAgICAgICAgICAgICogICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5MQlJBQ0tFVCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdG9rZW5TdHJlYW0udG9rZW4oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdG9rZW4udmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5zID0gdGhpcy5fbmFtZXNwYWNlX3ByZWZpeCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChucykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IG5zOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm11c3RNYXRjaChUb2tlbnMuSURFTlQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gdG9rZW5TdHJlYW0udG9rZW4oKS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLm1hdGNoKFtUb2tlbnMuUFJFRklYTUFUQ0gsIFRva2Vucy5TVUZGSVhNQVRDSCwgVG9rZW5zLlNVQlNUUklOR01BVENILCBUb2tlbnMuRVFVQUxTLCBUb2tlbnMuSU5DTFVERVMsIFRva2Vucy5EQVNITUFUQ0hdKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSB0b2tlblN0cmVhbS50b2tlbigpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm11c3RNYXRjaChbVG9rZW5zLklERU5ULCBUb2tlbnMuU1RSSU5HXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gdG9rZW5TdHJlYW0udG9rZW4oKS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm11c3RNYXRjaChUb2tlbnMuUkJSQUNLRVQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2VsZWN0b3JTdWJQYXJ0KHZhbHVlICsgIl0iLCAiYXR0cmlidXRlIiwgdG9rZW4uc3RhcnRMaW5lLCB0b2tlbi5zdGFydENvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIC8vQ1NTMyBTZWxlY3RvcnMKICAgICAgICAgICAgICAgICAgICBfcHNldWRvOiBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBwc2V1ZG8KICAgICAgICAgICAgICAgICAgICAgICAgICogICA6ICc6JyAnOic/IFsgSURFTlQgfCBmdW5jdGlvbmFsX3BzZXVkbyBdCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHNldWRvID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9ucyA9ICI6IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5TdHJlYW0ubWF0Y2goVG9rZW5zLkNPTE9OKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuQ09MT04pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb25zICs9ICI6IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5TdHJlYW0ubWF0Y2goVG9rZW5zLklERU5UKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBzZXVkbyA9IHRva2VuU3RyZWFtLnRva2VuKCkudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IHRva2VuU3RyZWFtLnRva2VuKCkuc3RhcnRMaW5lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9IHRva2VuU3RyZWFtLnRva2VuKCkuc3RhcnRDb2wgLSBjb2xvbnMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0b2tlblN0cmVhbS5wZWVrKCkgPT0gVG9rZW5zLkZVTkNUSU9OKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IHRva2VuU3RyZWFtLkxUKDEpLnN0YXJ0TGluZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSB0b2tlblN0cmVhbS5MVCgxKS5zdGFydENvbCAtIGNvbG9ucy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHNldWRvID0gdGhpcy5fZnVuY3Rpb25hbF9wc2V1ZG8oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHNldWRvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHNldWRvID0gbmV3IFNlbGVjdG9yU3ViUGFydChjb2xvbnMgKyBwc2V1ZG8sICJwc2V1ZG8iLCBsaW5lLCBjb2wpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHNldWRvOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIC8vQ1NTMyBTZWxlY3RvcnMKICAgICAgICAgICAgICAgICAgICBfZnVuY3Rpb25hbF9wc2V1ZG86IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogZnVuY3Rpb25hbF9wc2V1ZG8KICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IEZVTkNUSU9OIFMqIGV4cHJlc3Npb24gJyknCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5TdHJlYW0ubWF0Y2goVG9rZW5zLkZVTkNUSU9OKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0b2tlblN0cmVhbS50b2tlbigpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IHRoaXMuX2V4cHJlc3Npb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm11c3RNYXRjaChUb2tlbnMuUlBBUkVOKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9ICIpIjsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIC8vQ1NTMyBTZWxlY3RvcnMKICAgICAgICAgICAgICAgICAgICBfZXhwcmVzc2lvbjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBleHByZXNzaW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBbIFsgUExVUyB8ICctJyB8IERJTUVOU0lPTiB8IE5VTUJFUiB8IFNUUklORyB8IElERU5UIF0gUyogXSsKICAgICAgICAgICAgICAgICAgICAgICAgICogICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICIiOwoKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRva2VuU3RyZWFtLm1hdGNoKFtUb2tlbnMuUExVUywgVG9rZW5zLk1JTlVTLCBUb2tlbnMuRElNRU5TSU9OLCBUb2tlbnMuTlVNQkVSLCBUb2tlbnMuU1RSSU5HLCBUb2tlbnMuSURFTlQsIFRva2Vucy5MRU5HVEgsIFRva2Vucy5GUkVRLCBUb2tlbnMuQU5HTEUsIFRva2Vucy5USU1FLCBUb2tlbnMuUkVTT0xVVElPTl0pKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gdG9rZW5TdHJlYW0udG9rZW4oKS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS5sZW5ndGggPyB2YWx1ZSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy9DU1MzIFNlbGVjdG9ycwogICAgICAgICAgICAgICAgICAgIF9uZWdhdGlvbjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBuZWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDogTk9UIFMqIG5lZ2F0aW9uX2FyZyBTKiAnKScKICAgICAgICAgICAgICAgICAgICAgICAgICogICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnBhcnQgPSBudWxsOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5OT1QpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHRva2VuU3RyZWFtLnRva2VuKCkudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gdG9rZW5TdHJlYW0udG9rZW4oKS5zdGFydExpbmU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSB0b2tlblN0cmVhbS50b2tlbigpLnN0YXJ0Q29sOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZyA9IHRoaXMuX25lZ2F0aW9uX2FyZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gYXJnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5SUEFSRU4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gdG9rZW5TdHJlYW0udG9rZW4oKS52YWx1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJwYXJ0ID0gbmV3IFNlbGVjdG9yU3ViUGFydCh2YWx1ZSwgIm5vdCIsIGxpbmUsIGNvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJwYXJ0LmFyZ3MucHVzaChhcmcpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VicGFydDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAvL0NTUzMgU2VsZWN0b3JzCiAgICAgICAgICAgICAgICAgICAgX25lZ2F0aW9uX2FyZzogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBuZWdhdGlvbl9hcmcKICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IHR5cGVfc2VsZWN0b3IgfCB1bml2ZXJzYWwgfCBIQVNIIHwgY2xhc3MgfCBhdHRyaWIgfCBwc2V1ZG8KICAgICAgICAgICAgICAgICAgICAgICAgICogICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gW3RoaXMuX3R5cGVfc2VsZWN0b3IsIHRoaXMuX3VuaXZlcnNhbCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5IQVNIKSA/IG5ldyBTZWxlY3RvclN1YlBhcnQodG9rZW5TdHJlYW0udG9rZW4oKS52YWx1ZSwgImlkIiwgdG9rZW5TdHJlYW0udG9rZW4oKS5zdGFydExpbmUsIHRva2VuU3RyZWFtLnRva2VuKCkuc3RhcnRDb2wpIDogbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5fY2xhc3MsIHRoaXMuX2F0dHJpYiwgdGhpcy5fcHNldWRvXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZyA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbiA9IGFyZ3MubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSB0b2tlblN0cmVhbS5MVCgxKS5zdGFydExpbmU7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9IHRva2VuU3RyZWFtLkxUKDEpLnN0YXJ0Q29sOwoKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGkgPCBsZW4gJiYgYXJnID09PSBudWxsKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnID0gYXJnc1tpXS5jYWxsKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvL211c3QgYmUgYSBuZWdhdGlvbiBhcmcKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZyA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdW5leHBlY3RlZFRva2VuKHRva2VuU3RyZWFtLkxUKDEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy9pdCdzIGFuIGVsZW1lbnQgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJnLnR5cGUgPT0gImVsZW1lbnROYW1lIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydCA9IG5ldyBTZWxlY3RvclBhcnQoYXJnLCBbXSwgYXJnLnRvU3RyaW5nKCksIGxpbmUsIGNvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0ID0gbmV3IFNlbGVjdG9yUGFydChudWxsLCBbYXJnXSwgYXJnLnRvU3RyaW5nKCksIGxpbmUsIGNvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJ0OwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIF9kZWNsYXJhdGlvbjogZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogZGVjbGFyYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IHByb3BlcnR5ICc6JyBTKiBleHByIHByaW8/CiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgfCAvKCBlbXB0eSApLwogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHIgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbyA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnZhbGlkID0gbnVsbDsKCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gdGhpcy5fcHJvcGVydHkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5ICE9PSBudWxsKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5TdHJlYW0ubXVzdE1hdGNoKFRva2Vucy5DT0xPTik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHIgPSB0aGlzLl9leHByKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiB0aGVyZSdzIG5vIHBhcnRzIGZvciB0aGUgdmFsdWUsIGl0J3MgYW4gZXJyb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZXhwciB8fCBleHByLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3VuZXhwZWN0ZWRUb2tlbih0b2tlblN0cmVhbS5MVCgxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbyA9IHRoaXMuX3ByaW8oKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3ZhbGlkYXRlUHJvcGVydHkocHJvcGVydHksIGV4cHIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnZhbGlkID0gZXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAicHJvcGVydHkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiBwcm9wZXJ0eSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZXhwciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnRhbnQ6IHByaW8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogcHJvcGVydHkubGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w6IHByb3BlcnR5LmNvbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnZhbGlkOiBpbnZhbGlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIF9wcmlvOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIHByaW8KICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IElNUE9SVEFOVF9TWU0gUyoKICAgICAgICAgICAgICAgICAgICAgICAgICogICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuSU1QT1JUQU5UX1NZTSk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIF9leHByOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIGV4cHIKICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IHRlcm0gWyBvcGVyYXRvciB0ZXJtIF0qCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0gW10sCgogICAgICAgICAgICAgICAgICAgICAgICAvL3ZhbHVlUGFydHMJPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3IgPSBudWxsOwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLl90ZXJtKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHZhbHVlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3IgPSB0aGlzLl9vcGVyYXRvcigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIHRoZXJlJ3MgYW4gb3BlcmF0b3IsIGtlZXAgYnVpbGRpbmcgdXAgdGhlIHZhbHVlIHBhcnRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wZXJhdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKG9wZXJhdG9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IC8qZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUncyBub3QgYW4gb3BlcmF0b3IsIHlvdSBoYXZlIGEgZnVsbCB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzLnB1c2gobmV3IFByb3BlcnR5VmFsdWUodmFsdWVQYXJ0cywgdmFsdWVQYXJ0c1swXS5saW5lLCB2YWx1ZVBhcnRzWzBdLmNvbCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVQYXJ0cyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSovCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5fdGVybSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzLnB1c2godmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvL2NsZWFudXAKICAgICAgICAgICAgICAgICAgICAgICAgLyppZiAodmFsdWVQYXJ0cy5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzLnB1c2gobmV3IFByb3BlcnR5VmFsdWUodmFsdWVQYXJ0cywgdmFsdWVQYXJ0c1swXS5saW5lLCB2YWx1ZVBhcnRzWzBdLmNvbCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9Ki8KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZXMubGVuZ3RoID4gMCA/IG5ldyBQcm9wZXJ0eVZhbHVlKHZhbHVlcywgdmFsdWVzWzBdLnN0YXJ0TGluZSwgdmFsdWVzWzBdLnN0YXJ0Q29sKSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgX3Rlcm06IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIHRlcm0KICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IHVuYXJ5X29wZXJhdG9yPwogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICAgWyBOVU1CRVIgUyogfCBQRVJDRU5UQUdFIFMqIHwgTEVOR1RIIFMqIHwgQU5HTEUgUyogfAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgICAgICBUSU1FIFMqIHwgRlJFUSBTKiB8IGZ1bmN0aW9uIHwgaWVfZnVuY3Rpb24gXQogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIHwgU1RSSU5HIFMqIHwgSURFTlQgUyogfCBVUkkgUyogfCBVTklDT0RFUkFOR0UgUyogfCBoZXhjb2xvcgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuYXJ5ID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2w7CgogICAgICAgICAgICAgICAgICAgICAgICAvL3JldHVybnMgdGhlIG9wZXJhdG9yIG9yIG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgdW5hcnkgPSB0aGlzLl91bmFyeV9vcGVyYXRvcigpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5hcnkgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSB0b2tlblN0cmVhbS50b2tlbigpLnN0YXJ0TGluZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9IHRva2VuU3RyZWFtLnRva2VuKCkuc3RhcnRDb2w7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vZXhjZXB0aW9uIGZvciBJRSBmaWx0ZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5wZWVrKCkgPT0gVG9rZW5zLklFX0ZVTkNUSU9OICYmIHRoaXMub3B0aW9ucy5pZUZpbHRlcnMpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMuX2llX2Z1bmN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5hcnkgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gdG9rZW5TdHJlYW0udG9rZW4oKS5zdGFydExpbmU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sID0gdG9rZW5TdHJlYW0udG9rZW4oKS5zdGFydENvbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3NlZSBpZiB0aGVyZSdzIGEgc2ltcGxlIG1hdGNoCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodG9rZW5TdHJlYW0ubWF0Y2goW1Rva2Vucy5OVU1CRVIsIFRva2Vucy5QRVJDRU5UQUdFLCBUb2tlbnMuTEVOR1RILCBUb2tlbnMuQU5HTEUsIFRva2Vucy5USU1FLCBUb2tlbnMuRlJFUSwgVG9rZW5zLlNUUklORywgVG9rZW5zLklERU5ULCBUb2tlbnMuVVJJLCBUb2tlbnMuVU5JQ09ERV9SQU5HRV0pKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0b2tlblN0cmVhbS50b2tlbigpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVuYXJ5ID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IHRva2VuU3RyZWFtLnRva2VuKCkuc3RhcnRMaW5lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9IHRva2VuU3RyZWFtLnRva2VuKCkuc3RhcnRDb2w7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vc2VlIGlmIGl0J3MgYSBjb2xvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLl9oZXhjb2xvcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUncyBubyB1bmFyeSwgZ2V0IHRoZSBzdGFydCBvZiB0aGUgbmV4dCB0b2tlbiBmb3IgbGluZS9jb2wgaW5mbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1bmFyeSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gdG9rZW5TdHJlYW0uTFQoMSkuc3RhcnRMaW5lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSB0b2tlblN0cmVhbS5MVCgxKS5zdGFydENvbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaGFzIHRvIGJlIGEgZnVuY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFRoaXMgY2hlY2tzIGZvciBhbHBoYShvcGFjaXR5PTApIHN0eWxlIG9mIElFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGZ1bmN0aW9ucy4gSUVfRlVOQ1RJT04gb25seSBwcmVzZW50cyBwcm9naWQ6IHN0eWxlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLkxBKDMpID09IFRva2Vucy5FUVVBTFMgJiYgdGhpcy5vcHRpb25zLmllRmlsdGVycykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLl9pZV9mdW5jdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLl9mdW5jdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKmlmICh2YWx1ZSA9PT0gbnVsbCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3Rocm93IG5ldyBFcnJvcigiRXhwZWN0ZWQgaWRlbnRpZmllciBhdCBsaW5lICIgKyB0b2tlblN0cmVhbS50b2tlbigpLnN0YXJ0TGluZSArICIsIGNoYXJhY3RlciAiICsgIHRva2VuU3RyZWFtLnRva2VuKCkuc3RhcnRDb2wgKyAiLiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0qLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5hcnkgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IHRva2VuU3RyZWFtLnRva2VuKCkuc3RhcnRMaW5lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSB0b2tlblN0cmVhbS50b2tlbigpLnN0YXJ0Q29sOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlICE9PSBudWxsID8gbmV3IFByb3BlcnR5VmFsdWVQYXJ0KHVuYXJ5ICE9PSBudWxsID8gdW5hcnkgKyB2YWx1ZSA6IHZhbHVlLCBsaW5lLCBjb2wpIDogbnVsbDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBfZnVuY3Rpb246IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBGVU5DVElPTiBTKiBleHByICcpJyBTKgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5TdHJlYW0gPSB0aGlzLl90b2tlblN0cmVhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uVGV4dCA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHByID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx0OwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5GVU5DVElPTikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uVGV4dCA9IHRva2VuU3RyZWFtLnRva2VuKCkudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwciA9IHRoaXMuX2V4cHIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uVGV4dCArPSBleHByOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vU1RBUlQ6IEhvcnJpYmxlIGhhY2sgaW4gY2FzZSBpdCdzIGFuIElFIGZpbHRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZUZpbHRlcnMgJiYgdG9rZW5TdHJlYW0ucGVlaygpID09IFRva2Vucy5FUVVBTFMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcmVhZFdoaXRlc3BhY2UoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25UZXh0ICs9IHRva2VuU3RyZWFtLnRva2VuKCkudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbWlnaHQgYmUgc2Vjb25kIHRpbWUgaW4gdGhlIGxvb3AKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuU3RyZWFtLkxBKDApID09IFRva2Vucy5DT01NQSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25UZXh0ICs9IHRva2VuU3RyZWFtLnRva2VuKCkudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5JREVOVCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uVGV4dCArPSB0b2tlblN0cmVhbS50b2tlbigpLnZhbHVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5TdHJlYW0ubWF0Y2goVG9rZW5zLkVRVUFMUyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uVGV4dCArPSB0b2tlblN0cmVhbS50b2tlbigpLnZhbHVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9mdW5jdGlvblRleHQgKz0gdGhpcy5fdGVybSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdCA9IHRva2VuU3RyZWFtLnBlZWsoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGx0ICE9IFRva2Vucy5DT01NQSAmJiBsdCAhPSBUb2tlbnMuUyAmJiBsdCAhPSBUb2tlbnMuUlBBUkVOKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5nZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uVGV4dCArPSB0b2tlblN0cmVhbS50b2tlbigpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbHQgPSB0b2tlblN0cmVhbS5wZWVrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlICh0b2tlblN0cmVhbS5tYXRjaChbVG9rZW5zLkNPTU1BLCBUb2tlbnMuU10pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0VORDogSG9ycmlibGUgSGFjawoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5SUEFSRU4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25UZXh0ICs9ICIpIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvblRleHQ7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgX2llX2Z1bmN0aW9uOiBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAvKiAoTXkgb3duIGV4dGVuc2lvbikKICAgICAgICAgICAgICAgICAgICAgICAgICogaWVfZnVuY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IElFX0ZVTkNUSU9OIFMqIElERU5UICc9JyB0ZXJtIFtTKiAnLCc/IElERU5UICc9JyB0ZXJtXSsgJyknIFMqCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25UZXh0ID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHIgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbHQ7CgogICAgICAgICAgICAgICAgICAgICAgICAvL0lFIGZ1bmN0aW9uIGNhbiBiZWdpbiBsaWtlIGEgcmVndWxhciBmdW5jdGlvbiwgdG9vCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaChbVG9rZW5zLklFX0ZVTkNUSU9OLCBUb2tlbnMuRlVOQ1RJT05dKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25UZXh0ID0gdG9rZW5TdHJlYW0udG9rZW4oKS52YWx1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZWFkV2hpdGVzcGFjZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uVGV4dCArPSB0b2tlblN0cmVhbS50b2tlbigpLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9taWdodCBiZSBzZWNvbmQgdGltZSBpbiB0aGUgbG9vcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5MQSgwKSA9PSBUb2tlbnMuQ09NTUEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25UZXh0ICs9IHRva2VuU3RyZWFtLnRva2VuKCkudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuSURFTlQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uVGV4dCArPSB0b2tlblN0cmVhbS50b2tlbigpLnZhbHVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuRVFVQUxTKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvblRleHQgKz0gdG9rZW5TdHJlYW0udG9rZW4oKS52YWx1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9mdW5jdGlvblRleHQgKz0gdGhpcy5fdGVybSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx0ID0gdG9rZW5TdHJlYW0ucGVlaygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChsdCAhPSBUb2tlbnMuQ09NTUEgJiYgbHQgIT0gVG9rZW5zLlMgJiYgbHQgIT0gVG9rZW5zLlJQQVJFTikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5nZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25UZXh0ICs9IHRva2VuU3RyZWFtLnRva2VuKCkudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx0ID0gdG9rZW5TdHJlYW0ucGVlaygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKHRva2VuU3RyZWFtLm1hdGNoKFtUb2tlbnMuQ09NTUEsIFRva2Vucy5TXSkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5SUEFSRU4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25UZXh0ICs9ICIpIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvblRleHQ7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgX2hleGNvbG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIFRoZXJlIGlzIGEgY29uc3RyYWludCBvbiB0aGUgY29sb3IgdGhhdCBpdCBtdXN0CiAgICAgICAgICAgICAgICAgICAgICAgICAqIGhhdmUgZWl0aGVyIDMgb3IgNiBoZXgtZGlnaXRzIChpLmUuLCBbMC05YS1mQS1GXSkKICAgICAgICAgICAgICAgICAgICAgICAgICogYWZ0ZXIgdGhlICIjIjsgZS5nLiwgIiMwMDAiIGlzIE9LLCBidXQgIiNhYmNkIiBpcyBub3QuCiAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAqIGhleGNvbG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBIQVNIIFMqCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5TdHJlYW0ubWF0Y2goVG9rZW5zLkhBU0gpKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9uZWVkIHRvIGRvIHNvbWUgdmFsaWRhdGlvbiBoZXJlCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0b2tlblN0cmVhbS50b2tlbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSB0b2tlbi52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghLyNbYS1mMC05XXszLDZ9L2kudGVzdChjb2xvcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoIkV4cGVjdGVkIGEgaGV4IGNvbG9yIGJ1dCBmb3VuZCAnIiArIGNvbG9yICsgIicgYXQgbGluZSAiICsgdG9rZW4uc3RhcnRMaW5lICsgIiwgY29sICIgKyB0b2tlbi5zdGFydENvbCArICIuIiwgdG9rZW4uc3RhcnRMaW5lLCB0b2tlbi5zdGFydENvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sb3I7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAgICAgICAgIC8vIEFuaW1hdGlvbnMgbWV0aG9kcwogICAgICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAgICAgICAgICAgICAgICAgX2tleWZyYW1lczogZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICoga2V5ZnJhbWVzOgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDogS0VZRlJBTUVTX1NZTSBTKiBrZXlmcmFtZV9uYW1lIFMqICd7JyBTKiBrZXlmcmFtZV9ydWxlKiAnfScgewogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU7CgogICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLktFWUZSQU1FU19TWU0pOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gdGhpcy5fa2V5ZnJhbWVfbmFtZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5TdHJlYW0ubXVzdE1hdGNoKFRva2Vucy5MQlJBQ0UpOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdGFydGtleWZyYW1lcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbmFtZS5saW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBuYW1lLmNvbAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHR0ID0gdG9rZW5TdHJlYW0ucGVlaygpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9jaGVjayBmb3Iga2V5CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICh0dCA9PSBUb2tlbnMuSURFTlQgfHwgdHQgPT0gVG9rZW5zLlBFUkNFTlRBR0UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2tleWZyYW1lX3J1bGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dCA9IHRva2VuU3RyZWFtLnBlZWsoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJlbmRrZXlmcmFtZXMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IG5hbWUubGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogbmFtZS5jb2wKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB0b2tlblN0cmVhbS5tdXN0TWF0Y2goVG9rZW5zLlJCUkFDRSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgX2tleWZyYW1lX25hbWU6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIGtleWZyYW1lX25hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOiBJREVOVAogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIHwgU1RSSU5HCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbjsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm11c3RNYXRjaChbVG9rZW5zLklERU5ULCBUb2tlbnMuU1RSSU5HXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTeW50YXhVbml0LmZyb21Ub2tlbih0b2tlblN0cmVhbS50b2tlbigpKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBfa2V5ZnJhbWVfcnVsZTogZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICoga2V5ZnJhbWVfcnVsZToKICAgICAgICAgICAgICAgICAgICAgICAgICogICA6IGtleV9saXN0IFMqCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgICAneycgUyogZGVjbGFyYXRpb24gWyAnOycgUyogZGVjbGFyYXRpb24gXSogJ30nIFMqCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleUxpc3QgPSB0aGlzLl9rZXlfbGlzdCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdGFydGtleWZyYW1lcnVsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzOiBrZXlMaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZToga2V5TGlzdFswXS5saW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBrZXlMaXN0WzBdLmNvbAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWREZWNsYXJhdGlvbnModHJ1ZSk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImVuZGtleWZyYW1lcnVsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzOiBrZXlMaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZToga2V5TGlzdFswXS5saW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sOiBrZXlMaXN0WzBdLmNvbAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICBfa2V5X2xpc3Q6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIGtleV9saXN0OgogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDoga2V5IFsgUyogJywnIFMqIGtleV0qCiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleUxpc3QgPSBbXTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vbXVzdCBiZSBsZWFzdCBvbmUga2V5CiAgICAgICAgICAgICAgICAgICAgICAgIGtleUxpc3QucHVzaCh0aGlzLl9rZXkoKSk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5DT01NQSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlMaXN0LnB1c2godGhpcy5fa2V5KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleUxpc3Q7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgX2tleTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBUaGVyZSBpcyBhIHJlc3RyaWN0aW9uIHRoYXQgSURFTlQgY2FuIGJlIG9ubHkgImZyb20iIG9yICJ0byIuCiAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAqIGtleQogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIDogUEVSQ0VOVEFHRQogICAgICAgICAgICAgICAgICAgICAgICAgKiAgIHwgSURFTlQKICAgICAgICAgICAgICAgICAgICAgICAgICogICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuU3RyZWFtID0gdGhpcy5fdG9rZW5TdHJlYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbjsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuUEVSQ0VOVEFHRSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTeW50YXhVbml0LmZyb21Ub2tlbih0b2tlblN0cmVhbS50b2tlbigpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuSURFTlQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRva2VuU3RyZWFtLnRva2VuKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC9mcm9tfHRvL2kudGVzdCh0b2tlbi52YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3ludGF4VW5pdC5mcm9tVG9rZW4odG9rZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLnVuZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgaXQgZ2V0cyBoZXJlLCB0aGVyZSB3YXNuJ3QgYSB2YWxpZCB0b2tlbiwgc28gdGltZSB0byBleHBsb2RlCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3VuZXhwZWN0ZWRUb2tlbih0b2tlblN0cmVhbS5MVCgxKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAgICAgICAgIC8vIEhlbHBlciBtZXRob2RzCiAgICAgICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgICAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAgICAgKiBOb3QgcGFydCBvZiBDU1MgZ3JhbW1hciwgYnV0IHVzZWZ1bCBmb3Igc2tpcHBpbmcgb3ZlcgogICAgICAgICAgICAgICAgICAgICAqIGNvbWJpbmF0aW9uIG9mIHdoaXRlIHNwYWNlIGFuZCBIVE1MLXN0eWxlIGNvbW1lbnRzLgogICAgICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge3ZvaWR9CiAgICAgICAgICAgICAgICAgICAgICogQG1ldGhvZCBfc2tpcENydWZ0CiAgICAgICAgICAgICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICBfc2tpcENydWZ0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICh0aGlzLl90b2tlblN0cmVhbS5tYXRjaChbVG9rZW5zLlMsIFRva2Vucy5DRE8sIFRva2Vucy5DRENdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9ub29wCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAgICAgKiBOb3QgcGFydCBvZiBDU1MgZ3JhbW1hciwgYnV0IHRoaXMgcGF0dGVybiBvY2N1cnMgZnJlcXVlbnRseQogICAgICAgICAgICAgICAgICAgICAqIGluIHRoZSBvZmZpY2lhbCBDU1MgZ3JhbW1hci4gU3BsaXQgb3V0IGhlcmUgdG8gZWxpbWluYXRlCiAgICAgICAgICAgICAgICAgICAgICogZHVwbGljYXRlIGNvZGUuCiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBjaGVja1N0YXJ0IEluZGljYXRlcyBpZiB0aGUgcnVsZSBzaG91bGQgY2hlY2sKICAgICAgICAgICAgICAgICAgICAgKiAgICAgIGZvciB0aGUgbGVmdCBicmFjZSBhdCB0aGUgYmVnaW5uaW5nLgogICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gcmVhZE1hcmdpbnMgSW5kaWNhdGVzIGlmIHRoZSBydWxlIHNob3VsZCBjaGVjawogICAgICAgICAgICAgICAgICAgICAqICAgICAgZm9yIG1hcmdpbiBwYXR0ZXJucy4KICAgICAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICAgICAgICAgICAgICAgICAqIEBtZXRob2QgX3JlYWREZWNsYXJhdGlvbnMKICAgICAgICAgICAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgIF9yZWFkRGVjbGFyYXRpb25zOiBmdW5jdGlvbiAoY2hlY2tTdGFydCwgcmVhZE1hcmdpbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogUmVhZHMgdGhlIHBhdHRlcm4KICAgICAgICAgICAgICAgICAgICAgICAgICogUyogJ3snIFMqIGRlY2xhcmF0aW9uIFsgJzsnIFMqIGRlY2xhcmF0aW9uIF0qICd9JyBTKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBvcgogICAgICAgICAgICAgICAgICAgICAgICAgKiBTKiAneycgUyogWyBkZWNsYXJhdGlvbiB8IG1hcmdpbiBdPyBbICc7JyBTKiBbIGRlY2xhcmF0aW9uIHwgbWFyZ2luIF0/IF0qICd9JyBTKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBOb3RlIHRoYXQgdGhpcyBpcyBob3cgaXQgaXMgZGVzY3JpYmVkIGluIENTUzMgUGFnZWQgTWVkaWEsIGJ1dCBpcyBhY3R1YWxseSBpbmNvcnJlY3QuCiAgICAgICAgICAgICAgICAgICAgICAgICAqIEEgc2VtaWNvbG9uIGlzIG9ubHkgbmVjZXNzYXJ5IGZvbGxvd2luZyBhIGRlbGNhcmF0aW9uIGlzIHRoZXJlJ3MgYW5vdGhlciBkZWNsYXJhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgKiBvciBtYXJnaW4gYWZ0ZXJ3YXJkcy4KICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQ7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrU3RhcnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm11c3RNYXRjaChUb2tlbnMuTEJSQUNFKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlYWRNYXJnaW5zICYmIHRoaXMuX21hcmdpbigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbm9vcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fZGVjbGFyYXRpb24oKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5TRU1JQ09MT04pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAoKCF0aGlzLl9tYXJnaW4oKSAmJiAhdGhpcy5fZGVjbGFyYXRpb24oKSkgfHwgIXRva2VuU3RyZWFtLm1hdGNoKFRva2Vucy5TRU1JQ09MT04pKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuU3RyZWFtLm11c3RNYXRjaChUb2tlbnMuUkJSQUNFKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXggaW5zdGFuY2VvZiBTeW50YXhFcnJvciAmJiAhdGhpcy5vcHRpb25zLnN0cmljdCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2ZpcmUgZXJyb3IgZXZlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpcmUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGV4Lm1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IGV4LmxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogZXguY29sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vc2VlIGlmIHRoZXJlJ3MgYW5vdGhlciBkZWNsYXJhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0ID0gdG9rZW5TdHJlYW0uYWR2YW5jZShbVG9rZW5zLlNFTUlDT0xPTiwgVG9rZW5zLlJCUkFDRV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0dCA9PSBUb2tlbnMuU0VNSUNPTE9OKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUncyBhIHNlbWljb2xvbiwgdGhlbiB0aGVyZSBtaWdodCBiZSBhbm90aGVyIGRlY2xhcmF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWREZWNsYXJhdGlvbnMoZmFsc2UsIHJlYWRNYXJnaW5zKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR0ID09IFRva2Vucy5SQlJBQ0UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiB0aGVyZSdzIGEgcmlnaHQgYnJhY2UsIHRoZSBydWxlIGlzIGZpbmlzaGVkIHNvIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9vdGhlcndpc2UsIHJldGhyb3cgdGhlIGVycm9yIGJlY2F1c2UgaXQgd2Fzbid0IGhhbmRsZWQgcHJvcGVybHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL25vdCBhIHN5bnRheCBlcnJvciwgcmV0aHJvdyBpdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgICAgICogSW4gc29tZSBjYXNlcywgeW91IGNhbiBlbmQgdXAgd2l0aCB0d28gd2hpdGUgc3BhY2UgdG9rZW5zIGluIGEKICAgICAgICAgICAgICAgICAgICAgKiByb3cuIEluc3RlYWQgb2YgbWFraW5nIGEgY2hhbmdlIGluIGV2ZXJ5IGZ1bmN0aW9uIHRoYXQgbG9va3MgZm9yCiAgICAgICAgICAgICAgICAgICAgICogd2hpdGUgc3BhY2UsIHRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBtYXRjaCBhcyBtdWNoIHdoaXRlIHNwYWNlCiAgICAgICAgICAgICAgICAgICAgICogYXMgbmVjZXNzYXJ5LgogICAgICAgICAgICAgICAgICAgICAqIEBtZXRob2QgX3JlYWRXaGl0ZXNwYWNlCiAgICAgICAgICAgICAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgd2hpdGUgc3BhY2UgaWYgZm91bmQsIGVtcHR5IHN0cmluZyBpZiBub3QuCiAgICAgICAgICAgICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICBfcmVhZFdoaXRlc3BhY2U6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlblN0cmVhbSA9IHRoaXMuX3Rva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd3MgPSAiIjsKCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICh0b2tlblN0cmVhbS5tYXRjaChUb2tlbnMuUykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdzICs9IHRva2VuU3RyZWFtLnRva2VuKCkudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3czsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAgICAgKiBUaHJvd3MgYW4gZXJyb3Igd2hlbiBhbiB1bmV4cGVjdGVkIHRva2VuIGlzIGZvdW5kLgogICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB0b2tlbiBUaGUgdG9rZW4gdGhhdCB3YXMgZm91bmQuCiAgICAgICAgICAgICAgICAgICAgICogQG1ldGhvZCBfdW5leHBlY3RlZFRva2VuCiAgICAgICAgICAgICAgICAgICAgICogQHJldHVybiB7dm9pZH0KICAgICAgICAgICAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgIF91bmV4cGVjdGVkVG9rZW46IGZ1bmN0aW9uICh0b2tlbikgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoIlVuZXhwZWN0ZWQgdG9rZW4gJyIgKyB0b2tlbi52YWx1ZSArICInIGF0IGxpbmUgIiArIHRva2VuLnN0YXJ0TGluZSArICIsIGNvbCAiICsgdG9rZW4uc3RhcnRDb2wgKyAiLiIsIHRva2VuLnN0YXJ0TGluZSwgdG9rZW4uc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICAgICAqIEhlbHBlciBtZXRob2QgdXNlZCBmb3IgcGFyc2luZyBzdWJwYXJ0cyBvZiBhIHN0eWxlIHNoZWV0LgogICAgICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge3ZvaWR9CiAgICAgICAgICAgICAgICAgICAgICogQG1ldGhvZCBfdmVyaWZ5RW5kCiAgICAgICAgICAgICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICBfdmVyaWZ5RW5kOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl90b2tlblN0cmVhbS5MQSgxKSAhPSBUb2tlbnMuRU9GKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl91bmV4cGVjdGVkVG9rZW4odGhpcy5fdG9rZW5TdHJlYW0uTFQoMSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAgICAgICAgIC8vIFZhbGlkYXRpb24gbWV0aG9kcwogICAgICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAgICAgICAgICAgICBfdmFsaWRhdGVQcm9wZXJ0eTogZnVuY3Rpb24gKHByb3BlcnR5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHByb3BlcnR5LnRleHQudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFByb3BlcnRpZXNbbmFtZV0pIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIFByb3BlcnRpZXNbbmFtZV0gPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByb3BlcnRpZXNbbmFtZV0odmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vb3RoZXJ3aXNlLCBubyB2YWxpZGF0aW9uIGF2YWlsYWJsZSB5ZXQKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lLmluZGV4T2YoIi0iKSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92ZW5kb3IgcHJlZml4ZWQgYXJlIG9rCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCJVbmtub3duIHByb3BlcnR5ICciICsgcHJvcGVydHkgKyAiJy4iLCBwcm9wZXJ0eS5saW5lLCBwcm9wZXJ0eS5jb2wpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAgICAgICAgIC8vIFBhcnNpbmcgbWV0aG9kcwogICAgICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAgICAgICAgICAgICAgICAgcGFyc2U6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90b2tlblN0cmVhbSA9IG5ldyBUb2tlblN0cmVhbShpbnB1dCwgVG9rZW5zKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3R5bGVzaGVldCgpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHBhcnNlU3R5bGVTaGVldDogZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vanVzdCBwYXNzdGhyb3VnaAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZShpbnB1dCk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgcGFyc2VNZWRpYVF1ZXJ5OiBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdG9rZW5TdHJlYW0gPSBuZXcgVG9rZW5TdHJlYW0oaW5wdXQsIFRva2Vucyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLl9tZWRpYV9xdWVyeSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiB0aGVyZSdzIGFueXRoaW5nIG1vcmUsIHRoZW4gaXQncyBhbiBpbnZhbGlkIHNlbGVjdG9yCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeUVuZCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9vdGhlcndpc2UgcmV0dXJuIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICAgICAqIFBhcnNlcyBhIHByb3BlcnR5IHZhbHVlIChldmVyeXRoaW5nIGFmdGVyIHRoZSBzZW1pY29sb24pLgogICAgICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge3BhcnNlcmxpYi5jc3MuUHJvcGVydHlWYWx1ZX0gVGhlIHByb3BlcnR5IHZhbHVlLgogICAgICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgcGFyc2VybGliLnV0aWwuU3ludGF4RXJyb3IgSWYgYW4gdW5leHBlY3RlZCB0b2tlbiBpcyBmb3VuZC4KICAgICAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIHBhcnNlclByb3BlcnR5VmFsdWUKICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICBwYXJzZVByb3BlcnR5VmFsdWU6IGZ1bmN0aW9uIChpbnB1dCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdG9rZW5TdHJlYW0gPSBuZXcgVG9rZW5TdHJlYW0oaW5wdXQsIFRva2Vucyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5fZXhwcigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9va2F5IHRvIGhhdmUgYSB0cmFpbGluZyB3aGl0ZSBzcGFjZQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiB0aGVyZSdzIGFueXRoaW5nIG1vcmUsIHRoZW4gaXQncyBhbiBpbnZhbGlkIHNlbGVjdG9yCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeUVuZCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9vdGhlcndpc2UgcmV0dXJuIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICAgICAqIFBhcnNlcyBhIGNvbXBsZXRlIENTUyBydWxlLCBpbmNsdWRpbmcgc2VsZWN0b3JzIGFuZAogICAgICAgICAgICAgICAgICAgICAqIHByb3BlcnRpZXMuCiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSB0ZXh0IHRvIHBhcnNlci4KICAgICAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtCb29sZWFufSBUcnVlIGlmIHRoZSBwYXJzZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LCBmYWxzZSBpZiBub3QuCiAgICAgICAgICAgICAgICAgICAgICogQG1ldGhvZCBwYXJzZVJ1bGUKICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICBwYXJzZVJ1bGU6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90b2tlblN0cmVhbSA9IG5ldyBUb2tlblN0cmVhbShpbnB1dCwgVG9rZW5zKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2tpcCBhbnkgbGVhZGluZyB3aGl0ZSBzcGFjZQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkV2hpdGVzcGFjZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuX3J1bGVzZXQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2tpcCBhbnkgdHJhaWxpbmcgd2hpdGUgc3BhY2UKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUncyBhbnl0aGluZyBtb3JlLCB0aGVuIGl0J3MgYW4gaW52YWxpZCBzZWxlY3RvcgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlFbmQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vb3RoZXJ3aXNlIHJldHVybiByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAgICAgKiBQYXJzZXMgYSBzaW5nbGUgQ1NTIHNlbGVjdG9yIChubyBjb21tYSkKICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgVGhlIHRleHQgdG8gcGFyc2UgYXMgYSBDU1Mgc2VsZWN0b3IuCiAgICAgICAgICAgICAgICAgICAgICogQHJldHVybiB7U2VsZWN0b3J9IEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlbGVjdG9yLgogICAgICAgICAgICAgICAgICAgICAqIEB0aHJvd3MgcGFyc2VybGliLnV0aWwuU3ludGF4RXJyb3IgSWYgYW4gdW5leHBlY3RlZCB0b2tlbiBpcyBmb3VuZC4KICAgICAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIHBhcnNlU2VsZWN0b3IKICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICBwYXJzZVNlbGVjdG9yOiBmdW5jdGlvbiAoaW5wdXQpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rva2VuU3RyZWFtID0gbmV3IFRva2VuU3RyZWFtKGlucHV0LCBUb2tlbnMpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9za2lwIGFueSBsZWFkaW5nIHdoaXRlIHNwYWNlCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRXaGl0ZXNwYWNlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5fc2VsZWN0b3IoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2tpcCBhbnkgdHJhaWxpbmcgd2hpdGUgc3BhY2UKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVhZFdoaXRlc3BhY2UoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUncyBhbnl0aGluZyBtb3JlLCB0aGVuIGl0J3MgYW4gaW52YWxpZCBzZWxlY3RvcgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlFbmQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vb3RoZXJ3aXNlIHJldHVybiByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAgICAgKiBQYXJzZXMgYW4gSFRNTCBzdHlsZSBhdHRyaWJ1dGU6IGEgc2V0IG9mIENTUyBkZWNsYXJhdGlvbnMKICAgICAgICAgICAgICAgICAgICAgKiBzZXBhcmF0ZWQgYnkgc2VtaWNvbG9ucy4KICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgVGhlIHRleHQgdG8gcGFyc2UgYXMgYSBzdHlsZSBhdHRyaWJ1dGUKICAgICAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHt2b2lkfQogICAgICAgICAgICAgICAgICAgICAqIEBtZXRob2QgcGFyc2VTdHlsZUF0dHJpYnV0ZQogICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgIHBhcnNlU3R5bGVBdHRyaWJ1dGU6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICAgICAgICAgICAgICBpbnB1dCArPSAifSI7IC8vIGZvciBlcnJvciByZWNvdmVyeSBpbiBfcmVhZERlY2xhcmF0aW9ucygpCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rva2VuU3RyZWFtID0gbmV3IFRva2VuU3RyZWFtKGlucHV0LCBUb2tlbnMpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWFkRGVjbGFyYXRpb25zKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAvL2NvcHkgb3ZlciBvbnRvIHByb3RvdHlwZQogICAgICAgICAgICAgICAgZm9yIChwcm9wIGluIGFkZGl0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHByb3RvW3Byb3BdID0gYWRkaXRpb25zW3Byb3BdOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBwcm90bzsKICAgICAgICAgICAgfSgpOwoKICAgICAgICAgICAgLyoKICAgICAgICAgICAgbnRoCiAgICAgICAgICAgICAgOiBTKiBbIFsnLSd8JysnXT8gSU5URUdFUj8ge059IFsgUyogWyctJ3wnKyddIFMqIElOVEVHRVIgXT8gfAogICAgICAgICAgICAgICAgICAgICBbJy0nfCcrJ10/IElOVEVHRVIgfCB7T317RH17RH0gfCB7RX17Vn17RX17Tn0gXSBTKgogICAgICAgICAgICAgIDsKICAgICAgICAgICAgKi8KICAgICAgICAgICAgLy9UaGlzIGZpbGUgd2lsbCBsaWtlbHkgY2hhbmdlIGEgbG90ISBWZXJ5IGV4cGVyaW1lbnRhbCEKCiAgICAgICAgICAgIHZhciBWYWxpZGF0aW9uVHlwZSA9IHsKCiAgICAgICAgICAgICAgICAiYWJzb2x1dGUtc2l6ZSI6IGZ1bmN0aW9uIChwYXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWRlbnRpZmllcihwYXJ0LCAieHgtc21hbGwgfCB4LXNtYWxsIHwgc21hbGwgfCBtZWRpdW0gfCBsYXJnZSB8IHgtbGFyZ2UgfCB4eC1sYXJnZSIpOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAiYXR0YWNobWVudCI6IGZ1bmN0aW9uIChwYXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWRlbnRpZmllcihwYXJ0LCAic2Nyb2xsIHwgZml4ZWQgfCBsb2NhbCIpOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAiYm94IjogZnVuY3Rpb24gKHBhcnQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pZGVudGlmaWVyKHBhcnQsICJwYWRkaW5nLWJveCB8IGJvcmRlci1ib3ggfCBjb250ZW50LWJveCIpOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAicmVsYXRpdmUtc2l6ZSI6IGZ1bmN0aW9uIChwYXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWRlbnRpZmllcihwYXJ0LCAic21hbGxlciB8IGxhcmdlciIpOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAiaWRlbnRpZmllciI6IGZ1bmN0aW9uIChwYXJ0LCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRleHQgPSBwYXJ0LnRleHQudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gb3B0aW9ucy5zcGxpdCgiIHwgIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgICAgICAgICAgIGxlbiwKICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gYXJncy5sZW5ndGg7IGkgPCBsZW4gJiYgIWZvdW5kOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQgPT0gYXJnc1tpXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm91bmQ7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICJsZW5ndGgiOiBmdW5jdGlvbiAocGFydCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJ0LnR5cGUgPT0gImxlbmd0aCIgfHwgcGFydC50eXBlID09ICJudW1iZXIiIHx8IHBhcnQudHlwZSA9PSAiaW50ZWdlciIgfHwgcGFydCA9PSAiMCI7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICJjb2xvciI6IGZ1bmN0aW9uIChwYXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnQudHlwZSA9PSAiY29sb3IiIHx8IHBhcnQgPT0gInRyYW5zcGFyZW50IjsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgIm51bWJlciI6IGZ1bmN0aW9uIChwYXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnQudHlwZSA9PSAibnVtYmVyIiB8fCB0aGlzLmludGVnZXIocGFydCk7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICJpbnRlZ2VyIjogZnVuY3Rpb24gKHBhcnQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFydC50eXBlID09ICJpbnRlZ2VyIjsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgImFuZ2xlIjogZnVuY3Rpb24gKHBhcnQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFydC50eXBlID09ICJhbmdsZSI7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICJ1cmkiOiBmdW5jdGlvbiAocGFydCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJ0LnR5cGUgPT0gInVyaSI7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICJpbWFnZSI6IGZ1bmN0aW9uIChwYXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudXJpKHBhcnQpOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAiYmctaW1hZ2UiOiBmdW5jdGlvbiAocGFydCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmltYWdlKHBhcnQpIHx8IHBhcnQgPT0gIm5vbmUiOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAicGVyY2VudGFnZSI6IGZ1bmN0aW9uIChwYXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnQudHlwZSA9PSAicGVyY2VudGFnZSIgfHwgcGFydCA9PSAiMCI7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICJib3JkZXItd2lkdGgiOiBmdW5jdGlvbiAocGFydCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxlbmd0aChwYXJ0KSB8fCB0aGlzLmlkZW50aWZpZXIocGFydCwgInRoaW4gfCBtZWRpdW0gfCB0aGljayIpOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAiYm9yZGVyLXN0eWxlIjogZnVuY3Rpb24gKHBhcnQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pZGVudGlmaWVyKHBhcnQsICJub25lIHwgaGlkZGVuIHwgZG90dGVkIHwgZGFzaGVkIHwgc29saWQgfCBkb3VibGUgfCBncm9vdmUgfCByaWRnZSB8IGluc2V0IHwgb3V0c2V0Iik7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICJtYXJnaW4td2lkdGgiOiBmdW5jdGlvbiAocGFydCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxlbmd0aChwYXJ0KSB8fCB0aGlzLnBlcmNlbnRhZ2UocGFydCkgfHwgdGhpcy5pZGVudGlmaWVyKHBhcnQsICJhdXRvIik7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICJwYWRkaW5nLXdpZHRoIjogZnVuY3Rpb24gKHBhcnQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGgocGFydCkgfHwgdGhpcy5wZXJjZW50YWdlKHBhcnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFyIFByb3BlcnRpZXMgPSB7CgogICAgICAgICAgICAgICAgLy9BCiAgICAgICAgICAgICAgICAiYWxpZ25tZW50LWFkanVzdCI6IDEsCiAgICAgICAgICAgICAgICAiYWxpZ25tZW50LWJhc2VsaW5lIjogMSwKICAgICAgICAgICAgICAgICJhbmltYXRpb24iOiAxLAogICAgICAgICAgICAgICAgImFuaW1hdGlvbi1kZWxheSI6IDEsCiAgICAgICAgICAgICAgICAiYW5pbWF0aW9uLWRpcmVjdGlvbiI6IHsgbXVsdGk6IFsibm9ybWFsIHwgYWx0ZXJuYXRlIl0sIHNlcGFyYXRvcjogIiwiIH0sCiAgICAgICAgICAgICAgICAiYW5pbWF0aW9uLWR1cmF0aW9uIjogMSwKICAgICAgICAgICAgICAgICJhbmltYXRpb24tZmlsbC1tb2RlIjogMSwKICAgICAgICAgICAgICAgICJhbmltYXRpb24taXRlcmF0aW9uLWNvdW50IjogeyBtdWx0aTogWyJudW1iZXIiLCAiaW5maW5pdGUiXSwgc2VwYXJhdG9yOiAiLCIgfSwKICAgICAgICAgICAgICAgICJhbmltYXRpb24tbmFtZSI6IDEsCiAgICAgICAgICAgICAgICAiYW5pbWF0aW9uLXBsYXktc3RhdGUiOiB7IG11bHRpOiBbInJ1bm5pbmcgfCBwYXVzZWQiXSwgc2VwYXJhdG9yOiAiLCIgfSwKICAgICAgICAgICAgICAgICJhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uIjogMSwKICAgICAgICAgICAgICAgICJhcHBlYXJhbmNlIjogMSwKICAgICAgICAgICAgICAgICJhemltdXRoIjogMSwKCiAgICAgICAgICAgICAgICAvL0IKICAgICAgICAgICAgICAgICJiYWNrZmFjZS12aXNpYmlsaXR5IjogMSwKICAgICAgICAgICAgICAgICJiYWNrZ3JvdW5kIjogMSwKICAgICAgICAgICAgICAgICJiYWNrZ3JvdW5kLWF0dGFjaG1lbnQiOiB7IG11bHRpOiBbImF0dGFjaG1lbnQiXSwgc2VwYXJhdG9yOiAiLCIgfSwKICAgICAgICAgICAgICAgICJiYWNrZ3JvdW5kLWJyZWFrIjogMSwKICAgICAgICAgICAgICAgICJiYWNrZ3JvdW5kLWNsaXAiOiB7IG11bHRpOiBbImJveCJdLCBzZXBhcmF0b3I6ICIsIiB9LAogICAgICAgICAgICAgICAgImJhY2tncm91bmQtY29sb3IiOiBbImNvbG9yIiwgImluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJiYWNrZ3JvdW5kLWltYWdlIjogeyBtdWx0aTogWyJiZy1pbWFnZSJdLCBzZXBhcmF0b3I6ICIsIiB9LAogICAgICAgICAgICAgICAgImJhY2tncm91bmQtb3JpZ2luIjogeyBtdWx0aTogWyJib3giXSwgc2VwYXJhdG9yOiAiLCIgfSwKICAgICAgICAgICAgICAgICJiYWNrZ3JvdW5kLXBvc2l0aW9uIjogMSwKICAgICAgICAgICAgICAgICJiYWNrZ3JvdW5kLXJlcGVhdCI6IFsicmVwZWF0IHwgcmVwZWF0LXggfCByZXBlYXQteSB8IG5vLXJlcGVhdCB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJiYWNrZ3JvdW5kLXNpemUiOiAxLAogICAgICAgICAgICAgICAgImJhc2VsaW5lLXNoaWZ0IjogMSwKICAgICAgICAgICAgICAgICJiaW5kaW5nIjogMSwKICAgICAgICAgICAgICAgICJibGVlZCI6IDEsCiAgICAgICAgICAgICAgICAiYm9va21hcmstbGFiZWwiOiAxLAogICAgICAgICAgICAgICAgImJvb2ttYXJrLWxldmVsIjogMSwKICAgICAgICAgICAgICAgICJib29rbWFyay1zdGF0ZSI6IDEsCiAgICAgICAgICAgICAgICAiYm9va21hcmstdGFyZ2V0IjogMSwKICAgICAgICAgICAgICAgICJib3JkZXIiOiAxLAogICAgICAgICAgICAgICAgImJvcmRlci1ib3R0b20iOiAxLAogICAgICAgICAgICAgICAgImJvcmRlci1ib3R0b20tY29sb3IiOiAxLAogICAgICAgICAgICAgICAgImJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXMiOiAxLAogICAgICAgICAgICAgICAgImJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzIjogMSwKICAgICAgICAgICAgICAgICJib3JkZXItYm90dG9tLXN0eWxlIjogWyJib3JkZXItc3R5bGUiXSwKICAgICAgICAgICAgICAgICJib3JkZXItYm90dG9tLXdpZHRoIjogWyJib3JkZXItd2lkdGgiXSwKICAgICAgICAgICAgICAgICJib3JkZXItY29sbGFwc2UiOiBbImNvbGxhcHNlIHwgc2VwYXJhdGUgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAiYm9yZGVyLWNvbG9yIjogeyBtdWx0aTogWyJjb2xvciIsICJpbmhlcml0Il0sIG1heDogNCB9LAogICAgICAgICAgICAgICAgImJvcmRlci1pbWFnZSI6IDEsCiAgICAgICAgICAgICAgICAiYm9yZGVyLWltYWdlLW91dHNldCI6IHsgbXVsdGk6IFsibGVuZ3RoIiwgIm51bWJlciJdLCBtYXg6IDQgfSwKICAgICAgICAgICAgICAgICJib3JkZXItaW1hZ2UtcmVwZWF0IjogeyBtdWx0aTogWyJzdHJldGNoIHwgcmVwZWF0IHwgcm91bmQiXSwgbWF4OiAyIH0sCiAgICAgICAgICAgICAgICAiYm9yZGVyLWltYWdlLXNsaWNlIjogMSwKICAgICAgICAgICAgICAgICJib3JkZXItaW1hZ2Utc291cmNlIjogWyJpbWFnZSIsICJub25lIl0sCiAgICAgICAgICAgICAgICAiYm9yZGVyLWltYWdlLXdpZHRoIjogeyBtdWx0aTogWyJsZW5ndGgiLCAicGVyY2VudGFnZSIsICJudW1iZXIiLCAiYXV0byJdLCBtYXg6IDQgfSwKICAgICAgICAgICAgICAgICJib3JkZXItbGVmdCI6IDEsCiAgICAgICAgICAgICAgICAiYm9yZGVyLWxlZnQtY29sb3IiOiBbImNvbG9yIiwgImluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJib3JkZXItbGVmdC1zdHlsZSI6IFsiYm9yZGVyLXN0eWxlIl0sCiAgICAgICAgICAgICAgICAiYm9yZGVyLWxlZnQtd2lkdGgiOiBbImJvcmRlci13aWR0aCJdLAogICAgICAgICAgICAgICAgImJvcmRlci1yYWRpdXMiOiAxLAogICAgICAgICAgICAgICAgImJvcmRlci1yaWdodCI6IDEsCiAgICAgICAgICAgICAgICAiYm9yZGVyLXJpZ2h0LWNvbG9yIjogWyJjb2xvciIsICJpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAiYm9yZGVyLXJpZ2h0LXN0eWxlIjogWyJib3JkZXItc3R5bGUiXSwKICAgICAgICAgICAgICAgICJib3JkZXItcmlnaHQtd2lkdGgiOiBbImJvcmRlci13aWR0aCJdLAogICAgICAgICAgICAgICAgImJvcmRlci1zcGFjaW5nIjogMSwKICAgICAgICAgICAgICAgICJib3JkZXItc3R5bGUiOiB7IG11bHRpOiBbImJvcmRlci1zdHlsZSJdLCBtYXg6IDQgfSwKICAgICAgICAgICAgICAgICJib3JkZXItdG9wIjogMSwKICAgICAgICAgICAgICAgICJib3JkZXItdG9wLWNvbG9yIjogWyJjb2xvciIsICJpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAiYm9yZGVyLXRvcC1sZWZ0LXJhZGl1cyI6IDEsCiAgICAgICAgICAgICAgICAiYm9yZGVyLXRvcC1yaWdodC1yYWRpdXMiOiAxLAogICAgICAgICAgICAgICAgImJvcmRlci10b3Atc3R5bGUiOiBbImJvcmRlci1zdHlsZSJdLAogICAgICAgICAgICAgICAgImJvcmRlci10b3Atd2lkdGgiOiBbImJvcmRlci13aWR0aCJdLAogICAgICAgICAgICAgICAgImJvcmRlci13aWR0aCI6IHsgbXVsdGk6IFsiYm9yZGVyLXdpZHRoIl0sIG1heDogNCB9LAogICAgICAgICAgICAgICAgImJvdHRvbSI6IFsibWFyZ2luLXdpZHRoIiwgImluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJib3gtYWxpZ24iOiBbInN0YXJ0IHwgZW5kIHwgY2VudGVyIHwgYmFzZWxpbmUgfCBzdHJldGNoIl0sIC8vaHR0cDovL3d3dy53My5vcmcvVFIvMjAwOS9XRC1jc3MzLWZsZXhib3gtMjAwOTA3MjMvCiAgICAgICAgICAgICAgICAiYm94LWRlY29yYXRpb24tYnJlYWsiOiBbInNsaWNlIHxjbG9uZSJdLAogICAgICAgICAgICAgICAgImJveC1kaXJlY3Rpb24iOiBbIm5vcm1hbCB8IHJldmVyc2UgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAiYm94LWZsZXgiOiBbIm51bWJlciJdLAogICAgICAgICAgICAgICAgImJveC1mbGV4LWdyb3VwIjogWyJpbnRlZ2VyIl0sCiAgICAgICAgICAgICAgICAiYm94LWxpbmVzIjogWyJzaW5nbGUgfCBtdWx0aXBsZSJdLAogICAgICAgICAgICAgICAgImJveC1vcmRpbmFsLWdyb3VwIjogWyJpbnRlZ2VyIl0sCiAgICAgICAgICAgICAgICAiYm94LW9yaWVudCI6IFsiaG9yaXpvbnRhbCB8IHZlcnRpY2FsIHwgaW5saW5lLWF4aXMgfCBibG9jay1heGlzIHwgaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgImJveC1wYWNrIjogWyJzdGFydCB8IGVuZCB8IGNlbnRlciB8IGp1c3RpZnkiXSwKICAgICAgICAgICAgICAgICJib3gtc2hhZG93IjogMSwKICAgICAgICAgICAgICAgICJib3gtc2l6aW5nIjogWyJjb250ZW50LWJveCB8IGJvcmRlci1ib3ggfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAiYnJlYWstYWZ0ZXIiOiBbImF1dG8gfCBhbHdheXMgfCBhdm9pZCB8IGxlZnQgfCByaWdodCB8IHBhZ2UgfCBjb2x1bW4gfCBhdm9pZC1wYWdlIHwgYXZvaWQtY29sdW1uIl0sCiAgICAgICAgICAgICAgICAiYnJlYWstYmVmb3JlIjogWyJhdXRvIHwgYWx3YXlzIHwgYXZvaWQgfCBsZWZ0IHwgcmlnaHQgfCBwYWdlIHwgY29sdW1uIHwgYXZvaWQtcGFnZSB8IGF2b2lkLWNvbHVtbiJdLAogICAgICAgICAgICAgICAgImJyZWFrLWluc2lkZSI6IFsiYXV0byB8IGF2b2lkIHwgYXZvaWQtcGFnZSB8IGF2b2lkLWNvbHVtbiJdLAoKICAgICAgICAgICAgICAgIC8vQwogICAgICAgICAgICAgICAgImNhcHRpb24tc2lkZSI6IFsidG9wIHwgYm90dG9tIHwgaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgImNsZWFyIjogWyJub25lIHwgcmlnaHQgfCBsZWZ0IHwgYm90aCB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJjbGlwIjogMSwKICAgICAgICAgICAgICAgICJjb2xvciI6IFsiY29sb3IiLCAiaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgImNvbG9yLXByb2ZpbGUiOiAxLAogICAgICAgICAgICAgICAgImNvbHVtbi1jb3VudCI6IFsiaW50ZWdlciIsICJhdXRvIl0sIC8vaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1tdWx0aWNvbC8KICAgICAgICAgICAgICAgICJjb2x1bW4tZmlsbCI6IFsiYXV0byB8IGJhbGFuY2UiXSwKICAgICAgICAgICAgICAgICJjb2x1bW4tZ2FwIjogWyJsZW5ndGgiLCAibm9ybWFsIl0sCiAgICAgICAgICAgICAgICAiY29sdW1uLXJ1bGUiOiAxLAogICAgICAgICAgICAgICAgImNvbHVtbi1ydWxlLWNvbG9yIjogWyJjb2xvciJdLAogICAgICAgICAgICAgICAgImNvbHVtbi1ydWxlLXN0eWxlIjogWyJib3JkZXItc3R5bGUiXSwKICAgICAgICAgICAgICAgICJjb2x1bW4tcnVsZS13aWR0aCI6IFsiYm9yZGVyLXdpZHRoIl0sCiAgICAgICAgICAgICAgICAiY29sdW1uLXNwYW4iOiBbIm5vbmUgfCBhbGwiXSwKICAgICAgICAgICAgICAgICJjb2x1bW4td2lkdGgiOiBbImxlbmd0aCIsICJhdXRvIl0sCiAgICAgICAgICAgICAgICAiY29sdW1ucyI6IDEsCiAgICAgICAgICAgICAgICAiY29udGVudCI6IDEsCiAgICAgICAgICAgICAgICAiY291bnRlci1pbmNyZW1lbnQiOiAxLAogICAgICAgICAgICAgICAgImNvdW50ZXItcmVzZXQiOiAxLAogICAgICAgICAgICAgICAgImNyb3AiOiAxLAogICAgICAgICAgICAgICAgImN1ZSI6IFsiY3VlLWFmdGVyIHwgY3VlLWJlZm9yZSB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJjdWUtYWZ0ZXIiOiAxLAogICAgICAgICAgICAgICAgImN1ZS1iZWZvcmUiOiAxLAogICAgICAgICAgICAgICAgImN1cnNvciI6IDEsCgogICAgICAgICAgICAgICAgLy9ECiAgICAgICAgICAgICAgICAiZGlyZWN0aW9uIjogWyJsdHIgfCBydGwgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAiZGlzcGxheSI6IFsiaW5saW5lIHwgYmxvY2sgfCBsaXN0LWl0ZW0gfCBpbmxpbmUtYmxvY2sgfCB0YWJsZSB8IGlubGluZS10YWJsZSB8IHRhYmxlLXJvdy1ncm91cCB8IHRhYmxlLWhlYWRlci1ncm91cCB8IHRhYmxlLWZvb3Rlci1ncm91cCB8IHRhYmxlLXJvdyB8IHRhYmxlLWNvbHVtbi1ncm91cCB8IHRhYmxlLWNvbHVtbiB8IHRhYmxlLWNlbGwgfCB0YWJsZS1jYXB0aW9uIHwgYm94IHwgaW5saW5lLWJveCB8IGdyaWQgfCBpbmxpbmUtZ3JpZCIsICJub25lIHwgaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgImRvbWluYW50LWJhc2VsaW5lIjogMSwKICAgICAgICAgICAgICAgICJkcm9wLWluaXRpYWwtYWZ0ZXItYWRqdXN0IjogMSwKICAgICAgICAgICAgICAgICJkcm9wLWluaXRpYWwtYWZ0ZXItYWxpZ24iOiAxLAogICAgICAgICAgICAgICAgImRyb3AtaW5pdGlhbC1iZWZvcmUtYWRqdXN0IjogMSwKICAgICAgICAgICAgICAgICJkcm9wLWluaXRpYWwtYmVmb3JlLWFsaWduIjogMSwKICAgICAgICAgICAgICAgICJkcm9wLWluaXRpYWwtc2l6ZSI6IDEsCiAgICAgICAgICAgICAgICAiZHJvcC1pbml0aWFsLXZhbHVlIjogMSwKCiAgICAgICAgICAgICAgICAvL0UKICAgICAgICAgICAgICAgICJlbGV2YXRpb24iOiAxLAogICAgICAgICAgICAgICAgImVtcHR5LWNlbGxzIjogWyJzaG93IHwgaGlkZSB8IGluaGVyaXQiXSwKCiAgICAgICAgICAgICAgICAvL0YKICAgICAgICAgICAgICAgICJmaWx0ZXIiOiAxLAogICAgICAgICAgICAgICAgImZpdCI6IFsiZmlsbCB8IGhpZGRlbiB8IG1lZXQgfCBzbGljZSJdLAogICAgICAgICAgICAgICAgImZpdC1wb3NpdGlvbiI6IDEsCiAgICAgICAgICAgICAgICAiZmxvYXQiOiBbImxlZnQgfCByaWdodCB8IG5vbmUgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAiZmxvYXQtb2Zmc2V0IjogMSwKICAgICAgICAgICAgICAgICJmb250IjogMSwKICAgICAgICAgICAgICAgICJmb250LWZhbWlseSI6IDEsCiAgICAgICAgICAgICAgICAiZm9udC1zaXplIjogWyJhYnNvbHV0ZS1zaXplIiwgInJlbGF0aXZlLXNpemUiLCAibGVuZ3RoIiwgInBlcmNlbnRhZ2UiLCAiaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgImZvbnQtc2l6ZS1hZGp1c3QiOiAxLAogICAgICAgICAgICAgICAgImZvbnQtc3RyZXRjaCI6IDEsCiAgICAgICAgICAgICAgICAiZm9udC1zdHlsZSI6IFsibm9ybWFsIHwgaXRhbGljIHwgb2JsaXF1ZSB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJmb250LXZhcmlhbnQiOiBbIm5vcm1hbCB8IHNtYWxsLWNhcHMgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAiZm9udC13ZWlnaHQiOiBbIm5vcm1hbCB8IGJvbGQgfCBib2xkZXIgfCBsaWdodGVyIHwgMTAwIHwgMjAwIHwgMzAwIHwgNDAwIHwgNTAwIHwgNjAwIHwgNzAwIHwgODAwIHwgOTAwIHwgaW5oZXJpdCJdLAoKICAgICAgICAgICAgICAgIC8vRwogICAgICAgICAgICAgICAgImdyaWQtY2VsbC1zdGFja2luZyI6IFsiY29sdW1ucyB8IHJvd3MgfCBsYXllciJdLAogICAgICAgICAgICAgICAgImdyaWQtY29sdW1uIjogMSwKICAgICAgICAgICAgICAgICJncmlkLWNvbHVtbnMiOiAxLAogICAgICAgICAgICAgICAgImdyaWQtY29sdW1uLWFsaWduIjogWyJzdGFydCB8IGVuZCB8IGNlbnRlciB8IHN0cmV0Y2giXSwKICAgICAgICAgICAgICAgICJncmlkLWNvbHVtbi1zaXppbmciOiAxLAogICAgICAgICAgICAgICAgImdyaWQtY29sdW1uLXNwYW4iOiBbImludGVnZXIiXSwKICAgICAgICAgICAgICAgICJncmlkLWZsb3ciOiBbIm5vbmUgfCByb3dzIHwgY29sdW1ucyJdLAogICAgICAgICAgICAgICAgImdyaWQtbGF5ZXIiOiBbImludGVnZXIiXSwKICAgICAgICAgICAgICAgICJncmlkLXJvdyI6IDEsCiAgICAgICAgICAgICAgICAiZ3JpZC1yb3dzIjogMSwKICAgICAgICAgICAgICAgICJncmlkLXJvdy1hbGlnbiI6IFsic3RhcnQgfCBlbmQgfCBjZW50ZXIgfCBzdHJldGNoIl0sCiAgICAgICAgICAgICAgICAiZ3JpZC1yb3ctc3BhbiI6IFsiaW50ZWdlciJdLAogICAgICAgICAgICAgICAgImdyaWQtcm93LXNpemluZyI6IDEsCgogICAgICAgICAgICAgICAgLy9ICiAgICAgICAgICAgICAgICAiaGFuZ2luZy1wdW5jdHVhdGlvbiI6IDEsCiAgICAgICAgICAgICAgICAiaGVpZ2h0IjogWyJtYXJnaW4td2lkdGgiLCAiaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgImh5cGhlbmF0ZS1hZnRlciI6IDEsCiAgICAgICAgICAgICAgICAiaHlwaGVuYXRlLWJlZm9yZSI6IDEsCiAgICAgICAgICAgICAgICAiaHlwaGVuYXRlLWNoYXJhY3RlciI6IFsic3RyaW5nIiwgImF1dG8iXSwKICAgICAgICAgICAgICAgICJoeXBoZW5hdGUtbGluZXMiOiAxLAogICAgICAgICAgICAgICAgImh5cGhlbmF0ZS1yZXNvdXJjZSI6IDEsCiAgICAgICAgICAgICAgICAiaHlwaGVucyI6IFsibm9uZSB8IG1hbnVhbCB8IGF1dG8iXSwKCiAgICAgICAgICAgICAgICAvL0kKICAgICAgICAgICAgICAgICJpY29uIjogMSwKICAgICAgICAgICAgICAgICJpbWFnZS1vcmllbnRhdGlvbiI6IFsiYW5nbGUiLCAiYXV0byJdLAogICAgICAgICAgICAgICAgImltYWdlLXJlbmRlcmluZyI6IDEsCiAgICAgICAgICAgICAgICAiaW1hZ2UtcmVzb2x1dGlvbiI6IDEsCiAgICAgICAgICAgICAgICAiaW5saW5lLWJveC1hbGlnbiI6IDEsCgogICAgICAgICAgICAgICAgLy9MCiAgICAgICAgICAgICAgICAibGVmdCI6IFsibWFyZ2luLXdpZHRoIiwgImluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJsZXR0ZXItc3BhY2luZyI6IFsibGVuZ3RoIiwgIm5vcm1hbCB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJsaW5lLWhlaWdodCI6IFsibnVtYmVyIiwgImxlbmd0aCIsICJwZXJjZW50YWdlIiwgIm5vcm1hbCB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJsaW5lLWJyZWFrIjogWyJhdXRvIHwgbG9vc2UgfCBub3JtYWwgfCBzdHJpY3QiXSwKICAgICAgICAgICAgICAgICJsaW5lLXN0YWNraW5nIjogMSwKICAgICAgICAgICAgICAgICJsaW5lLXN0YWNraW5nLXJ1YnkiOiAxLAogICAgICAgICAgICAgICAgImxpbmUtc3RhY2tpbmctc2hpZnQiOiAxLAogICAgICAgICAgICAgICAgImxpbmUtc3RhY2tpbmctc3RyYXRlZ3kiOiAxLAogICAgICAgICAgICAgICAgImxpc3Qtc3R5bGUiOiAxLAogICAgICAgICAgICAgICAgImxpc3Qtc3R5bGUtaW1hZ2UiOiBbInVyaSIsICJub25lIHwgaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgImxpc3Qtc3R5bGUtcG9zaXRpb24iOiBbImluc2lkZSB8IG91dHNpZGUgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAibGlzdC1zdHlsZS10eXBlIjogWyJkaXNjIHwgY2lyY2xlIHwgc3F1YXJlIHwgZGVjaW1hbCB8IGRlY2ltYWwtbGVhZGluZy16ZXJvIHwgbG93ZXItcm9tYW4gfCB1cHBlci1yb21hbiB8IGxvd2VyLWdyZWVrIHwgbG93ZXItbGF0aW4gfCB1cHBlci1sYXRpbiB8IGFybWVuaWFuIHwgZ2VvcmdpYW4gfCBsb3dlci1hbHBoYSB8IHVwcGVyLWFscGhhIHwgbm9uZSB8IGluaGVyaXQiXSwKCiAgICAgICAgICAgICAgICAvL00KICAgICAgICAgICAgICAgICJtYXJnaW4iOiB7IG11bHRpOiBbIm1hcmdpbi13aWR0aCIsICJpbmhlcml0Il0sIG1heDogNCB9LAogICAgICAgICAgICAgICAgIm1hcmdpbi1ib3R0b20iOiBbIm1hcmdpbi13aWR0aCIsICJpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAibWFyZ2luLWxlZnQiOiBbIm1hcmdpbi13aWR0aCIsICJpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAibWFyZ2luLXJpZ2h0IjogWyJtYXJnaW4td2lkdGgiLCAiaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgIm1hcmdpbi10b3AiOiBbIm1hcmdpbi13aWR0aCIsICJpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAibWFyayI6IDEsCiAgICAgICAgICAgICAgICAibWFyay1hZnRlciI6IDEsCiAgICAgICAgICAgICAgICAibWFyay1iZWZvcmUiOiAxLAogICAgICAgICAgICAgICAgIm1hcmtzIjogMSwKICAgICAgICAgICAgICAgICJtYXJxdWVlLWRpcmVjdGlvbiI6IDEsCiAgICAgICAgICAgICAgICAibWFycXVlZS1wbGF5LWNvdW50IjogMSwKICAgICAgICAgICAgICAgICJtYXJxdWVlLXNwZWVkIjogMSwKICAgICAgICAgICAgICAgICJtYXJxdWVlLXN0eWxlIjogMSwKICAgICAgICAgICAgICAgICJtYXgtaGVpZ2h0IjogWyJsZW5ndGgiLCAicGVyY2VudGFnZSIsICJub25lIHwgaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgIm1heC13aWR0aCI6IFsibGVuZ3RoIiwgInBlcmNlbnRhZ2UiLCAibm9uZSB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJtaW4taGVpZ2h0IjogWyJsZW5ndGgiLCAicGVyY2VudGFnZSIsICJpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAibWluLXdpZHRoIjogWyJsZW5ndGgiLCAicGVyY2VudGFnZSIsICJpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAibW92ZS10byI6IDEsCgogICAgICAgICAgICAgICAgLy9OCiAgICAgICAgICAgICAgICAibmF2LWRvd24iOiAxLAogICAgICAgICAgICAgICAgIm5hdi1pbmRleCI6IDEsCiAgICAgICAgICAgICAgICAibmF2LWxlZnQiOiAxLAogICAgICAgICAgICAgICAgIm5hdi1yaWdodCI6IDEsCiAgICAgICAgICAgICAgICAibmF2LXVwIjogMSwKCiAgICAgICAgICAgICAgICAvL08KICAgICAgICAgICAgICAgICJvcGFjaXR5IjogWyJudW1iZXIiLCAiaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgIm9ycGhhbnMiOiBbImludGVnZXIiLCAiaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgIm91dGxpbmUiOiAxLAogICAgICAgICAgICAgICAgIm91dGxpbmUtY29sb3IiOiBbImNvbG9yIiwgImludmVydCB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJvdXRsaW5lLW9mZnNldCI6IDEsCiAgICAgICAgICAgICAgICAib3V0bGluZS1zdHlsZSI6IFsiYm9yZGVyLXN0eWxlIiwgImluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJvdXRsaW5lLXdpZHRoIjogWyJib3JkZXItd2lkdGgiLCAiaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgIm92ZXJmbG93IjogWyJ2aXNpYmxlIHwgaGlkZGVuIHwgc2Nyb2xsIHwgYXV0byB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJvdmVyZmxvdy1zdHlsZSI6IDEsCiAgICAgICAgICAgICAgICAib3ZlcmZsb3cteCI6IDEsCiAgICAgICAgICAgICAgICAib3ZlcmZsb3cteSI6IDEsCgogICAgICAgICAgICAgICAgLy9QCiAgICAgICAgICAgICAgICAicGFkZGluZyI6IHsgbXVsdGk6IFsicGFkZGluZy13aWR0aCIsICJpbmhlcml0Il0sIG1heDogNCB9LAogICAgICAgICAgICAgICAgInBhZGRpbmctYm90dG9tIjogWyJwYWRkaW5nLXdpZHRoIiwgImluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJwYWRkaW5nLWxlZnQiOiBbInBhZGRpbmctd2lkdGgiLCAiaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgInBhZGRpbmctcmlnaHQiOiBbInBhZGRpbmctd2lkdGgiLCAiaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgInBhZGRpbmctdG9wIjogWyJwYWRkaW5nLXdpZHRoIiwgImluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJwYWdlIjogMSwKICAgICAgICAgICAgICAgICJwYWdlLWJyZWFrLWFmdGVyIjogWyJhdXRvIHwgYWx3YXlzIHwgYXZvaWQgfCBsZWZ0IHwgcmlnaHQgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAicGFnZS1icmVhay1iZWZvcmUiOiBbImF1dG8gfCBhbHdheXMgfCBhdm9pZCB8IGxlZnQgfCByaWdodCB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJwYWdlLWJyZWFrLWluc2lkZSI6IFsiYXV0byB8IGF2b2lkIHwgaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgInBhZ2UtcG9saWN5IjogMSwKICAgICAgICAgICAgICAgICJwYXVzZSI6IDEsCiAgICAgICAgICAgICAgICAicGF1c2UtYWZ0ZXIiOiAxLAogICAgICAgICAgICAgICAgInBhdXNlLWJlZm9yZSI6IDEsCiAgICAgICAgICAgICAgICAicGVyc3BlY3RpdmUiOiAxLAogICAgICAgICAgICAgICAgInBlcnNwZWN0aXZlLW9yaWdpbiI6IDEsCiAgICAgICAgICAgICAgICAicGhvbmVtZXMiOiAxLAogICAgICAgICAgICAgICAgInBpdGNoIjogMSwKICAgICAgICAgICAgICAgICJwaXRjaC1yYW5nZSI6IDEsCiAgICAgICAgICAgICAgICAicGxheS1kdXJpbmciOiAxLAogICAgICAgICAgICAgICAgInBvc2l0aW9uIjogWyJzdGF0aWMgfCByZWxhdGl2ZSB8IGFic29sdXRlIHwgZml4ZWQgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAicHJlc2VudGF0aW9uLWxldmVsIjogMSwKICAgICAgICAgICAgICAgICJwdW5jdHVhdGlvbi10cmltIjogMSwKCiAgICAgICAgICAgICAgICAvL1EKICAgICAgICAgICAgICAgICJxdW90ZXMiOiAxLAoKICAgICAgICAgICAgICAgIC8vUgogICAgICAgICAgICAgICAgInJlbmRlcmluZy1pbnRlbnQiOiAxLAogICAgICAgICAgICAgICAgInJlc2l6ZSI6IDEsCiAgICAgICAgICAgICAgICAicmVzdCI6IDEsCiAgICAgICAgICAgICAgICAicmVzdC1hZnRlciI6IDEsCiAgICAgICAgICAgICAgICAicmVzdC1iZWZvcmUiOiAxLAogICAgICAgICAgICAgICAgInJpY2huZXNzIjogMSwKICAgICAgICAgICAgICAgICJyaWdodCI6IFsibWFyZ2luLXdpZHRoIiwgImluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJyb3RhdGlvbiI6IDEsCiAgICAgICAgICAgICAgICAicm90YXRpb24tcG9pbnQiOiAxLAogICAgICAgICAgICAgICAgInJ1YnktYWxpZ24iOiAxLAogICAgICAgICAgICAgICAgInJ1Ynktb3ZlcmhhbmciOiAxLAogICAgICAgICAgICAgICAgInJ1YnktcG9zaXRpb24iOiAxLAogICAgICAgICAgICAgICAgInJ1Ynktc3BhbiI6IDEsCgogICAgICAgICAgICAgICAgLy9TCiAgICAgICAgICAgICAgICAic2l6ZSI6IDEsCiAgICAgICAgICAgICAgICAic3BlYWsiOiBbIm5vcm1hbCB8IG5vbmUgfCBzcGVsbC1vdXQgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAic3BlYWstaGVhZGVyIjogWyJvbmNlIHwgYWx3YXlzIHwgaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgInNwZWFrLW51bWVyYWwiOiBbImRpZ2l0cyB8IGNvbnRpbnVvdXMgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAic3BlYWstcHVuY3R1YXRpb24iOiBbImNvZGUgfCBub25lIHwgaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgInNwZWVjaC1yYXRlIjogMSwKICAgICAgICAgICAgICAgICJzcmMiOiAxLAogICAgICAgICAgICAgICAgInN0cmVzcyI6IDEsCiAgICAgICAgICAgICAgICAic3RyaW5nLXNldCI6IDEsCgogICAgICAgICAgICAgICAgInRhYmxlLWxheW91dCI6IFsiYXV0byB8IGZpeGVkIHwgaW5oZXJpdCJdLAogICAgICAgICAgICAgICAgInRhYi1zaXplIjogWyJpbnRlZ2VyIiwgImxlbmd0aCJdLAogICAgICAgICAgICAgICAgInRhcmdldCI6IDEsCiAgICAgICAgICAgICAgICAidGFyZ2V0LW5hbWUiOiAxLAogICAgICAgICAgICAgICAgInRhcmdldC1uZXciOiAxLAogICAgICAgICAgICAgICAgInRhcmdldC1wb3NpdGlvbiI6IDEsCiAgICAgICAgICAgICAgICAidGV4dC1hbGlnbiI6IFsibGVmdCB8IHJpZ2h0IHwgY2VudGVyIHwganVzdGlmeSB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJ0ZXh0LWFsaWduLWxhc3QiOiAxLAogICAgICAgICAgICAgICAgInRleHQtZGVjb3JhdGlvbiI6IDEsCiAgICAgICAgICAgICAgICAidGV4dC1lbXBoYXNpcyI6IDEsCiAgICAgICAgICAgICAgICAidGV4dC1oZWlnaHQiOiAxLAogICAgICAgICAgICAgICAgInRleHQtaW5kZW50IjogWyJsZW5ndGgiLCAicGVyY2VudGFnZSIsICJpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAidGV4dC1qdXN0aWZ5IjogWyJhdXRvIHwgbm9uZSB8IGludGVyLXdvcmQgfCBpbnRlci1pZGVvZ3JhcGggfCBpbnRlci1jbHVzdGVyIHwgZGlzdHJpYnV0ZSB8IGthc2hpZGEiXSwKICAgICAgICAgICAgICAgICJ0ZXh0LW91dGxpbmUiOiAxLAogICAgICAgICAgICAgICAgInRleHQtb3ZlcmZsb3ciOiAxLAogICAgICAgICAgICAgICAgInRleHQtc2hhZG93IjogMSwKICAgICAgICAgICAgICAgICJ0ZXh0LXRyYW5zZm9ybSI6IFsiY2FwaXRhbGl6ZSB8IHVwcGVyY2FzZSB8IGxvd2VyY2FzZSB8IG5vbmUgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAidGV4dC13cmFwIjogWyJub3JtYWwgfCBub25lIHwgYXZvaWQiXSwKICAgICAgICAgICAgICAgICJ0b3AiOiBbIm1hcmdpbi13aWR0aCIsICJpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAidHJhbnNmb3JtIjogMSwKICAgICAgICAgICAgICAgICJ0cmFuc2Zvcm0tb3JpZ2luIjogMSwKICAgICAgICAgICAgICAgICJ0cmFuc2Zvcm0tc3R5bGUiOiAxLAogICAgICAgICAgICAgICAgInRyYW5zaXRpb24iOiAxLAogICAgICAgICAgICAgICAgInRyYW5zaXRpb24tZGVsYXkiOiAxLAogICAgICAgICAgICAgICAgInRyYW5zaXRpb24tZHVyYXRpb24iOiAxLAogICAgICAgICAgICAgICAgInRyYW5zaXRpb24tcHJvcGVydHkiOiAxLAogICAgICAgICAgICAgICAgInRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uIjogMSwKCiAgICAgICAgICAgICAgICAvL1UKICAgICAgICAgICAgICAgICJ1bmljb2RlLWJpZGkiOiBbIm5vcm1hbCB8IGVtYmVkIHwgYmlkaS1vdmVycmlkZSB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJ1c2VyLW1vZGlmeSI6IFsicmVhZC1vbmx5IHwgcmVhZC13cml0ZSB8IHdyaXRlLW9ubHkgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAidXNlci1zZWxlY3QiOiBbIm5vbmUgfCB0ZXh0IHwgdG9nZ2xlIHwgZWxlbWVudCB8IGVsZW1lbnRzIHwgYWxsIHwgaW5oZXJpdCJdLAoKICAgICAgICAgICAgICAgIC8vVgogICAgICAgICAgICAgICAgInZlcnRpY2FsLWFsaWduIjogWyJwZXJjZW50YWdlIiwgImxlbmd0aCIsICJiYXNlbGluZSB8IHN1YiB8IHN1cGVyIHwgdG9wIHwgdGV4dC10b3AgfCBtaWRkbGUgfCBib3R0b20gfCB0ZXh0LWJvdHRvbSB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJ2aXNpYmlsaXR5IjogWyJ2aXNpYmxlIHwgaGlkZGVuIHwgY29sbGFwc2UgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAidm9pY2UtYmFsYW5jZSI6IDEsCiAgICAgICAgICAgICAgICAidm9pY2UtZHVyYXRpb24iOiAxLAogICAgICAgICAgICAgICAgInZvaWNlLWZhbWlseSI6IDEsCiAgICAgICAgICAgICAgICAidm9pY2UtcGl0Y2giOiAxLAogICAgICAgICAgICAgICAgInZvaWNlLXBpdGNoLXJhbmdlIjogMSwKICAgICAgICAgICAgICAgICJ2b2ljZS1yYXRlIjogMSwKICAgICAgICAgICAgICAgICJ2b2ljZS1zdHJlc3MiOiAxLAogICAgICAgICAgICAgICAgInZvaWNlLXZvbHVtZSI6IDEsCiAgICAgICAgICAgICAgICAidm9sdW1lIjogMSwKCiAgICAgICAgICAgICAgICAvL1cKICAgICAgICAgICAgICAgICJ3aGl0ZS1zcGFjZSI6IFsibm9ybWFsIHwgcHJlIHwgbm93cmFwIHwgcHJlLXdyYXAgfCBwcmUtbGluZSB8IGluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJ3aGl0ZS1zcGFjZS1jb2xsYXBzZSI6IDEsCiAgICAgICAgICAgICAgICAid2lkb3dzIjogWyJpbnRlZ2VyIiwgImluaGVyaXQiXSwKICAgICAgICAgICAgICAgICJ3aWR0aCI6IFsibGVuZ3RoIiwgInBlcmNlbnRhZ2UiLCAiYXV0byIsICJpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAid29yZC1icmVhayI6IFsibm9ybWFsIHwga2VlcC1hbGwgfCBicmVhay1hbGwiXSwKICAgICAgICAgICAgICAgICJ3b3JkLXNwYWNpbmciOiBbImxlbmd0aCIsICJub3JtYWwgfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAid29yZC13cmFwIjogMSwKCiAgICAgICAgICAgICAgICAvL1oKICAgICAgICAgICAgICAgICJ6LWluZGV4IjogWyJpbnRlZ2VyIiwgImF1dG8gfCBpbmhlcml0Il0sCiAgICAgICAgICAgICAgICAiem9vbSI6IFsibnVtYmVyIiwgInBlcmNlbnRhZ2UiLCAibm9ybWFsIl0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vQ3JlYXRlIHZhbGlkYXRpb24gZnVuY3Rpb25zIGZvciBzdHJpbmdzCiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgcHJvcDsKICAgICAgICAgICAgICAgIGZvciAocHJvcCBpbiBQcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKFByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkocHJvcCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFByb3BlcnRpZXNbcHJvcF0gaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvcGVydGllc1twcm9wXSA9IGZ1bmN0aW9uICh2YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWxpZCA9IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0ID0gdmFsdWUucGFydHNbMF07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUucGFydHMubGVuZ3RoICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoIkV4cGVjdGVkIDEgdmFsdWUgYnV0IGZvdW5kICIgKyB2YWx1ZS5wYXJ0cy5sZW5ndGggKyAiLiIsIHZhbHVlLmxpbmUsIHZhbHVlLmNvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB2YWx1ZXMubGVuZ3RoOyBpIDwgbGVuICYmICF2YWxpZDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIFZhbGlkYXRpb25UeXBlW3ZhbHVlc1tpXV0gPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IHZhbGlkIHx8IFZhbGlkYXRpb25UeXBlLmlkZW50aWZpZXIocGFydCwgdmFsdWVzW2ldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2cucHVzaCgib25lIG9mICgiICsgdmFsdWVzW2ldICsgIikiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSB2YWxpZCB8fCBWYWxpZGF0aW9uVHlwZVt2YWx1ZXNbaV1dKHBhcnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zZy5wdXNoKHZhbHVlc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoIkV4cGVjdGVkICIgKyBtc2cuam9pbigiIG9yICIpICsgIiBidXQgZm91bmQgJyIgKyB2YWx1ZSArICInLiIsIHZhbHVlLmxpbmUsIHZhbHVlLmNvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfShQcm9wZXJ0aWVzW3Byb3BdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgUHJvcGVydGllc1twcm9wXSA9PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvcGVydGllc1twcm9wXSA9IGZ1bmN0aW9uIChzcGVjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRzID0gdmFsdWUucGFydHM7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIHRoZXJlJ3MgYSBtYXhpbXVtIHNldCwgdXNlIGl0IChtYXggY2FuJ3QgYmUgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWMubWF4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID4gc3BlYy5tYXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCJFeHBlY3RlZCBhIG1heCBvZiAiICsgc3BlYy5tYXggKyAiIHByb3BlcnR5IHZhbHVlcyBidXQgZm91bmQgIiArIHBhcnRzLmxlbmd0aCArICIuIiwgdmFsdWUubGluZSwgdmFsdWUuY29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWMubXVsdGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IHNwZWMubXVsdGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHBhcnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2cgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWMuc2VwYXJhdG9yICYmIHBhcnRzW2ldLnR5cGUgPT0gIm9wZXJhdG9yIikgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3R3byBvcGVyYXRvcnMgaW4gYSByb3cgLSBub3QgYWxsb3dlZD8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdCAmJiBsYXN0LnR5cGUgPT0gIm9wZXJhdG9yIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2cgPSBtc2cuY29uY2F0KHZhbHVlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpID09IGxlbiAtIDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gbXNnLmNvbmNhdCgiZW5kIG9mIGxpbmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnRzW2ldICE9IHNwZWMuc2VwYXJhdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zZy5wdXNoKCInIiArIHNwZWMuc2VwYXJhdG9yICsgIiciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMCwgY291bnQgPSB2YWx1ZXMubGVuZ3RoOyBqIDwgY291bnQ7IGorKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIFZhbGlkYXRpb25UeXBlW3ZhbHVlc1tqXV0gPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChWYWxpZGF0aW9uVHlwZS5pZGVudGlmaWVyKHBhcnRzW2ldLCB2YWx1ZXNbal0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnLnB1c2goIm9uZSBvZiAoIiArIHZhbHVlc1tqXSArICIpIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoVmFsaWRhdGlvblR5cGVbdmFsdWVzW2pdXShwYXJ0c1tpXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2cucHVzaCh2YWx1ZXNbal0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCJFeHBlY3RlZCAiICsgbXNnLmpvaW4oIiBvciAiKSArICIgYnV0IGZvdW5kICciICsgcGFydHNbaV0gKyAiJy4iLCB2YWx1ZS5saW5lLCB2YWx1ZS5jb2wpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QgPSBwYXJ0c1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KFByb3BlcnRpZXNbcHJvcF0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSgpOwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogUmVwcmVzZW50cyBhIHNlbGVjdG9yIGNvbWJpbmF0b3IgKHdoaXRlc3BhY2UsICssID4pLgogICAgICAgICAgICAgKiBAbmFtZXNwYWNlIHBhcnNlcmxpYi5jc3MKICAgICAgICAgICAgICogQGNsYXNzIFByb3BlcnR5TmFtZQogICAgICAgICAgICAgKiBAZXh0ZW5kcyBwYXJzZXJsaWIudXRpbC5TeW50YXhVbml0CiAgICAgICAgICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUaGUgdGV4dCByZXByZXNlbnRhdGlvbiBvZiB0aGUgdW5pdC4KICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGhhY2sgVGhlIHR5cGUgb2YgSUUgaGFjayBhcHBsaWVkICgiKiIsICJfIiwgb3IgbnVsbCkuCiAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBsaW5lIFRoZSBsaW5lIG9mIHRleHQgb24gd2hpY2ggdGhlIHVuaXQgcmVzaWRlcy4KICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IGNvbCBUaGUgY29sdW1uIG9mIHRleHQgb24gd2hpY2ggdGhlIHVuaXQgcmVzaWRlcy4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIGZ1bmN0aW9uIFByb3BlcnR5TmFtZSh0ZXh0LCBoYWNrLCBsaW5lLCBjb2wpIHsKCiAgICAgICAgICAgICAgICBTeW50YXhVbml0LmNhbGwodGhpcywgdGV4dCwgbGluZSwgY29sLCBQYXJzZXIuUFJPUEVSVFlfTkFNRV9UWVBFKTsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSB0eXBlIG9mIElFIGhhY2sgYXBwbGllZCAoIioiLCAiXyIsIG9yIG51bGwpLgogICAgICAgICAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkgaGFjawogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB0aGlzLmhhY2sgPSBoYWNrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBQcm9wZXJ0eU5hbWUucHJvdG90eXBlID0gbmV3IFN5bnRheFVuaXQoKTsKICAgICAgICAgICAgUHJvcGVydHlOYW1lLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFByb3BlcnR5TmFtZTsKICAgICAgICAgICAgUHJvcGVydHlOYW1lLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAodGhpcy5oYWNrID8gdGhpcy5oYWNrIDogIiIpICsgdGhpcy50ZXh0OwogICAgICAgICAgICB9OwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogUmVwcmVzZW50cyBhIHNpbmdsZSBwYXJ0IG9mIGEgQ1NTIHByb3BlcnR5IHZhbHVlLCBtZWFuaW5nIHRoYXQgaXQgcmVwcmVzZW50cwogICAgICAgICAgICAgKiBqdXN0IGV2ZXJ5dGhpbmcgc2luZ2xlIHBhcnQgYmV0d2VlbiAiOiIgYW5kICI7Ii4gSWYgdGhlcmUgYXJlIG11bHRpcGxlIHZhbHVlcwogICAgICAgICAgICAgKiBzZXBhcmF0ZWQgYnkgY29tbWFzLCB0aGlzIHR5cGUgcmVwcmVzZW50cyBqdXN0IG9uZSBvZiB0aGUgdmFsdWVzLgogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ1tdfSBwYXJ0cyBBbiBhcnJheSBvZiB2YWx1ZSBwYXJ0cyBtYWtpbmcgdXAgdGhpcyB2YWx1ZS4KICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IGxpbmUgVGhlIGxpbmUgb2YgdGV4dCBvbiB3aGljaCB0aGUgdW5pdCByZXNpZGVzLgogICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gY29sIFRoZSBjb2x1bW4gb2YgdGV4dCBvbiB3aGljaCB0aGUgdW5pdCByZXNpZGVzLgogICAgICAgICAgICAgKiBAbmFtZXNwYWNlIHBhcnNlcmxpYi5jc3MKICAgICAgICAgICAgICogQGNsYXNzIFByb3BlcnR5VmFsdWUKICAgICAgICAgICAgICogQGV4dGVuZHMgcGFyc2VybGliLnV0aWwuU3ludGF4VW5pdAogICAgICAgICAgICAgKiBAY29uc3RydWN0b3IKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGZ1bmN0aW9uIFByb3BlcnR5VmFsdWUocGFydHMsIGxpbmUsIGNvbCkgewoKICAgICAgICAgICAgICAgIFN5bnRheFVuaXQuY2FsbCh0aGlzLCBwYXJ0cy5qb2luKCIgIiksIGxpbmUsIGNvbCwgUGFyc2VyLlBST1BFUlRZX1ZBTFVFX1RZUEUpOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogVGhlIHBhcnRzIHRoYXQgbWFrZSB1cCB0aGUgc2VsZWN0b3IuCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBBcnJheQogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHBhcnRzCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMucGFydHMgPSBwYXJ0czsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgUHJvcGVydHlWYWx1ZS5wcm90b3R5cGUgPSBuZXcgU3ludGF4VW5pdCgpOwogICAgICAgICAgICBQcm9wZXJ0eVZhbHVlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFByb3BlcnR5VmFsdWU7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogUmVwcmVzZW50cyBhIHNpbmdsZSBwYXJ0IG9mIGEgQ1NTIHByb3BlcnR5IHZhbHVlLCBtZWFuaW5nIHRoYXQgaXQgcmVwcmVzZW50cwogICAgICAgICAgICAgKiBqdXN0IG9uZSBwYXJ0IG9mIHRoZSBkYXRhIGJldHdlZW4gIjoiIGFuZCAiOyIuCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSB1bml0LgogICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gbGluZSBUaGUgbGluZSBvZiB0ZXh0IG9uIHdoaWNoIHRoZSB1bml0IHJlc2lkZXMuCiAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBjb2wgVGhlIGNvbHVtbiBvZiB0ZXh0IG9uIHdoaWNoIHRoZSB1bml0IHJlc2lkZXMuCiAgICAgICAgICAgICAqIEBuYW1lc3BhY2UgcGFyc2VybGliLmNzcwogICAgICAgICAgICAgKiBAY2xhc3MgUHJvcGVydHlWYWx1ZVBhcnQKICAgICAgICAgICAgICogQGV4dGVuZHMgcGFyc2VybGliLnV0aWwuU3ludGF4VW5pdAogICAgICAgICAgICAgKiBAY29uc3RydWN0b3IKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGZ1bmN0aW9uIFByb3BlcnR5VmFsdWVQYXJ0KHRleHQsIGxpbmUsIGNvbCkgewoKICAgICAgICAgICAgICAgIFN5bnRheFVuaXQuY2FsbCh0aGlzLCB0ZXh0LCBsaW5lLCBjb2wsIFBhcnNlci5QUk9QRVJUWV9WQUxVRV9QQVJUX1RZUEUpOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogSW5kaWNhdGVzIHRoZSB0eXBlIG9mIHZhbHVlIHVuaXQuCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB0eXBlCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJ1bmtub3duIjsKCiAgICAgICAgICAgICAgICAvL2ZpZ3VyZSBvdXQgd2hhdCB0eXBlIG9mIGRhdGEgaXQgaXMKCiAgICAgICAgICAgICAgICB2YXIgdGVtcDsKCiAgICAgICAgICAgICAgICAvL2l0IGlzIGEgbWVhc3VyZW1lbnQ/CiAgICAgICAgICAgICAgICBpZiAoL14oWytcLV0/W1xkXC5dKykoW2Etel0rKSQvaS50ZXN0KHRleHQpKSB7CiAgICAgICAgICAgICAgICAgICAgLy9kaW1lbnNpb24KICAgICAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSAiZGltZW5zaW9uIjsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gK1JlZ0V4cC4kMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVuaXRzID0gUmVnRXhwLiQyOwoKICAgICAgICAgICAgICAgICAgICAvL3RyeSB0byBuYXJyb3cgZG93bgogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy51bml0cy50b0xvd2VyQ2FzZSgpKSB7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInJlbSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImV4IjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAicHgiOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjbSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm1tIjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaW4iOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJwdCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInBjIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJsZW5ndGgiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJkZWciOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJyYWQiOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJncmFkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJhbmdsZSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm1zIjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAicyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSAidGltZSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImh6IjoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAia2h6IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJmcmVxdWVuY3kiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJkcGkiOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJkcGNtIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJyZXNvbHV0aW9uIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9kZWZhdWx0CgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoL14oWytcLV0/W1xkXC5dKyklJC9pLnRlc3QodGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICAvL3BlcmNlbnRhZ2UKICAgICAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSAicGVyY2VudGFnZSI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9ICtSZWdFeHAuJDE7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9eKFsrXC1dP1tcZFwuXSspJSQvaS50ZXN0KHRleHQpKSB7CiAgICAgICAgICAgICAgICAgICAgLy9wZXJjZW50YWdlCiAgICAgICAgICAgICAgICAgICAgdGhpcy50eXBlID0gInBlcmNlbnRhZ2UiOwogICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSArUmVnRXhwLiQxOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvXihbK1wtXT9cZCspJC9pLnRlc3QodGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICAvL2ludGVnZXIKICAgICAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSAiaW50ZWdlciI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9ICtSZWdFeHAuJDE7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9eKFsrXC1dP1tcZFwuXSspJC9pLnRlc3QodGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICAvL251bWJlcgogICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJudW1iZXIiOwogICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSArUmVnRXhwLiQxOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvXiMoW2EtZjAtOV17Myw2fSkvaS50ZXN0KHRleHQpKSB7CiAgICAgICAgICAgICAgICAgICAgLy9oZXhjb2xvcgogICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJjb2xvciI7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IFJlZ0V4cC4kMTsKICAgICAgICAgICAgICAgICAgICBpZiAodGVtcC5sZW5ndGggPT0gMykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZCA9IHBhcnNlSW50KHRlbXAuY2hhckF0KDApICsgdGVtcC5jaGFyQXQoMCksIDE2KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmVlbiA9IHBhcnNlSW50KHRlbXAuY2hhckF0KDEpICsgdGVtcC5jaGFyQXQoMSksIDE2KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ibHVlID0gcGFyc2VJbnQodGVtcC5jaGFyQXQoMikgKyB0ZW1wLmNoYXJBdCgyKSwgMTYpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVkID0gcGFyc2VJbnQodGVtcC5zdWJzdHJpbmcoMCwgMiksIDE2KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmVlbiA9IHBhcnNlSW50KHRlbXAuc3Vic3RyaW5nKDIsIDQpLCAxNik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmx1ZSA9IHBhcnNlSW50KHRlbXAuc3Vic3RyaW5nKDQsIDYpLCAxNik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgvXnJnYlwoXHMqKFxkKylccyosXHMqKFxkKylccyosXHMqKFxkKylccypcKS9pLnRlc3QodGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICAvL3JnYigpIGNvbG9yIHdpdGggYWJzb2x1dGUgbnVtYmVycwogICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJjb2xvciI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWQgPSArUmVnRXhwLiQxOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JlZW4gPSArUmVnRXhwLiQyOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYmx1ZSA9ICtSZWdFeHAuJDM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9ecmdiXChccyooXGQrKSVccyosXHMqKFxkKyklXHMqLFxzKihcZCspJVxzKlwpL2kudGVzdCh0ZXh0KSkgewogICAgICAgICAgICAgICAgICAgIC8vcmdiKCkgY29sb3Igd2l0aCBwZXJjZW50YWdlcwogICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJjb2xvciI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWQgPSArUmVnRXhwLiQxICogMjU1IC8gMTAwOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JlZW4gPSArUmVnRXhwLiQyICogMjU1IC8gMTAwOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYmx1ZSA9ICtSZWdFeHAuJDMgKiAyNTUgLyAxMDA7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9ecmdiYVwoXHMqKFxkKylccyosXHMqKFxkKylccyosXHMqKFxkKylccyosXHMqKFtcZFwuXSspXHMqXCkvaS50ZXN0KHRleHQpKSB7CiAgICAgICAgICAgICAgICAgICAgLy9yZ2JhKCkgY29sb3Igd2l0aCBhYnNvbHV0ZSBudW1iZXJzCiAgICAgICAgICAgICAgICAgICAgdGhpcy50eXBlID0gImNvbG9yIjsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZCA9ICtSZWdFeHAuJDE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmVlbiA9ICtSZWdFeHAuJDI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ibHVlID0gK1JlZ0V4cC4kMzsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFscGhhID0gK1JlZ0V4cC4kNDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoL15yZ2JhXChccyooXGQrKSVccyosXHMqKFxkKyklXHMqLFxzKihcZCspJVxzKixccyooW1xkXC5dKylccypcKS9pLnRlc3QodGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICAvL3JnYmEoKSBjb2xvciB3aXRoIHBlcmNlbnRhZ2VzCiAgICAgICAgICAgICAgICAgICAgdGhpcy50eXBlID0gImNvbG9yIjsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZCA9ICtSZWdFeHAuJDEgKiAyNTUgLyAxMDA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmVlbiA9ICtSZWdFeHAuJDIgKiAyNTUgLyAxMDA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ibHVlID0gK1JlZ0V4cC4kMyAqIDI1NSAvIDEwMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFscGhhID0gK1JlZ0V4cC4kNDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoL15oc2xcKFxzKihcZCspXHMqLFxzKihcZCspJVxzKixccyooXGQrKSVccypcKS9pLnRlc3QodGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICAvL2hzbCgpCiAgICAgICAgICAgICAgICAgICAgdGhpcy50eXBlID0gImNvbG9yIjsKICAgICAgICAgICAgICAgICAgICB0aGlzLmh1ZSA9ICtSZWdFeHAuJDE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXR1cmF0aW9uID0gK1JlZ0V4cC4kMiAvIDEwMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxpZ2h0bmVzcyA9ICtSZWdFeHAuJDMgLyAxMDA7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9eaHNsYVwoXHMqKFxkKylccyosXHMqKFxkKyklXHMqLFxzKihcZCspJVxzKixccyooW1xkXC5dKylccypcKS9pLnRlc3QodGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICAvL2hzbGEoKSBjb2xvciB3aXRoIHBlcmNlbnRhZ2VzCiAgICAgICAgICAgICAgICAgICAgdGhpcy50eXBlID0gImNvbG9yIjsKICAgICAgICAgICAgICAgICAgICB0aGlzLmh1ZSA9ICtSZWdFeHAuJDE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXR1cmF0aW9uID0gK1JlZ0V4cC4kMiAvIDEwMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxpZ2h0bmVzcyA9ICtSZWdFeHAuJDMgLyAxMDA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hbHBoYSA9ICtSZWdFeHAuJDQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9edXJsXChbIiddPyhbXlwpIiddKylbIiddP1wpL2kudGVzdCh0ZXh0KSkgewogICAgICAgICAgICAgICAgICAgIC8vVVJJCiAgICAgICAgICAgICAgICAgICAgdGhpcy50eXBlID0gInVyaSI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51cmkgPSBSZWdFeHAuJDE7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9eWyInXVteIiddKlsiJ10vLnRlc3QodGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICAvL3N0cmluZwogICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJzdHJpbmciOwogICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSBldmFsKHRleHQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChDb2xvcnNbdGV4dC50b0xvd2VyQ2FzZSgpXSkgewogICAgICAgICAgICAgICAgICAgIC8vbmFtZWQgY29sb3IKICAgICAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSAiY29sb3IiOwogICAgICAgICAgICAgICAgICAgIHRlbXAgPSBDb2xvcnNbdGV4dC50b0xvd2VyQ2FzZSgpXS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWQgPSBwYXJzZUludCh0ZW1wLnN1YnN0cmluZygwLCAyKSwgMTYpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JlZW4gPSBwYXJzZUludCh0ZW1wLnN1YnN0cmluZygyLCA0KSwgMTYpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYmx1ZSA9IHBhcnNlSW50KHRlbXAuc3Vic3RyaW5nKDQsIDYpLCAxNik7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9eW1wsXC9dJC8udGVzdCh0ZXh0KSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJvcGVyYXRvciI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRleHQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9eW2EtelwtXHUwMDgwLVx1RkZGRl1bYS16MC05XC1cdTAwODAtXHVGRkZGXSokL2kudGVzdCh0ZXh0KSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9ICJpZGVudGlmaWVyIjsKICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdGV4dDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgUHJvcGVydHlWYWx1ZVBhcnQucHJvdG90eXBlID0gbmV3IFN5bnRheFVuaXQoKTsKICAgICAgICAgICAgUHJvcGVydHlWYWx1ZVBhcnQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUHJvcGVydHlWYWx1ZTsKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBDcmVhdGUgYSBuZXcgc3ludGF4IHVuaXQgYmFzZWQgc29sZWx5IG9uIHRoZSBnaXZlbiB0b2tlbi4KICAgICAgICAgICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBjcmVhdGluZyBhIG5ldyBzeW50YXggdW5pdCB3aGVuCiAgICAgICAgICAgICAqIGl0IHJlcHJlc2VudHMgYSBzaW5nbGUgdG9rZW4gaW5zdGVhZCBvZiBtdWx0aXBsZS4KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHRva2VuIFRoZSB0b2tlbiBvYmplY3QgdG8gcmVwcmVzZW50LgogICAgICAgICAgICAgKiBAcmV0dXJuIHtwYXJzZXJsaWIuY3NzLlByb3BlcnR5VmFsdWVQYXJ0fSBUaGUgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgdG9rZW4uCiAgICAgICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgICAgICogQG1ldGhvZCBmcm9tVG9rZW4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIFByb3BlcnR5VmFsdWVQYXJ0LmZyb21Ub2tlbiA9IGZ1bmN0aW9uICh0b2tlbikgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9wZXJ0eVZhbHVlUGFydCh0b2tlbi52YWx1ZSwgdG9rZW4uc3RhcnRMaW5lLCB0b2tlbi5zdGFydENvbCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBQc2V1ZG9zID0gewogICAgICAgICAgICAgICAgIjpmaXJzdC1sZXR0ZXIiOiAxLAogICAgICAgICAgICAgICAgIjpmaXJzdC1saW5lIjogMSwKICAgICAgICAgICAgICAgICI6YmVmb3JlIjogMSwKICAgICAgICAgICAgICAgICI6YWZ0ZXIiOiAxCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBQc2V1ZG9zLkVMRU1FTlQgPSAxOwogICAgICAgICAgICBQc2V1ZG9zLkNMQVNTID0gMjsKCiAgICAgICAgICAgIFBzZXVkb3MuaXNFbGVtZW50ID0gZnVuY3Rpb24gKHBzZXVkbykgewogICAgICAgICAgICAgICAgcmV0dXJuIHBzZXVkby5pbmRleE9mKCI6OiIpID09PSAwIHx8IFBzZXVkb3NbcHNldWRvLnRvTG93ZXJDYXNlKCldID09IFBzZXVkb3MuRUxFTUVOVDsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFJlcHJlc2VudHMgYW4gZW50aXJlIHNpbmdsZSBzZWxlY3RvciwgaW5jbHVkaW5nIGFsbCBwYXJ0cyBidXQgbm90CiAgICAgICAgICAgICAqIGluY2x1ZGluZyBtdWx0aXBsZSBzZWxlY3RvcnMgKHRob3NlIHNlcGFyYXRlZCBieSBjb21tYXMpLgogICAgICAgICAgICAgKiBAbmFtZXNwYWNlIHBhcnNlcmxpYi5jc3MKICAgICAgICAgICAgICogQGNsYXNzIFNlbGVjdG9yCiAgICAgICAgICAgICAqIEBleHRlbmRzIHBhcnNlcmxpYi51dGlsLlN5bnRheFVuaXQKICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHBhcnRzIEFycmF5IG9mIHNlbGVjdG9ycyBwYXJ0cyBtYWtpbmcgdXAgdGhpcyBzZWxlY3Rvci4KICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IGxpbmUgVGhlIGxpbmUgb2YgdGV4dCBvbiB3aGljaCB0aGUgdW5pdCByZXNpZGVzLgogICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gY29sIFRoZSBjb2x1bW4gb2YgdGV4dCBvbiB3aGljaCB0aGUgdW5pdCByZXNpZGVzLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgZnVuY3Rpb24gU2VsZWN0b3IocGFydHMsIGxpbmUsIGNvbCkgewoKICAgICAgICAgICAgICAgIFN5bnRheFVuaXQuY2FsbCh0aGlzLCBwYXJ0cy5qb2luKCIgIiksIGxpbmUsIGNvbCwgUGFyc2VyLlNFTEVDVE9SX1RZUEUpOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogVGhlIHBhcnRzIHRoYXQgbWFrZSB1cCB0aGUgc2VsZWN0b3IuCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBBcnJheQogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHBhcnRzCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHRoaXMucGFydHMgPSBwYXJ0czsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSBzcGVjaWZpY2l0eSBvZiB0aGUgc2VsZWN0b3IuCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBwYXJzZXJsaWIuY3NzLlNwZWNpZmljaXR5CiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkgc3BlY2lmaWNpdHkKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdGhpcy5zcGVjaWZpY2l0eSA9IFNwZWNpZmljaXR5LmNhbGN1bGF0ZSh0aGlzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgU2VsZWN0b3IucHJvdG90eXBlID0gbmV3IFN5bnRheFVuaXQoKTsKICAgICAgICAgICAgU2VsZWN0b3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU2VsZWN0b3I7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogUmVwcmVzZW50cyBhIHNpbmdsZSBwYXJ0IG9mIGEgc2VsZWN0b3Igc3RyaW5nLCBtZWFuaW5nIGEgc2luZ2xlIHNldCBvZgogICAgICAgICAgICAgKiBlbGVtZW50IG5hbWUgYW5kIG1vZGlmaWVycy4gVGhpcyBkb2VzIG5vdCBpbmNsdWRlIGNvbWJpbmF0b3JzIHN1Y2ggYXMKICAgICAgICAgICAgICogc3BhY2VzLCArLCA+LCBldGMuCiAgICAgICAgICAgICAqIEBuYW1lc3BhY2UgcGFyc2VybGliLmNzcwogICAgICAgICAgICAgKiBAY2xhc3MgU2VsZWN0b3JQYXJ0CiAgICAgICAgICAgICAqIEBleHRlbmRzIHBhcnNlcmxpYi51dGlsLlN5bnRheFVuaXQKICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBlbGVtZW50TmFtZSBUaGUgZWxlbWVudCBuYW1lIGluIHRoZSBzZWxlY3RvciBvciBudWxsCiAgICAgICAgICAgICAqICAgICAgaWYgdGhlcmUgaXMgbm8gZWxlbWVudCBuYW1lLgogICAgICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBtb2RpZmllcnMgQXJyYXkgb2YgaW5kaXZpZHVhbCBtb2RpZmllcnMgZm9yIHRoZSBlbGVtZW50LgogICAgICAgICAgICAgKiAgICAgIE1heSBiZSBlbXB0eSBpZiB0aGVyZSBhcmUgbm9uZS4KICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQgVGhlIHRleHQgcmVwcmVzZW50YXRpb24gb2YgdGhlIHVuaXQuCiAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBsaW5lIFRoZSBsaW5lIG9mIHRleHQgb24gd2hpY2ggdGhlIHVuaXQgcmVzaWRlcy4KICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IGNvbCBUaGUgY29sdW1uIG9mIHRleHQgb24gd2hpY2ggdGhlIHVuaXQgcmVzaWRlcy4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIGZ1bmN0aW9uIFNlbGVjdG9yUGFydChlbGVtZW50TmFtZSwgbW9kaWZpZXJzLCB0ZXh0LCBsaW5lLCBjb2wpIHsKCiAgICAgICAgICAgICAgICBTeW50YXhVbml0LmNhbGwodGhpcywgdGV4dCwgbGluZSwgY29sLCBQYXJzZXIuU0VMRUNUT1JfUEFSVF9UWVBFKTsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSB0YWcgbmFtZSBvZiB0aGUgZWxlbWVudCB0byB3aGljaCB0aGlzIHBhcnQKICAgICAgICAgICAgICAgICAqIG9mIHRoZSBzZWxlY3RvciBhZmZlY3RzLgogICAgICAgICAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkgZWxlbWVudE5hbWUKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50TmFtZSA9IGVsZW1lbnROYW1lOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogVGhlIHBhcnRzIHRoYXQgY29tZSBhZnRlciB0aGUgZWxlbWVudCBuYW1lLCBzdWNoIGFzIGNsYXNzIG5hbWVzLCBJRHMsCiAgICAgICAgICAgICAgICAgKiBwc2V1ZG8gY2xhc3Nlcy9lbGVtZW50cywgZXRjLgogICAgICAgICAgICAgICAgICogQHR5cGUgQXJyYXkKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBtb2RpZmllcnMKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdGhpcy5tb2RpZmllcnMgPSBtb2RpZmllcnM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFNlbGVjdG9yUGFydC5wcm90b3R5cGUgPSBuZXcgU3ludGF4VW5pdCgpOwogICAgICAgICAgICBTZWxlY3RvclBhcnQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU2VsZWN0b3JQYXJ0OwoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFJlcHJlc2VudHMgYSBzZWxlY3RvciBtb2RpZmllciBzdHJpbmcsIG1lYW5pbmcgYSBjbGFzcyBuYW1lLCBlbGVtZW50IG5hbWUsCiAgICAgICAgICAgICAqIGVsZW1lbnQgSUQsIHBzZXVkbyBydWxlLCBldGMuCiAgICAgICAgICAgICAqIEBuYW1lc3BhY2UgcGFyc2VybGliLmNzcwogICAgICAgICAgICAgKiBAY2xhc3MgU2VsZWN0b3JTdWJQYXJ0CiAgICAgICAgICAgICAqIEBleHRlbmRzIHBhcnNlcmxpYi51dGlsLlN5bnRheFVuaXQKICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSB1bml0LgogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgdHlwZSBvZiBzZWxlY3RvciBtb2RpZmllci4KICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IGxpbmUgVGhlIGxpbmUgb2YgdGV4dCBvbiB3aGljaCB0aGUgdW5pdCByZXNpZGVzLgogICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gY29sIFRoZSBjb2x1bW4gb2YgdGV4dCBvbiB3aGljaCB0aGUgdW5pdCByZXNpZGVzLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgZnVuY3Rpb24gU2VsZWN0b3JTdWJQYXJ0KHRleHQsIHR5cGUsIGxpbmUsIGNvbCkgewoKICAgICAgICAgICAgICAgIFN5bnRheFVuaXQuY2FsbCh0aGlzLCB0ZXh0LCBsaW5lLCBjb2wsIFBhcnNlci5TRUxFQ1RPUl9TVUJfUEFSVF9UWVBFKTsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSB0eXBlIG9mIG1vZGlmaWVyLgogICAgICAgICAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkgdHlwZQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogU29tZSBzdWJwYXJ0cyBoYXZlIGFyZ3VtZW50cywgdGhpcyByZXByZXNlbnRzIHRoZW0uCiAgICAgICAgICAgICAgICAgKiBAdHlwZSBBcnJheQogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IGFyZ3MKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdGhpcy5hcmdzID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFNlbGVjdG9yU3ViUGFydC5wcm90b3R5cGUgPSBuZXcgU3ludGF4VW5pdCgpOwogICAgICAgICAgICBTZWxlY3RvclN1YlBhcnQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU2VsZWN0b3JTdWJQYXJ0OwoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFJlcHJlc2VudHMgYSBzZWxlY3RvcidzIHNwZWNpZmljaXR5LgogICAgICAgICAgICAgKiBAbmFtZXNwYWNlIHBhcnNlcmxpYi5jc3MKICAgICAgICAgICAgICogQGNsYXNzIFNwZWNpZmljaXR5CiAgICAgICAgICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gYSBTaG91bGQgYmUgMSBmb3IgaW5saW5lIHN0eWxlcywgemVybyBmb3Igc3R5bGVzaGVldCBzdHlsZXMKICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IGIgTnVtYmVyIG9mIElEIHNlbGVjdG9ycwogICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gYyBOdW1iZXIgb2YgY2xhc3NlcyBhbmQgcHNldWRvIGNsYXNzZXMKICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IGQgTnVtYmVyIG9mIGVsZW1lbnQgbmFtZXMgYW5kIHBzZXVkbyBlbGVtZW50cwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgZnVuY3Rpb24gU3BlY2lmaWNpdHkoYSwgYiwgYywgZCkgewogICAgICAgICAgICAgICAgdGhpcy5hID0gYTsKICAgICAgICAgICAgICAgIHRoaXMuYiA9IGI7CiAgICAgICAgICAgICAgICB0aGlzLmMgPSBjOwogICAgICAgICAgICAgICAgdGhpcy5kID0gZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgU3BlY2lmaWNpdHkucHJvdG90eXBlID0gewogICAgICAgICAgICAgICAgY29uc3RydWN0b3I6IFNwZWNpZmljaXR5LAoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogQ29tcGFyZSB0aGlzIHNwZWNpZmljaXR5IHRvIGFub3RoZXIuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1NwZWNpZmljaXR5fSBvdGhlciBUaGUgb3RoZXIgc3BlY2lmaWNpdHkgdG8gY29tcGFyZSB0by4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge2ludH0gLTEgaWYgdGhlIG90aGVyIHNwZWNpZmljaXR5IGlzIGxhcmdlciwgMSBpZiBzbWFsbGVyLCAwIGlmIGVxdWFsLgogICAgICAgICAgICAgICAgICogQG1ldGhvZCBjb21wYXJlCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIGNvbXBhcmU6IGZ1bmN0aW9uIChvdGhlcikgewogICAgICAgICAgICAgICAgICAgIHZhciBjb21wcyA9IFsiYSIsICJiIiwgImMiLCAiZCJdLAogICAgICAgICAgICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgICAgICAgICAgICBsZW47CgogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGNvbXBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzW2NvbXBzW2ldXSA8IG90aGVyW2NvbXBzW2ldXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXNbY29tcHNbaV1dID4gb3RoZXJbY29tcHNbaV1dKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogQ3JlYXRlcyBhIG51bWVyaWMgdmFsdWUgZm9yIHRoZSBzcGVjaWZpY2l0eS4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge2ludH0gVGhlIG51bWVyaWMgdmFsdWUgZm9yIHRoZSBzcGVjaWZpY2l0eS4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgdmFsdWVPZgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB2YWx1ZU9mOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYSAqIDEwMDAgKyB0aGlzLmIgKiAxMDAgKyB0aGlzLmMgKiAxMCArIHRoaXMuZDsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIGZvciBzcGVjaWZpY2l0eS4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge1N0cmluZ30gVGhlIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiBzcGVjaWZpY2l0eS4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgdG9TdHJpbmcKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hICsgIiwiICsgdGhpcy5iICsgIiwiICsgdGhpcy5jICsgIiwiICsgdGhpcy5kOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBDYWxjdWxhdGVzIHRoZSBzcGVjaWZpY2l0eSBvZiB0aGUgZ2l2ZW4gc2VsZWN0b3IuCiAgICAgICAgICAgICAqIEBwYXJhbSB7cGFyc2VybGliLmNzcy5TZWxlY3Rvcn0gVGhlIHNlbGVjdG9yIHRvIGNhbGN1bGF0ZSBzcGVjaWZpY2l0eSBmb3IuCiAgICAgICAgICAgICAqIEByZXR1cm4ge3BhcnNlcmxpYi5jc3MuU3BlY2lmaWNpdHl9IFRoZSBzcGVjaWZpY2l0eSBvZiB0aGUgc2VsZWN0b3IuCiAgICAgICAgICAgICAqIEBzdGF0aWMKICAgICAgICAgICAgICogQG1ldGhvZCBjYWxjdWxhdGUKICAgICAgICAgICAgICovCiAgICAgICAgICAgIFNwZWNpZmljaXR5LmNhbGN1bGF0ZSA9IGZ1bmN0aW9uIChzZWxlY3RvcikgewoKICAgICAgICAgICAgICAgIHZhciBpLAogICAgICAgICAgICAgICAgICAgIGxlbiwKICAgICAgICAgICAgICAgICAgICBiID0gMCwKICAgICAgICAgICAgICAgICAgICBjID0gMCwKICAgICAgICAgICAgICAgICAgICBkID0gMDsKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVWYWx1ZXMocGFydCkgewoKICAgICAgICAgICAgICAgICAgICB2YXIgaSwgaiwgbGVuLCBudW0sIG1vZGlmaWVyOwoKICAgICAgICAgICAgICAgICAgICBpZiAocGFydC5lbGVtZW50TmFtZSAmJiBwYXJ0LnRleHQuY2hhckF0KHBhcnQudGV4dC5sZW5ndGggLSAxKSAhPSAiKiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZCsrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gcGFydC5tb2RpZmllcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZXIgPSBwYXJ0Lm1vZGlmaWVyc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChtb2RpZmllci50eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjbGFzcyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhdHRyaWJ1dGUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJpZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYisrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInBzZXVkbyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFBzZXVkb3MuaXNFbGVtZW50KG1vZGlmaWVyLnRleHQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIm5vdCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMCwgbnVtID0gbW9kaWZpZXIuYXJncy5sZW5ndGg7IGogPCBudW07IGorKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVWYWx1ZXMobW9kaWZpZXIuYXJnc1tqXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHNlbGVjdG9yLnBhcnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgcGFydCA9IHNlbGVjdG9yLnBhcnRzW2ldOwoKICAgICAgICAgICAgICAgICAgICBpZiAocGFydCBpbnN0YW5jZW9mIFNlbGVjdG9yUGFydCkgewogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVWYWx1ZXMocGFydCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3BlY2lmaWNpdHkoMCwgYiwgYywgZCk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgaCA9IC9eWzAtOWEtZkEtRl0kLywKICAgICAgICAgICAgICAgIG5vbmFzY2lpID0gL15bXHUwMDgwLVx1RkZGRl0kLywKICAgICAgICAgICAgICAgIG5sID0gL1xufFxyXG58XHJ8XGYvOwoKICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAvLyBIZWxwZXIgZnVuY3Rpb25zCiAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgogICAgICAgICAgICBmdW5jdGlvbiBpc0hleERpZ2l0KGMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjICE9IG51bGwgJiYgaC50ZXN0KGMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpc0RpZ2l0KGMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjICE9IG51bGwgJiYgL1xkLy50ZXN0KGMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBpc1doaXRlc3BhY2UoYykgewogICAgICAgICAgICAgICAgcmV0dXJuIGMgIT0gbnVsbCAmJiAvXHMvLnRlc3QoYyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGlzTmV3TGluZShjKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYyAhPSBudWxsICYmIG5sLnRlc3QoYyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGlzTmFtZVN0YXJ0KGMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjICE9IG51bGwgJiYgL1thLXpfXHUwMDgwLVx1RkZGRlxcXS9pLnRlc3QoYyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGlzTmFtZUNoYXIoYykgewogICAgICAgICAgICAgICAgcmV0dXJuIGMgIT0gbnVsbCAmJiAoaXNOYW1lU3RhcnQoYykgfHwgL1swLTlcLVxcXS8udGVzdChjKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGlzSWRlbnRTdGFydChjKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYyAhPSBudWxsICYmIChpc05hbWVTdGFydChjKSB8fCAvXC1cXC8udGVzdChjKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIG1peChyZWNlaXZlciwgc3VwcGxpZXIpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gc3VwcGxpZXIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3VwcGxpZXIuaGFzT3duUHJvcGVydHkocHJvcCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXJbcHJvcF0gPSBzdXBwbGllcltwcm9wXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcmVjZWl2ZXI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAgICAgLy8gQ1NTIFRva2VuIFN0cmVhbQogICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEEgdG9rZW4gc3RyZWFtIHRoYXQgcHJvZHVjZXMgQ1NTIHRva2Vucy4KICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd8UmVhZGVyfSBpbnB1dCBUaGUgc291cmNlIG9mIHRleHQgdG8gdG9rZW5pemUuCiAgICAgICAgICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgKiBAY2xhc3MgVG9rZW5TdHJlYW0KICAgICAgICAgICAgICogQG5hbWVzcGFjZSBwYXJzZXJsaWIuY3NzCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBmdW5jdGlvbiBUb2tlblN0cmVhbShpbnB1dCkgewogICAgICAgICAgICAgICAgVG9rZW5TdHJlYW1CYXNlLmNhbGwodGhpcywgaW5wdXQsIFRva2Vucyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFRva2VuU3RyZWFtLnByb3RvdHlwZSA9IG1peChuZXcgVG9rZW5TdHJlYW1CYXNlKCksIHsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIE92ZXJyaWRlcyB0aGUgVG9rZW5TdHJlYW1CYXNlIG1ldGhvZCBvZiB0aGUgc2FtZSBuYW1lCiAgICAgICAgICAgICAgICAgKiB0byBwcm9kdWNlIENTUyB0b2tlbnMuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3ZhcmlhbnR9IGNoYW5uZWwgVGhlIG5hbWUgb2YgdGhlIGNoYW5uZWwgdG8gdXNlCiAgICAgICAgICAgICAgICAgKiAgICAgIGZvciB0aGUgbmV4dCB0b2tlbi4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQSB0b2tlbiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBuZXh0IHRva2VuLgogICAgICAgICAgICAgICAgICogQG1ldGhvZCBfZ2V0VG9rZW4KICAgICAgICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIF9nZXRUb2tlbjogZnVuY3Rpb24gKGNoYW5uZWwpIHsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGMsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlciA9IHRoaXMuX3JlYWRlciwKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBzdGFydExpbmUgPSByZWFkZXIuZ2V0TGluZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBzdGFydENvbCA9IHJlYWRlci5nZXRDb2woKTsKCiAgICAgICAgICAgICAgICAgICAgYyA9IHJlYWRlci5yZWFkKCk7CgogICAgICAgICAgICAgICAgICAgIHdoaWxlIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYykgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBQb3RlbnRpYWwgdG9rZW5zOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBDT01NRU5UCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAtIFNMQVNICiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAtIENIQVIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiLyI6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFkZXIucGVlaygpID09ICIqIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuY29tbWVudFRva2VuKGMsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5jaGFyVG9rZW4oYywgc3RhcnRMaW5lLCBzdGFydENvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBQb3RlbnRpYWwgdG9rZW5zOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBEQVNITUFUQ0gKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gSU5DTFVERVMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gUFJFRklYTUFUQ0gKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gU1VGRklYTUFUQ0gKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gU1VCU1RSSU5HTUFUQ0gKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gQ0hBUgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ8IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIn4iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiXiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICIkIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIioiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFkZXIucGVlaygpID09ICI9IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuY29tcGFyaXNvblRva2VuKGMsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5jaGFyVG9rZW4oYywgc3RhcnRMaW5lLCBzdGFydENvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBQb3RlbnRpYWwgdG9rZW5zOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBTVFJJTkcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gSU5WQUxJRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJcIiI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICInIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuc3RyaW5nVG9rZW4oYywgc3RhcnRMaW5lLCBzdGFydENvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFBvdGVudGlhbCB0b2tlbnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAtIEhBU0gKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gQ0hBUgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICIjIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYW1lQ2hhcihyZWFkZXIucGVlaygpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuaGFzaFRva2VuKGMsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5jaGFyVG9rZW4oYywgc3RhcnRMaW5lLCBzdGFydENvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBQb3RlbnRpYWwgdG9rZW5zOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBET1QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gTlVNQkVSCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAtIERJTUVOU0lPTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBQRVJDRU5UQUdFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIi4iOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0RpZ2l0KHJlYWRlci5wZWVrKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5udW1iZXJUb2tlbihjLCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuY2hhclRva2VuKGMsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogUG90ZW50aWFsIHRva2VuczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gQ0RDCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAtIE1JTlVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAtIE5VTUJFUgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBESU1FTlNJT04KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gUEVSQ0VOVEFHRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICItIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVhZGVyLnBlZWsoKSA9PSAiLSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb3VsZCBiZSBjbG9zaW5nIEhUTUwtc3R5bGUgY29tbWVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuaHRtbENvbW1lbnRFbmRUb2tlbihjLCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzTmFtZVN0YXJ0KHJlYWRlci5wZWVrKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5pZGVudE9yRnVuY3Rpb25Ub2tlbihjLCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuY2hhclRva2VuKGMsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogUG90ZW50aWFsIHRva2VuczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gSU1QT1JUQU5UX1NZTQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBDSEFSCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIiEiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5pbXBvcnRhbnRUb2tlbihjLCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQW55IGF0LWtleXdvcmQgb3IgQ0hBUgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJAIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuYXRSdWxlVG9rZW4oYywgc3RhcnRMaW5lLCBzdGFydENvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFBvdGVudGlhbCB0b2tlbnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAtIE5PVAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBDSEFSCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIjoiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5ub3RUb2tlbihjLCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogUG90ZW50aWFsIHRva2VuczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gQ0RPCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAtIENIQVIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiPCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLmh0bWxDb21tZW50U3RhcnRUb2tlbihjLCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogUG90ZW50aWFsIHRva2VuczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gVU5JQ09ERV9SQU5HRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBVUkwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gQ0hBUgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJVIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFkZXIucGVlaygpID09ICIrIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMudW5pY29kZVJhbmdlVG9rZW4oYywgc3RhcnRMaW5lLCBzdGFydENvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qZmFsbHMgdGhyb3VnaCovCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBQb3RlbnRpYWwgdG9rZW5zOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gTlVNQkVSCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBESU1FTlNJT04KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAtIExFTkdUSAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gRlJFUQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gVElNRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gRU1TCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBFWFMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAtIEFOR0xFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRGlnaXQoYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLm51bWJlclRva2VuKGMsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogUG90ZW50aWFsIHRva2VuczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNXaGl0ZXNwYWNlKGMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMud2hpdGVzcGFjZVRva2VuKGMsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogUG90ZW50aWFsIHRva2VuczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIC0gSURFTlQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzSWRlbnRTdGFydChjKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5pZGVudE9yRnVuY3Rpb25Ub2tlbihjLCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIFBvdGVudGlhbCB0b2tlbnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBDSEFSCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogLSBQTFVTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuY2hhclRva2VuKGMsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vbWFrZSBzdXJlIHRoaXMgdG9rZW4gaXMgd2FudGVkCiAgICAgICAgICAgICAgICAgICAgICAgIC8vVE9ETzogY2hlY2sgY2hhbm5lbAogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSByZWFkZXIucmVhZCgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCF0b2tlbiAmJiBjID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLmNyZWF0ZVRva2VuKFRva2Vucy5FT0YsIG51bGwsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRva2VuOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAgICAgICAgIC8vIE1ldGhvZHMgdG8gY3JlYXRlIHRva2VucwogICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBQcm9kdWNlcyBhIHRva2VuIGJhc2VkIG9uIGF2YWlsYWJsZSBkYXRhIGFuZCB0aGUgY3VycmVudAogICAgICAgICAgICAgICAgICogcmVhZGVyIHBvc2l0aW9uIGluZm9ybWF0aW9uLiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgYnkgb3RoZXIKICAgICAgICAgICAgICAgICAqIHByaXZhdGUgbWV0aG9kcyB0byBjcmVhdGUgdG9rZW5zIGFuZCBpcyBuZXZlciBjYWxsZWQgZGlyZWN0bHkuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gdHQgVGhlIHRva2VuIHR5cGUuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgVGhlIHRleHQgdmFsdWUgb2YgdGhlIHRva2VuLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IHN0YXJ0TGluZSBUaGUgYmVnaW5uaW5nIGxpbmUgZm9yIHRoZSBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gc3RhcnRDb2wgVGhlIGJlZ2lubmluZyBjb2x1bW4gZm9yIHRoZSBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAoT3B0aW9uYWwpIFNwZWNpZmllcyBhIGNoYW5uZWwgcHJvcGVydHkKICAgICAgICAgICAgICAgICAqICAgICAgdG8gaW5kaWNhdGUgdGhhdCBhIGRpZmZlcmVudCBjaGFubmVsIHNob3VsZCBiZSBzY2FubmVkCiAgICAgICAgICAgICAgICAgKiAgICAgIGFuZC9vciBhIGhpZGUgcHJvcGVydHkgaW5kaWNhdGluZyB0aGF0IHRoZSB0b2tlbiBzaG91bGQKICAgICAgICAgICAgICAgICAqICAgICAgYmUgaGlkZGVuLgogICAgICAgICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBBIHRva2VuIG9iamVjdC4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgY3JlYXRlVG9rZW4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgY3JlYXRlVG9rZW46IGZ1bmN0aW9uICh0dCwgdmFsdWUsIHN0YXJ0TGluZSwgc3RhcnRDb2wsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fcmVhZGVyOwogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHR0LAogICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsOiBvcHRpb25zLmNoYW5uZWwsCiAgICAgICAgICAgICAgICAgICAgICAgIGhpZGU6IG9wdGlvbnMuaGlkZSB8fCBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRMaW5lOiBzdGFydExpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sOiBzdGFydENvbCwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kTGluZTogcmVhZGVyLmdldExpbmUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kQ29sOiByZWFkZXIuZ2V0Q29sKCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAgICAgICAgIC8vIE1ldGhvZHMgdG8gY3JlYXRlIHNwZWNpZmljIHRva2VucwogICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBQcm9kdWNlcyBhIHRva2VuIGZvciBhbnkgYXQtcnVsZS4gSWYgdGhlIGF0LXJ1bGUgaXMgdW5rbm93biwgdGhlbgogICAgICAgICAgICAgICAgICogdGhlIHRva2VuIGlzIGZvciBhIHNpbmdsZSAiQCIgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGZpcnN0IFRoZSBmaXJzdCBjaGFyYWN0ZXIgZm9yIHRoZSB0b2tlbi4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBzdGFydExpbmUgVGhlIGJlZ2lubmluZyBsaW5lIGZvciB0aGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IHN0YXJ0Q29sIFRoZSBiZWdpbm5pbmcgY29sdW1uIGZvciB0aGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBBIHRva2VuIG9iamVjdC4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgYXRSdWxlVG9rZW4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgYXRSdWxlVG9rZW46IGZ1bmN0aW9uIChmaXJzdCwgc3RhcnRMaW5lLCBzdGFydENvbCkgewogICAgICAgICAgICAgICAgICAgIHZhciBydWxlID0gZmlyc3QsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlciA9IHRoaXMuX3JlYWRlciwKICAgICAgICAgICAgICAgICAgICAgICAgdHQgPSBUb2tlbnMuQ0hBUiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGM7CgogICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICogRmlyc3QsIG1hcmsgd2hlcmUgd2UgYXJlLiBUaGVyZSBhcmUgb25seSBmb3VyIEAgcnVsZXMsCiAgICAgICAgICAgICAgICAgICAgICogc28gYW55dGhpbmcgZWxzZSBpcyByZWFsbHkganVzdCBhbiBpbnZhbGlkIHRva2VuLgogICAgICAgICAgICAgICAgICAgICAqIEJhc2ljYWxseSwgaWYgdGhpcyBkb2Vzbid0IG1hdGNoIG9uZSBvZiB0aGUga25vd24gQAogICAgICAgICAgICAgICAgICAgICAqIHJ1bGVzLCBqdXN0IHJldHVybiAnQCcgYXMgYW4gdW5rbm93biB0b2tlbiBhbmQgYWxsb3cKICAgICAgICAgICAgICAgICAgICAgKiBwYXJzaW5nIHRvIGNvbnRpbnVlIGFmdGVyIHRoYXQgcG9pbnQuCiAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLm1hcmsoKTsKCiAgICAgICAgICAgICAgICAgICAgLy90cnkgdG8gZmluZCB0aGUgYXQta2V5d29yZAogICAgICAgICAgICAgICAgICAgIGlkZW50ID0gdGhpcy5yZWFkTmFtZSgpOwogICAgICAgICAgICAgICAgICAgIHJ1bGUgPSBmaXJzdCArIGlkZW50OwogICAgICAgICAgICAgICAgICAgIHR0ID0gVG9rZW5zLnR5cGUocnVsZS50b0xvd2VyQ2FzZSgpKTsKCiAgICAgICAgICAgICAgICAgICAgLy9pZiBpdCdzIG5vdCB2YWxpZCwgdXNlIHRoZSBmaXJzdCBjaGFyYWN0ZXIgb25seSBhbmQgcmVzZXQgdGhlIHJlYWRlcgogICAgICAgICAgICAgICAgICAgIGlmICh0dCA9PSBUb2tlbnMuQ0hBUiB8fCB0dCA9PSBUb2tlbnMuVU5LTk9XTikgewogICAgICAgICAgICAgICAgICAgICAgICB0dCA9IFRva2Vucy5DSEFSOwogICAgICAgICAgICAgICAgICAgICAgICBydWxlID0gZmlyc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZXNldCgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVG9rZW4odHQsIHJ1bGUsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFByb2R1Y2VzIGEgY2hhcmFjdGVyIHRva2VuIGJhc2VkIG9uIHRoZSBnaXZlbiBjaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAqIGFuZCBsb2NhdGlvbiBpbiB0aGUgc3RyZWFtLiBJZiB0aGVyZSdzIGEgc3BlY2lhbCAobm9uLXN0YW5kYXJkKQogICAgICAgICAgICAgICAgICogdG9rZW4gbmFtZSwgdGhpcyBpcyB1c2VkOyBvdGhlcndpc2UgQ0hBUiBpcyB1c2VkLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGMgVGhlIGNoYXJhY3RlciBmb3IgdGhlIHRva2VuLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IHN0YXJ0TGluZSBUaGUgYmVnaW5uaW5nIGxpbmUgZm9yIHRoZSBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gc3RhcnRDb2wgVGhlIGJlZ2lubmluZyBjb2x1bW4gZm9yIHRoZSBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IEEgdG9rZW4gb2JqZWN0LgogICAgICAgICAgICAgICAgICogQG1ldGhvZCBjaGFyVG9rZW4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgY2hhclRva2VuOiBmdW5jdGlvbiAoYywgc3RhcnRMaW5lLCBzdGFydENvbCkgewogICAgICAgICAgICAgICAgICAgIHZhciB0dCA9IFRva2Vucy50eXBlKGMpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodHQgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHQgPSBUb2tlbnMuQ0hBUjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVRva2VuKHR0LCBjLCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBQcm9kdWNlcyBhIGNoYXJhY3RlciB0b2tlbiBiYXNlZCBvbiB0aGUgZ2l2ZW4gY2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgKiBhbmQgbG9jYXRpb24gaW4gdGhlIHN0cmVhbS4gSWYgdGhlcmUncyBhIHNwZWNpYWwgKG5vbi1zdGFuZGFyZCkKICAgICAgICAgICAgICAgICAqIHRva2VuIG5hbWUsIHRoaXMgaXMgdXNlZDsgb3RoZXJ3aXNlIENIQVIgaXMgdXNlZC4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBmaXJzdCBUaGUgZmlyc3QgY2hhcmFjdGVyIGZvciB0aGUgdG9rZW4uCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gc3RhcnRMaW5lIFRoZSBiZWdpbm5pbmcgbGluZSBmb3IgdGhlIGNoYXJhY3Rlci4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBzdGFydENvbCBUaGUgYmVnaW5uaW5nIGNvbHVtbiBmb3IgdGhlIGNoYXJhY3Rlci4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQSB0b2tlbiBvYmplY3QuCiAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIGNvbW1lbnRUb2tlbgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBjb21tZW50VG9rZW46IGZ1bmN0aW9uIChmaXJzdCwgc3RhcnRMaW5lLCBzdGFydENvbCkgewogICAgICAgICAgICAgICAgICAgIHZhciByZWFkZXIgPSB0aGlzLl9yZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnQgPSB0aGlzLnJlYWRDb21tZW50KGZpcnN0KTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVG9rZW4oVG9rZW5zLkNPTU1FTlQsIGNvbW1lbnQsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFByb2R1Y2VzIGEgY29tcGFyaXNvbiB0b2tlbiBiYXNlZCBvbiB0aGUgZ2l2ZW4gY2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgKiBhbmQgbG9jYXRpb24gaW4gdGhlIHN0cmVhbS4gVGhlIG5leHQgY2hhcmFjdGVyIG11c3QgYmUKICAgICAgICAgICAgICAgICAqIHJlYWQgYW5kIGlzIGFscmVhZHkga25vd24gdG8gYmUgYW4gZXF1YWxzIHNpZ24uCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gYyBUaGUgY2hhcmFjdGVyIGZvciB0aGUgdG9rZW4uCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gc3RhcnRMaW5lIFRoZSBiZWdpbm5pbmcgbGluZSBmb3IgdGhlIGNoYXJhY3Rlci4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBzdGFydENvbCBUaGUgYmVnaW5uaW5nIGNvbHVtbiBmb3IgdGhlIGNoYXJhY3Rlci4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQSB0b2tlbiBvYmplY3QuCiAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIGNvbXBhcmlzb25Ub2tlbgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBjb21wYXJpc29uVG9rZW46IGZ1bmN0aW9uIChjLCBzdGFydExpbmUsIHN0YXJ0Q29sKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlYWRlciA9IHRoaXMuX3JlYWRlciwKICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFyaXNvbiA9IGMgKyByZWFkZXIucmVhZCgpLAogICAgICAgICAgICAgICAgICAgICAgICB0dCA9IFRva2Vucy50eXBlKGNvbXBhcmlzb24pIHx8IFRva2Vucy5DSEFSOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVUb2tlbih0dCwgY29tcGFyaXNvbiwgc3RhcnRMaW5lLCBzdGFydENvbCk7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogUHJvZHVjZXMgYSBoYXNoIHRva2VuIGJhc2VkIG9uIHRoZSBzcGVjaWZpZWQgaW5mb3JtYXRpb24uIFRoZQogICAgICAgICAgICAgICAgICogZmlyc3QgY2hhcmFjdGVyIHByb3ZpZGVkIGlzIHRoZSBwb3VuZCBzaWduICgjKSBhbmQgdGhlbiB0aGlzCiAgICAgICAgICAgICAgICAgKiBtZXRob2QgcmVhZHMgYSBuYW1lIGFmdGVyd2FyZC4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBmaXJzdCBUaGUgZmlyc3QgY2hhcmFjdGVyICgjKSBpbiB0aGUgaGFzaCBuYW1lLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IHN0YXJ0TGluZSBUaGUgYmVnaW5uaW5nIGxpbmUgZm9yIHRoZSBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gc3RhcnRDb2wgVGhlIGJlZ2lubmluZyBjb2x1bW4gZm9yIHRoZSBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IEEgdG9rZW4gb2JqZWN0LgogICAgICAgICAgICAgICAgICogQG1ldGhvZCBoYXNoVG9rZW4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgaGFzaFRva2VuOiBmdW5jdGlvbiAoZmlyc3QsIHN0YXJ0TGluZSwgc3RhcnRDb2wpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fcmVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gdGhpcy5yZWFkTmFtZShmaXJzdCk7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVRva2VuKFRva2Vucy5IQVNILCBuYW1lLCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBQcm9kdWNlcyBhIENETyBvciBDSEFSIHRva2VuIGJhc2VkIG9uIHRoZSBzcGVjaWZpZWQgaW5mb3JtYXRpb24uIFRoZQogICAgICAgICAgICAgICAgICogZmlyc3QgY2hhcmFjdGVyIGlzIHByb3ZpZGVkIGFuZCB0aGUgcmVzdCBpcyByZWFkIGJ5IHRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUKICAgICAgICAgICAgICAgICAqIHRoZSBjb3JyZWN0IHRva2VuIHRvIGNyZWF0ZS4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBmaXJzdCBUaGUgZmlyc3QgY2hhcmFjdGVyIGluIHRoZSB0b2tlbi4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBzdGFydExpbmUgVGhlIGJlZ2lubmluZyBsaW5lIGZvciB0aGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IHN0YXJ0Q29sIFRoZSBiZWdpbm5pbmcgY29sdW1uIGZvciB0aGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBBIHRva2VuIG9iamVjdC4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgaHRtbENvbW1lbnRTdGFydFRva2VuCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIGh0bWxDb21tZW50U3RhcnRUb2tlbjogZnVuY3Rpb24gKGZpcnN0LCBzdGFydExpbmUsIHN0YXJ0Q29sKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlYWRlciA9IHRoaXMuX3JlYWRlciwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGZpcnN0OwoKICAgICAgICAgICAgICAgICAgICByZWFkZXIubWFyaygpOwogICAgICAgICAgICAgICAgICAgIHRleHQgKz0gcmVhZGVyLnJlYWRDb3VudCgzKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQgPT0gIjwhLS0iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVRva2VuKFRva2Vucy5DRE8sIHRleHQsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZXNldCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGFyVG9rZW4oZmlyc3QsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBQcm9kdWNlcyBhIENEQyBvciBDSEFSIHRva2VuIGJhc2VkIG9uIHRoZSBzcGVjaWZpZWQgaW5mb3JtYXRpb24uIFRoZQogICAgICAgICAgICAgICAgICogZmlyc3QgY2hhcmFjdGVyIGlzIHByb3ZpZGVkIGFuZCB0aGUgcmVzdCBpcyByZWFkIGJ5IHRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUKICAgICAgICAgICAgICAgICAqIHRoZSBjb3JyZWN0IHRva2VuIHRvIGNyZWF0ZS4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBmaXJzdCBUaGUgZmlyc3QgY2hhcmFjdGVyIGluIHRoZSB0b2tlbi4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBzdGFydExpbmUgVGhlIGJlZ2lubmluZyBsaW5lIGZvciB0aGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IHN0YXJ0Q29sIFRoZSBiZWdpbm5pbmcgY29sdW1uIGZvciB0aGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBBIHRva2VuIG9iamVjdC4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgaHRtbENvbW1lbnRFbmRUb2tlbgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBodG1sQ29tbWVudEVuZFRva2VuOiBmdW5jdGlvbiAoZmlyc3QsIHN0YXJ0TGluZSwgc3RhcnRDb2wpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fcmVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gZmlyc3Q7CgogICAgICAgICAgICAgICAgICAgIHJlYWRlci5tYXJrKCk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCArPSByZWFkZXIucmVhZENvdW50KDIpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGV4dCA9PSAiLS0+IikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVUb2tlbihUb2tlbnMuQ0RDLCB0ZXh0LCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVzZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hhclRva2VuKGZpcnN0LCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogUHJvZHVjZXMgYW4gSURFTlQgb3IgRlVOQ1RJT04gdG9rZW4gYmFzZWQgb24gdGhlIHNwZWNpZmllZCBpbmZvcm1hdGlvbi4gVGhlCiAgICAgICAgICAgICAgICAgKiBmaXJzdCBjaGFyYWN0ZXIgaXMgcHJvdmlkZWQgYW5kIHRoZSByZXN0IGlzIHJlYWQgYnkgdGhlIGZ1bmN0aW9uIHRvIGRldGVybWluZQogICAgICAgICAgICAgICAgICogdGhlIGNvcnJlY3QgdG9rZW4gdG8gY3JlYXRlLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGZpcnN0IFRoZSBmaXJzdCBjaGFyYWN0ZXIgaW4gdGhlIGlkZW50aWZpZXIuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gc3RhcnRMaW5lIFRoZSBiZWdpbm5pbmcgbGluZSBmb3IgdGhlIGNoYXJhY3Rlci4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBzdGFydENvbCBUaGUgYmVnaW5uaW5nIGNvbHVtbiBmb3IgdGhlIGNoYXJhY3Rlci4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQSB0b2tlbiBvYmplY3QuCiAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIGlkZW50T3JGdW5jdGlvblRva2VuCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIGlkZW50T3JGdW5jdGlvblRva2VuOiBmdW5jdGlvbiAoZmlyc3QsIHN0YXJ0TGluZSwgc3RhcnRDb2wpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fcmVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgICBpZGVudCA9IHRoaXMucmVhZE5hbWUoZmlyc3QpLAogICAgICAgICAgICAgICAgICAgICAgICB0dCA9IFRva2Vucy5JREVOVDsKCiAgICAgICAgICAgICAgICAgICAgLy9pZiB0aGVyZSdzIGEgbGVmdCBwYXJlbiBpbW1lZGlhdGVseSBhZnRlciwgaXQncyBhIFVSSSBvciBmdW5jdGlvbgogICAgICAgICAgICAgICAgICAgIGlmIChyZWFkZXIucGVlaygpID09ICIoIikgewogICAgICAgICAgICAgICAgICAgICAgICBpZGVudCArPSByZWFkZXIucmVhZCgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWRlbnQudG9Mb3dlckNhc2UoKSA9PSAidXJsKCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0ID0gVG9rZW5zLlVSSTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50ID0gdGhpcy5yZWFkVVJJKGlkZW50KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2RpZG4ndCBmaW5kIGEgdmFsaWQgVVJMIG9yIHRoZXJlJ3Mgbm8gY2xvc2luZyBwYXJlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkZW50LnRvTG93ZXJDYXNlKCkgPT0gInVybCgiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQgPSBUb2tlbnMuRlVOQ1RJT047CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dCA9IFRva2Vucy5GVU5DVElPTjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVhZGVyLnBlZWsoKSA9PSAiOiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9taWdodCBiZSBhbiBJRSBmdW5jdGlvbgoKICAgICAgICAgICAgICAgICAgICAgICAgLy9JRS1zcGVjaWZpYyBmdW5jdGlvbnMgYWx3YXlzIGJlaW5nIHdpdGggcHJvZ2lkOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWRlbnQudG9Mb3dlckNhc2UoKSA9PSAicHJvZ2lkIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnQgKz0gcmVhZGVyLnJlYWRUbygiKCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQgPSBUb2tlbnMuSUVfRlVOQ1RJT047CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVRva2VuKHR0LCBpZGVudCwgc3RhcnRMaW5lLCBzdGFydENvbCk7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogUHJvZHVjZXMgYW4gSU1QT1JUQU5UX1NZTSBvciBDSEFSIHRva2VuIGJhc2VkIG9uIHRoZSBzcGVjaWZpZWQgaW5mb3JtYXRpb24uIFRoZQogICAgICAgICAgICAgICAgICogZmlyc3QgY2hhcmFjdGVyIGlzIHByb3ZpZGVkIGFuZCB0aGUgcmVzdCBpcyByZWFkIGJ5IHRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUKICAgICAgICAgICAgICAgICAqIHRoZSBjb3JyZWN0IHRva2VuIHRvIGNyZWF0ZS4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBmaXJzdCBUaGUgZmlyc3QgY2hhcmFjdGVyIGluIHRoZSB0b2tlbi4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBzdGFydExpbmUgVGhlIGJlZ2lubmluZyBsaW5lIGZvciB0aGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IHN0YXJ0Q29sIFRoZSBiZWdpbm5pbmcgY29sdW1uIGZvciB0aGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBBIHRva2VuIG9iamVjdC4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgaW1wb3J0YW50VG9rZW4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgaW1wb3J0YW50VG9rZW46IGZ1bmN0aW9uIChmaXJzdCwgc3RhcnRMaW5lLCBzdGFydENvbCkgewogICAgICAgICAgICAgICAgICAgIHZhciByZWFkZXIgPSB0aGlzLl9yZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydGFudCA9IGZpcnN0LAogICAgICAgICAgICAgICAgICAgICAgICB0dCA9IFRva2Vucy5DSEFSLAogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wLAogICAgICAgICAgICAgICAgICAgICAgICBjOwoKICAgICAgICAgICAgICAgICAgICByZWFkZXIubWFyaygpOwogICAgICAgICAgICAgICAgICAgIGMgPSByZWFkZXIucmVhZCgpOwoKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYykgewoKICAgICAgICAgICAgICAgICAgICAgICAgLy90aGVyZSBjYW4gYmUgYSBjb21tZW50IGluIGhlcmUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMgPT0gIi8iKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiB0aGUgbmV4dCBjaGFyYWN0ZXIgaXNuJ3QgYSBzdGFyLCB0aGVuIHRoaXMgaXNuJ3QgYSB2YWxpZCAhaW1wb3J0YW50IHRva2VuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVhZGVyLnBlZWsoKSAhPSAiKiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCA9IHRoaXMucmVhZENvbW1lbnQoYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXAgPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9icm9rZW4hCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1doaXRlc3BhY2UoYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydGFudCArPSBjICsgdGhpcy5yZWFkV2hpdGVzcGFjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9pL2kudGVzdChjKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCA9IHJlYWRlci5yZWFkQ291bnQoOCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoL21wb3J0YW50L2kudGVzdCh0ZW1wKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydGFudCArPSBjICsgdGVtcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dCA9IFRva2Vucy5JTVBPUlRBTlRfU1lNOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vd2UncmUgZG9uZQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSByZWFkZXIucmVhZCgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHR0ID09IFRva2Vucy5DSEFSKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZXNldCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGFyVG9rZW4oZmlyc3QsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVRva2VuKHR0LCBpbXBvcnRhbnQsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBQcm9kdWNlcyBhIE5PVCBvciBDSEFSIHRva2VuIGJhc2VkIG9uIHRoZSBzcGVjaWZpZWQgaW5mb3JtYXRpb24uIFRoZQogICAgICAgICAgICAgICAgICogZmlyc3QgY2hhcmFjdGVyIGlzIHByb3ZpZGVkIGFuZCB0aGUgcmVzdCBpcyByZWFkIGJ5IHRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUKICAgICAgICAgICAgICAgICAqIHRoZSBjb3JyZWN0IHRva2VuIHRvIGNyZWF0ZS4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBmaXJzdCBUaGUgZmlyc3QgY2hhcmFjdGVyIGluIHRoZSB0b2tlbi4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBzdGFydExpbmUgVGhlIGJlZ2lubmluZyBsaW5lIGZvciB0aGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IHN0YXJ0Q29sIFRoZSBiZWdpbm5pbmcgY29sdW1uIGZvciB0aGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBBIHRva2VuIG9iamVjdC4KICAgICAgICAgICAgICAgICAqIEBtZXRob2Qgbm90VG9rZW4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgbm90VG9rZW46IGZ1bmN0aW9uIChmaXJzdCwgc3RhcnRMaW5lLCBzdGFydENvbCkgewogICAgICAgICAgICAgICAgICAgIHZhciByZWFkZXIgPSB0aGlzLl9yZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBmaXJzdDsKCiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLm1hcmsoKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IHJlYWRlci5yZWFkQ291bnQoNCk7CgogICAgICAgICAgICAgICAgICAgIGlmICh0ZXh0LnRvTG93ZXJDYXNlKCkgPT0gIjpub3QoIikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVUb2tlbihUb2tlbnMuTk9ULCB0ZXh0LCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVzZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hhclRva2VuKGZpcnN0LCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogUHJvZHVjZXMgYSBudW1iZXIgdG9rZW4gYmFzZWQgb24gdGhlIGdpdmVuIGNoYXJhY3RlcgogICAgICAgICAgICAgICAgICogYW5kIGxvY2F0aW9uIGluIHRoZSBzdHJlYW0uIFRoaXMgbWF5IHJldHVybiBhIHRva2VuIG9mCiAgICAgICAgICAgICAgICAgKiBOVU1CRVIsIEVNUywgRVhTLCBMRU5HVEgsIEFOR0xFLCBUSU1FLCBGUkVRLCBESU1FTlNJT04sCiAgICAgICAgICAgICAgICAgKiBvciBQRVJDRU5UQUdFLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGZpcnN0IFRoZSBmaXJzdCBjaGFyYWN0ZXIgZm9yIHRoZSB0b2tlbi4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBzdGFydExpbmUgVGhlIGJlZ2lubmluZyBsaW5lIGZvciB0aGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IHN0YXJ0Q29sIFRoZSBiZWdpbm5pbmcgY29sdW1uIGZvciB0aGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBBIHRva2VuIG9iamVjdC4KICAgICAgICAgICAgICAgICAqIEBtZXRob2QgbnVtYmVyVG9rZW4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgbnVtYmVyVG9rZW46IGZ1bmN0aW9uIChmaXJzdCwgc3RhcnRMaW5lLCBzdGFydENvbCkgewogICAgICAgICAgICAgICAgICAgIHZhciByZWFkZXIgPSB0aGlzLl9yZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5yZWFkTnVtYmVyKGZpcnN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHR0ID0gVG9rZW5zLk5VTUJFUiwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHJlYWRlci5wZWVrKCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChpc0lkZW50U3RhcnQoYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWRlbnQgPSB0aGlzLnJlYWROYW1lKHJlYWRlci5yZWFkKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSBpZGVudDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgvXmVtJHxeZXgkfF5weCR8XmdkJHxecmVtJHxednckfF52aCR8XnZtJHxeY2gkfF5jbSR8Xm1tJHxeaW4kfF5wdCR8XnBjJC9pLnRlc3QoaWRlbnQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dCA9IFRva2Vucy5MRU5HVEg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoL15kZWd8XnJhZCR8XmdyYWQkL2kudGVzdChpZGVudCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0ID0gVG9rZW5zLkFOR0xFOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9ebXMkfF5zJC9pLnRlc3QoaWRlbnQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dCA9IFRva2Vucy5USU1FOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKC9eaHokfF5raHokL2kudGVzdChpZGVudCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0ID0gVG9rZW5zLkZSRVE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoL15kcGkkfF5kcGNtJC9pLnRlc3QoaWRlbnQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dCA9IFRva2Vucy5SRVNPTFVUSU9OOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQgPSBUb2tlbnMuRElNRU5TSU9OOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjID09ICIlIikgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSByZWFkZXIucmVhZCgpOwogICAgICAgICAgICAgICAgICAgICAgICB0dCA9IFRva2Vucy5QRVJDRU5UQUdFOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVG9rZW4odHQsIHZhbHVlLCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBQcm9kdWNlcyBhIHN0cmluZyB0b2tlbiBiYXNlZCBvbiB0aGUgZ2l2ZW4gY2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgKiBhbmQgbG9jYXRpb24gaW4gdGhlIHN0cmVhbS4gU2luY2Ugc3RyaW5ncyBtYXkgYmUgaW5kaWNhdGVkCiAgICAgICAgICAgICAgICAgKiBieSBzaW5nbGUgb3IgZG91YmxlIHF1b3RlcywgYSBmYWlsdXJlIHRvIG1hdGNoIHN0YXJ0aW5nCiAgICAgICAgICAgICAgICAgKiBhbmQgZW5kaW5nIHF1b3RlcyByZXN1bHRzIGluIGFuIElOVkFMSUQgdG9rZW4gYmVpbmcgZ2VuZXJhdGVkLgogICAgICAgICAgICAgICAgICogVGhlIGZpcnN0IGNoYXJhY3RlciBpbiB0aGUgc3RyaW5nIGlzIHBhc3NlZCBpbiBhbmQgdGhlbgogICAgICAgICAgICAgICAgICogdGhlIHJlc3QgYXJlIHJlYWQgdXAgdG8gYW5kIGluY2x1ZGluZyB0aGUgZmluYWwgcXVvdGF0aW9uIG1hcmsuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gZmlyc3QgVGhlIGZpcnN0IGNoYXJhY3RlciBpbiB0aGUgc3RyaW5nLgogICAgICAgICAgICAgICAgICogQHBhcmFtIHtpbnR9IHN0YXJ0TGluZSBUaGUgYmVnaW5uaW5nIGxpbmUgZm9yIHRoZSBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gc3RhcnRDb2wgVGhlIGJlZ2lubmluZyBjb2x1bW4gZm9yIHRoZSBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IEEgdG9rZW4gb2JqZWN0LgogICAgICAgICAgICAgICAgICogQG1ldGhvZCBzdHJpbmdUb2tlbgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBzdHJpbmdUb2tlbjogZnVuY3Rpb24gKGZpcnN0LCBzdGFydExpbmUsIHN0YXJ0Q29sKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGRlbGltID0gZmlyc3QsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyA9IGZpcnN0LAogICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIgPSB0aGlzLl9yZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHByZXYgPSBmaXJzdCwKICAgICAgICAgICAgICAgICAgICAgICAgdHQgPSBUb2tlbnMuU1RSSU5HLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gcmVhZGVyLnJlYWQoKTsKCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nICs9IGM7CgogICAgICAgICAgICAgICAgICAgICAgICAvL2lmIHRoZSBkZWxpbWl0ZXIgaXMgZm91bmQgd2l0aCBhbiBlc2NhcGVtZW50LCB3ZSdyZSBkb25lLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyA9PSBkZWxpbSAmJiBwcmV2ICE9ICJcXCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvL2lmIHRoZXJlJ3MgYSBuZXdsaW5lIHdpdGhvdXQgYW4gZXNjYXBlbWVudCwgaXQncyBhbiBpbnZhbGlkIHN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOZXdMaW5lKHJlYWRlci5wZWVrKCkpICYmIGMgIT0gIlxcIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQgPSBUb2tlbnMuSU5WQUxJRDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvL3NhdmUgcHJldmlvdXMgYW5kIGdldCBuZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXYgPSBjOwogICAgICAgICAgICAgICAgICAgICAgICBjID0gcmVhZGVyLnJlYWQoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vaWYgYyBpcyBudWxsLCB0aGF0IG1lYW5zIHdlJ3JlIG91dCBvZiBpbnB1dCBhbmQgdGhlIHN0cmluZyB3YXMgbmV2ZXIgY2xvc2VkCiAgICAgICAgICAgICAgICAgICAgaWYgKGMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICB0dCA9IFRva2Vucy5JTlZBTElEOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVG9rZW4odHQsIHN0cmluZywgc3RhcnRMaW5lLCBzdGFydENvbCk7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIHVuaWNvZGVSYW5nZVRva2VuOiBmdW5jdGlvbiAoZmlyc3QsIHN0YXJ0TGluZSwgc3RhcnRDb2wpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fcmVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGZpcnN0LAogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wLAogICAgICAgICAgICAgICAgICAgICAgICB0dCA9IFRva2Vucy5DSEFSOwoKICAgICAgICAgICAgICAgICAgICAvL3RoZW4gaXQgc2hvdWxkIGJlIGEgdW5pY29kZSByYW5nZQogICAgICAgICAgICAgICAgICAgIGlmIChyZWFkZXIucGVlaygpID09ICIrIikgewogICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIubWFyaygpOwogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSByZWFkZXIucmVhZCgpOwogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSB0aGlzLnJlYWRVbmljb2RlUmFuZ2VQYXJ0KHRydWUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9lbnN1cmUgdGhlcmUncyBhbiBhY3R1YWwgdW5pY29kZSByYW5nZSBoZXJlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnJlc2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQgPSBUb2tlbnMuVU5JQ09ERV9SQU5HRTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIHRoZXJlJ3MgYSA/IGluIHRoZSBmaXJzdCBwYXJ0LCB0aGVyZSBjYW4ndCBiZSBhIHNlY29uZCBwYXJ0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuaW5kZXhPZigiPyIpID09IC0xKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFkZXIucGVlaygpID09ICItIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIubWFyaygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wID0gcmVhZGVyLnJlYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCArPSB0aGlzLnJlYWRVbmljb2RlUmFuZ2VQYXJ0KGZhbHNlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUncyBub3QgYW5vdGhlciB2YWx1ZSwgYmFjayB1cCBhbmQganVzdCB0YWtlIHRoZSBmaXJzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcC5sZW5ndGggPT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnJlc2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSB0ZW1wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVUb2tlbih0dCwgdmFsdWUsIHN0YXJ0TGluZSwgc3RhcnRDb2wpOwogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFByb2R1Y2VzIGEgUyB0b2tlbiBiYXNlZCBvbiB0aGUgc3BlY2lmaWVkIGluZm9ybWF0aW9uLiBTaW5jZSB3aGl0ZXNwYWNlCiAgICAgICAgICAgICAgICAgKiBtYXkgaGF2ZSBtdWx0aXBsZSBjaGFyYWN0ZXJzLCB0aGlzIGNvbnN1bWVzIGFsbCB3aGl0ZXNwYWNlIGNoYXJhY3RlcnMKICAgICAgICAgICAgICAgICAqIGludG8gYSBzaW5nbGUgdG9rZW4uCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gZmlyc3QgVGhlIGZpcnN0IGNoYXJhY3RlciBpbiB0aGUgdG9rZW4uCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gc3RhcnRMaW5lIFRoZSBiZWdpbm5pbmcgbGluZSBmb3IgdGhlIGNoYXJhY3Rlci4KICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBzdGFydENvbCBUaGUgYmVnaW5uaW5nIGNvbHVtbiBmb3IgdGhlIGNoYXJhY3Rlci4KICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gQSB0b2tlbiBvYmplY3QuCiAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIHdoaXRlc3BhY2VUb2tlbgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB3aGl0ZXNwYWNlVG9rZW46IGZ1bmN0aW9uIChmaXJzdCwgc3RhcnRMaW5lLCBzdGFydENvbCkgewogICAgICAgICAgICAgICAgICAgIHZhciByZWFkZXIgPSB0aGlzLl9yZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZmlyc3QgKyB0aGlzLnJlYWRXaGl0ZXNwYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVG9rZW4oVG9rZW5zLlMsIHZhbHVlLCBzdGFydExpbmUsIHN0YXJ0Q29sKTsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgICAgICAvLyBNZXRob2RzIHRvIHJlYWQgdmFsdWVzIGZyb20gdGhlIHN0cmluZyBzdHJlYW0KICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgICAgICAgICAgICAgIHJlYWRVbmljb2RlUmFuZ2VQYXJ0OiBmdW5jdGlvbiAoYWxsb3dRdWVzdGlvbk1hcmspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fcmVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJ0ID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSByZWFkZXIucGVlaygpOwoKICAgICAgICAgICAgICAgICAgICAvL2ZpcnN0IHJlYWQgaGV4IGRpZ2l0cwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChpc0hleERpZ2l0KGMpICYmIHBhcnQubGVuZ3RoIDwgNikgewogICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVhZCgpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJ0ICs9IGM7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSByZWFkZXIucGVlaygpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy90aGVuIHJlYWQgcXVlc3Rpb24gbWFya3MgaWYgYWxsb3dlZAogICAgICAgICAgICAgICAgICAgIGlmIChhbGxvd1F1ZXN0aW9uTWFyaykgewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYyA9PSAiPyIgJiYgcGFydC5sZW5ndGggPCA2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVhZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydCArPSBjOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHJlYWRlci5wZWVrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vdGhlcmUgY2FuJ3QgYmUgYW55IG90aGVyIGNoYXJhY3RlcnMgYWZ0ZXIgdGhpcyBwb2ludAoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFydDsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgcmVhZFdoaXRlc3BhY2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fcmVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgICB3aGl0ZXNwYWNlID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSByZWFkZXIucGVlaygpOwoKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaXNXaGl0ZXNwYWNlKGMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaXRlc3BhY2UgKz0gYzsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHJlYWRlci5wZWVrKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2hpdGVzcGFjZTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZWFkTnVtYmVyOiBmdW5jdGlvbiAoZmlyc3QpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fcmVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgICBudW1iZXIgPSBmaXJzdCwKICAgICAgICAgICAgICAgICAgICAgICAgaGFzRG90ID0gZmlyc3QgPT0gIi4iLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gcmVhZGVyLnBlZWsoKTsKCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRGlnaXQoYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlciArPSByZWFkZXIucmVhZCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGMgPT0gIi4iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzRG90KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc0RvdCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyICs9IHJlYWRlci5yZWFkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHJlYWRlci5wZWVrKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVtYmVyOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlYWRTdHJpbmc6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fcmVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxpbSA9IHJlYWRlci5yZWFkKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyA9IGRlbGltLAogICAgICAgICAgICAgICAgICAgICAgICBwcmV2ID0gZGVsaW0sCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSByZWFkZXIucGVlaygpOwoKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYykgewogICAgICAgICAgICAgICAgICAgICAgICBjID0gcmVhZGVyLnJlYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nICs9IGM7CgogICAgICAgICAgICAgICAgICAgICAgICAvL2lmIHRoZSBkZWxpbWl0ZXIgaXMgZm91bmQgd2l0aCBhbiBlc2NhcGVtZW50LCB3ZSdyZSBkb25lLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyA9PSBkZWxpbSAmJiBwcmV2ICE9ICJcXCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvL2lmIHRoZXJlJ3MgYSBuZXdsaW5lIHdpdGhvdXQgYW4gZXNjYXBlbWVudCwgaXQncyBhbiBpbnZhbGlkIHN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOZXdMaW5lKHJlYWRlci5wZWVrKCkpICYmIGMgIT0gIlxcIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy9zYXZlIHByZXZpb3VzIGFuZCBnZXQgbmV4dAogICAgICAgICAgICAgICAgICAgICAgICBwcmV2ID0gYzsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHJlYWRlci5wZWVrKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvL2lmIGMgaXMgbnVsbCwgdGhhdCBtZWFucyB3ZSdyZSBvdXQgb2YgaW5wdXQgYW5kIHRoZSBzdHJpbmcgd2FzIG5ldmVyIGNsb3NlZAogICAgICAgICAgICAgICAgICAgIGlmIChjID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nID0gIiI7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlYWRVUkk6IGZ1bmN0aW9uIChmaXJzdCkgewogICAgICAgICAgICAgICAgICAgIHZhciByZWFkZXIgPSB0aGlzLl9yZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHVyaSA9IGZpcnN0LAogICAgICAgICAgICAgICAgICAgICAgICBpbm5lciA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gcmVhZGVyLnBlZWsoKTsKCiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLm1hcmsoKTsKCiAgICAgICAgICAgICAgICAgICAgLy9za2lwIHdoaXRlc3BhY2UgYmVmb3JlCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGMgJiYgaXNXaGl0ZXNwYWNlKGMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSByZWFkZXIucGVlaygpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy9pdCdzIGEgc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKGMgPT0gIiciIHx8IGMgPT0gIlwiIikgewogICAgICAgICAgICAgICAgICAgICAgICBpbm5lciA9IHRoaXMucmVhZFN0cmluZygpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlubmVyID0gdGhpcy5yZWFkVVJMKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjID0gcmVhZGVyLnBlZWsoKTsKCiAgICAgICAgICAgICAgICAgICAgLy9za2lwIHdoaXRlc3BhY2UgYWZ0ZXIKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYyAmJiBpc1doaXRlc3BhY2UoYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnJlYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHJlYWRlci5wZWVrKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvL2lmIHRoZXJlIHdhcyBubyBpbm5lciB2YWx1ZSBvciB0aGUgbmV4dCBjaGFyYWN0ZXIgaXNuJ3QgY2xvc2luZyBwYXJlbiwgaXQncyBub3QgYSBVUkkKICAgICAgICAgICAgICAgICAgICBpZiAoaW5uZXIgPT0gIiIgfHwgYyAhPSAiKSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJpID0gZmlyc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRlci5yZXNldCgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVyaSArPSBpbm5lciArIHJlYWRlci5yZWFkKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXJpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlYWRVUkw6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVhZGVyID0gdGhpcy5fcmVhZGVyLAogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHJlYWRlci5wZWVrKCk7CgogICAgICAgICAgICAgICAgICAgIC8vVE9ETzogQ2hlY2sgZm9yIGVzY2FwZSBhbmQgbm9uYXNjaWkKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoL15bISMkJSZcXCotfl0kLy50ZXN0KGMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybCArPSByZWFkZXIucmVhZCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjID0gcmVhZGVyLnBlZWsoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB1cmw7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVhZE5hbWU6IGZ1bmN0aW9uIChmaXJzdCkgewogICAgICAgICAgICAgICAgICAgIHZhciByZWFkZXIgPSB0aGlzLl9yZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50ID0gZmlyc3QgfHwgIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSByZWFkZXIucGVlaygpOwoKICAgICAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyA9PSAiXFwiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVudCArPSB0aGlzLnJlYWRFc2NhcGUocmVhZGVyLnJlYWQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gcmVhZGVyLnBlZWsoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjICYmIGlzTmFtZUNoYXIoYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50ICs9IHJlYWRlci5yZWFkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gcmVhZGVyLnBlZWsoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRlbnQ7CiAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgIHJlYWRFc2NhcGU6IGZ1bmN0aW9uIChmaXJzdCkgewogICAgICAgICAgICAgICAgICAgIHZhciByZWFkZXIgPSB0aGlzLl9yZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNzc0VzY2FwZSA9IGZpcnN0IHx8ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBpID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHJlYWRlci5wZWVrKCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChpc0hleERpZ2l0KGMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzc0VzY2FwZSArPSByZWFkZXIucmVhZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHJlYWRlci5wZWVrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKGMgJiYgaXNIZXhEaWdpdChjKSAmJiArK2kgPCA2KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChjc3NFc2NhcGUubGVuZ3RoID09IDMgJiYgL1xzLy50ZXN0KGMpIHx8IGNzc0VzY2FwZS5sZW5ndGggPT0gNyB8fCBjc3NFc2NhcGUubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnJlYWQoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjID0gIiI7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3NzRXNjYXBlICsgYzsKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgcmVhZENvbW1lbnQ6IGZ1bmN0aW9uIChmaXJzdCkgewogICAgICAgICAgICAgICAgICAgIHZhciByZWFkZXIgPSB0aGlzLl9yZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBmaXJzdCB8fCAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHJlYWRlci5yZWFkKCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChjID09ICIqIikgewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudCArPSBjOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbG9vayBmb3IgZW5kIG9mIGNvbW1lbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb21tZW50Lmxlbmd0aCA+IDIgJiYgYyA9PSAiKiIgJiYgcmVhZGVyLnBlZWsoKSA9PSAiLyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50ICs9IHJlYWRlci5yZWFkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHJlYWRlci5yZWFkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21tZW50OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFyIFRva2VucyA9IFsKCiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAqIFRoZSBmb2xsb3dpbmcgdG9rZW4gbmFtZXMgYXJlIGRlZmluZWQgaW4gQ1NTMyBHcmFtbWFyOiBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXN5bnRheC8jbGV4aWNhbAogICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIC8vSFRNTC1zdHlsZSBjb21tZW50cwogICAgICAgICAgICB7IG5hbWU6ICJDRE8iIH0sIHsgbmFtZTogIkNEQyIgfSwKCiAgICAgICAgICAgIC8vaWdub3JhYmxlcwogICAgICAgICAgICB7IG5hbWU6ICJTIiwgd2hpdGVzcGFjZTogdHJ1ZSAvKiwgY2hhbm5lbDogIndzIiovIH0sIHsgbmFtZTogIkNPTU1FTlQiLCBjb21tZW50OiB0cnVlLCBoaWRlOiB0cnVlLCBjaGFubmVsOiAiY29tbWVudCIgfSwKCiAgICAgICAgICAgIC8vYXR0cmlidXRlIGVxdWFsaXR5CiAgICAgICAgICAgIHsgbmFtZTogIklOQ0xVREVTIiwgdGV4dDogIn49IiB9LCB7IG5hbWU6ICJEQVNITUFUQ0giLCB0ZXh0OiAifD0iIH0sIHsgbmFtZTogIlBSRUZJWE1BVENIIiwgdGV4dDogIl49IiB9LCB7IG5hbWU6ICJTVUZGSVhNQVRDSCIsIHRleHQ6ICIkPSIgfSwgeyBuYW1lOiAiU1VCU1RSSU5HTUFUQ0giLCB0ZXh0OiAiKj0iIH0sCgogICAgICAgICAgICAvL2lkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgeyBuYW1lOiAiU1RSSU5HIiB9LCB7IG5hbWU6ICJJREVOVCIgfSwgeyBuYW1lOiAiSEFTSCIgfSwKCiAgICAgICAgICAgIC8vYXQta2V5d29yZHMKICAgICAgICAgICAgeyBuYW1lOiAiSU1QT1JUX1NZTSIsIHRleHQ6ICJAaW1wb3J0IiB9LCB7IG5hbWU6ICJQQUdFX1NZTSIsIHRleHQ6ICJAcGFnZSIgfSwgeyBuYW1lOiAiTUVESUFfU1lNIiwgdGV4dDogIkBtZWRpYSIgfSwgeyBuYW1lOiAiRk9OVF9GQUNFX1NZTSIsIHRleHQ6ICJAZm9udC1mYWNlIiB9LCB7IG5hbWU6ICJDSEFSU0VUX1NZTSIsIHRleHQ6ICJAY2hhcnNldCIgfSwgeyBuYW1lOiAiTkFNRVNQQUNFX1NZTSIsIHRleHQ6ICJAbmFtZXNwYWNlIiB9LAogICAgICAgICAgICAvL3sgbmFtZTogIkFUS0VZV09SRCJ9LAoKICAgICAgICAgICAgLy9DU1MzIGFuaW1hdGlvbnMKICAgICAgICAgICAgeyBuYW1lOiAiS0VZRlJBTUVTX1NZTSIsIHRleHQ6IFsiQGtleWZyYW1lcyIsICJALXdlYmtpdC1rZXlmcmFtZXMiLCAiQC1tb3ota2V5ZnJhbWVzIl0gfSwKCiAgICAgICAgICAgIC8vaW1wb3J0YW50IHN5bWJvbAogICAgICAgICAgICB7IG5hbWU6ICJJTVBPUlRBTlRfU1lNIiB9LAoKICAgICAgICAgICAgLy9tZWFzdXJlbWVudHMKICAgICAgICAgICAgeyBuYW1lOiAiTEVOR1RIIiB9LCB7IG5hbWU6ICJBTkdMRSIgfSwgeyBuYW1lOiAiVElNRSIgfSwgeyBuYW1lOiAiRlJFUSIgfSwgeyBuYW1lOiAiRElNRU5TSU9OIiB9LCB7IG5hbWU6ICJQRVJDRU5UQUdFIiB9LCB7IG5hbWU6ICJOVU1CRVIiIH0sCgogICAgICAgICAgICAvL2Z1bmN0aW9ucwogICAgICAgICAgICB7IG5hbWU6ICJVUkkiIH0sIHsgbmFtZTogIkZVTkNUSU9OIiB9LAoKICAgICAgICAgICAgLy9Vbmljb2RlIHJhbmdlcwogICAgICAgICAgICB7IG5hbWU6ICJVTklDT0RFX1JBTkdFIiB9LAoKICAgICAgICAgICAgLyoKICAgICAgICAgICAgICogVGhlIGZvbGxvd2luZyB0b2tlbiBuYW1lcyBhcmUgZGVmaW5lZCBpbiBDU1MzIFNlbGVjdG9yczogaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zZWxlY3RvcnMvI3NlbGVjdG9yLXN5bnRheAogICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIC8vaW52YWxpZCBzdHJpbmcKICAgICAgICAgICAgeyBuYW1lOiAiSU5WQUxJRCIgfSwKCiAgICAgICAgICAgIC8vY29tYmluYXRvcnMKICAgICAgICAgICAgeyBuYW1lOiAiUExVUyIsIHRleHQ6ICIrIiB9LCB7IG5hbWU6ICJHUkVBVEVSIiwgdGV4dDogIj4iIH0sIHsgbmFtZTogIkNPTU1BIiwgdGV4dDogIiwiIH0sIHsgbmFtZTogIlRJTERFIiwgdGV4dDogIn4iIH0sCgogICAgICAgICAgICAvL21vZGlmaWVyCiAgICAgICAgICAgIHsgbmFtZTogIk5PVCIgfSwKCiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAqIERlZmluZWQgaW4gQ1NTMyBQYWdlZCBNZWRpYQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgeyBuYW1lOiAiVE9QTEVGVENPUk5FUl9TWU0iLCB0ZXh0OiAiQHRvcC1sZWZ0LWNvcm5lciIgfSwgeyBuYW1lOiAiVE9QTEVGVF9TWU0iLCB0ZXh0OiAiQHRvcC1sZWZ0IiB9LCB7IG5hbWU6ICJUT1BDRU5URVJfU1lNIiwgdGV4dDogIkB0b3AtY2VudGVyIiB9LCB7IG5hbWU6ICJUT1BSSUdIVF9TWU0iLCB0ZXh0OiAiQHRvcC1yaWdodCIgfSwgeyBuYW1lOiAiVE9QUklHSFRDT1JORVJfU1lNIiwgdGV4dDogIkB0b3AtcmlnaHQtY29ybmVyIiB9LCB7IG5hbWU6ICJCT1RUT01MRUZUQ09STkVSX1NZTSIsIHRleHQ6ICJAYm90dG9tLWxlZnQtY29ybmVyIiB9LCB7IG5hbWU6ICJCT1RUT01MRUZUX1NZTSIsIHRleHQ6ICJAYm90dG9tLWxlZnQiIH0sIHsgbmFtZTogIkJPVFRPTUNFTlRFUl9TWU0iLCB0ZXh0OiAiQGJvdHRvbS1jZW50ZXIiIH0sIHsgbmFtZTogIkJPVFRPTVJJR0hUX1NZTSIsIHRleHQ6ICJAYm90dG9tLXJpZ2h0IiB9LCB7IG5hbWU6ICJCT1RUT01SSUdIVENPUk5FUl9TWU0iLCB0ZXh0OiAiQGJvdHRvbS1yaWdodC1jb3JuZXIiIH0sIHsgbmFtZTogIkxFRlRUT1BfU1lNIiwgdGV4dDogIkBsZWZ0LXRvcCIgfSwgeyBuYW1lOiAiTEVGVE1JRERMRV9TWU0iLCB0ZXh0OiAiQGxlZnQtbWlkZGxlIiB9LCB7IG5hbWU6ICJMRUZUQk9UVE9NX1NZTSIsIHRleHQ6ICJAbGVmdC1ib3R0b20iIH0sIHsgbmFtZTogIlJJR0hUVE9QX1NZTSIsIHRleHQ6ICJAcmlnaHQtdG9wIiB9LCB7IG5hbWU6ICJSSUdIVE1JRERMRV9TWU0iLCB0ZXh0OiAiQHJpZ2h0LW1pZGRsZSIgfSwgeyBuYW1lOiAiUklHSFRCT1RUT01fU1lNIiwgdGV4dDogIkByaWdodC1ib3R0b20iIH0sCgogICAgICAgICAgICAvKgogICAgICAgICAgICAgKiBUaGUgZm9sbG93aW5nIHRva2VuIG5hbWVzIGFyZSBkZWZpbmVkIGluIENTUzMgTWVkaWEgUXVlcmllczogaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1tZWRpYXF1ZXJpZXMvI3N5bnRheAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgLyp7IG5hbWU6ICJNRURJQV9PTkxZIiwgc3RhdGU6ICJtZWRpYSJ9LAogICAgICAgICAgICB7IG5hbWU6ICJNRURJQV9OT1QiLCBzdGF0ZTogIm1lZGlhIn0sCiAgICAgICAgICAgIHsgbmFtZTogIk1FRElBX0FORCIsIHN0YXRlOiAibWVkaWEifSwqLwogICAgICAgICAgICB7IG5hbWU6ICJSRVNPTFVUSU9OIiwgc3RhdGU6ICJtZWRpYSIgfSwKCiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAqIFRoZSBmb2xsb3dpbmcgdG9rZW4gbmFtZXMgYXJlIG5vdCBkZWZpbmVkIGluIGFueSBDU1Mgc3BlY2lmaWNhdGlvbiBidXQgYXJlIHVzZWQgYnkgdGhlIGxleGVyLgogICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIC8vbm90IGEgcmVhbCB0b2tlbiwgYnV0IHVzZWZ1bCBmb3Igc3R1cGlkIElFIGZpbHRlcnMKICAgICAgICAgICAgeyBuYW1lOiAiSUVfRlVOQ1RJT04iIH0sCgogICAgICAgICAgICAvL3BhcnQgb2YgQ1NTMyBncmFtbWFyIGJ1dCBub3QgdGhlIEZsZXggY29kZQogICAgICAgICAgICB7IG5hbWU6ICJDSEFSIiB9LAoKICAgICAgICAgICAgLy9UT0RPOiBOZWVkZWQ/CiAgICAgICAgICAgIC8vTm90IGRlZmluZWQgYXMgdG9rZW5zLCBidXQgbWlnaHQgYXMgd2VsbCBiZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuYW1lOiAiUElQRSIsCiAgICAgICAgICAgICAgICB0ZXh0OiAifCIKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogIlNMQVNIIiwKICAgICAgICAgICAgICAgIHRleHQ6ICIvIgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiTUlOVVMiLAogICAgICAgICAgICAgICAgdGV4dDogIi0iCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTVEFSIiwKICAgICAgICAgICAgICAgIHRleHQ6ICIqIgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiTEJSQUNFIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJ7IgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiUkJSQUNFIiwKICAgICAgICAgICAgICAgIHRleHQ6ICJ9IgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiTEJSQUNLRVQiLAogICAgICAgICAgICAgICAgdGV4dDogIlsiCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJSQlJBQ0tFVCIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiXSIKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogIkVRVUFMUyIsCiAgICAgICAgICAgICAgICB0ZXh0OiAiPSIKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogIkNPTE9OIiwKICAgICAgICAgICAgICAgIHRleHQ6ICI6IgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU0VNSUNPTE9OIiwKICAgICAgICAgICAgICAgIHRleHQ6ICI7IgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiTFBBUkVOIiwKICAgICAgICAgICAgICAgIHRleHQ6ICIoIgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiUlBBUkVOIiwKICAgICAgICAgICAgICAgIHRleHQ6ICIpIgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiRE9UIiwKICAgICAgICAgICAgICAgIHRleHQ6ICIuIgogICAgICAgICAgICB9XTsKCiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICAgICAgdmFyIG5hbWVNYXAgPSBbXSwKICAgICAgICAgICAgICAgICAgICB0eXBlTWFwID0ge307CgogICAgICAgICAgICAgICAgVG9rZW5zLlVOS05PV04gPSAtMTsKICAgICAgICAgICAgICAgIFRva2Vucy51bnNoaWZ0KHsgbmFtZTogIkVPRiIgfSk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gVG9rZW5zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgbmFtZU1hcC5wdXNoKFRva2Vuc1tpXS5uYW1lKTsKICAgICAgICAgICAgICAgICAgICBUb2tlbnNbVG9rZW5zW2ldLm5hbWVdID0gaTsKICAgICAgICAgICAgICAgICAgICBpZiAoVG9rZW5zW2ldLnRleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRva2Vuc1tpXS50ZXh0IGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgVG9rZW5zW2ldLnRleHQubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlTWFwW1Rva2Vuc1tpXS50ZXh0W2pdXSA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlTWFwW1Rva2Vuc1tpXS50ZXh0XSA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgVG9rZW5zLm5hbWUgPSBmdW5jdGlvbiAodHQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmFtZU1hcFt0dF07CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIFRva2Vucy50eXBlID0gZnVuY3Rpb24gKGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHlwZU1hcFtjXSB8fCAtMTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pKCk7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogVHlwZSB0byB1c2Ugd2hlbiBhIHZhbGlkYXRpb24gZXJyb3Igb2NjdXJzLgogICAgICAgICAgICAgKiBAY2xhc3MgVmFsaWRhdGlvbkVycm9yCiAgICAgICAgICAgICAqIEBuYW1lc3BhY2UgcGFyc2VybGliLnV0aWwKICAgICAgICAgICAgICogQGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXNzYWdlIFRoZSBlcnJvciBtZXNzYWdlLgogICAgICAgICAgICAgKiBAcGFyYW0ge2ludH0gbGluZSBUaGUgbGluZSBhdCB3aGljaCB0aGUgZXJyb3Igb2NjdXJyZWQuCiAgICAgICAgICAgICAqIEBwYXJhbSB7aW50fSBjb2wgVGhlIGNvbHVtbiBhdCB3aGljaCB0aGUgZXJyb3Igb2NjdXJyZWQuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBmdW5jdGlvbiBWYWxpZGF0aW9uRXJyb3IobWVzc2FnZSwgbGluZSwgY29sKSB7CgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBUaGUgY29sdW1uIGF0IHdoaWNoIHRoZSBlcnJvciBvY2N1cnJlZC4KICAgICAgICAgICAgICAgICAqIEB0eXBlIGludAogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IGNvbAogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB0aGlzLmNvbCA9IGNvbDsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSBsaW5lIGF0IHdoaWNoIHRoZSBlcnJvciBvY2N1cnJlZC4KICAgICAgICAgICAgICAgICAqIEB0eXBlIGludAogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IGxpbmUKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdGhpcy5saW5lID0gbGluZTsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFRoZSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSB1bml0LgogICAgICAgICAgICAgICAgICogQHR5cGUgU3RyaW5nCiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkgdGV4dAogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL2luaGVyaXQgZnJvbSBFcnJvcgogICAgICAgICAgICBWYWxpZGF0aW9uRXJyb3IucHJvdG90eXBlID0gbmV3IEVycm9yKCk7CgogICAgICAgICAgICBwYXJzZXJsaWIuY3NzID0gewogICAgICAgICAgICAgICAgQ29sb3JzOiBDb2xvcnMsCiAgICAgICAgICAgICAgICBDb21iaW5hdG9yOiBDb21iaW5hdG9yLAogICAgICAgICAgICAgICAgUGFyc2VyOiBQYXJzZXIsCiAgICAgICAgICAgICAgICBQcm9wZXJ0eU5hbWU6IFByb3BlcnR5TmFtZSwKICAgICAgICAgICAgICAgIFByb3BlcnR5VmFsdWU6IFByb3BlcnR5VmFsdWUsCiAgICAgICAgICAgICAgICBQcm9wZXJ0eVZhbHVlUGFydDogUHJvcGVydHlWYWx1ZVBhcnQsCiAgICAgICAgICAgICAgICBNZWRpYUZlYXR1cmU6IE1lZGlhRmVhdHVyZSwKICAgICAgICAgICAgICAgIE1lZGlhUXVlcnk6IE1lZGlhUXVlcnksCiAgICAgICAgICAgICAgICBTZWxlY3RvcjogU2VsZWN0b3IsCiAgICAgICAgICAgICAgICBTZWxlY3RvclBhcnQ6IFNlbGVjdG9yUGFydCwKICAgICAgICAgICAgICAgIFNlbGVjdG9yU3ViUGFydDogU2VsZWN0b3JTdWJQYXJ0LAogICAgICAgICAgICAgICAgU3BlY2lmaWNpdHk6IFNwZWNpZmljaXR5LAogICAgICAgICAgICAgICAgVG9rZW5TdHJlYW06IFRva2VuU3RyZWFtLAogICAgICAgICAgICAgICAgVG9rZW5zOiBUb2tlbnMsCiAgICAgICAgICAgICAgICBWYWxpZGF0aW9uRXJyb3I6IFZhbGlkYXRpb25FcnJvcgogICAgICAgICAgICB9OwogICAgICAgIH0pKCk7CgogICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgKiAgc3JjL2ltcGwvVVJMLmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9VUkwuanMiCiAgICAgICAgZnVuY3Rpb24gVVJMKHVybCkgewogICAgICAgICAgICBpZiAoIXVybCkgcmV0dXJuIE9iamVjdC5jcmVhdGUoVVJMLnByb3RvdHlwZSk7CiAgICAgICAgICAgIC8vIENhbid0IHVzZSBTdHJpbmcudHJpbSgpIHNpbmNlIGl0IGRlZmluZXMgd2hpdGVzcGFjZSBkaWZmZXJlbnRseSB0aGFuIEhUTUwKICAgICAgICAgICAgdGhpcy51cmwgPSB1cmwucmVwbGFjZSgvXlsgXHRcblxyXGZdK3xbIFx0XG5cclxmXSskL2csICIiKTsKCiAgICAgICAgICAgIC8vIFNlZSBodHRwOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMzOTg2I2FwcGVuZGl4LUIKICAgICAgICAgICAgdmFyIG1hdGNoID0gVVJMLnBhdHRlcm4uZXhlYyh0aGlzLnVybCk7CiAgICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICAgICAgaWYgKG1hdGNoWzJdKSB0aGlzLnNjaGVtZSA9IG1hdGNoWzJdOwogICAgICAgICAgICAgICAgaWYgKG1hdGNoWzRdKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gWFhYIGlnbm9yaW5nIHVzZXJpbmZvIGJlZm9yZSB0aGUgaG9zdG5hbWUKICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hbNF0ubWF0Y2goVVJMLnBvcnRQYXR0ZXJuKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gUy5sYXN0SW5kZXhPZihtYXRjaFs0XSwgIjoiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ob3N0ID0gc3Vic3RyaW5nKG1hdGNoWzRdLCAwLCBwb3MpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcnQgPSBzdWJzdHJpbmcobWF0Y2hbNF0sIHBvcyArIDEpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaG9zdCA9IG1hdGNoWzRdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChtYXRjaFs1XSkgdGhpcy5wYXRoID0gbWF0Y2hbNV07CiAgICAgICAgICAgICAgICBpZiAobWF0Y2hbNl0pIHRoaXMucXVlcnkgPSBtYXRjaFs3XTsKICAgICAgICAgICAgICAgIGlmIChtYXRjaFs4XSkgdGhpcy5mcmFnbWVudCA9IG1hdGNoWzldOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBVUkwucGF0dGVybiA9IC9eKChbXjpcLz8jXSspOik/KFwvXC8oW15cLz8jXSopKT8oW14/I10qKShcPyhbXiNdKikpPygjKC4qKSk/JC87CiAgICAgICAgVVJMLnBvcnRQYXR0ZXJuID0gLzpcZCskLzsKICAgICAgICBVUkwuYXV0aG9yaXR5UGF0dGVybiA9IC9eW146XC8/I10rOlwvXC8vOwogICAgICAgIFVSTC5oaWVyYXJjaHlQYXR0ZXJuID0gL15bXjpcLz8jXSs6XC8vOwoKICAgICAgICAvLyBSZXR1cm4gYSBwZXJjZW50RW5jb2RlZCB2ZXJzaW9uIG9mIHMuCiAgICAgICAgLy8gUyBzaG91bGQgYmUgYSBzaW5nbGUtY2hhcmFjdGVyIHN0cmluZwogICAgICAgIC8vIFhYWDogbmVlZHMgdG8gZG8gdXRmLTggZW5jb2Rpbmc/CiAgICAgICAgVVJMLnBlcmNlbnRFbmNvZGUgPSBmdW5jdGlvbiBwZXJjZW50RW5jb2RlKHMpIHsKICAgICAgICAgICAgdmFyIGMgPSBjaGFyQ29kZUF0KHMsIDApOwogICAgICAgICAgICBpZiAoYyA8IDI1NikgcmV0dXJuICIlIiArIGMudG9TdHJpbmcoMTYpO2Vsc2UgdGhyb3cgRXJyb3IoImNhbid0IHBlcmNlbnQtZW5jb2RlIGNvZGVwb2ludHMgPiAyNTUgeWV0Iik7CiAgICAgICAgfTsKCiAgICAgICAgVVJMLnByb3RvdHlwZSA9IHsKICAgICAgICAgICAgY29uc3RydWN0b3I6IFVSTCwKCiAgICAgICAgICAgIC8vIFhYWDogbm90IHN1cmUgaWYgdGhpcyBpcyB0aGUgcHJlY2lzZSBkZWZpbml0aW9uIG9mIGFic29sdXRlCiAgICAgICAgICAgIGlzQWJzb2x1dGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhIXRoaXMuc2NoZW1lOwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc0F1dGhvcml0eUJhc2VkOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gVVJMLmF1dGhvcml0eVBhdHRlcm4udGVzdCh0aGlzLnVybCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzSGllcmFyY2hpY2FsOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gVVJMLmhpZXJhcmNoeVBhdHRlcm4udGVzdCh0aGlzLnVybCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHMgPSAiIjsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjaGVtZSAhPT0gdW5kZWZpbmVkKSBzICs9IHRoaXMuc2NoZW1lICsgIjoiOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuaG9zdCAhPT0gdW5kZWZpbmVkKSBzICs9ICIvLyIgKyB0aGlzLmhvc3Q7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5wb3J0ICE9PSB1bmRlZmluZWQpIHMgKz0gIjoiICsgdGhpcy5wb3J0OwogICAgICAgICAgICAgICAgaWYgKHRoaXMucGF0aCAhPT0gdW5kZWZpbmVkKSBzICs9IHRoaXMucGF0aDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnF1ZXJ5ICE9PSB1bmRlZmluZWQpIHMgKz0gIj8iICsgdGhpcy5xdWVyeTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmZyYWdtZW50ICE9PSB1bmRlZmluZWQpIHMgKz0gIiMiICsgdGhpcy5mcmFnbWVudDsKICAgICAgICAgICAgICAgIHJldHVybiBzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLy8gU2VlOiBodHRwOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMzOTg2I3NlY3Rpb24tNS4yCiAgICAgICAgICAgIHJlc29sdmU6IGZ1bmN0aW9uIChyZWxhdGl2ZSkgewogICAgICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOyAvLyBUaGUgYmFzZSB1cmwgd2UncmUgcmVzb2x2aW5nIGFnYWluc3QKICAgICAgICAgICAgICAgIHZhciByID0gbmV3IFVSTChyZWxhdGl2ZSk7IC8vIFRoZSByZWxhdGl2ZSByZWZlcmVuY2UgdXJsIHRvIHJlc29sdmUKICAgICAgICAgICAgICAgIHZhciB0ID0gbmV3IFVSTCgpOyAvLyBUaGUgYWJzb2x1dGUgdGFyZ2V0IHVybCB3ZSB3aWxsIHJldHVybgoKICAgICAgICAgICAgICAgIGlmIChyLnNjaGVtZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgdC5zY2hlbWUgPSByLnNjaGVtZTsKICAgICAgICAgICAgICAgICAgICB0Lmhvc3QgPSByLmhvc3Q7CiAgICAgICAgICAgICAgICAgICAgdC5wb3J0ID0gci5wb3J0OwogICAgICAgICAgICAgICAgICAgIHQucGF0aCA9IHJlbW92ZV9kb3Rfc2VnbWVudHMoci5wYXRoKTsKICAgICAgICAgICAgICAgICAgICB0LnF1ZXJ5ID0gci5xdWVyeTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdC5zY2hlbWUgPSBiYXNlLnNjaGVtZTsKICAgICAgICAgICAgICAgICAgICBpZiAoci5ob3N0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC5ob3N0ID0gci5ob3N0OwogICAgICAgICAgICAgICAgICAgICAgICB0LnBvcnQgPSByLnBvcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHQucGF0aCA9IHJlbW92ZV9kb3Rfc2VnbWVudHMoci5wYXRoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdC5xdWVyeSA9IHIucXVlcnk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC5ob3N0ID0gYmFzZS5ob3N0OwogICAgICAgICAgICAgICAgICAgICAgICB0LnBvcnQgPSBiYXNlLnBvcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghci5wYXRoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB1bmRlZmluZWQgb3IgZW1wdHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQucGF0aCA9IGJhc2UucGF0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyLnF1ZXJ5ICE9PSB1bmRlZmluZWQpIHQucXVlcnkgPSByLnF1ZXJ5O2Vsc2UgdC5xdWVyeSA9IGJhc2UucXVlcnk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoci5wYXRoLmNoYXJBdCgwKSA9PT0gIi8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5wYXRoID0gcmVtb3ZlX2RvdF9zZWdtZW50cyhyLnBhdGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnBhdGggPSBtZXJnZShiYXNlLnBhdGgsIHIucGF0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5wYXRoID0gcmVtb3ZlX2RvdF9zZWdtZW50cyh0LnBhdGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5xdWVyeSA9IHIucXVlcnk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0LmZyYWdtZW50ID0gci5mcmFnbWVudDsKCiAgICAgICAgICAgICAgICByZXR1cm4gdC50b1N0cmluZygpOwoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG1lcmdlKGJhc2VwYXRoLCByZWZwYXRoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2UuaG9zdCAhPT0gdW5kZWZpbmVkICYmICFiYXNlLnBhdGgpIHJldHVybiAiLyIgKyByZWZwYXRoOwoKICAgICAgICAgICAgICAgICAgICB2YXIgbGFzdHNsYXNoID0gYmFzZXBhdGgubGFzdEluZGV4T2YoIi8iKTsKICAgICAgICAgICAgICAgICAgICBpZiAobGFzdHNsYXNoID09PSAtMSkgcmV0dXJuIHJlZnBhdGg7ZWxzZSByZXR1cm4gYmFzZXBhdGguc3Vic3RyaW5nKDAsIGxhc3RzbGFzaCArIDEpICsgcmVmcGF0aDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiByZW1vdmVfZG90X3NlZ21lbnRzKHBhdGgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXBhdGgpIHJldHVybiBwYXRoOyAvLyBGb3IgIiIgb3IgdW5kZWZpbmVkCgogICAgICAgICAgICAgICAgICAgIHZhciBvdXRwdXQgPSAiIjsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAocGF0aC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXRoID09PSAiLiIgfHwgcGF0aCA9PT0gIi4uIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0d29jaGFycyA9IHBhdGguc3Vic3RyaW5nKDAsIDIpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGhyZWVjaGFycyA9IHBhdGguc3Vic3RyaW5nKDAsIDMpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm91cmNoYXJzID0gcGF0aC5zdWJzdHJpbmcoMCwgNCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aHJlZWNoYXJzID09PSAiLi4vIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IHBhdGguc3Vic3RyaW5nKDMpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR3b2NoYXJzID09PSAiLi8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHJpbmcoMik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhyZWVjaGFycyA9PT0gIi8uLyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSAiLyIgKyBwYXRoLnN1YnN0cmluZygzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0d29jaGFycyA9PT0gIi8uIiAmJiBwYXRoLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9ICIvIjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmb3VyY2hhcnMgPT09ICIvLi4vIiB8fCB0aHJlZWNoYXJzID09PSAiLy4uIiAmJiBwYXRoLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9ICIvIiArIHBhdGguc3Vic3RyaW5nKDQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dC5yZXBsYWNlKC9cLz9bXlwvXSokLywgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlZ21lbnQgPSBwYXRoLm1hdGNoKC8oXC8/KFteXC9dKikpLylbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQgKz0gc2VnbWVudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSBwYXRoLnN1YnN0cmluZyhzZWdtZW50Lmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL1VSTERlY29tcG9zaXRpb25BdHRyaWJ1dGVzLmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9VUkxEZWNvbXBvc2l0aW9uQXR0cmlidXRlcy5qcyIKICAgICAgICAvLyBUaGlzIGlzIGFuIGFic3RyYWN0IHN1cGVyY2xhc3MgZm9yIExvY2F0aW9uLCBIVE1MQW5jaG9yRWxlbWVudCBhbmQKICAgICAgICAvLyBvdGhlciB0eXBlcyB0aGF0IGhhdmUgdGhlIHN0YW5kYXJkIGNvbXBsZW1lbnQgb2YgIlVSTCBkZWNvbXBvc2l0aW9uCiAgICAgICAgLy8gSURMIGF0dHJpYnV0ZXMiLgogICAgICAgIC8vIFN1YmNsYXNzZXMgbXVzdCBkZWZpbmUgZ2V0SW5wdXQoKSBhbmQgc2V0T3V0cHV0KCkgbWV0aG9kcy4KICAgICAgICAvLyBUaGUgZ2V0dGVyIGFuZCBzZXR0ZXIgbWV0aG9kcyBwYXJzZSBhbmQgcmVidWlsZCB0aGUgVVJMIG9uIGVhY2gKICAgICAgICAvLyBpbnZvY2F0aW9uOyB0aGVyZSBpcyBubyBhdHRlbXB0IHRvIGNhY2hlIHRoZSB2YWx1ZSBhbmQgYmUgbW9yZSBlZmZpY2llbnQKICAgICAgICBmdW5jdGlvbiBVUkxEZWNvbXBvc2l0aW9uQXR0cmlidXRlcygpIHt9CiAgICAgICAgVVJMRGVjb21wb3NpdGlvbkF0dHJpYnV0ZXMucHJvdG90eXBlID0gewogICAgICAgICAgICBjb25zdHJ1Y3RvcjogVVJMRGVjb21wb3NpdGlvbkF0dHJpYnV0ZXMsCgogICAgICAgICAgICBnZXQgcHJvdG9jb2woKSB7CiAgICAgICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTCh0aGlzLmdldElucHV0KCkpOwogICAgICAgICAgICAgICAgaWYgKHVybC5pc0Fic29sdXRlKCkpIHJldHVybiB1cmwuc2NoZW1lICsgIjoiO2Vsc2UgcmV0dXJuICIiOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZ2V0IGhvc3QoKSB7CiAgICAgICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTCh0aGlzLmdldElucHV0KCkpOwogICAgICAgICAgICAgICAgaWYgKHVybC5pc0Fic29sdXRlKCkgJiYgdXJsLmlzQXV0aG9yaXR5QmFzZWQoKSkgcmV0dXJuIHVybC5ob3N0ICsgKHVybC5wb3J0ID8gIjoiICsgdXJsLnBvcnQgOiAiIik7ZWxzZSByZXR1cm4gIiI7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXQgaG9zdG5hbWUoKSB7CiAgICAgICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTCh0aGlzLmdldElucHV0KCkpOwogICAgICAgICAgICAgICAgaWYgKHVybC5pc0Fic29sdXRlKCkgJiYgdXJsLmlzQXV0aG9yaXR5QmFzZWQoKSkgcmV0dXJuIHVybC5ob3N0O2Vsc2UgcmV0dXJuICIiOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZ2V0IHBvcnQoKSB7CiAgICAgICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTCh0aGlzLmdldElucHV0KCkpOwogICAgICAgICAgICAgICAgaWYgKHVybC5pc0Fic29sdXRlKCkgJiYgdXJsLmlzQXV0aG9yaXR5QmFzZWQoKSAmJiB1cmwucG9ydCAhPT0gdW5kZWZpbmVkKSByZXR1cm4gdXJsLnBvcnQ7ZWxzZSByZXR1cm4gIiI7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXQgcGF0aG5hbWUoKSB7CiAgICAgICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTCh0aGlzLmdldElucHV0KCkpOwogICAgICAgICAgICAgICAgaWYgKHVybC5pc0Fic29sdXRlKCkgJiYgdXJsLmlzSGllcmFyY2hpY2FsKCkpIHJldHVybiB1cmwucGF0aDtlbHNlIHJldHVybiAiIjsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGdldCBzZWFyY2goKSB7CiAgICAgICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTCh0aGlzLmdldElucHV0KCkpOwogICAgICAgICAgICAgICAgaWYgKHVybC5pc0Fic29sdXRlKCkgJiYgdXJsLmlzSGllcmFyY2hpY2FsKCkgJiYgdXJsLnF1ZXJ5ICE9PSB1bmRlZmluZWQpIHJldHVybiAiPyIgKyB1cmwucXVlcnk7ZWxzZSByZXR1cm4gIiI7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXQgaGFzaCgpIHsKICAgICAgICAgICAgICAgIHZhciB1cmwgPSBuZXcgVVJMKHRoaXMuZ2V0SW5wdXQoKSk7CiAgICAgICAgICAgICAgICBpZiAodXJsLmlzQWJzb2x1dGUoKSAmJiB1cmwuZnJhZ21lbnQgIT0gdW5kZWZpbmVkKSByZXR1cm4gIiMiICsgdXJsLmZyYWdtZW50O2Vsc2UgcmV0dXJuICIiOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2V0IHByb3RvY29sKHYpIHsKICAgICAgICAgICAgICAgIHZhciBvdXRwdXQgPSB0aGlzLmdldElucHV0KCk7CiAgICAgICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTChvdXRwdXQpOwogICAgICAgICAgICAgICAgaWYgKHVybC5pc0Fic29sdXRlKCkpIHsKICAgICAgICAgICAgICAgICAgICB2ID0gdi5yZXBsYWNlKC86KyQvLCAiIik7CiAgICAgICAgICAgICAgICAgICAgdiA9IHYucmVwbGFjZSgvW14tK1wuYS16QS16MC05XS9nLCBVUkwucGVyY2VudEVuY29kZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHYubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1cmwuc2NoZW1lID0gdjsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0ID0gdXJsLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5zZXRPdXRwdXQob3V0cHV0KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNldCBob3N0KHYpIHsKICAgICAgICAgICAgICAgIHZhciBvdXRwdXQgPSB0aGlzLmdldElucHV0KCk7CiAgICAgICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTChvdXRwdXQpOwogICAgICAgICAgICAgICAgaWYgKHVybC5pc0Fic29sdXRlKCkgJiYgdXJsLmlzQXV0aG9yaXR5QmFzZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHYgPSB2LnJlcGxhY2UoL1teLStcLl9+ISQmJygpKiw7Oj1hLXpBLXowLTldL2csIFVSTC5wZXJjZW50RW5jb2RlKTsKICAgICAgICAgICAgICAgICAgICBpZiAodi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybC5ob3N0ID0gdjsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHVybC5wb3J0OwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSB1cmwudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnNldE91dHB1dChvdXRwdXQpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2V0IGhvc3RuYW1lKHYpIHsKICAgICAgICAgICAgICAgIHZhciBvdXRwdXQgPSB0aGlzLmdldElucHV0KCk7CiAgICAgICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTChvdXRwdXQpOwogICAgICAgICAgICAgICAgaWYgKHVybC5pc0Fic29sdXRlKCkgJiYgdXJsLmlzQXV0aG9yaXR5QmFzZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHYgPSB2LnJlcGxhY2UoL15cLysvLCAiIik7CiAgICAgICAgICAgICAgICAgICAgdiA9IHYucmVwbGFjZSgvW14tK1wuX34hJCYnKCkqLDs6PWEtekEtejAtOV0vZywgVVJMLnBlcmNlbnRFbmNvZGUpOwogICAgICAgICAgICAgICAgICAgIGlmICh2Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmhvc3QgPSB2OwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSB1cmwudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnNldE91dHB1dChvdXRwdXQpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2V0IHBvcnQodikgewogICAgICAgICAgICAgICAgdmFyIG91dHB1dCA9IHRoaXMuZ2V0SW5wdXQoKTsKICAgICAgICAgICAgICAgIHZhciB1cmwgPSBuZXcgVVJMKG91dHB1dCk7CiAgICAgICAgICAgICAgICBpZiAodXJsLmlzQWJzb2x1dGUoKSAmJiB1cmwuaXNBdXRob3JpdHlCYXNlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgdiA9IHYucmVwbGFjZSgvW14wLTldLiokLywgIiIpOwogICAgICAgICAgICAgICAgICAgIHYgPSB2LnJlcGxhY2UoL14wKy8sICIiKTsKICAgICAgICAgICAgICAgICAgICBpZiAodi5sZW5ndGggPT09IDApIHYgPSAiMCI7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHYsIDEwKSA8PSA2NTUzNSkgewogICAgICAgICAgICAgICAgICAgICAgICB1cmwucG9ydCA9IHY7CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IHVybC50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuc2V0T3V0cHV0KG91dHB1dCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZXQgcGF0aG5hbWUodikgewogICAgICAgICAgICAgICAgdmFyIG91dHB1dCA9IHRoaXMuZ2V0SW5wdXQoKTsKICAgICAgICAgICAgICAgIHZhciB1cmwgPSBuZXcgVVJMKG91dHB1dCk7CiAgICAgICAgICAgICAgICBpZiAodXJsLmlzQWJzb2x1dGUoKSAmJiB1cmwuaXNIaWVyYXJjaGljYWwoKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh2LmNoYXJBdCgwKSAhPT0gIi8iKSB2ID0gIi8iICsgdjsKICAgICAgICAgICAgICAgICAgICB2ID0gdi5yZXBsYWNlKC9bXi0rXC5ffiEkJicoKSosOzo9QFwvYS16QS16MC05XS9nLCBVUkwucGVyY2VudEVuY29kZSk7CiAgICAgICAgICAgICAgICAgICAgdXJsLnBhdGggPSB2OwogICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IHVybC50b1N0cmluZygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5zZXRPdXRwdXQob3V0cHV0KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNldCBzZWFyY2godikgewogICAgICAgICAgICAgICAgdmFyIG91dHB1dCA9IHRoaXMuZ2V0SW5wdXQoKTsKICAgICAgICAgICAgICAgIHZhciB1cmwgPSBuZXcgVVJMKG91dHB1dCk7CiAgICAgICAgICAgICAgICBpZiAodXJsLmlzQWJzb2x1dGUoKSAmJiB1cmwuaXNIaWVyYXJjaGljYWwoKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh2LmNoYXJBdCgwKSAhPT0gIj8iKSB2ID0gdi5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgICAgICAgICAgdiA9IHYucmVwbGFjZSgvW14tK1wuX34hJCYnKCkqLDs6PUBcLz9hLXpBLXowLTldL2csIFVSTC5wZXJjZW50RW5jb2RlKTsKICAgICAgICAgICAgICAgICAgICB1cmwucXVlcnkgPSB2OwogICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IHVybC50b1N0cmluZygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5zZXRPdXRwdXQob3V0cHV0KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNldCBoYXNoKHYpIHsKICAgICAgICAgICAgICAgIHZhciBvdXRwdXQgPSB0aGlzLmdldElucHV0KCk7CiAgICAgICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTChvdXRwdXQpOwogICAgICAgICAgICAgICAgaWYgKHVybC5pc0Fic29sdXRlKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodi5jaGFyQXQoMCkgIT09ICIjIikgdiA9IHYuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICAgICAgICAgIHYgPSB2LnJlcGxhY2UoL1teLStcLl9+ISQmJygpKiw7Oj1AXC8/YS16QS16MC05XS9nLCBVUkwucGVyY2VudEVuY29kZSk7CiAgICAgICAgICAgICAgICAgICAgdXJsLmZyYWdtZW50ID0gdjsKICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSB1cmwudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuc2V0T3V0cHV0KG91dHB1dCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL0xvY2F0aW9uLmpzCiAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLy9AbGluZSAxICJzcmMvaW1wbC9Mb2NhdGlvbi5qcyIKICAgICAgICBmdW5jdGlvbiBMb2NhdGlvbih3aW5kb3csIGhyZWYpIHsKICAgICAgICAgICAgdGhpcy5fd2luZG93ID0gd2luZG93OwogICAgICAgICAgICB0aGlzLl9ocmVmID0gaHJlZjsKICAgICAgICB9CgogICAgICAgIExvY2F0aW9uLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoVVJMRGVjb21wb3NpdGlvbkF0dHJpYnV0ZXMucHJvdG90eXBlLCB7CiAgICAgICAgICAgIF9pZGxOYW1lOiBjb25zdGFudCgiTG9jYXRpb24iKSwKICAgICAgICAgICAgY29uc3RydWN0b3I6IGNvbnN0YW50KExvY2F0aW9uKSwKICAgICAgICAgICAgLy8gVGhlIGNvbmNyZXRlIG1ldGhvZHMgdGhhdCB0aGUgc3VwZXJjbGFzcyBuZWVkcwogICAgICAgICAgICBnZXRJbnB1dDogY29uc3RhbnQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHJlZjsKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHNldE91dHB1dDogY29uc3RhbnQoZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgIHRoaXMuaHJlZiA9IHY7CiAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgLy8gU3BlY2lhbCBiZWhhdmlvciB3aGVuIGhyZWYgaXMgc2V0CiAgICAgICAgICAgIGhyZWY6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faHJlZjsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgIHRoaXMuYXNzaWduKHYpOwogICAgICAgICAgICB9KSwKCiAgICAgICAgICAgIGFzc2lnbjogY29uc3RhbnQoZnVuY3Rpb24gKHVybCkgewogICAgICAgICAgICAgICAgLy8gUmVzb2x2ZSB0aGUgbmV3IHVybCBhZ2FpbnN0IHRoZSBjdXJyZW50IG9uZQogICAgICAgICAgICAgICAgLy8gWFhYOgogICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBub3QgYWN0dWFsbHkgY29ycmVjdC4gSXQgc2hvdWxkIGJlIHJlc29sdmVkIGFnYWluc3QKICAgICAgICAgICAgICAgIC8vIHRoZSBVUkwgb2YgdGhlIGRvY3VtZW50IG9mIHRoZSBzY3JpcHQuIEZvciBub3csIHRob3VnaCwgSSBvbmx5CiAgICAgICAgICAgICAgICAvLyBzdXBwb3J0IGEgc2luZ2xlIHdpbmRvdyBhbmQgdGhlcmUgaXMgb25seSBvbmUgYmFzZSB1cmwuCiAgICAgICAgICAgICAgICAvLyBTbyB0aGlzIGlzIGdvb2QgZW5vdWdoIGZvciBub3cuCiAgICAgICAgICAgICAgICB2YXIgY3VycmVudCA9IG5ldyBVUkwodGhpcy5faHJlZik7CiAgICAgICAgICAgICAgICB2YXIgbmV3dXJsID0gY3VycmVudC5yZXNvbHZlKHVybCk7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7IC8vIGZvciB0aGUgWEhSIGNhbGxiYWNrIGJlbG93CgogICAgICAgICAgICAgICAgLy8gU2F2ZSB0aGUgbmV3IHVybAogICAgICAgICAgICAgICAgdGhpcy5faHJlZiA9IG5ld3VybDsKCiAgICAgICAgICAgICAgICAvLyBTdGFydCBsb2FkaW5nIHRoZSBuZXcgZG9jdW1lbnQhCiAgICAgICAgICAgICAgICAvLyBYWFgKICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMganVzdCBzb21ldGhpbmcgaGFja2VkIHRvZ2V0aGVyLgogICAgICAgICAgICAgICAgLy8gVGhlIHJlYWwgYWxnb3JpdGhtIGlzOiBodHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrL211bHRpcGFnZS9oaXN0b3J5Lmh0bWwjbmF2aWdhdGUKICAgICAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCiAgICAgICAgICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBvbGRkb2MgPSBzZWxmLl93aW5kb3cuZG9jdW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBIVE1MUGFyc2VyKG5ld3VybCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld2RvYyA9IHVud3JhcChwYXJzZXIuZG9jdW1lbnQoKSk7CiAgICAgICAgICAgICAgICAgICAgbmV3ZG9jLm11dGF0aW9uSGFuZGxlciA9IG9sZGRvYy5tdXRhdGlvbkhhbmRsZXI7CgogICAgICAgICAgICAgICAgICAgIC8vIEdldCByaWQgb2YgYW55IGN1cnJlbnQgY29udGVudCBpbiB0aGUgb2xkIGRvYwogICAgICAgICAgICAgICAgICAgIC8vIFhYWAogICAgICAgICAgICAgICAgICAgIC8vIFNob3VsZCB3ZSBoYXZlIGEgc3BlY2lhbCBtdXRhdGlvbiBldmVudCB0aGF0IG1lYW5zCiAgICAgICAgICAgICAgICAgICAgLy8gZGlzY2FyZCB0aGUgZW50aXJlIGRvY3VtZW50IGJlY2F1c2Ugd2UncmUgbG9hZGluZyBhIG5ldyBvbmU/CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG9sZGRvYy5oYXNDaGlsZE5vZGVzKCkpIG9sZGRvYy5yZW1vdmVDaGlsZChvbGRkb2MuZmlyc3RDaGlsZCk7CgogICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgdGhlIG5ldyBkb2N1bWVudCB0aGUgY3VycmVudCBkb2N1bWVudCBpbiB0aGUgd2luZG93CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fd2luZG93LmRvY3VtZW50ID0gbmV3ZG9jOwogICAgICAgICAgICAgICAgICAgIG5ld2RvYy5kZWZhdWx0VmlldyA9IHNlbGYuX3dpbmRvdzsKCiAgICAgICAgICAgICAgICAgICAgLy8gQW5kIHBhcnNlIHRoZSBuZXcgZmlsZQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5wYXJzZSh4aHIucmVzcG9uc2VUZXh0LCB0cnVlKTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgeGhyLm9wZW4oIkdFVCIsIG5ld3VybCk7CiAgICAgICAgICAgICAgICB4aHIuc2VuZCgpOwogICAgICAgICAgICB9KSwKCiAgICAgICAgICAgIHJlcGxhY2U6IGNvbnN0YW50KGZ1bmN0aW9uICh1cmwpIHsKICAgICAgICAgICAgICAgIC8vIFhYWAogICAgICAgICAgICAgICAgLy8gU2luY2Ugd2UgYXJlbid0IHRyYWNraW5nIGhpc3RvcnkgeWV0LCByZXBsYWNlIGlzIHRoZSBzYW1lIGFzIGFzc2lnbgogICAgICAgICAgICAgICAgdGhpcy5hc3NpZ24odXJsKTsKICAgICAgICAgICAgfSksCgogICAgICAgICAgICByZWxvYWQ6IGNvbnN0YW50KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8vIFhYWDoKICAgICAgICAgICAgICAgIC8vIEFjdHVhbGx5LCB0aGUgc3BlYyBpcyBhIGxvdCBtb3JlIGNvbXBsaWNhdGVkIHRoYW4gdGhpcwogICAgICAgICAgICAgICAgdGhpcy5hc3NpZ24odGhpcy5ocmVmKTsKICAgICAgICAgICAgfSksCgogICAgICAgICAgICAvLyBYWFg6IERvZXMgV2ViSURMIGFsbG93IHRoZSB3cmFwcGVyIGNsYXNzIHRvIGhhdmUgaXRzIG93biB0b1N0cmluZwogICAgICAgICAgICAvLyBtZXRob2Q/IE9yIGRvIEkgaGF2ZSB0byBjcmVhdGUgYSBwcm94eSBqdXN0IHRvIGZha2Ugb3V0IHRoZSBzdHJpbmcKICAgICAgICAgICAgLy8gY29udmVyc2lvbj8KICAgICAgICAgICAgLy8gSW4gRkYsIGRvY3VtZW50LmxvY2F0aW9uLl9fcHJvdG9fXy5oYXNPd25Qcm9wZXJ0eSgidG9TdHJpbmciKSBpcyB0cnVlCiAgICAgICAgICAgIHRvU3RyaW5nOiBjb25zdGFudChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ocmVmOwogICAgICAgICAgICB9KQogICAgICAgIH0pOwoKICAgICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICogIHNyYy9pbXBsL1dpbmRvdy5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL2ltcGwvV2luZG93LmpzIgogICAgICAgIC8vIFRoaXMgaXMgYSBzaW1wbGUgY29uc3RydWN0b3IgZm9yIGEgc2ltcGxlIFdpbmRvdyBpbXBsZW1lbnRhdGlvbgogICAgICAgIC8vIFdlJ2xsIHNldCB0aGluZ3MgdXAgKGluIHNyYy9tYWluLmpzIGZvciBub3cpIHNvIHRoYXQgaXQgdW53cmFwcwogICAgICAgIC8vIHRvIHRoZSBnbG9iYWwgb2JqZWN0CiAgICAgICAgZnVuY3Rpb24gV2luZG93KCkgewogICAgICAgICAgICB0aGlzLmRvY3VtZW50ID0gbmV3IGltcGwuRE9NSW1wbGVtZW50YXRpb24oKS5jcmVhdGVIVE1MRG9jdW1lbnQoIiIpOwogICAgICAgICAgICB0aGlzLmRvY3VtZW50Ll9zY3JpcHRpbmdfZW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnQuZGVmYXVsdFZpZXcgPSB0aGlzOwogICAgICAgICAgICB0aGlzLmxvY2F0aW9uID0gbmV3IExvY2F0aW9uKHRoaXMsIGdsb2JhbC5faG9sYV9sb2NhdGlvbnx8ImFib3V0OmJsYW5rIik7CiAgICAgICAgfQoKICAgICAgICBXaW5kb3cucHJvdG90eXBlID0gTy5jcmVhdGUoaW1wbC5FdmVudFRhcmdldC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgX2lkbE5hbWU6IGNvbnN0YW50KCJXaW5kb3ciKSwKCiAgICAgICAgICAgIGhpc3Rvcnk6IGNvbnN0YW50KHsKICAgICAgICAgICAgICAgIGJhY2s6IG55aSwKICAgICAgICAgICAgICAgIGZvcndhcmQ6IG55aSwKICAgICAgICAgICAgICAgIGdvOiBueWksCiAgICAgICAgICAgICAgICBfaWRsTmFtZTogIkhpc3RvcnkiCiAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgbmF2aWdhdG9yOiBjb25zdGFudCh7CiAgICAgICAgICAgICAgICBhcHBOYW1lOiAiZG9tLmpzIiwKICAgICAgICAgICAgICAgIGFwcFZlcnNpb246ICIwLjEiLAogICAgICAgICAgICAgICAgcGxhdGZvcm06ICJpb3MiLAogICAgICAgICAgICAgICAgdXNlckFnZW50OiAiSG9sYUNETiBpT1MiLAogICAgICAgICAgICAgICAgX2lkbE5hbWU6ICJOYXZpZ2F0b3IiCiAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgLy8gU2VsZi1yZWZlcmVudGlhbCBwcm9wZXJ0aWVzCiAgICAgICAgICAgIHdpbmRvdzogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9KSwKICAgICAgICAgICAgc2VsZjogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9KSwKICAgICAgICAgICAgZnJhbWVzOiBhdHRyaWJ1dGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0pLAoKICAgICAgICAgICAgLy8gU2VsZi1yZWZlcmVudGlhbCBwcm9wZXJ0aWVzIGZvciBhIHRvcC1sZXZlbCB3aW5kb3cKICAgICAgICAgICAgcGFyZW50OiBhdHRyaWJ1dGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICB0b3A6IGF0dHJpYnV0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSksCgogICAgICAgICAgICAvLyBXZSBkb24ndCBzdXBwb3J0IGFueSBvdGhlciB3aW5kb3dzIGZvciBub3cKICAgICAgICAgICAgbGVuZ3RoOiBjb25zdGFudCgwKSwgLy8gbm8gZnJhbWVzCiAgICAgICAgICAgIGZyYW1lRWxlbWVudDogY29uc3RhbnQobnVsbCksIC8vIG5vdCBwYXJ0IG9mIGEgZnJhbWUKICAgICAgICAgICAgb3BlbmVyOiBjb25zdGFudChudWxsKSwgLy8gbm90IG9wZW5lZCBieSBhbm90aGVyIHdpbmRvdwoKICAgICAgICAgICAgLy8gVGhlIG9ubG9hZCBldmVudCBoYW5kbGVyLgogICAgICAgICAgICAvLyBYWFg6IG5lZWQgdG8gc3VwcG9ydCBhIGJ1bmNoIG9mIG90aGVyIGV2ZW50IHR5cGVzLCB0b28sCiAgICAgICAgICAgIC8vIGFuZCBoYXZlIHRoZW0gaW50ZXJvcGVyYXRlIHdpdGggZG9jdW1lbnQuYm9keS4KCiAgICAgICAgICAgIG9ubG9hZDogYXR0cmlidXRlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRFdmVudEhhbmRsZXIoImxvYWQiKTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3NldEV2ZW50SGFuZGxlcigibG9hZCIsIHYpOwogICAgICAgICAgICB9KQoKICAgICAgICB9KTsKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgICAqICBzcmMvbWFpbi5qcwogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgICAgIC8vQGxpbmUgMSAic3JjL21haW4uanMiCiAgICAgICAgLyoKICAgICAgICAvLyBUaGUgZG9jdW1lbnQgb2JqZWN0IGlzIHRoZSBlbnRyeSBwb2ludCB0byB0aGUgZW50aXJlIERPTQogICAgICAgIGRlZmluZUxhenlQcm9wZXJ0eShnbG9iYWwsICJkb2N1bWVudCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgZG9jID0gbmV3IGltcGwuRE9NSW1wbGVtZW50YXRpb24oKS5jcmVhdGVIVE1MRG9jdW1lbnQoIiIpOwogICAgICAgICAgICBkb2MuX3NjcmlwdGluZ19lbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIHdyYXAoZG9jKTsKICAgICAgICB9KTsKICAgICAgICAqLwoKICAgICAgICAvLyBDcmVhdGUgYSB3aW5kb3cgaW1wbGVtZW50YXRpb24gb2JqZWN0CiAgICAgICAgdmFyIHcgPSBuZXcgV2luZG93KCk7IC8vIFNlZSBzcmMvaW1wbC9XaW5kb3cuanMKCiAgICAgICAgLy8gQXJyYW5nZSB0byBoYXZlIGl0IHdyYXAgdG8gdGhlIGdsb2JhbCBvYmplY3QKICAgICAgICAvLyBBbmQgaGF2ZSB0aGUgZ2xvYmFsIG9iamVjdCB1bndyYXAgdG8gdwogICAgICAgIHcuX2lkbCA9IGdsb2JhbDsKICAgICAgICB3bXNldChpZGxUb0ltcGxNYXAsIGdsb2JhbCwgdyk7CgogICAgICAgIC8vIE5vdyBkZWZpbmUgd2luZG93IHByb3BlcnRpZXMgdGhhdCBkbyB0aGUgcmlnaHQgdGhpbmcKICAgICAgICAvLyBGb3Igb3RoZXIgd3JhcHBlciB0eXBlcyB0aGlzIGlzIGF1dG9tYXRlZCBieSB0b29scy9pZGwyZG9tanMKICAgICAgICAvLyBidXQgdGhlIHdpbmRvdyBvYmplY3QgaXMgYSBzcGVjaWFsIGNhc2UuCgoKICAgICAgICAvLyBhbGV4ZXltOiBoYXJkLWNvZGUgJ2dsb2JhbCcgaW5zdGVhZCBvZiAndGhpcycgaW5zb2RlIGdldHRlcnMgYW5kIHNldHRlcnMKICAgICAgICBbIndpbmRvdyIsICJzZWxmIiwgImZyYW1lcyIsICJwYXJlbnQiLCAidG9wIiwgIm9wZW5lciIsICJkb2N1bWVudCIsICJoaXN0b3J5IiwgIm5hdmlnYXRvciJdLmZvckVhY2goZnVuY3Rpb24gKHByb3BlcnR5KSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShnbG9iYWwsIHByb3BlcnR5LCB7CiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd3JhcCh1bndyYXAoZ2xvYmFsKVtwcm9wZXJ0eV0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlIH0pOwogICAgICAgIH0pOwoKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZ2xvYmFsLCAibG9jYXRpb24iLCB7CiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHdyYXAodW53cmFwKGdsb2JhbCkubG9jYXRpb24pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2KSB7CiAgICAgICAgICAgICAgICB1bndyYXAoZ2xvYmFsKS5sb2NhdGlvbi5ocmVmID0gdjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9KTsKCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGdsb2JhbCwgIm9ubG9hZCIsIHsKICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKGdsb2JhbCkub25sb2FkOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2KSB7CiAgICAgICAgICAgICAgICB1bndyYXAoZ2xvYmFsKS5vbmxvYWQgPSB0b0NhbGxiYWNrT3JOdWxsKHYpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9KTsKCiAgICAgICAgZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyLCBjYXB0dXJlKSB7CiAgICAgICAgICAgIHVud3JhcCh0aGlzKS5hZGRFdmVudExpc3RlbmVyKFN0cmluZyh0eXBlKSwgdG9DYWxsYmFja09yTnVsbChsaXN0ZW5lciksIE9wdGlvbmFsQm9vbGVhbihjYXB0dXJlKSk7CiAgICAgICAgfTsKCiAgICAgICAgZ2xvYmFsLnBvc3RNZXNzYWdlID0gZnVuY3Rpb24gcG9zdE1lc3NhZ2UoZGF0YSkgewogICAgICAgICAgICB1bndyYXAodGhpcykucG9zdE1lc3NhZ2UoZGF0YSk7CiAgICAgICAgfTsKCiAgICAgICAgZ2xvYmFsLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyLCBjYXB0dXJlKSB7CiAgICAgICAgICAgIHVud3JhcCh0aGlzKS5yZW1vdmVFdmVudExpc3RlbmVyKFN0cmluZyh0eXBlKSwgdG9DYWxsYmFja09yTnVsbChsaXN0ZW5lciksIE9wdGlvbmFsQm9vbGVhbihjYXB0dXJlKSk7CiAgICAgICAgfTsKCiAgICAgICAgLy8gWFhYCiAgICAgICAgLy8gVGhpcyBpcyBhIGNvbXBsZXRlbHkgYnJva2VuIGltcGxlbWVudGF0aW9uIHB1dCBoZXJlIGp1c3QgdG8gc2VlIGlmIHdlCiAgICAgICAgLy8gY2FuIGdldCBqUXVlcnkgYW5pbWF0aW9ucyB0byB3b3JrCiAgICAgICAgLy8KICAgICAgICBnbG9iYWwuZ2V0Q29tcHV0ZWRTdHlsZSA9IGZ1bmN0aW9uIGdldENvbXB1dGVkU3R5bGUoZWx0KSB7CiAgICAgICAgICAgIHJldHVybiBlbHQuc3R5bGU7CiAgICAgICAgfTsKICAgIH0pKGdsb2JhbCk7Cn0pKHRoaXMpOwoKd2luZG93LmxvY2FsU3RvcmFnZSA9IHsKICAgIF9kYXRhICAgICAgIDoge30sCiAgICBzZXRJdGVtICAgICA6IGZ1bmN0aW9uKGlkLCB2YWwpIHsgcmV0dXJuIHRoaXMuX2RhdGFbaWRdID0gU3RyaW5nKHZhbCk7IH0sCiAgICBnZXRJdGVtICAgICA6IGZ1bmN0aW9uKGlkKSB7IHJldHVybiB0aGlzLl9kYXRhLmhhc093blByb3BlcnR5KGlkKSA/IHRoaXMuX2RhdGFbaWRdIDogbnVsbDsgfSwKICAgIHJlbW92ZUl0ZW0gIDogZnVuY3Rpb24oaWQpIHsgcmV0dXJuIGRlbGV0ZSB0aGlzLl9kYXRhW2lkXTsgfSwKICAgIGNsZWFyICAgICAgIDogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLl9kYXRhID0ge307IH0KfTsKCg==";
